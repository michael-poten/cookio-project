import{I as Re,C as ee,R as w,a as O}from"./CS2M1cia.js";import{L as ie,_ as De,M as Ce,N as te,O as Pe,J as $e,P as xe,K as de,r as $,o as re,k as H,g as _,x as v,y as o,z as i,B as u,Q as c,R as l,C as s,D as m,S as ne,T as oe,A as y,U as T,V as ae}from"./CLJmnhjq.js";import"./DA__SF9z.js";import{R as Se}from"./DKQYMiBg.js";function le(x){return x?ie(x).format("DD.MM."):"-"}function se(x){return x?ie(x).format("DD.MM.YYYY"):"-"}const ze={class:"text-center"},Te={class:"text-center"},Ae={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ee={class:"mx-auto"},Me={style:{"background-color":"rgba(93,93,93,0.66)"}},Ve={key:0,class:"px-1 pb-1"},Ue={key:1,class:"pa-1 text-white",style:{"font-size":"0.8em"}},Ne={class:"text-white"},Oe={key:0,class:"px-1"},He={class:"ma-2"},Be=["onClick"],Fe={style:{width:"100%"}},Le={style:{width:"100%"},class:"text-right mt-2"},Ye={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ze={class:"overlay-bottom-right"},Ge={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},Ke={style:{"font-size":"1.1em"},class:"px-1"},je=["href"],Je={key:1,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Qe={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},We={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},qe={key:2},Xe={key:3},et={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},tt={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},nt={key:2},ot={key:3},at={key:4},lt={class:"ma-2"},st={class:"ma-2"},it={class:"ma-2"},dt={class:"overlay-bottom-right"},rt={style:{color:"#ffffff","background-color":"rgba(93,93,93,0.66)","font-size":"0.8em"},class:"pa-1"},ut={style:{color:"#ffffff","background-color":"rgba(93,93,93,0.66)","font-size":"1.4em"},class:"pa-1"},ct={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},ft={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},vt={key:0},gt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},mt={key:2},kt={key:3},_t={class:"ma-2"},yt={__name:"MealPlanner",setup(x){const M=Ce(),{recipes:C}=te(M);Pe(),$e(),xe();const S=de(),{authInfo:k,githubMode:V,lanAddress:ue}=te(S);$("");const B=$({}),F=new Intl.DateTimeFormat("de-DE",{weekday:"long"}),I=$({}),U=$(null),L=$(null),Y=$(null),Z=$(null),A=$([]);re(async()=>{await p()});const G=H(()=>R.value.filter(n=>!n.ordered)),z=H(()=>C.value?(C.value=C.value.sort((n,e)=>{const a=n.rating,d=e.rating,r=typeof a=="number"&&a!==null,f=typeof d=="number"&&d!==null;return!r&&!f?0:r?f?d-a:-1:1}),C.value.filter(n=>!!n.voting)):[]),R=H(()=>{let n=[];return C.value.filter(e=>!!e.planned).forEach(e=>{n.push(e)}),A.value.forEach(e=>n.push(e)),n=n.sort((e,a)=>{const d=e.plannedInDays,r=a.plannedInDays;return d===null&&r===null?0:d===null?1:r===null?-1:d-r}),n});function ce(n){if(n==="OTHER")return"Sonstiges";if(n==="SCHEDULED")return"AuswÃ¤rts / Lieferung / Verzehrfertig"}function K(n){return n?V.value?"https://mmhhhh.de/data/home/recipes/"+n+"/image.jpg":ue.value+"api/"+k.value.userId+"/recipes/"+n+"/image":""}async function N(n){V.value?window.open("https://mmhhhh.de/recipes/go?id="+n.id,"_blank","noopener"):window.open("/recipes/go?id="+n.id,"_blank","noopener")}async function fe(n){const e={planned:!0,voting:0};await w.updateRecipe(k.value.userId,n,e),await p(),w.uploadRecipeToGithub(k.value.userId,null)}async function ve(){L.value().then(async n=>{if(n){let e=z.value;for(const a of e){const d={voting:0};await w.updateRecipe(k.value.userId,a.id,d)}await p()}})}async function ge(n){const e={voting:0};await w.updateRecipe(k.value.userId,n,e),await p()}async function me(){Y.value().then(async n=>{if(n){let e=R.value;for(const a of e){const d={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await w.updateRecipe(k.value.userId,a.id,d)}await p(),w.uploadRecipeToGithub(k.value.userId,null)}})}async function ke(){const n=R.value.filter(e=>!e.ordered).map(e=>e.id);n&&n.length>0&&U.value(n).then(e=>{p()})}async function j(n){const e=n.id,a={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await w.updateRecipe(k.value.userId,e,a),await p(),w.uploadRecipeToGithub(k.value.userId,null);let d=k.value.calendarPlan;if(d||(d={}),n.cooked){const r=new Date;for(const f of Object.keys(d))d[f]&&d[f].recipeId===e&&(new Date(f).getTime()<=r.getTime()?d[f].cooked=!0:d[f].cooked||delete d[f])}else for(const r of Object.keys(d))d[r]&&d[r].recipeId===e&&!d[r].cooked&&delete d[r];await O.saveCalendarPlan(k.value.userId,d)}async function _e(n){const e=n.id,a={planned:!0,voting:0,cooked:!1,ordered:!1,preparations:[]};await w.updateRecipe(k.value.userId,e,a),await p(),w.uploadRecipeToGithub(k.value.userId,null)}async function p(){C.value=await M.getAllRecipes(k.value.userId);let e=(await S.getAuthInfo()).calendarPlan;e||(e={}),I.value={};for(const a of Object.keys(e))e[a]&&e[a].type==="RECIPE"&&e[a].recipeId&&(I.value[e[a].recipeId]=new Date(a));C.value.forEach(a=>{const d=I.value[a.id];if(d){const r=new Date(d).getTime()-new Date().getTime();a.plannedInDays=Math.floor(r/(1e3*60*60*24))}else a.plannedInDays=null}),await be()}function J(n){U.value(n).then(e=>{p()})}function ye(n){Z.value(n)}async function he(n){let a=(await S.getAuthInfo()).calendarPlan;const d=n.date.getFullYear(),r=String(n.date.getMonth()+1).padStart(2,"0"),f=String(n.date.getDate()).padStart(2,"0");delete a[`${d}-${r}-${f}`],await O.saveCalendarPlan(k.value.userId,a),await S.refreshPlannendUntil(),await p()}async function pe(n){let a=(await S.getAuthInfo()).calendarPlan;const d=n.date.getFullYear(),r=String(n.date.getMonth()+1).padStart(2,"0"),f=String(n.date.getDate()).padStart(2,"0");a[`${d}-${r}-${f}`].cooked=!0,await O.saveCalendarPlan(k.value.userId,a),await S.refreshPlannendUntil(),await p()}async function be(){A.value=[];let n=await S.getAuthInfo();if(n){let e=n.calendarPlan;if(e||(e={}),e){const a=new Date;a.setHours(0,0,0,0),new Date().setHours(23,59,59,0);for(let r=0;r<14;r++){const f=new Date;if(f.setDate(f.getDate()+r),f.getTime()>a.getTime()){const D=f.getFullYear(),b=String(f.getMonth()+1).padStart(2,"0"),h=String(f.getDate()).padStart(2,"0");if(e[`${D}-${b}-${h}`]&&e[`${D}-${b}-${h}`].type&&e[`${D}-${b}-${h}`].type!=="RECIPE"&&!e[`${D}-${b}-${h}`].cooked){const P=new Date(f).getTime()-new Date().getTime(),E=Math.floor(P/(1e3*60*60*24));A.value.push({date:f,plannedInDays:E,title:e[`${D}-${b}-${h}`].recipeTitle,type:e[`${D}-${b}-${h}`].type,cooked:e[`${D}-${b}-${h}`].cooked})}}}}}console.log(A.value)}return(n,e)=>{const a=_("v-btn"),d=_("v-rating"),r=_("v-icon"),f=_("v-carousel-item"),D=_("v-carousel"),b=_("v-divider"),h=_("v-list-item-title"),P=_("v-list-item"),E=_("v-list"),Q=_("v-menu"),W=_("v-toolbar"),q=_("v-img"),X=_("v-card"),we=_("v-col"),Ie=_("v-row");return o(),v("div",null,[i("div",ze,[e[11]||(e[11]=i("h2",{class:"mt-6 text-center"},"VorschlÃ¤ge",-1)),z.value&&z.value.length>0?(o(),c(a,{key:0,variant:"plain",class:"text-center",onClick:ve},{default:s(()=>[...e[4]||(e[4]=[m("Alle Likes entfernen",-1)])]),_:1})):l("",!0),i("div",Te,[z.value.length===0?(o(),v("div",Ae,[...e[5]||(e[5]=[i("div",{style:{"font-size":"1.2em"}},"Keine VorschlÃ¤ge vorhanden!",-1)])])):l("",!0),z.value.length>0?(o(),c(D,{key:1,"hide-delimiter-background":"","hide-delimiters":z.value.length===1},{default:s(()=>[(o(!0),v(ne,null,oe(z.value,t=>(o(),c(f,{cover:"",src:K(t?t.id:null),key:t.id},{default:s(()=>[i("div",Ee,[i("div",Me,[t.rating?(o(),v("div",Ve,[u(d,{modelValue:t.rating,"onUpdate:modelValue":g=>t.rating=g,hover:"",length:"5",size:"20",readonly:"",color:"white"},null,8,["modelValue","onUpdate:modelValue"])])):l("",!0),!t.ingredientsInProgress&&!t.sectionsInProgress&&!t.imageInProgress&&!t.sectionsUploaded?(o(),v("div",Ue,[i("span",null,[u(r,{icon:"mdi-information-slab-circle"}),e[6]||(e[6]=m()),e[7]||(e[7]=i("b",null,"Nur Zutatenliste vorhanden!",-1))])])):l("",!0),i("div",Ne,[t.duration?(o(),v("span",Oe,[i("b",null,y(t.duration)+" Min.",1),e[8]||(e[8]=m(" | ",-1))])):l("",!0),i("span",null,[i("b",null,y(t.voting)+" x ðŸ‘",1)])])]),i("div",He,[i("span",{onClick:g=>N(t),style:{cursor:"pointer","text-decoration-line":"none","font-weight":"700","font-size":"2.04em",color:"#ffffff !important","background-color":"rgba(93,93,93,0.66)",hyphens:"auto","overflow-wrap":"break-word"},class:"text-medium-emphasis"},y(t.title),9,Be)]),i("div",null,[u(a,{onClick:g=>fe(t.id),variant:"flat",color:"rgba(198, 217, 238, 0.7)",height:"50"},{default:s(()=>[...e[9]||(e[9]=[m("Rezept einplanen",-1)])]),_:1},8,["onClick"])]),i("div",null,[u(a,{onClick:g=>ge(t.id),variant:"flat",color:"rgb(238 198 198 / 70%)",class:"mt-1"},{default:s(()=>[...e[10]||(e[10]=[m("Ignorieren",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["src"]))),128))]),_:1},8,["hide-delimiters"])):l("",!0)])]),u(b,{class:"mt-4"}),i("div",Fe,[e[26]||(e[26]=i("h2",{class:"mt-6 text-center"},"AusgewÃ¤hlt",-1)),i("div",Le,[R.value&&R.value.length>0?(o(),c(a,{key:0,variant:"outlined",onClick:ke,disabled:!G.value||G.value.length===0},{default:s(()=>[...e[12]||(e[12]=[m("Alle Zutaten einkaufen",-1)])]),_:1},8,["disabled"])):l("",!0),R.value&&R.value.length>0?(o(),c(a,{key:1,variant:"outlined",class:"ml-2",color:"red",onClick:me},{default:s(()=>[...e[13]||(e[13]=[m("Alle entfernen",-1)])]),_:1})):l("",!0)]),u(Ie,{class:"text-center mt-2",id:"recipesDiv"},{default:s(()=>[R.value.length===0?(o(),v("div",Ye,[...e[14]||(e[14]=[i("div",{style:{"font-size":"1.2em"}},"Keine geplanten Rezepte gefunden!",-1)])])):l("",!0),(o(!0),v(ne,null,oe(R.value,t=>(o(),c(we,{cols:"12",sm:"12",md:"6",lg:"4",xl:"3",key:t.id},{default:s(()=>[t.type!=="SCHEDULED"&&t.type!=="OTHER"?(o(),c(X,{key:0,class:"mx-auto","max-width":"374"},{default:s(()=>[(o(),c(q,{class:"position-relative",height:"200",src:K(t?t.id:null),key:B.value[t.id]?B.value[t.id]:0,color:"grey",cover:""},{default:s(()=>[i("div",Ze,[t.duration?(o(),v("div",Ge,[i("b",null,y(t.duration)+" Min.",1)])):l("",!0),i("div",Ke,[!t.ingredientsInProgress&&!t.sectionsInProgress&&t.sectionsUploaded?(o(),v("a",{key:0,target:"_blank",href:"/recipes/go?id="+t.id,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},y(t.title),9,je)):l("",!0),!t.ingredientsInProgress&&!t.sectionsInProgress&&!t.sectionsUploaded?(o(),v("span",Je,y(t.title),1)):l("",!0)])]),i("div",Qe,[i("div",We,[I.value[t.id]?(o(),c(r,{key:0,icon:"mdi-check-bold"})):l("",!0),I.value[t.id]?l("",!0):(o(),c(r,{key:1,icon:"mdi-close-thick",color:"red"})),I.value[t.id]?(o(),v("b",qe,"Geplant "+y(T(F).format(I.value[t.id]))+", "+y(T(le)(I.value[t.id]))+" (in "+y(t.plannedInDays)+" Tagen)",1)):l("",!0),I.value[t.id]?l("",!0):(o(),v("b",Xe,"Kein Datum festgelegt"))]),i("div",et,[t.ordered?(o(),c(r,{key:0,icon:"mdi-check-bold"})):l("",!0),t.ordered?l("",!0):(o(),c(r,{key:1,icon:"mdi-close-thick",color:"red"})),e[15]||(e[15]=i("b",null,"Zutaten bestellt",-1))]),t.sectionsUploaded&&!t.sectionsInProgress?(o(),v("div",tt,[t.cooked?(o(),c(r,{key:0,icon:"mdi-check-bold"})):l("",!0),t.cooked?l("",!0):(o(),c(r,{key:1,icon:"mdi-close-thick",color:"red"})),t.cooked?l("",!0):(o(),v("b",nt,"Noch nicht zubereitet")),t.cooked&&!t.lastCookedAt?(o(),v("b",ot,"Rezept zubereitet")):l("",!0),t.cooked&&t.lastCookedAt?(o(),v("b",at,"Zubereitet am "+y(T(se)(t.lastCookedAt)),1)):l("",!0)])):l("",!0)]),u(W,{color:"transparent"},{append:s(()=>[u(Q,null,{activator:s(({props:g})=>[!t.imageInProgress&&!t.sectionsInProgress&&!t.ingredientsInProgress?(o(),c(a,ae({key:0,icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},g),{default:s(()=>[u(r,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)):l("",!0)]),default:s(()=>[u(E,null,{default:s(()=>[u(P,{onClick:g=>J(t.id)},{default:s(()=>[u(h,null,{default:s(()=>[...e[16]||(e[16]=[m("Zutaten einkaufen",-1)])]),_:1})]),_:1},8,["onClick"]),t.sectionsUploaded&&!t.sectionsInProgress?(o(),c(P,{key:0,onClick:g=>N(t,!0)},{default:s(()=>[u(h,null,{default:s(()=>[...e[17]||(e[17]=[m("Rezept zubereiten",-1)])]),_:1})]),_:1},8,["onClick"])):l("",!0),T(V)?l("",!0):(o(),c(P,{key:1,onClick:g=>ye(t)},{default:s(()=>[u(h,null,{default:s(()=>[...e[18]||(e[18]=[m("Daten importieren",-1)])]),_:1})]),_:1},8,["onClick"])),u(b),t.cooked||t.ordered?(o(),c(P,{key:2,onClick:g=>_e(t)},{default:s(()=>[u(h,null,{default:s(()=>[...e[19]||(e[19]=[m("Planung zurÃ¼cksetzen",-1)])]),_:1})]),_:1},8,["onClick"])):l("",!0),u(P,{onClick:g=>j(t)},{default:s(()=>[u(h,null,{default:s(()=>[...e[20]||(e[20]=[m("Aus Planung entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])),i("div",lt,[!t.ordered&&!t.cooked?(o(),c(a,{key:0,variant:"outlined",onClick:g=>J(t.id)},{default:s(()=>[...e[21]||(e[21]=[m("Zutaten einkaufen",-1)])]),_:1},8,["onClick"])):l("",!0)]),i("div",st,[t.ordered&&!t.cooked&&t.sectionsUploaded&&!t.sectionsInProgress?(o(),c(a,{key:0,variant:"outlined",onClick:g=>N(t,!0),color:"blue"},{default:s(()=>[...e[22]||(e[22]=[m("Rezept zubereiten",-1)])]),_:1},8,["onClick"])):l("",!0)]),i("div",it,[t.sectionsUploaded&&!t.sectionsInProgress&&t.cooked||!(t.sectionsUploaded&&!t.sectionsInProgress)&&t.ordered?(o(),c(a,{key:0,variant:"outlined",color:"red",onClick:g=>j(t)},{default:s(()=>[...e[23]||(e[23]=[m("Aus Planung entfernen",-1)])]),_:1},8,["onClick"])):l("",!0)])]),_:2},1024)):l("",!0),t.type==="SCHEDULED"||t.type==="OTHER"?(o(),c(X,{key:1,class:"mx-auto","max-width":"374"},{default:s(()=>[u(q,{class:"position-relative",height:"200",color:"rgb(160, 171, 183)",cover:""},{default:s(()=>[i("div",dt,[i("div",rt,"Typ: "+y(ce(t.type)),1),i("div",ut,y(t.title),1)]),i("div",ct,[i("div",ft,[u(r,{icon:"mdi-check-bold"}),t.date?(o(),v("b",vt,"Geplant "+y(T(F).format(t.date))+", "+y(T(le)(t.date)),1)):l("",!0)]),i("div",gt,[t.cooked?(o(),c(r,{key:0,icon:"mdi-check-bold"})):l("",!0),t.cooked?l("",!0):(o(),c(r,{key:1,icon:"mdi-close-thick",color:"red"})),t.cooked?l("",!0):(o(),v("b",mt,"Noch nicht zubereitet")),t.cooked?(o(),v("b",kt,"Zubereitet am "+y(T(se)(t.date)),1)):l("",!0)])]),u(W,{color:"transparent"},{append:s(()=>[u(Q,null,{activator:s(({props:g})=>[u(a,ae({icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},g),{default:s(()=>[u(r,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)]),default:s(()=>[u(E,null,{default:s(()=>[u(P,{onClick:g=>he(t)},{default:s(()=>[u(h,null,{default:s(()=>[...e[24]||(e[24]=[m("Aus Kalender entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),i("div",_t,[t.cooked?l("",!0):(o(),c(a,{key:0,variant:"outlined",onClick:g=>pe(t),color:"red"},{default:s(()=>[...e[25]||(e[25]=[m("Mahlzeit wurde verzehrt",-1)])]),_:1},8,["onClick"]))])]),_:2},1024)):l("",!0)]),_:2},1024))),128))]),_:1})]),u(Re,{onResult:e[0]||(e[0]=t=>U.value=t)}),u(Se,{onResult:e[1]||(e[1]=t=>Z.value=t)}),u(ee,{onResult:e[2]||(e[2]=t=>L.value=t),title:"Bitte bestÃ¤tigen",message:"Sollen alle vorgeschlagenen Rezepte entfernt werden?"}),u(ee,{onResult:e[3]||(e[3]=t=>Y.value=t),title:"Bitte bestÃ¤tigen",message:"Sollen alle geplanten Rezepte aus der Planung entfernt werden?"})])}}},ht=De(yt,[["__scopeId","data-v-d2fa1e4f"]]),Rt={__name:"index",setup(x){return re(async()=>{de()}),(M,C)=>(o(),c(ht))}};export{Rt as default};
