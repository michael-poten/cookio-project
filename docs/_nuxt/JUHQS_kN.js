import{_ as ye,O as ge,K as he,N as be,u as ke,P as we,r as m,o as Pe,g as v,x as r,y as i,B as n,C as c,a3 as Ie,S as w,z as p,D as _,R as d,T as W,U as Y,Q as B,A as y,V as xe,X as M}from"./Dc-SAfZz.js";import{R as U,C as Ce,I as z,G as Re}from"./CnbI8feb.js";const Se={methods:{formatCurrency(E){return"€ "+(""+(Math.round(E*100)/100).toFixed(2)).replace(".",",")}}},Ve={class:"d-flex justify-space-between align-center"},Ne={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Be={key:0,class:"text-h6 text-medium-emphasis"},Te={key:0},De={key:0},Ae={class:"text-right mt-3"},Ue={key:1,style:{width:"100%","text-align":"right"}},ze=["colspan"],Qe={key:0,class:"pl-6"},$e={key:0},Me={key:1},Ee={key:1,class:"py-2"},Le=["onClick"],Fe={key:0},Oe={key:1},Ze={key:0},je={key:0},Ge={key:1},Ke={key:0,class:"px-0 mx-0"},Xe={style:{"max-width":"200px"}},qe={class:"my-2"},He={class:"my-2"},Je={class:"my-2"},We={class:"text-right"},Ye={key:0,class:"mt-3"},et={class:"mt-2"},tt={__name:"IngredientsDialog",emits:["result"],setup(E,{emit:L}){const F=ge(),O=he(),{authInfo:b,githubMode:T}=be(O),ee=L;ke(),we();const C=m(!1),Q=m(null),te=m(null),Z=m(null),P=m([]),g=m([]),o=m(null),D=m(null),A=m(2),R=m(!1),I=m(!1),S=m(!1),x=m(!1),V=m({name:null,password:null});Pe(async()=>{ee("result",async t=>(Array.isArray(t)?P.value=t:P.value=[t],D.value=null,g.value=[],o.value=null,S.value=!1,x.value=!1,I.value=!1,A.value=2,j(),await G(!0),C.value=!0,new Promise((e,a)=>{Q.value=e,te.value=a})))});async function j(){let t=await O.getAuthInfo();R.value=t.picnicLoggedIn}async function le(t){o.value=null,P.value=P.value.filter(e=>e!==t),await G(!0)}async function G(t){let e=[];for(const a of P.value){const s=await U.getRecipe(b.value.userId,a);s.ingredients=(await U.getRecipeIngredients(b.value.userId,a)).data,e.push(s)}g.value=e,X(t)}function ae(t){let e=null;if(t.selectedPicnicProduktId&&t.picnicResults&&t.picnicResults.length>0){let a=t.picnicResults.find(s=>s.id===t.selectedPicnicProduktId);a&&(e=a.name)}t.searchQuery&&t.searchQuery!==t.basicName&&t.searchQuery!==e&&Re.debounceTime("debounceSearch",()=>{N("picnic",t,t.searchQuery)},2500)}async function se(){await z.loginPicnic(b.value.userId,V.value),await j()}async function ne(){let t=!1;for(const e of g.value)e.planned&&!e.ordered&&(t=!0);t?Z.value().then(async e=>{if(e){for(const a of g.value)if(a.planned&&!a.ordered){const s={ordered:!0};await U.updateRecipe(b.value.userId,a.id,s)}}C.value=!1,Q.value(!0)}):(C.value=!1,Q.value(!1))}async function K(){let t=o.value.filter(e=>e.bring);D.value=z.convertToBringUrl(t)}async function ie(){let t=o.value.filter(s=>s.picnic);for(const s of t)if(s.selectedPicnicProduktId){let u=s.picnicResults.find(k=>k.id===s.selectedPicnicProduktId).multiplier;(!u||u===0||u>0&&u<1)&&(u=1),u=Math.ceil(u);for(let k=1;k<=u;k++)await z.addProductToPicnicShoppingCart(b.value.userId,s.selectedPicnicProduktId)}I.value=!0;const a={picnicPurchaseDate:new Date().toISOString()};for(const s of P.value)await U.updateRecipe(b.value.userId,s,a)}async function oe(t){await navigator.clipboard.writeText(t.basicName)}function X(t){o.value=[];for(const e of g.value){let a=e.portions?e.portions:2;e.ingredients.forEach(s=>{o.value.push({name:s.name,searchQuery:s.basicName,basicName:s.basicName,genericName:s.genericName?s.genericName:"Sonstiges",unit:s.unit,amount:Math.ceil(s.amount/a*A.value),standardIngredient:s.standardIngredient})})}o.value=o.value.sort((e,a)=>e.basicName.localeCompare(a.basicName)),console.log("ingredients",o.value),t&&ce(),K()}function ce(){o.value.forEach(t=>{t.standardIngredient?(t.bring=!1,t.picnic=!1):(t.bring=!0,t.picnic=!1)}),x.value=o.value.filter(t=>!!t.bring).length>0,o.value=o.value.sort((t,e)=>{let a=0;return!t.bring&&!e.bring&&(a=0),!t.bring&&e.bring&&(a=1),t.bring&&!e.bring&&(a=-1),t.bring&&e.bring&&(a=0),a!==0?a:t.genericName.localeCompare(e.genericName)})}async function ue(){o.value.forEach(t=>{t.bring&&N("picnic",t)})}async function N(t,e,a=null){if(t==="bring")e.bring=!0,e.picnic=!1,S.value=o.value.filter(s=>!!s.picnic).length>0,x.value=o.value.filter(s=>!!s.bring).length>0;else if(t==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0,a||(a=e.basicName);const s=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await z.searchPicnic(b.value.userId,a,s,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:e.selectedPicnicProduktId=null,S.value=o.value.filter(u=>!!u.picnic).length>0,x.value=o.value.filter(u=>!!u.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,S.value=o.value.filter(s=>!!s.picnic).length>0,x.value=o.value.filter(s=>!!s.bring).length>0;K()}return(t,e)=>{const a=v("v-btn"),s=v("v-card-title"),u=v("v-img"),k=v("v-text-field"),q=v("v-card-text"),H=v("v-card"),re=v("v-select"),J=v("v-icon"),de=v("v-progress-linear"),pe=v("v-list-item"),ve=v("v-autocomplete"),$=v("v-col"),me=v("v-row"),fe=v("v-table"),_e=v("v-dialog");return i(),r("div",null,[n(_e,{"max-width":"600",modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l),fullscreen:w(F).smAndDown.value},{default:c(()=>[n(H,{style:{"background-color":"white"},class:Ie({"pa-4":!w(F).smAndDown.value})},{default:c(()=>[n(s,{style:{"white-space":"normal"}},{default:c(()=>[p("div",Ve,[p("div",Ne,[e[6]||(e[6]=_(" Zutaten einkaufen ",-1)),g.value?(i(),r("div",Be,[(i(!0),r(W,null,Y(g.value,(l,f)=>(i(),r("span",{key:l.title},[f!==0?(i(),r("span",Te,", ")):d("",!0),_(" "+y(l.title)+" ",1),g.value.length>1?(i(),B(a,{key:1,icon:"mdi-close-circle",onClick:h=>le(l.id),variant:"plain"},null,8,["onClick"])):d("",!0)]))),128))])):d("",!0)]),n(a,{icon:"mdi-close",variant:"text",onClick:ne})])]),_:1}),n(q,null,{default:c(()=>[g.value?(i(),r("div",De,[!R.value&&!w(T)?(i(),B(H,{key:0,class:"mb-4"},{default:c(()=>[n(s,null,{default:c(()=>[n(u,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=_(" Bei Picnic einloggen ",-1))]),_:1}),n(q,null,{default:c(()=>[n(k,{modelValue:V.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value.name=l),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),n(k,{modelValue:V.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value.password=l),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),p("div",Ae,[n(a,{variant:"outlined",onClick:se},{default:c(()=>[...e[8]||(e[8]=[_("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):d("",!0),e[13]||(e[13]=p("h3",null,"Anzahl Portionen",-1)),n(re,{modelValue:A.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>A.value=l),X],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=p("h3",null,"Zutatenliste",-1)),w(T)?d("",!0):(i(),r("div",Ue,[n(a,{variant:"flat",onClick:e[3]||(e[3]=l=>ue()),class:"mb-1 my-1"},{default:c(()=>[n(u,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=_(" Alles bei Picnic einkaufen ",-1))]),_:1})])),n(fe,{class:"table-ingredients"},{default:c(()=>[p("tbody",null,[(i(!0),r(W,null,Y(o.value,l=>(i(),r("tr",{key:l.name},[p("td",{colspan:l.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[l.picnic?d("",!0):(i(),r("div",Qe,[l.amount?(i(),r("span",$e,y(l.amount),1)):d("",!0),e[10]||(e[10]=_()),l.unit?(i(),r("span",Me,y(l.unit),1)):d("",!0)])),l.picnic?(i(),r("div",Ee,[p("div",{style:{"font-size":"0.8em"},onClick:f=>oe(l)},[n(J,{icon:"mdi-arrow-right"}),e[11]||(e[11]=_()),l.amount?(i(),r("span",Fe,y(l.amount),1)):d("",!0),e[12]||(e[12]=_()),l.unit?(i(),r("span",Oe,y(l.unit),1)):d("",!0),_(" "+y(l.name),1)],8,Le),l.picnic?(i(),r("div",Ze,[l.loading?(i(),B(de,{key:0,indeterminate:""})):d("",!0),(i(),B(ve,{modelValue:l.selectedPicnicProduktId,"onUpdate:modelValue":f=>l.selectedPicnicProduktId=f,search:l.searchQuery,"onUpdate:search":[f=>l.searchQuery=f,f=>ae(l)],label:"Bitte Produkt auswählen",items:l.picnicResults,autocomplete:"off","item-title":"name","item-value":"id",clearable:"","hide-details":"",key:l.id,disabled:l.loading},{item:c(({props:f,item:h})=>[n(pe,xe({ref_for:!0},f),{default:c(()=>[p("h4",null,[h.raw.multiplier&&h.raw.multiplier>1?(i(),r("span",je,y(h.raw.multiplier)+"x ",1)):d("",!0),h.raw.unitQuantity&&h.raw.unitQuantity!=="undefined"?(i(),r("span",Ge,y(h.raw.unitQuantity),1)):d("",!0)]),p("h5",null,y(w(Se).methods.formatCurrency(h.raw.price/100)),1),n(u,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${h.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","search","onUpdate:search","items","disabled"]))])):d("",!0)])):d("",!0)],8,ze),l.picnic?d("",!0):(i(),r("td",Ke,y(l.name),1)),p("td",Xe,[n(me,{class:"px-0 mx-0",style:{width:"180px"}},{default:c(()=>[n($,{cols:"3"},{default:c(()=>[p("div",qe,[n(a,{variant:"flat",style:M({opacity:l.bring?1:.3}),onClick:f=>N("bring",l),class:"mx-0"},{default:c(()=>[n(u,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),w(T)?d("",!0):(i(),B($,{key:0,cols:"3"},{default:c(()=>[p("div",He,[n(a,{variant:"plain",style:M({opacity:l.picnic?1:.3}),disabled:!R.value||I.value,onClick:f=>N("picnic",l)},{default:c(()=>[n(u,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),n($,{cols:"4"},{default:c(()=>[p("div",Je,[n(a,{variant:"plain",style:M({opacity:!l.bring&&!l.picnic?1:.3}),disabled:!R.value||I.value,onClick:f=>N(null,l)},{default:c(()=>[n(J,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):d("",!0),p("div",We,[w(T)?d("",!0):(i(),r("div",Ye,[n(a,{variant:"outlined",rounded:"",onClick:ie,"prepend-icon":I.value?"mdi-check":null,disabled:!R.value||I.value||!S.value},{default:c(()=>[n(u,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=_(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),p("div",et,[n(a,{link:"",variant:"outlined",rounded:"",href:D.value,disabled:D.value===null||!x.value,target:"_blank",class:"ml-2"},{default:c(()=>[n(u,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=_(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),n(Ce,{onResult:e[5]||(e[5]=l=>Z.value=l),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},st=ye(tt,[["__scopeId","data-v-d1983d2a"]]);export{st as I};
