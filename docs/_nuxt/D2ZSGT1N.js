import{K as k,X as p,ab as O,_ as ne,r as b,o as se,g as f,Q as H,y as v,C as d,B as a,$ as ge,z as w,D as I,a0 as _e,ac as he,N as ye,M as we,u as be,O as ke,x as h,ad as Pe,P as z,R as y,A as R,S as Se,T as Ie,U as xe,a4 as G}from"./CYTyNksY.js";const j={convertToBringUrl:function(c){let o=[];for(const C of c){const _=[];_.push(C.name),C.amount&&C.amount!==0&&_.push(C.amount+(C.unit?" "+C.unit:"")),o.push(_.join("__"))}const l=o.join("---"),t=btoa(unescape(encodeURIComponent(l)));let P="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return P=encodeURIComponent(P),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+P+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeWithNewEngine:async function(c,o){const l=k();try{return await O.post(l.lanAddress+"api/"+c+"/recipes/"+o+"/import/newEngine",{})}catch(t){p.catchError(t)}},analyzeIngredients:async function(c,o,l){const t=k();try{const i=new FormData;return i.append("image",l),await O.post(t.lanAddress+"api/"+c+"/recipes/"+o+"/import/image/ingredients",i,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){p.catchError(i)}},analyzeSections:async function(c,o,l){const t=k();try{const i=new FormData;return i.append("image",l),await O.post(t.lanAddress+"api/"+c+"/recipes/"+o+"/import/image/sections",i,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){p.catchError(i)}},uploadImage:async function(c,o,l){const t=k();try{const i=new FormData;return i.append("image",l),await O.post(t.lanAddress+"api/"+c+"/recipes/"+o+"/import/image",i,{headers:{"Content-Type":"multipart/form-data"}})}catch(i){p.catchError(i)}},generateImage:async function(c,o){const l=k();try{return await p.post(l.lanAddress+"api/"+c+"/recipes/"+o+"/import/generateImage")}catch(t){p.catchError(t)}},loginPicnic:async function(c,o){const l=k();try{return await p.post(l.lanAddress+"api/"+c+"/loginPicnic",o)}catch(t){p.catchError(t)}},searchPicnic:async function(c,o,l,t=!1){const i=k();try{return await p.post(i.lanAddress+"api/"+c+"/picnic/search",{query:o,ingredientDescription:l,useChatGpt:t})}catch(P){p.catchError(P)}},addProductToPicnicShoppingCart:async function(c,o){const l=k();try{return await p.post(l.lanAddress+"api/"+c+"/picnic/addProductToShoppingCart",{productId:o})}catch(t){p.catchError(t)}}},Z={getRecipe:async function(c,o){const l=k();try{if(l.isNetworkAccess){let t=l.lanAddress+"api/"+c+"/recipes/"+o;return(await p.get(t)).data}else return(await p.get("https://mmhhhh.de/data/home/recipes.json")).data[o]}catch(t){p.catchError(t)}},getRecipeIngredients:async function(c,o){const l=k();try{let t;return l.isNetworkAccess?t=l.lanAddress+"api/"+c+"/recipes/"+o+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+o+"/ingredients.json",await p.get(t)}catch(t){p.catchError(t)}},getRecipeSections:async function(c,o){const l=k();try{let t;return l.isNetworkAccess?t=l.lanAddress+"api/"+c+"/recipes/"+o+"/sections":t="https://mmhhhh.de/data/home/recipes/"+o+"/sections.json",await p.get(t)}catch(t){p.catchError(t)}},updateRecipe:async function(c,o,l){const t=k();try{return await p.put(t.lanAddress+"api/"+c+"/recipes/"+o,l)}catch(i){p.catchError(i)}},uploadRecipeToGithub:async function(c,o){const l=k();let t={};o&&(t.recipeId=o);try{return await p.put(l.lanAddress+"api/"+c+"/recipes/githubUpload",t)}catch(i){p.catchError(i)}},deleteRecipe:async function(c,o){const l=k();try{return await p.post(l.lanAddress+"api/"+c+"/recipes/"+o+"/delete")}catch(t){p.catchError(t)}}},Ce={methods:{formatCurrency(c){return"€ "+(""+(Math.round(c*100)/100).toFixed(2)).replace(".",",")}}},Re=["innerHTML"],Ae={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(c,{emit:o}){const l=c,t=o,i=b(!1),P=b(l.message),C=b(l.title);let _=null;se(()=>{t("result",Q=>(i.value=!0,new Promise((S,x)=>{_=S})))});function M(){_&&_(!0),i.value=!1,_=null}function $(){_&&_(!1),i.value=!1,_=null}return(Q,S)=>{const x=f("v-toolbar"),g=f("v-btn"),T=f("v-col"),L=f("v-row"),U=f("v-container"),D=f("v-card-text"),N=f("v-card"),V=f("v-dialog");return v(),H(V,{modelValue:i.value,"onUpdate:modelValue":S[0]||(S[0]=B=>i.value=B),onKeydown:he($,["esc"]),"max-width":"420"},{default:d(()=>[a(N,null,{default:d(()=>[a(x,{color:"rgb(191, 208, 217)",title:C.value},null,8,["title"]),ge(a(D,null,{default:d(()=>[w("div",{style:{"margin-bottom":"30px"},innerHTML:P.value},null,8,Re),a(U,{class:"sub-grid"},{default:d(()=>[a(L,null,{default:d(()=>[a(T,{cols:"6"},{default:d(()=>[a(g,{onClick:$,style:{width:"100%"}},{default:d(()=>[...S[1]||(S[1]=[I("Abbrechen",-1)])]),_:1})]),_:1}),a(T,{cols:"6"},{default:d(()=>[a(g,{color:"secondary",onClick:M,style:{width:"100%"}},{default:d(()=>[...S[2]||(S[2]=[I(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!P.value]])]),_:1})]),_:1},8,["modelValue"])}}},De=ne(Ae,[["__scopeId","data-v-6b314bdd"]]),Ve={class:"d-flex justify-space-between align-center"},Ee={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Te={key:0,class:"text-h6 text-medium-emphasis"},Ue={key:0},Ne={class:"text-right mt-3"},Be={key:1,style:{width:"100%","text-align":"right"}},ze=["colspan"],je={key:0,class:"pl-6"},Le={key:0},Fe={key:1},Me={key:1,class:"py-2"},$e={style:{"font-size":"0.8em"}},Qe={key:0},Ke={key:1},Oe={key:0},Ze={key:0},He={key:1},qe={key:0,class:"px-0 mx-0"},Ge={style:{"max-width":"200px"}},Je={class:"my-2"},We={class:"my-2"},Xe={class:"my-2"},Ye={class:"text-right"},et={key:0,class:"mt-3"},tt={class:"mt-2"},at={__name:"IngredientsDialog",emits:["result"],setup(c,{emit:o}){const l=ye(),t=k(),{authInfo:i,githubMode:P}=we(t),C=o;be(),ke();const _=b(!1),M=b(null),$=b(null),Q=b(null),S=b([]),x=b([]),g=b(null),T=b(null),L=b(2),U=b(!1),D=b(!1),N=b(!1),V=b(!1),B=b({name:null,password:null});se(async()=>{C("result",async r=>(Array.isArray(r)?S.value=r:S.value=[r],T.value=null,x.value=[],g.value=null,N.value=!1,V.value=!1,D.value=!1,L.value=2,J(),await oe(!0),_.value=!0,new Promise((e,n)=>{M.value=e,$.value=n})))});async function J(){let r=await t.getAuthInfo();U.value=r.picnicLoggedIn}async function oe(r){let e=[];for(const n of S.value){const u=await Z.getRecipe(i.value.userId,n);u.ingredients=(await Z.getRecipeIngredients(i.value.userId,n)).data,e.push(u)}x.value=e,X(r)}async function ie(){await j.loginPicnic(i.value.userId,B.value),await J()}async function le(){let r=!1;for(const e of x.value)e.planned&&!e.ordered&&(r=!0);r?Q.value().then(async e=>{if(e){for(const n of x.value)if(n.planned&&!n.ordered){const u={ordered:!0};await Z.updateRecipe(i.value.userId,n.id,u)}}_.value=!1,M.value(!0)}):(_.value=!1,M.value(!1))}async function W(){let r=g.value.filter(e=>e.bring);T.value=j.convertToBringUrl(r)}async function re(){let r=g.value.filter(u=>u.picnic);for(const u of r)if(u.selectedPicnicProduktId){let m=u.picnicResults.find(A=>A.id===u.selectedPicnicProduktId).multiplier;(!m||m===0||m>0&&m<1)&&(m=1),m=Math.ceil(m);for(let A=1;A<=m;A++)await j.addProductToPicnicShoppingCart(i.value.userId,u.selectedPicnicProduktId)}D.value=!0;const n={picnicPurchaseDate:new Date().toISOString()};for(const u of S.value)await Z.updateRecipe(i.value.userId,u,n)}function X(r){g.value=[];for(const e of x.value){let n=e.portions?e.portions:2;e.ingredients.forEach(u=>{g.value.push({name:u.name,basicName:u.basicName,genericName:u.genericName?u.genericName:"Sonstiges",unit:u.unit,amount:Math.ceil(u.amount/n*L.value),standardIngredient:u.standardIngredient})})}r&&ce(),W()}function ce(){g.value.forEach(r=>{r.standardIngredient?(r.bring=!1,r.picnic=!1):(r.bring=!0,r.picnic=!1)}),V.value=g.value.filter(r=>!!r.bring).length>0,g.value=g.value.sort((r,e)=>{let n=0;return!r.bring&&!e.bring&&(n=0),!r.bring&&e.bring&&(n=1),r.bring&&!e.bring&&(n=-1),r.bring&&e.bring&&(n=0),n!==0?n:r.genericName.localeCompare(e.genericName)})}async function ue(){g.value.forEach(r=>{r.bring&&K("picnic",r)})}async function K(r,e){if(r==="bring")e.bring=!0,e.picnic=!1,N.value=g.value.filter(n=>!!n.picnic).length>0,V.value=g.value.filter(n=>!!n.bring).length>0;else if(r==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const n=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await j.searchPicnic(i.value.userId,e.basicName,n,!0)).data;let u=(await j.searchPicnic(i.value.userId,e.name,n,!1)).data;(!u||u.length===0)&&(u=(await j.searchPicnic(i.value.userId,e.basicName,n,!1)).data,(!u||u.length===0)&&(u=(await j.searchPicnic(i.value.userId,e.genericName,n,!1)).data)),u&&u.forEach(m=>{e.picnicResults.find(A=>A.id!==m.id)||e.picnicResults.push(m)}),e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),N.value=g.value.filter(m=>!!m.picnic).length>0,V.value=g.value.filter(m=>!!m.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,N.value=g.value.filter(n=>!!n.picnic).length>0,V.value=g.value.filter(n=>!!n.bring).length>0;W()}return(r,e)=>{const n=f("v-btn"),u=f("v-card-title"),m=f("v-img"),A=f("v-text-field"),Y=f("v-card-text"),ee=f("v-card"),te=f("v-select"),ae=f("v-icon"),de=f("v-progress-linear"),pe=f("v-list-item"),q=f("v-col"),me=f("v-row"),fe=f("v-table"),ve=f("v-dialog");return v(),h("div",null,[a(ve,{"max-width":"600",modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),fullscreen:z(l).smAndDown.value},{default:d(()=>[a(ee,{style:{"background-color":"white"},class:Pe({"pa-4":!z(l).smAndDown.value})},{default:d(()=>[a(u,{style:{"white-space":"normal"}},{default:d(()=>[w("div",Ve,[w("div",Ee,[e[6]||(e[6]=I(" Zutaten einkaufen ",-1)),x.value?(v(),h("div",Te,R(x.value.map(s=>s.title).join(", ")),1)):y("",!0)]),a(n,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),a(Y,null,{default:d(()=>[x.value?(v(),h("div",Ue,[!U.value&&!z(P)?(v(),H(ee,{key:0,class:"mb-4"},{default:d(()=>[a(u,null,{default:d(()=>[a(m,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=I(" Bei Picnic einloggen ",-1))]),_:1}),a(Y,null,{default:d(()=>[a(A,{modelValue:B.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>B.value.name=s),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),a(A,{modelValue:B.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>B.value.password=s),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),w("div",Ne,[a(n,{variant:"outlined",onClick:ie},{default:d(()=>[...e[8]||(e[8]=[I("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):y("",!0),e[13]||(e[13]=w("h3",null,"Anzahl Portionen",-1)),a(te,{modelValue:L.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>L.value=s),X],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=w("h3",null,"Zutatenliste",-1)),z(P)?y("",!0):(v(),h("div",Be,[a(n,{variant:"flat",onClick:e[3]||(e[3]=s=>ue()),class:"mb-1 my-1"},{default:d(()=>[a(m,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=I(" Alles bei Picnic einkaufen ",-1))]),_:1})])),a(fe,{class:"table-ingredients"},{default:d(()=>[w("tbody",null,[(v(!0),h(Se,null,Ie(g.value,s=>(v(),h("tr",{key:s.name},[w("td",{colspan:s.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[s.picnic?y("",!0):(v(),h("div",je,[s.amount?(v(),h("span",Le,R(s.amount),1)):y("",!0),e[10]||(e[10]=I()),s.unit?(v(),h("span",Fe,R(s.unit),1)):y("",!0)])),s.picnic?(v(),h("div",Me,[w("div",$e,[a(ae,{icon:"mdi-arrow-right"}),e[11]||(e[11]=I()),s.amount?(v(),h("span",Qe,R(s.amount),1)):y("",!0),e[12]||(e[12]=I()),s.unit?(v(),h("span",Ke,R(s.unit),1)):y("",!0),I(" "+R(s.name),1)]),s.picnic?(v(),h("div",Oe,[s.loading?(v(),H(de,{key:0,indeterminate:""})):y("",!0),a(te,{modelValue:s.selectedPicnicProduktId,"onUpdate:modelValue":F=>s.selectedPicnicProduktId=F,label:"Bitte Produkt auswählen",items:s.picnicResults,"item-title":"name","item-value":"id","hide-details":"",disabled:s.loading},{item:d(({props:F,item:E})=>[a(pe,xe({ref_for:!0},F),{default:d(()=>[w("h4",null,[E.raw.multiplier&&E.raw.multiplier>1?(v(),h("span",Ze,R(E.raw.multiplier)+"x ",1)):y("",!0),E.raw.unitQuantity&&E.raw.unitQuantity!=="undefined"?(v(),h("span",He,R(E.raw.unitQuantity),1)):y("",!0)]),w("h5",null,R(z(Ce).methods.formatCurrency(E.raw.price/100)),1),a(m,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${E.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])])):y("",!0)])):y("",!0)],8,ze),s.picnic?y("",!0):(v(),h("td",qe,R(s.name),1)),w("td",Ge,[a(me,{class:"px-0 mx-0",style:{width:"180px"}},{default:d(()=>[a(q,{cols:"3"},{default:d(()=>[w("div",Je,[a(n,{variant:"flat",style:G({opacity:s.bring?1:.3}),onClick:F=>K("bring",s),class:"mx-0"},{default:d(()=>[a(m,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),z(P)?y("",!0):(v(),H(q,{key:0,cols:"3"},{default:d(()=>[w("div",We,[a(n,{variant:"plain",style:G({opacity:s.picnic?1:.3}),disabled:!U.value||D.value,onClick:F=>K("picnic",s)},{default:d(()=>[a(m,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),a(q,{cols:"4"},{default:d(()=>[w("div",Xe,[a(n,{variant:"plain",style:G({opacity:!s.bring&&!s.picnic?1:.3}),disabled:!U.value||D.value,onClick:F=>K(null,s)},{default:d(()=>[a(ae,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):y("",!0),w("div",Ye,[z(P)?y("",!0):(v(),h("div",et,[a(n,{variant:"outlined",rounded:"",onClick:re,"prepend-icon":D.value?"mdi-check":null,disabled:!U.value||D.value||!N.value},{default:d(()=>[a(m,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=I(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),w("div",tt,[a(n,{link:"",variant:"outlined",rounded:"",href:T.value,disabled:T.value===null||!V.value,target:"_blank",class:"ml-2"},{default:d(()=>[a(m,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=I(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),a(De,{onResult:e[5]||(e[5]=s=>Q.value=s),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},st=ne(at,[["__scopeId","data-v-e10a6f63"]]);export{De as C,st as I,Z as R,j as a};
