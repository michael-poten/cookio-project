import{n as P,a3 as o,a4 as re,a5 as ue,a6 as L,M as pe,K as de,L as me,u as ve,N as fe,r as v,o as _e,g as f,O as $,y as d,C as r,B as s,a7 as he,Q as E,z as u,D as w,A as b,P as h,x as y,R as ye,S as ge,T as we,a8 as M}from"./7DXENtcA.js";import{_ as be}from"./DlAUqK2U.js";const X={getRecipe:async function(n,i){try{let t=P().public.apiBase;return await o.get(t+"api/"+n+"/recipes/"+i)}catch(t){o.catchError(t)}},updateRecipe:async function(n,i,t){try{let c=P().public.apiBase;return await o.put(c+"api/"+n+"/recipes/"+i,t)}catch(c){o.catchError(c)}},deleteRecipe:async function(n,i){try{let t=P().public.apiBase;return await o.post(t+"api/"+n+"/recipes/"+i+"/delete")}catch(t){o.catchError(t)}}},He=re("recipe",{state:()=>ue({recipes:[]}),actions:{getAllRecipes:async function(n){try{let i=P().public.apiBase;const t=await o.get(i+"api/"+n+"/recipes");return this.$patch({recipes:t.data}),t}catch(i){o.catchError(i)}}}}),U={convertToBringUrl:async function(n){try{let i=P().public.apiBase;return await o.post(i+"api/convertIngredientsToBringUrl",n)}catch(i){o.catchError(i)}},analyzeIngredients:async function(n,i,t){try{const c=new FormData;return c.append("image",t),await L.post("/api/"+n+"/recipes/"+i+"/import/image/ingredients",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){o.catchError(c)}},analyzeSections:async function(n,i,t){try{const c=new FormData;return c.append("image",t),await L.post("/api/"+n+"/recipes/"+i+"/import/image/sections",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){o.catchError(c)}},uploadImage:async function(n,i,t){try{const c=new FormData;return c.append("image",t),await L.post("/api/"+n+"/recipes/"+i+"/import/image",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){o.catchError(c)}},generateImage:async function(n,i){try{let t=P().public.apiBase;return await o.post(t+"api/"+n+"/recipes/"+i+"/import/generateImage")}catch(t){o.catchError(t)}},loginPicnic:async function(n,i){try{let t=P().public.apiBase;return await o.post(t+"api/"+n+"/loginPicnic",i)}catch(t){o.catchError(t)}},searchPicnic:async function(n,i){try{let t=P().public.apiBase;return await o.post(t+"api/"+n+"/picnic/search",{query:i})}catch(t){o.catchError(t)}},addProductToPicnicShoppingCart:async function(n,i){try{let t=P().public.apiBase;return await o.post(t+"api/"+n+"/picnic/addProductToShoppingCart",{productId:i})}catch(t){o.catchError(t)}}},Pe={methods:{formatCurrency(n){return"€ "+(""+(Math.round(n*100)/100).toFixed(2)).replace(".",",")}}},ke={class:"d-flex justify-space-between align-center"},Ie={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},xe={class:"text-h6 text-medium-emphasis"},Ce={class:"mt-2 px-2"},Re={key:0},Be={class:"text-right mt-3"},Se=["colspan"],Ue={key:0,class:"pl-6"},Ve={key:0},De={key:1},Te={key:1,class:"py-2"},Ee={style:{"font-size":"0.8em"}},ze={key:0},Ae={key:1},Ne={key:0},Fe={key:0,class:"px-0 mx-0"},Le={style:{"max-width":"200px"}},$e={class:"my-2"},Me={class:"my-2"},je={class:"my-2"},Oe={class:"text-right"},Ze={class:"mt-3"},qe={class:"mt-2"},Ke={__name:"IngredientsDialog",emits:["result"],setup(n,{emit:i}){const t=pe(),c=de(),{authInfo:k}=me(c),Y=i;ve(),fe();const V=v(!1),j=v(null),ee=v(null),z=v(null),g=v(null),p=v(null),D=v(null),T=v(2),x=v(!1),C=v(!1),R=v(!1),B=v(!1),S=v({name:null,password:null});_e(async()=>{Y("result",async m=>(z.value=m,D.value=null,g.value=null,p.value=null,T.value=2,O(),await te(),V.value=!0,new Promise((e,l)=>{j.value=e,ee.value=l})))});async function O(){let m=await c.getAuthInfo();x.value=m.picnicLoggedIn}async function te(){g.value=(await X.getRecipe(k.value.userId,z.value)).data,q()}async function ae(){await U.loginPicnic(k.value.userId,S.value),await O()}function ie(){V.value=!1,j.value(!1)}async function Z(){let m=p.value.filter(e=>e.bring);D.value=(await U.convertToBringUrl(m)).data.url}async function se(){let m=p.value.filter(_=>_.picnic);for(const _ of m)_.selectedPicnicProduktId&&await U.addProductToPicnicShoppingCart(k.value.userId,_.selectedPicnicProduktId);C.value=!0;const l={picnicPurchaseDate:new Date().toISOString()};await X.updateRecipe(k.value.userId,z,l)}function q(){let m=g.value.portions?g.value.portions:2;p.value=[],g.value.ingredients.forEach(e=>{p.value.push({name:e.name,basicName:e.basicName,unit:e.unit,amount:e.amount/m*T.value})}),Z()}async function A(m,e){m==="bring"?(e.bring=!0,e.picnic=!1,R.value=p.value.filter(l=>!!l.picnic).length>0,B.value=p.value.filter(l=>!!l.bring).length>0):m==="picnic"?(e.bring=!1,e.picnic=!0,e.picnicResults=(await U.searchPicnic(k.value.userId,e.basicName+" bio")).data,e.picnicResults&&e.picnicResults.length>0?(e.selectedPicnicProduktId=e.picnicResults[0].id,R.value=p.value.filter(l=>!!l.picnic).length>0,B.value=p.value.filter(l=>!!l.bring).length>0):(e.picnicResults=(await U.searchPicnic(k.value.userId,e.basicName)).data,e.picnicResults&&e.picnicResults.length>0&&(e.selectedPicnicProduktId=e.picnicResults[0].id,R.value=p.value.filter(l=>!!l.picnic).length>0,B.value=p.value.filter(l=>!!l.bring).length>0))):(e.bring=!1,e.picnic=!1,R.value=p.value.filter(l=>!!l.picnic).length>0,B.value=p.value.filter(l=>!!l.bring).length>0),Z()}return(m,e)=>{const l=f("v-btn"),_=f("v-img"),K=f("v-card-title"),Q=f("v-text-field"),G=f("v-card-text"),H=f("v-card"),J=f("v-select"),W=f("v-icon"),le=f("v-list-item"),N=f("v-col"),ne=f("v-row"),ce=f("v-table"),oe=f("v-dialog");return d(),$(oe,{"max-width":"600",modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),fullscreen:E(t).smAndDown.value},{default:r(()=>[s(H,{style:{"background-color":"white"},class:he({"pa-4":!E(t).smAndDown.value})},{default:r(()=>[s(K,{style:{"white-space":"normal"}},{default:r(()=>[u("div",ke,[u("div",Ie,[e[4]||(e[4]=w(" Zutaten einkaufen ")),u("div",xe,b(g.value.title),1)]),s(l,{icon:"mdi-close",variant:"text",onClick:ie})]),u("div",Ce,[!g.value.imageInProgress&&g.value.imageUploaded?(d(),$(_,{key:0,height:"200",src:"/api/"+E(k).userId+"/recipes/"+g.value.id+"/image",color:"grey",cover:""},null,8,["src"])):h("",!0)])]),_:1}),s(G,null,{default:r(()=>[g.value?(d(),y("div",Re,[x.value?h("",!0):(d(),$(H,{key:0},{default:r(()=>[s(K,null,{default:r(()=>[s(_,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[5]||(e[5]=w(" Bei Picnic einloggen "))]),_:1,__:[5]}),s(G,null,{default:r(()=>[s(Q,{modelValue:S.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>S.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),s(Q,{modelValue:S.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),u("div",Be,[s(l,{variant:"outlined",onClick:ae},{default:r(()=>e[6]||(e[6]=[w("Einloggen")])),_:1,__:[6]})])]),_:1})]),_:1})),e[10]||(e[10]=u("h3",{class:"mt-4"},"Anzahl Portionen",-1)),s(J,{modelValue:T.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>T.value=a),q],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[11]||(e[11]=u("h3",null,"Zutatenliste",-1)),s(ce,{class:"table-ingredients"},{default:r(()=>[u("tbody",null,[(d(!0),y(ye,null,ge(p.value,a=>(d(),y("tr",{key:a.name},[u("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?h("",!0):(d(),y("div",Ue,[a.amount?(d(),y("span",Ve,b(a.amount),1)):h("",!0),e[7]||(e[7]=w()),a.unit?(d(),y("span",De,b(a.unit),1)):h("",!0)])),a.picnic?(d(),y("div",Te,[u("div",Ee,[s(W,{icon:"mdi-arrow-right"}),e[8]||(e[8]=w()),a.amount?(d(),y("span",ze,b(a.amount),1)):h("",!0),e[9]||(e[9]=w()),a.unit?(d(),y("span",Ae,b(a.unit),1)):h("",!0),w(" "+b(a.name),1)]),a.picnic?(d(),y("div",Ne,[s(J,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":I=>a.selectedPicnicProduktId=I,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":""},{item:r(({props:I,item:F})=>[s(le,we({ref_for:!0},I),{default:r(()=>[u("h4",null,b(F.raw.unit_quantity),1),u("h5",null,b(E(Pe).methods.formatCurrency(F.raw.display_price/100)),1),s(_,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${F.raw.image_id}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items"])])):h("",!0)])):h("",!0)],8,Se),a.picnic?h("",!0):(d(),y("td",Fe,b(a.name),1)),u("td",Le,[s(ne,{class:"px-0 mx-0",style:{width:"180px"}},{default:r(()=>[s(N,{cols:"3"},{default:r(()=>[u("div",$e,[s(l,{variant:"flat",style:M({opacity:a.bring?1:.3}),onClick:I=>A("bring",a),class:"mx-0"},{default:r(()=>[s(_,{src:"/images/bring.png",width:"32",contain:""})]),_:2},1032,["style","onClick"])])]),_:2},1024),s(N,{cols:"3"},{default:r(()=>[u("div",Me,[s(l,{variant:"plain",style:M({opacity:a.picnic?1:.3}),disabled:!x.value||C.value,onClick:I=>A("picnic",a)},{default:r(()=>[s(_,{src:"/images/picnic.png",width:"32",contain:""})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024),s(N,{cols:"4"},{default:r(()=>[u("div",je,[s(l,{variant:"plain",style:M({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!x.value||C.value,onClick:I=>A(null,a)},{default:r(()=>[s(W,{icon:"mdi-selection-remove",size:"34"})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):h("",!0),u("div",Oe,[u("div",Ze,[s(l,{variant:"outlined",rounded:"",onClick:se,"prepend-icon":C.value?"mdi-check":null,disabled:!x.value||C.value||!R.value},{default:r(()=>[s(_,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[12]||(e[12]=w(" In Picnic importieren "))]),_:1,__:[12]},8,["prepend-icon","disabled"])]),u("div",qe,[s(l,{link:"",variant:"outlined",rounded:"",href:D.value,disabled:D.value===null||!B.value,target:"_blank",class:"ml-2"},{default:r(()=>[s(_,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[13]||(e[13]=w(" In Bring importieren "))]),_:1,__:[13]},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"])}}},Je=be(Ke,[["__scopeId","data-v-b01664fc"]]);export{Je as I,X as R,U as a,He as u};
