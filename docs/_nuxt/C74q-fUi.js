import{I as ge,C as G,R,a as me}from"./DwQUDUmI.js";import{L as J,_ as _e,M as ke,N as Y,O as pe,J as ye,P as be,K as Q,r as x,o as W,k as U,g as f,x as v,y as n,z as s,B as d,Q as u,R as l,C as a,D as m,S as L,T as F,A as y,U as z,V as he}from"./BzLVdxCs.js";import"./DA__SF9z.js";import{R as Re}from"./BM3GZYiP.js";function Ie(I){return I?J(I).format("DD.MM."):"-"}function we(I){return I?J(I).format("DD.MM.YYYY"):"-"}const Ce={class:"text-center"},xe={class:"text-center"},Pe={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},De={class:"mx-auto"},ze={style:{"background-color":"rgba(93,93,93,0.66)"}},Ve={key:0,class:"px-1 pb-1"},Ae={key:1,class:"pa-1 text-white",style:{"font-size":"0.8em"}},Se={class:"text-white"},Me={key:0,class:"px-1"},Ue={class:"ma-2"},$e=["onClick"],Te={style:{width:"100%"}},Ne={style:{width:"100%"},class:"text-right mt-2"},Be={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ze={class:"overlay-bottom-right"},je={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},Ke={style:{"font-size":"1.1em"},class:"px-1"},Oe=["href"],Ee={key:1,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Ge={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},Ye={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Le={key:2},Fe={key:3},Je={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Qe={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},We={key:2},qe={key:3},He={key:4},Xe={class:"ma-2"},et={class:"ma-2"},tt={class:"ma-2"},nt={__name:"MealPlanner",setup(I){const V=ke(),{recipes:w}=Y(V);pe(),ye(),be();const $=Q(),{authInfo:_,githubMode:A,lanAddress:q}=Y($);x("");const T=x({}),H=new Intl.DateTimeFormat("de-DE",{weekday:"long"}),b=x({}),S=x(null),N=x(null),B=x(null),Z=x(null);W(async()=>{await h()});const j=U(()=>p.value.filter(o=>!o.ordered)),C=U(()=>w.value?(w.value=w.value.sort((o,t)=>{const i=o.rating,r=t.rating,c=typeof i=="number"&&i!==null,k=typeof r=="number"&&r!==null;return!c&&!k?0:c?k?r-i:-1:1}),w.value.filter(o=>!!o.voting)):[]),p=U(()=>w.value.filter(o=>!!o.planned));function K(o){return o?A.value?"https://mmhhhh.de/data/home/recipes/"+o+"/image.jpg":q.value+"api/"+_.value.userId+"/recipes/"+o+"/image":""}async function M(o){A.value?window.open("https://mmhhhh.de/recipes/go?id="+o.id,"_blank","noopener"):window.open("/recipes/go?id="+o.id,"_blank","noopener")}async function X(o){const t={planned:!0,voting:0};await R.updateRecipe(_.value.userId,o,t),await h(),R.uploadRecipeToGithub(_.value.userId,null)}async function ee(){N.value().then(async o=>{if(o){let t=C.value;for(const i of t){const r={voting:0};await R.updateRecipe(_.value.userId,i.id,r)}await h()}})}async function te(o){const t={voting:0};await R.updateRecipe(_.value.userId,o,t),await h()}async function ne(){B.value().then(async o=>{if(o){let t=p.value;for(const i of t){const r={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await R.updateRecipe(_.value.userId,i.id,r)}await h(),R.uploadRecipeToGithub(_.value.userId,null)}})}async function oe(){const o=p.value.filter(t=>!t.ordered).map(t=>t.id);o&&o.length>0&&S.value(o).then(t=>{h()})}async function O(o){const t=o.id,i={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await R.updateRecipe(_.value.userId,t,i),await h(),R.uploadRecipeToGithub(_.value.userId,null);let r=_.value.calendarPlan;if(r||(r={}),o.cooked){const c=new Date;for(const k of Object.keys(r))r[k]&&r[k].recipeId===t&&(new Date(k).getTime()<=c.getTime()?r[k].cooked=!0:r[k].cooked||delete r[k])}else for(const c of Object.keys(r))r[c]&&r[c].recipeId===t&&!r[c].cooked&&delete r[c];await me.saveCalendarPlan(_.value.userId,r)}async function h(){w.value=await V.getAllRecipes(_.value.userId);let t=(await $.getAuthInfo()).calendarPlan;t||(t={}),b.value={};for(const i of Object.keys(t))t[i]&&t[i].type==="RECIPE"&&t[i].recipeId&&(b.value[t[i].recipeId]=new Date(i))}function E(o){S.value(o).then(t=>{h()})}function se(o){Z.value(o)}return(o,t)=>{const i=f("v-btn"),r=f("v-rating"),c=f("v-icon"),k=f("v-carousel-item"),le=f("v-carousel"),ae=f("v-divider"),P=f("v-list-item-title"),D=f("v-list-item"),ie=f("v-list"),re=f("v-menu"),de=f("v-toolbar"),ue=f("v-img"),ce=f("v-card"),ve=f("v-col"),fe=f("v-row");return n(),v("div",null,[s("div",Ce,[t[11]||(t[11]=s("h2",{class:"mt-6 text-center"},"Vorschläge",-1)),C.value&&C.value.length>0?(n(),u(i,{key:0,variant:"plain",class:"text-center",onClick:ee},{default:a(()=>[...t[4]||(t[4]=[m("Alle Likes entfernen",-1)])]),_:1})):l("",!0),s("div",xe,[C.value.length===0?(n(),v("div",Pe,[...t[5]||(t[5]=[s("div",{style:{"font-size":"1.2em"}},"Keine Vorschläge vorhanden!",-1)])])):l("",!0),C.value.length>0?(n(),u(le,{key:1,"hide-delimiter-background":"","hide-delimiters":C.value.length===1},{default:a(()=>[(n(!0),v(L,null,F(C.value,e=>(n(),u(k,{cover:"",src:K(e?e.id:null),key:e.id},{default:a(()=>[s("div",De,[s("div",ze,[e.rating?(n(),v("div",Ve,[d(r,{modelValue:e.rating,"onUpdate:modelValue":g=>e.rating=g,hover:"",length:"5",size:"20",readonly:"",color:"white"},null,8,["modelValue","onUpdate:modelValue"])])):l("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.imageInProgress&&!e.sectionsUploaded?(n(),v("div",Ae,[s("span",null,[d(c,{icon:"mdi-information-slab-circle"}),t[6]||(t[6]=m()),t[7]||(t[7]=s("b",null,"Nur Zutatenliste vorhanden!",-1))])])):l("",!0),s("div",Se,[e.duration?(n(),v("span",Me,[s("b",null,y(e.duration)+" Min.",1),t[8]||(t[8]=m(" | ",-1))])):l("",!0),s("span",null,[s("b",null,y(e.voting)+" x 👍",1)])])]),s("div",Ue,[s("span",{onClick:g=>M(e),style:{cursor:"pointer","text-decoration-line":"none","font-weight":"700","font-size":"2.04em",color:"#ffffff !important","background-color":"rgba(93,93,93,0.66)",hyphens:"auto","overflow-wrap":"break-word"},class:"text-medium-emphasis"},y(e.title),9,$e)]),s("div",null,[d(i,{onClick:g=>X(e.id),variant:"flat",color:"rgba(198, 217, 238, 0.7)",height:"50"},{default:a(()=>[...t[9]||(t[9]=[m("Rezept einplanen",-1)])]),_:1},8,["onClick"])]),s("div",null,[d(i,{onClick:g=>te(e.id),variant:"flat",color:"rgb(238 198 198 / 70%)",class:"mt-1"},{default:a(()=>[...t[10]||(t[10]=[m("Ignorieren",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["src"]))),128))]),_:1},8,["hide-delimiters"])):l("",!0)])]),d(ae,{class:"mt-4"}),s("div",Te,[t[23]||(t[23]=s("h2",{class:"mt-6 text-center"},"Ausgewählt",-1)),s("div",Ne,[p.value&&p.value.length>0?(n(),u(i,{key:0,variant:"outlined",onClick:oe,disabled:!j.value||j.value.length===0},{default:a(()=>[...t[12]||(t[12]=[m("Alle Zutaten einkaufen",-1)])]),_:1},8,["disabled"])):l("",!0),p.value&&p.value.length>0?(n(),u(i,{key:1,variant:"outlined",class:"ml-2",color:"red",onClick:ne},{default:a(()=>[...t[13]||(t[13]=[m("Alle entfernen",-1)])]),_:1})):l("",!0)]),d(fe,{class:"text-center mt-2",id:"recipesDiv"},{default:a(()=>[p.value.length===0?(n(),v("div",Be,[...t[14]||(t[14]=[s("div",{style:{"font-size":"1.2em"}},"Keine geplanten Rezepte gefunden!",-1)])])):l("",!0),(n(!0),v(L,null,F(p.value,e=>(n(),u(ve,{cols:"12",sm:"12",md:"6",lg:"4",xl:"3",key:e.id},{default:a(()=>[d(ce,{class:"mx-auto","max-width":"374",draggable:"true",onDragstart:g=>o.onDragStart(e)},{default:a(()=>[(n(),u(ue,{class:"position-relative",height:"200",src:K(e?e.id:null),key:T.value[e.id]?T.value[e.id]:0,color:"grey",cover:""},{default:a(()=>[s("div",Ze,[e.duration?(n(),v("div",je,[s("b",null,y(e.duration)+" Min.",1)])):l("",!0),s("div",Ke,[!e.ingredientsInProgress&&!e.sectionsInProgress&&e.sectionsUploaded?(n(),v("a",{key:0,target:"_blank",href:"/recipes/go?id="+e.id,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},y(e.title),9,Oe)):l("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.sectionsUploaded?(n(),v("span",Ee,y(e.title),1)):l("",!0)])]),s("div",Ge,[s("div",Ye,[b.value[e.id]?(n(),u(c,{key:0,icon:"mdi-check-bold"})):l("",!0),b.value[e.id]?l("",!0):(n(),u(c,{key:1,icon:"mdi-close-thick",color:"red"})),b.value[e.id]?(n(),v("b",Le,"Geplant "+y(z(H).format(b.value[e.id]))+", "+y(z(Ie)(b.value[e.id])),1)):l("",!0),b.value[e.id]?l("",!0):(n(),v("b",Fe,"Kein Datum festgelegt"))]),s("div",Je,[e.ordered?(n(),u(c,{key:0,icon:"mdi-check-bold"})):l("",!0),e.ordered?l("",!0):(n(),u(c,{key:1,icon:"mdi-close-thick",color:"red"})),t[15]||(t[15]=s("b",null,"Zutaten bestellt",-1))]),e.sectionsUploaded&&!e.sectionsInProgress?(n(),v("div",Qe,[e.cooked?(n(),u(c,{key:0,icon:"mdi-check-bold"})):l("",!0),e.cooked?l("",!0):(n(),u(c,{key:1,icon:"mdi-close-thick",color:"red"})),e.cooked?l("",!0):(n(),v("b",We,"Noch nicht zubereitet")),e.cooked&&!e.lastCookedAt?(n(),v("b",qe,"Rezept zubereitet")):l("",!0),e.cooked&&e.lastCookedAt?(n(),v("b",He,"Zubereitet am "+y(z(we)(e.lastCookedAt)),1)):l("",!0)])):l("",!0)]),d(de,{color:"transparent"},{append:a(()=>[d(re,null,{activator:a(({props:g})=>[!e.imageInProgress&&!e.sectionsInProgress&&!e.ingredientsInProgress?(n(),u(i,he({key:0,icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},g),{default:a(()=>[d(c,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)):l("",!0)]),default:a(()=>[d(ie,null,{default:a(()=>[d(D,{onClick:g=>E(e.id)},{default:a(()=>[d(P,null,{default:a(()=>[...t[16]||(t[16]=[m("Zutaten einkaufen",-1)])]),_:1})]),_:1},8,["onClick"]),e.sectionsUploaded&&!e.sectionsInProgress?(n(),u(D,{key:0,onClick:g=>M(e,!0)},{default:a(()=>[d(P,null,{default:a(()=>[...t[17]||(t[17]=[m("Rezept zubereiten",-1)])]),_:1})]),_:1},8,["onClick"])):l("",!0),z(A)?l("",!0):(n(),u(D,{key:1,onClick:g=>se(e)},{default:a(()=>[d(P,null,{default:a(()=>[...t[18]||(t[18]=[m("Daten importieren",-1)])]),_:1})]),_:1},8,["onClick"])),d(D,{onClick:g=>O(e)},{default:a(()=>[d(P,null,{default:a(()=>[...t[19]||(t[19]=[m("Aus Planung entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])),s("div",Xe,[!e.ordered&&!e.cooked?(n(),u(i,{key:0,variant:"outlined",onClick:g=>E(e.id)},{default:a(()=>[...t[20]||(t[20]=[m("Zutaten einkaufen",-1)])]),_:1},8,["onClick"])):l("",!0)]),s("div",et,[e.ordered&&!e.cooked&&e.sectionsUploaded&&!e.sectionsInProgress?(n(),u(i,{key:0,variant:"outlined",onClick:g=>M(e,!0),color:"blue"},{default:a(()=>[...t[21]||(t[21]=[m("Rezept zubereiten",-1)])]),_:1},8,["onClick"])):l("",!0)]),s("div",tt,[e.sectionsUploaded&&!e.sectionsInProgress&&e.cooked||!(e.sectionsUploaded&&!e.sectionsInProgress)&&e.ordered?(n(),u(i,{key:0,variant:"outlined",color:"red",onClick:g=>O(e)},{default:a(()=>[...t[22]||(t[22]=[m("Aus Planung entfernen",-1)])]),_:1},8,["onClick"])):l("",!0)])]),_:2},1032,["onDragstart"])]),_:2},1024))),128))]),_:1})]),d(ge,{onResult:t[0]||(t[0]=e=>S.value=e)}),d(Re,{onResult:t[1]||(t[1]=e=>Z.value=e)}),d(G,{onResult:t[2]||(t[2]=e=>N.value=e),title:"Bitte bestätigen",message:"Sollen alle vorgeschlagenen Rezepte entfernt werden?"}),d(G,{onResult:t[3]||(t[3]=e=>B.value=e),title:"Bitte bestätigen",message:"Sollen alle geplanten Rezepte aus der Planung entfernt werden?"})])}}},ot=_e(nt,[["__scopeId","data-v-e44885a1"]]),rt={__name:"index",setup(I){return W(async()=>{Q()}),(V,w)=>(n(),u(ot))}};export{rt as default};
