import{K as _,W as u,a8 as Z,_ as me,M as ve,L as fe,u as ge,N as he,r as b,o as _e,g,P as M,y as p,C as d,B as o,a9 as ye,O as U,z as m,D as P,A as I,x as h,Q as f,R as be,S as we,T as ke,aa as q}from"./CGHT5vID.js";const Q={convertToBringUrl:function(l){let n=[];for(const x of l){const C=[];C.push(x.name),x.amount&&x.amount!==0&&C.push(x.amount+(x.unit?" "+x.unit:"")),n.push(C.join("__"))}const s=n.join("---"),t=btoa(unescape(encodeURIComponent(s)));let S="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return S=encodeURIComponent(S),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+S+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeIngredients:async function(l,n,s){const t=_();try{const r=new FormData;return r.append("image",s),await Z.post(t.lanAddress+"api/"+l+"/recipes/"+n+"/import/image/ingredients",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){u.catchError(r)}},analyzeSections:async function(l,n,s){const t=_();try{const r=new FormData;return r.append("image",s),await Z.post(t.lanAddress+"api/"+l+"/recipes/"+n+"/import/image/sections",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){u.catchError(r)}},uploadImage:async function(l,n,s){const t=_();try{const r=new FormData;return r.append("image",s),await Z.post(t.lanAddress+"api/"+l+"/recipes/"+n+"/import/image",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){u.catchError(r)}},generateImage:async function(l,n){const s=_();try{return await u.post(s.lanAddress+"api/"+l+"/recipes/"+n+"/import/generateImage")}catch(t){u.catchError(t)}},loginPicnic:async function(l,n){const s=_();try{return await u.post(s.lanAddress+"api/"+l+"/loginPicnic",n)}catch(t){u.catchError(t)}},searchPicnic:async function(l,n,s,t=!1){const r=_();try{return await u.post(r.lanAddress+"api/"+l+"/picnic/search",{query:n,ingredientDescription:s,useChatGpt:t})}catch(S){u.catchError(S)}},addProductToPicnicShoppingCart:async function(l,n){const s=_();try{return await u.post(s.lanAddress+"api/"+l+"/picnic/addProductToShoppingCart",{productId:n})}catch(t){u.catchError(t)}}},$={getRecipe:async function(l,n){const s=_();try{if(s.isNetworkAccess){let t=s.lanAddress+"api/"+l+"/recipes/"+n;return(await u.get(t)).data}else return(await u.get("https://mmhhhh.de/data/home/recipes.json")).data[n]}catch(t){u.catchError(t)}},getRecipeIngredients:async function(l,n){const s=_();try{let t;return s.isNetworkAccess?t=s.lanAddress+"api/"+l+"/recipes/"+n+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+n+"/ingredients.json",await u.get(t)}catch(t){u.catchError(t)}},getRecipeSections:async function(l,n){const s=_();try{let t;return s.isNetworkAccess?t=s.lanAddress+"api/"+l+"/recipes/"+n+"/sections":t="https://mmhhhh.de/data/home/recipes/"+n+"/sections.json",await u.get(t)}catch(t){u.catchError(t)}},updateRecipe:async function(l,n,s){const t=_();try{return await u.put(t.lanAddress+"api/"+l+"/recipes/"+n,s)}catch(r){u.catchError(r)}},uploadRecipeToGithub:async function(l,n){const s=_();let t={};n&&(t.recipeId=n);try{return await u.put(s.lanAddress+"api/"+l+"/recipes/githubUpload",t)}catch(r){u.catchError(r)}},deleteRecipe:async function(l,n){const s=_();try{return await u.post(s.lanAddress+"api/"+l+"/recipes/"+n+"/delete")}catch(t){u.catchError(t)}}},Pe={methods:{formatCurrency(l){return"€ "+(""+(Math.round(l*100)/100).toFixed(2)).replace(".",",")}}},Ie={class:"d-flex justify-space-between align-center"},Se={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},xe={class:"text-h6 text-medium-emphasis"},Ce={key:0},Re={class:"text-right mt-3"},Ae={style:{width:"100%","text-align":"right"}},De=["colspan"],Ve={key:0,class:"pl-6"},Ee={key:0},Ue={key:1},Te={key:1,class:"py-2"},Be={style:{"font-size":"0.8em"}},ze={key:0},Ne={key:1},je={key:0},Le={key:0},Fe={key:1},Me={key:0,class:"px-0 mx-0"},Qe={style:{"max-width":"200px"}},$e={class:"my-2"},Oe={class:"my-2"},Ze={class:"my-2"},qe={class:"text-right"},Ge={key:0,class:"mt-3"},Ke={class:"mt-2"},We={__name:"IngredientsDialog",emits:["result"],setup(l,{emit:n}){const s=ve(),t=_(),{authInfo:r,githubMode:S}=fe(t),x=n;ge(),he();const C=b(!1),G=b(null),ae=b(null),N=b(null),k=b(null),v=b(null),j=b(null),L=b(2),T=b(!1),D=b(!1),B=b(!1),V=b(!1),z=b({name:null,password:null});_e(async()=>{x("result",async i=>{if(N.value=i,j.value=null,k.value=null,v.value=null,B.value=!1,V.value=!1,D.value=!1,L.value=2,K(),await W(!0),k.value.planned){const e={ordered:!0};await $.updateRecipe(r.value.userId,k.value.id,e),await W(!0)}return C.value=!0,new Promise((e,c)=>{G.value=e,ae.value=c})})});async function K(){let i=await t.getAuthInfo();T.value=i.picnicLoggedIn}async function W(i){k.value=await $.getRecipe(r.value.userId,N.value),k.value.ingredients=(await $.getRecipeIngredients(r.value.userId,N.value)).data,J(i)}async function ne(){await Q.loginPicnic(r.value.userId,z.value),await K()}function se(){C.value=!1,G.value(!1)}async function H(){let i=v.value.filter(e=>e.bring);j.value=Q.convertToBringUrl(i)}async function ie(){let i=v.value.filter(y=>y.picnic);for(const y of i)if(y.selectedPicnicProduktId){let w=y.picnicResults.find(A=>A.id===y.selectedPicnicProduktId).multiplier;w||(w=1);for(let A=1;A<=w;A++)await Q.addProductToPicnicShoppingCart(r.value.userId,y.selectedPicnicProduktId)}D.value=!0;const c={picnicPurchaseDate:new Date().toISOString()};await $.updateRecipe(r.value.userId,N.value,c)}function J(i){let e=k.value.portions?k.value.portions:2;v.value=[],k.value.ingredients.forEach(c=>{v.value.push({name:c.name,basicName:c.basicName,unit:c.unit,amount:Math.ceil(c.amount/e*L.value),standardIngredient:c.standardIngredient})}),i&&oe(),H()}function oe(){v.value.forEach(i=>{i.standardIngredient?(i.bring=!1,i.picnic=!1):(i.bring=!0,i.picnic=!1)}),V.value=v.value.filter(i=>!!i.bring).length>0,v.value=v.value.sort((i,e)=>!i.bring&&!e.bring?0:!i.bring&&e.bring?1:i.bring&&!e.bring?-1:(i.bring&&e.bring,0))}async function le(){v.value.forEach(i=>{i.bring&&F("picnic",i)})}async function F(i,e){if(i==="bring")e.bring=!0,e.picnic=!1,B.value=v.value.filter(c=>!!c.picnic).length>0,V.value=v.value.filter(c=>!!c.bring).length>0;else if(i==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const c=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await Q.searchPicnic(r.value.userId,e.basicName,c,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),B.value=v.value.filter(y=>!!y.picnic).length>0,V.value=v.value.filter(y=>!!y.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,B.value=v.value.filter(c=>!!c.picnic).length>0,V.value=v.value.filter(c=>!!c.bring).length>0;H()}return(i,e)=>{const c=g("v-btn"),y=g("v-card-title"),w=g("v-img"),A=g("v-text-field"),X=g("v-card-text"),Y=g("v-card"),ee=g("v-select"),te=g("v-icon"),re=g("v-progress-linear"),ce=g("v-list-item"),O=g("v-col"),ue=g("v-row"),de=g("v-table"),pe=g("v-dialog");return p(),M(pe,{"max-width":"600",modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=a=>C.value=a),fullscreen:U(s).smAndDown.value},{default:d(()=>[o(Y,{style:{"background-color":"white"},class:ye({"pa-4":!U(s).smAndDown.value})},{default:d(()=>[o(y,{style:{"white-space":"normal"}},{default:d(()=>[m("div",Ie,[m("div",Se,[e[5]||(e[5]=P(" Zutaten einkaufen ",-1)),m("div",xe,I(k.value.title),1)]),o(c,{icon:"mdi-close",variant:"text",onClick:se})])]),_:1}),o(X,null,{default:d(()=>[k.value?(p(),h("div",Ce,[!T.value&&!U(S)?(p(),M(Y,{key:0,class:"mb-4"},{default:d(()=>[o(y,null,{default:d(()=>[o(w,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[6]||(e[6]=P(" Bei Picnic einloggen ",-1))]),_:1}),o(X,null,{default:d(()=>[o(A,{modelValue:z.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>z.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),o(A,{modelValue:z.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>z.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),m("div",Re,[o(c,{variant:"outlined",onClick:ne},{default:d(()=>[...e[7]||(e[7]=[P("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):f("",!0),e[12]||(e[12]=m("h3",null,"Anzahl Portionen",-1)),o(ee,{modelValue:L.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>L.value=a),J],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[13]||(e[13]=m("h3",null,"Zutatenliste",-1)),m("div",Ae,[o(c,{variant:"flat",onClick:e[3]||(e[3]=a=>le()),class:"mb-1 my-1"},{default:d(()=>[o(w,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[8]||(e[8]=P(" Alles bei Picnic einkaufen ",-1))]),_:1})]),o(de,{class:"table-ingredients"},{default:d(()=>[m("tbody",null,[(p(!0),h(be,null,we(v.value,a=>(p(),h("tr",{key:a.name},[m("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?f("",!0):(p(),h("div",Ve,[a.amount?(p(),h("span",Ee,I(a.amount),1)):f("",!0),e[9]||(e[9]=P()),a.unit?(p(),h("span",Ue,I(a.unit),1)):f("",!0)])),a.picnic?(p(),h("div",Te,[m("div",Be,[o(te,{icon:"mdi-arrow-right"}),e[10]||(e[10]=P()),a.amount?(p(),h("span",ze,I(a.amount),1)):f("",!0),e[11]||(e[11]=P()),a.unit?(p(),h("span",Ne,I(a.unit),1)):f("",!0),P(" "+I(a.name),1)]),a.picnic?(p(),h("div",je,[a.loading?(p(),M(re,{key:0,indeterminate:""})):f("",!0),o(ee,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":E=>a.selectedPicnicProduktId=E,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":"",disabled:a.loading},{item:d(({props:E,item:R})=>[o(ce,ke({ref_for:!0},E),{default:d(()=>[m("h4",null,[R.raw.multiplier&&R.raw.multiplier>1?(p(),h("span",Le,I(R.raw.multiplier)+"x ",1)):f("",!0),R.raw.unitQuantity&&R.raw.unitQuantity!=="undefined"?(p(),h("span",Fe,I(R.raw.unitQuantity),1)):f("",!0)]),m("h5",null,I(U(Pe).methods.formatCurrency(R.raw.price/100)),1),o(w,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${R.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])])):f("",!0)])):f("",!0)],8,De),a.picnic?f("",!0):(p(),h("td",Me,I(a.name),1)),m("td",Qe,[o(ue,{class:"px-0 mx-0",style:{width:"180px"}},{default:d(()=>[o(O,{cols:"3"},{default:d(()=>[m("div",$e,[o(c,{variant:"flat",style:q({opacity:a.bring?1:.3}),onClick:E=>F("bring",a),class:"mx-0"},{default:d(()=>[o(w,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),U(S)?f("",!0):(p(),M(O,{key:0,cols:"3"},{default:d(()=>[m("div",Oe,[o(c,{variant:"plain",style:q({opacity:a.picnic?1:.3}),disabled:!T.value||D.value,onClick:E=>F("picnic",a)},{default:d(()=>[o(w,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),o(O,{cols:"4"},{default:d(()=>[m("div",Ze,[o(c,{variant:"plain",style:q({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!T.value||D.value,onClick:E=>F(null,a)},{default:d(()=>[o(te,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):f("",!0),m("div",qe,[U(S)?f("",!0):(p(),h("div",Ge,[o(c,{variant:"outlined",rounded:"",onClick:ie,"prepend-icon":D.value?"mdi-check":null,disabled:!T.value||D.value||!B.value},{default:d(()=>[o(w,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[14]||(e[14]=P(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),m("div",Ke,[o(c,{link:"",variant:"outlined",rounded:"",href:j.value,disabled:j.value===null||!V.value,target:"_blank",class:"ml-2"},{default:d(()=>[o(w,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=P(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"])}}},Je=me(We,[["__scopeId","data-v-c376977b"]]);export{Je as I,$ as R,Q as a};
