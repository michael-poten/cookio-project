import{_ as Se,O as De,r as n,K as he,N as Fe,u as je,W as _e,o as ze,$ as Be,e as $e,g as y,x as r,y as o,B as t,C as u,R as i,Q as $,a6 as k,D as s,z as d,a7 as h,S as L,a8 as F,X as Le}from"./CSQU4AtQ.js";import{I as M,R as Me}from"./C6kbBVjZ.js";import{f as Te}from"./BtHaaEq5.js";const Ae={key:0,style:{"font-size":"1.3em"}},Ee={key:1,style:{"font-size":"1.3em"}},Ve={key:2},Oe={key:0},Ne={key:0},Ze={key:1,class:"mt-3"},Pe={key:2,class:"mt-3"},qe={key:0,class:"mt-3"},He={key:1},We={class:"ma-4"},Ke={key:0,class:"mt-3"},Qe={key:1},Xe={key:1,class:"mx-2 mt-2 mb-2"},Ge={key:2,class:"ml-2 mt-3"},Je={key:0},Ye={key:1,class:"mt-3"},el={key:2,class:"mt-3"},ll={__name:"RecipeImportDialog",emits:["result"],setup(tl,{emit:ue}){const T=De(),oe=n({aspectRatio:1.3}),N=n(null),R=n(null),x=n(null),ie=n("image/jpeg"),se=n(.9),de=n(!1),b=n(null),w=n(null),U=n(null),C=n(null),re=he(),{authInfo:j}=Fe(re),ve=ue;je(),_e();const _=n(!1),A=n(null),pe=n(null),S=n(null),v=n(!1),p=n(null),m=n(!1),Z=n(null),P=n(!1),z=n(!1),q=n(!1),B=n(!1),E=n(!1),Q=n(!1);n(!0);const H=n(!0),V=n(!0),W=n([]),X=n([]),K=n(!1);ze(async()=>{ve("result",async l=>(G(l),_.value=!0,new Promise((e,a)=>{A.value=e,pe.value=a})))}),Be(W,l=>{X.value=[...l].sort((e,a)=>e.name.localeCompare(a.name)),Ie(X.value)});function G(l){p.value=null,Z.value=null,z.value=null,v.value=!1,w.value=null,U.value=null,C.value=null,m.value=!1,P.value=!1,q.value=!1,B.value=!1,R.value=null,b.value=null,l?(S.value=l.id,v.value=!0,l.sectionsUploaded?V.value=!1:V.value=!0,H.value=!1):(S.value=ae(),H.value=!0,V.value=!0)}async function ce(){K.value&&await Me.planRecipe(j.value.userId,S.value)}function fe(){_.value=!1,A.value(null)}async function me(){R.value&&!z.value&&await ne(),_.value=!1,A.value(S.value)}async function ge(){R.value&&!z.value&&await ne(),G()}function J(l){const e=l.target.files;e&&e.length>0&&(w.value=e[0]),Y()}function ye(l){const e=l.dataTransfer.files;e&&e.length>0&&(w.value=e[0]),Y()}function ke(l){const e=l.dataTransfer.files;if(e&&e.length>0){const a=Array.from(e);W.value=Array.from(a)}}async function Y(){if(w.value){m.value=!0;try{p.value=(await M.analyzeIngredients(j.value.userId,S.value,w.value)).data,m.value=!1}catch{m.value=!1}}}function ee(l){const e=l.target.files;e&&e.length>0&&(U.value=e[0]),le()}function xe(l){const e=l.dataTransfer.files;e&&e.length>0&&(U.value=e[0]),le()}async function le(){if(U.value&&!(!p.value&&!v.value)){P.value=!0;try{Z.value=(await M.analyzeSections(j.value.userId,S.value,U.value)).data}catch{}}}function te(l){const e=l.target.files;e&&e.length>0&&(C.value=e[0]);const a=URL.createObjectURL(C.value);x.value&&URL.revokeObjectURL(x.value),x.value=a,R.value=a}function be(l){const e=l.dataTransfer.files;e&&e.length>0&&(C.value=e[0]);const a=URL.createObjectURL(C.value);x.value&&URL.revokeObjectURL(x.value),x.value=a,R.value=a}async function ne(){if(!C.value||!p.value&&!v.value||(q.value=!0,!N.value))return;const l=N.value.getResult(),e=l&&l.canvas;if(!e)return;const a=ie.value,g=a==="image/jpeg"||a==="image/webp"?se.value:void 0;de.value=!0;const c=await new Promise((I,D)=>{e.toBlob(O=>O?I(O):D(new Error("toBlob() failed")),a,g)});try{await M.uploadImage(j.value.userId,S.value,c),z.value=!0,b.value&&URL.revokeObjectURL(b.value),b.value=URL.createObjectURL(c)}catch{}}$e(()=>{x.value&&URL.revokeObjectURL(x.value),b.value&&URL.revokeObjectURL(b.value)});function ae(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const e=Math.random()*16|0;return(l==="x"?e:e&3|8).toString(16)})}function Ce(l){const e=Array.from(l.target.files);W.value=e}async function Ie(l){E.value=!0;try{for(let e=0;e<l.length;e+=2){const a=l[e],g=l[e+1]||null,c=ae();await M.analyzeIngredients(j.value.userId,c,a),await M.analyzeSections(j.value.userId,c,g)}}catch{}E.value=!1,m.value=!1,setTimeout(()=>{_.value=!1,A.value(!0)},500)}return(l,e)=>{const a=y("v-btn"),g=y("v-card-title"),c=y("v-icon"),I=y("v-card-text"),D=y("v-card"),O=y("v-img"),Re=y("v-checkbox"),we=y("v-card-actions"),Ue=y("v-dialog");return o(),r("div",null,[t(Ue,{"max-width":"600",modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=f=>_.value=f)},{default:u(()=>[t(D,{style:{"background-color":"white"},class:"text-center"},{default:u(()=>[t(g,{class:"px-4 py-4 pb-0"},{default:u(()=>[v.value?i("",!0):(o(),r("div",Ae,"Rezept hinzufügen")),v.value?(o(),r("div",Ee,"Bild ändern")):i("",!0),v.value?i("",!0):(o(),r("div",Ve,[B.value?i("",!0):(o(),$(a,{key:0,variant:"plain",style:{"font-size":"0.7em"},onClick:e[0]||(e[0]=k(f=>B.value=!0,["prevent"])),"prepend-icon":"mdi-arrow-right"},{default:u(()=>[...e[14]||(e[14]=[s("Zum Multi-Dateiupload",-1)])]),_:1}))]))]),_:1}),t(I,{class:"ma-0 pa-0 text-center"},{default:u(()=>[B.value?i("",!0):(o(),r("div",Oe,[H.value?(o(),r("div",{key:0,onDrop:k(ye,["prevent"]),onDragover:e[3]||(e[3]=k(()=>{},["prevent"]))},[t(D,{rounded:"",loading:m.value,elevation:"0",color:"white"},{default:u(()=>[d("div",null,[d("div",null,[t(g,null,{default:u(()=>[...e[15]||(e[15]=[s(" Zutatenliste ",-1)])]),_:1}),t(I,null,{default:u(()=>[e[20]||(e[20]=s(" Erkennt sämtliche Zutaten aus der Zutatenliste. Dabei wird insbesondere der Fokus auf die Menge und den Namen gelegt. ",-1)),!m.value&&!p.value&&!w.value?(o(),r("div",Ne,[d("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[1]||(e[1]=f=>l.$refs.uploadIngredients.click())},{default:u(()=>[...e[16]||(e[16]=[s("Bild hochladen ",-1)])]),_:1})]),d("div",null,[L(T).smAndDown.value?(o(),$(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-camera-enhance",onClick:e[2]||(e[2]=f=>l.$refs.uploadIngredientsCamera.click())},{default:u(()=>[...e[17]||(e[17]=[s("Foto machen ",-1)])]),_:1})):i("",!0)])])):i("",!0),m.value&&!p.value?(o(),r("div",Ze,[t(c,{icon:"mdi-sync"}),e[18]||(e[18]=s(" Analyse läuft... ",-1))])):i("",!0),p.value?(o(),r("div",Pe,[t(c,{icon:"mdi-check"}),e[19]||(e[19]=s(" Upload abgeschlossen. ",-1))])):i("",!0)]),_:1})])]),h(d("input",{type:"file",id:"uploadIngredients",ref:"uploadIngredients",onChange:J,accept:"image/png,image/jpeg"},null,544),[[F,!1]]),h(d("input",{type:"file",id:"uploadIngredientsCamera",ref:"uploadIngredientsCamera",capture:"environment",onChange:J,accept:"image/png,image/jpeg"},null,544),[[F,!1]])]),_:1},8,["loading"])],32)):i("",!0),V.value?(o(),r("div",{key:1,class:"mt-2",onDrop:k(xe,["prevent"]),onDragover:e[6]||(e[6]=k(()=>{},["prevent"]))},[t(D,null,{default:u(()=>[d("div",null,[d("div",null,[t(g,{class:"text-center"},{default:u(()=>[...e[21]||(e[21]=[s(" Tätigkeitsschritte ",-1)])]),_:1}),t(I,{class:"text-center"},{default:u(()=>[e[25]||(e[25]=s(" Erfasst alle Arbeitsschritte, den Titel, die Zubereitungsdauer und generiert Schlagwörter. Wird im Hintergrund analysiert. ",-1)),U.value&&!Z.value&&P.value?(o(),r("div",qe,[t(c,{icon:"mdi-check"}),e[22]||(e[22]=s(" Upload abgeschlossen. ",-1))])):i("",!0),U.value?i("",!0):(o(),r("div",He,[d("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[4]||(e[4]=f=>l.$refs.uploadSections.click())},{default:u(()=>[...e[23]||(e[23]=[s("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),d("div",null,[L(T).smAndDown.value?(o(),$(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-camera-enhance",onClick:e[5]||(e[5]=f=>l.$refs.uploadSectionsCamera.click())},{default:u(()=>[...e[24]||(e[24]=[s("Foto machen ",-1)])]),_:1},8,["disabled"])):i("",!0)])]))]),_:1})])]),h(d("input",{type:"file",id:"uploadSections",ref:"uploadSections",onChange:ee,accept:"image/png,image/jpeg"},null,544),[[F,!1]]),h(d("input",{type:"file",id:"uploadSectionsCamera",ref:"uploadSectionsCamera",capture:"environment",onChange:ee,accept:"image/png,image/jpeg"},null,544),[[F,!1]])]),_:1})],32)):i("",!0),d("div",{class:"mt-2",onDrop:k(be,["prevent"]),onDragover:e[9]||(e[9]=k(()=>{},["prevent"]))},[t(D,null,{default:u(()=>[d("div",null,[d("div",null,[t(g,{class:"ma-2 pa-0 text-center"},{default:u(()=>[...e[26]||(e[26]=[s(" Rezeptbild ",-1)])]),_:1}),t(I,{class:"ma-0 pa-0 text-center"},{default:u(()=>[d("div",We,[e[30]||(e[30]=s(" Hier kann ein Bild vom zubereiteten Rezept hochgeladen werden. ",-1)),C.value&&!z.value&&q.value?(o(),r("div",Ke,[t(c,{icon:"mdi-check"}),e[27]||(e[27]=s(" Upload abgeschlossen. ",-1))])):i("",!0),C.value?i("",!0):(o(),r("div",Qe,[d("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[7]||(e[7]=f=>l.$refs.uploadImage.click())},{default:u(()=>[...e[28]||(e[28]=[s("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),d("div",null,[L(T).smAndDown.value?(o(),$(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-camera-enhance",onClick:e[8]||(e[8]=f=>l.$refs.uploadImageCamera.click())},{default:u(()=>[...e[29]||(e[29]=[s("Foto machen ",-1)])]),_:1},8,["disabled"])):i("",!0)])]))]),R.value&&!z.value?(o(),r("div",{key:0,style:Le({width:L(T).smAndDown.value?"370px":"580px"})},[t(L(Te),{ref_key:"cropperRef",ref:N,src:R.value,"stencil-props":oe.value,"auto-zoom":!1,"image-restriction":"stencil",transitions:!0,debounce:150},null,8,["src","stencil-props"])],4)):i("",!0),b.value?(o(),r("div",Xe,[e[31]||(e[31]=d("p",{class:"text-sm text-gray-600"},"Bild erfolgreich hochgeladen!",-1)),t(O,{src:b.value,alt:"Cropped preview",class:"mt-1 w-full rounded border"},null,8,["src"])])):i("",!0)]),_:1})])]),h(d("input",{type:"file",id:"uploadImage",ref:"uploadImage",onChange:te,accept:"image/png,image/jpeg"},null,544),[[F,!1]]),h(d("input",{type:"file",id:"uploadImageCamera",ref:"uploadImageCamera",capture:"environment",onChange:te,accept:"image/png,image/jpeg"},null,544),[[F,!1]])]),_:1})],32),v.value?i("",!0):(o(),r("div",Ge,[t(Re,{modelValue:K.value,"onUpdate:modelValue":[e[10]||(e[10]=f=>K.value=f),ce],"hide-details":"",density:"comfortable",label:"Rezept nach Import sofort einplanen"},null,8,["modelValue"])]))])),B.value?(o(),r("div",{key:1,onDrop:k(ke,["prevent"]),onDragover:e[12]||(e[12]=k(()=>{},["prevent"]))},[t(D,{rounded:"",loading:E.value},{default:u(()=>[d("div",null,[d("div",null,[t(g,null,{default:u(()=>[...e[32]||(e[32]=[s(" Multi-Dateiupload ",-1)])]),_:1}),t(I,null,{default:u(()=>[e[36]||(e[36]=s(" Erkennt sämtliche Zutaten und Tätigkeitsschritte aus den hochgeladenen Bildern. Die Dateien werden immer pärchenweise entsprechend der alphabetischen Reihenfolge des Dateinamens analysiert. ",-1)),!m.value&&!p.value&&!w.value?(o(),r("div",Je,[d("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[11]||(e[11]=f=>l.$refs.uploadMulti.click())},{default:u(()=>[...e[33]||(e[33]=[s("Bilder hochladen ",-1)])]),_:1})])])):i("",!0),E.value&&!Q.value?(o(),r("div",Ye,[t(c,{icon:"mdi-sync"}),e[34]||(e[34]=s(" Upload läuft... ",-1))])):i("",!0),Q.value?(o(),r("div",el,[t(c,{icon:"mdi-check"}),e[35]||(e[35]=s(" Upload abgeschlossen. ",-1))])):i("",!0)]),_:1})])]),h(d("input",{type:"file",id:"uploadMulti",ref:"uploadMulti",multiple:"",onChange:Ce,accept:"image/png,image/jpeg"},null,544),[[F,!1]])]),_:1},8,["loading"])],32)):i("",!0)]),_:1}),t(we,null,{default:u(()=>[t(a,{onClick:fe,rounded:"",variant:"outlined",text:"",color:"red"},{default:u(()=>[...e[37]||(e[37]=[s(" Abbrechen ",-1)])]),_:1}),t(a,{disabled:!p.value&&!v.value,onClick:me,rounded:"",variant:"outlined",text:""},{default:u(()=>[...e[38]||(e[38]=[s(" Fertig ",-1)])]),_:1},8,["disabled"]),v.value?i("",!0):(o(),$(a,{key:0,disabled:!p.value&&!v.value,onClick:ge,rounded:"",variant:"outlined",text:""},{default:u(()=>[...e[39]||(e[39]=[s(" Fertig und weiter ",-1)])]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ol=Se(ll,[["__scopeId","data-v-e768eae5"]]);export{ol as R};
