import{a0 as ze,M as le,K as ue,r as p,u as re,N as W,o as Q,g as r,O as L,y as i,C as a,B as o,z as s,x as u,R as U,S as A,A as I,D as y,a1 as ie,a2 as De,L as $e,a3 as ae,V as Me,k as K,P as _,Q as V,a4 as Ue,a5 as Ae,J as Ee}from"./7vDRmOQw.js";import{R as M,I as Ne}from"./DwokY33Z.js";import{_ as de}from"./DlAUqK2U.js";const Le=ze("/images/bellring.png"),Ze={class:"mt-3"},Be={__name:"TimerDialog",emits:["result"],setup(G,{emit:E}){le();const x=ue();p(x.authInfo);const P=E;re(),W().params.userId;const N=p(!1),k=p(null),l=p(null),w=p([]);Q(async()=>{P("result",async f=>(w.value=f,N.value=!0,new Promise((g,z)=>{k.value=g,l.value=z})))});function Z(){N.value=!1,k.value(!1)}return(f,g)=>{const z=r("v-card-title"),T=r("v-divider"),j=r("v-card-text"),q=r("v-btn"),B=r("v-card-actions"),h=r("v-card"),O=r("v-dialog");return i(),L(O,{"max-width":"600",persistent:"",modelValue:N.value,"onUpdate:modelValue":g[0]||(g[0]=D=>N.value=D)},{default:a(()=>[o(h,{style:{"background-color":"#fcfaf7"},class:"pa-4"},{default:a(()=>[o(z,null,{default:a(()=>g[1]||(g[1]=[s("h2",null,"Zeit abgelaufen!",-1)])),_:1,__:[1]}),o(j,null,{default:a(()=>[g[3]||(g[3]=s("div",{style:{width:"100%"},class:"text-center"},[s("div",{class:"vibrate"},[s("img",{alt:"bellring",src:Le,style:{width:"300px",height:"300px"},class:"mt-2"})])],-1)),o(T),s("div",Ze,[g[2]||(g[2]=s("h3",null,"Folgende Timer sind abgelaufen:",-1)),(i(!0),u(U,null,A(w.value,D=>(i(),u("div",{key:D.id,style:{"font-size":"1.6em"}}," - "+I(D.title),1))),128))])]),_:1,__:[3]}),o(B,null,{default:a(()=>[o(q,{onClick:Z,style:{width:"100%"},rounded:"",size:"50",variant:"outlined"},{default:a(()=>g[4]||(g[4]=[y(" Schließen ")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},je=de(Be,[["__scopeId","data-v-dbd91138"]]),qe={class:"mt-2"},Je={class:"mb-1 mt-2"},Oe={class:"text-medium-emphasis"},Fe={class:"mt-2"},He={class:"text-h4 text-medium-emphasis mt-4"},Ke={key:0,class:"mt-6"},We=["href"],Qe=["id"],Ge=["innerHTML"],Xe={key:1,class:"mt-6"},Ye={key:0,class:"mb-4"},et={key:1},tt={style:{"font-size":"0.9em"}},nt={class:"mt-4"},ot={class:"text-center",style:{"margin-top":"40px"}},st={key:0},it={class:"text-center mt-2"},at={class:"text-medium-emphasis mt-6"},lt={key:1,class:"custom-bottom-sheet no-print"},ut={class:"sheet-content",style:{"background-color":"rgb(226, 226, 226)"}},rt={key:0},dt={key:0},ct={key:1},vt={class:"text-center"},mt={style:{"background-color":"rgb(203, 203, 204)"}},pt={key:0},_t={style:{"font-size":"1.7em","border-radius":"6px","background-color":"#ffffff",color:"#3d3d3d"},class:"px-2"},ft={key:0},gt={key:1},ht={__name:"MealMaker",setup(G){ie.extend(De),le();const E=ue(),{authInfo:x,githubMode:P,lanAddress:J}=$e(E);re();const k=W().query.id,l=p(null),w=p(null),Z=p(2),f=p([]),g=p(null),z=p(!1),T=p(!1),j=p(null),q=p(null),B=p([]),h=p([]);Q(async()=>{l.value=null,w.value=null,await E.getAuthInfo(),await $(!0),l.value.planned&&(g.value=setTimeout(async()=>{const e={cooked:!0};await M.updateRecipe(x.value.userId,k,e),await $()},5*6e4));const t=localStorage.getItem("timers-"+k);if(t)try{const e=JSON.parse(t);e.forEach(d=>{d.isPaused=!0}),f.value=e.map(d=>({...d,timeoutId:null}))}catch(e){console.error("Timer konnte nicht geladen werden:",e)}}),ae(()=>{clearTimeout(g.value)}),Me(f,t=>{const e=t.map(({timeoutId:d,...c})=>c);localStorage.setItem("timers-"+k,JSON.stringify(e))},{deep:!0});const O=K(()=>!h||h.value.length===0?0:h.value.filter(t=>!t.ingredient&&t.duration).reduce((t,e)=>t+e.duration,0)),D=K(()=>!h||h.value.length===0?[]:h.value.filter(t=>!!t.ingredient)),ce=K(()=>!h||h.value.length===0?[]:h.value.filter(t=>!t.ingredient));function ve(){const t=[];l.value.ingredients.forEach(e=>{e.preparationRequired&&t.push({name:e.preparationLongText,ingredient:!0})}),l.value.sections.forEach(e=>{e.ingredientsPreparations&&e.ingredientsPreparations.length>0&&e.ingredientsPreparations.forEach(d=>{t.push({name:d.instruction,sectionIndex:e.index-1,duration:d.duration})})}),h.value=t}function me(t){return P.value?"https://mmhhhh.de/data/home/recipes/"+t.id+"/image.jpg":J.value+"api/"+x.value.userId+"/recipes/"+t.id+"/image"}function X(){window.close()}async function pe(){const t={preparations:[]};await M.updateRecipe(x.value.userId,k,t),await $(!0)}function _e(t){te(t),$()}async function fe(t){const e={rating:t};await M.updateRecipe(x.value.userId,k,e),await $()}async function Y(){if(!P.value){const t={preparations:h.value};await M.updateRecipe(x.value.userId,k,t),await $()}}async function $(t=!1){l.value=await M.getRecipe(x.value.userId,k),l.value.ingredients=(await M.getRecipeIngredients(x.value.userId,k)).data,l.value.sections=(await M.getRecipeSections(x.value.userId,k)).data,t&&(l.value.preparations&&l.value.preparations.length>0?h.value=l.value.preparations:ve()),te();const e=[];for(let d=0;d<l.value.sections.length;d++){let c=l.value.sections[d],b=c.description;if(c.timer&&c.timer.length>0)for(let v=0;v<c.timer.length;v++){let m=c.timer[v];b=b.replace(m.descriptionText,'<span class="pa-1 stopwatch-button" style="cursor: pointer; background-color: rgba(187,187,187,0.66); border: rgba(41,56,80,0.49) solid 3px; border-radius: 20px; color: #545454; font-size: 0.9em" data-id="'+v+'" data-sectionid="'+d+'"> ⏱ '+m.descriptionText+"</span >")}T.value||c.ingredientsPreparations.forEach(v=>{h.value.find(R=>R.checked&&d===R.sectionIndex&&R.name===v.instruction)&&(b=b.replace(v.instruction,'<span style="text-decoration-line: line-through;text-decoration-style: solid;text-decoration-thickness: 2px;text-underline-offset: 4px;">'+v.instruction+"</span>"))}),c.usedIngredients.forEach(v=>{const m=w.value.find(H=>H.name===v.ingredientNameList);let R="";m&&!e.includes(m.name)&&(R=m.amount?m.amount+(m.unit?" "+m.unit:"")+" ":"",e.push(m.name)),b=b.replace(v.ingredientNameText,"<b>"+R+v.ingredientNameText+"</b>")}),c.description=b}document.title=l.value.title+" - Cookio"}function ge(t){j.value(t)}function ee(){T.value=!T.value,$()}function te(t){t&&(Z.value=t);let e=l.value.portions?l.value.portions:2;w.value=[],l.value.ingredients.forEach(d=>{w.value.push({name:d.name,unit:d.unit,amount:d.amount/e*Z.value})})}function he(t){const e=t.target.closest(".stopwatch-button");if(e){const d=e.dataset.id,c=e.dataset.sectionid,b=parseInt(d,10),v=parseInt(c,10),m=l.value.sections[v].timer[b];f.value.push({id:v+"-"+b,title:m.title,remainingSeconds:m.duration*60,timerStarted:!1,isPaused:!1,timeoutId:null})}}const ke=t=>{const e=ie.duration(t*1e3),d=String(e.minutes()).padStart(2,"0"),c=String(e.seconds()).padStart(2,"0");return`${d}:${c}`};function ye(t){f.value=f.value.filter(e=>e.id!==t)}const F=t=>{t.isPaused||t.remainingSeconds<=0||f.value.find(e=>e.id===t.id)&&(console.log("tick",t.id),t.remainingSeconds--,t.remainingSeconds<=0&&(B.value.push(t),q.value(B.value).then(()=>{B.value=[],f.value=f.value.filter(e=>e.remainingSeconds>0)})),t.remainingSeconds>0?t.timeoutId=setTimeout(()=>F(t),1e3):t.timeoutId=null)},be=t=>{clearTimeout(t.timeoutId),t.timerStarted=!0,t.isPaused=!1,t.timeoutId=setTimeout(()=>F(t),1e3)},xe=t=>{t.isPaused=!t.isPaused,!t.isPaused&&t.remainingSeconds>0&&(t.timeoutId=setTimeout(()=>F(t),1e3))},Ie=t=>{t.remainingSeconds=t.remainingSeconds+60},Se=t=>{const e=t.remainingSeconds-60;t.remainingSeconds=Math.max(e,0)};return ae(()=>{f.value.forEach(t=>clearTimeout(t.timeoutId))}),(t,e)=>{const d=r("v-app-bar-nav-icon"),c=r("v-icon"),b=r("v-list-item-title"),v=r("v-list-item"),m=r("v-divider"),R=r("v-chip"),H=r("v-list"),we=r("v-menu"),Ce=r("v-app-bar"),S=r("v-btn"),Pe=r("v-img"),ne=r("v-checkbox"),Te=r("v-rating"),oe=r("v-container"),Re=r("v-table"),se=r("v-col"),Ve=r("v-row");return i(),u("div",null,[o(Ce,{collapse:"",elevation:0,color:"#6969695A",class:"no-print"},{prepend:a(()=>[o(we,null,{activator:a(({props:n})=>[o(d,Ue(Ae(n)),null,16)]),default:a(()=>[o(H,{class:"mt-2"},{default:a(()=>[o(v,{onClick:ee},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-knife",size:"20"}),y(" Schnibbelmodus "+I(T.value?"beenden":"aktivieren"),1)]),_:1})]),_:1}),o(v,{onClick:e[0]||(e[0]=n=>ge(V(k)))},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-truck",size:"20"}),e[5]||(e[5]=y(" Zutaten einkaufen"))]),_:1,__:[5]})]),_:1}),o(m),o(v,null,{default:a(()=>[s("div",qe,[o(c,{icon:"mdi-account-group",size:"20"}),e[6]||(e[6]=y(" Portionen "))]),s("div",Je,[(i(),u(U,null,A([1,2,3,4,5,6],n=>s("span",{key:n,class:"ml-1"},[o(R,{color:n===Z.value?"indigo":null,"prepend-icon":"mdi-account",onClick:C=>_e(n)},{default:a(()=>[y(I(n),1)]),_:2},1032,["color","onClick"])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),l.value?(i(),L(oe,{key:0,class:"pt-0"},{default:a(()=>[s("div",null,[s("div",Oe,[o(S,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:X},{default:a(()=>e[7]||(e[7]=[y("Zurück")])),_:1,__:[7]})])]),s("div",Fe,[!l.value.imageInProgress&&l.value.imageUploaded?(i(),L(Pe,{key:0,height:"200",src:me(l.value),color:"grey",cover:""},null,8,["src"])):_("",!0),s("div",He,I(l.value.title),1)]),T.value?_("",!0):(i(),u("div",Ke,[(i(!0),u(U,null,A(l.value.sections,n=>(i(),u("div",{key:n.index},[s("div",null,[s("a",{href:"/recipes/go?id"+V(k)+"#section-"+n.index,style:{all:"revert","text-decoration":"none",cursor:"pointer"}},[s("h2",{style:{color:"dimgray"},class:"pt-8",id:"section-"+n.index},[y(I(n.index)+" "+I(n.sectionTitle)+" ",1),s("span",null,[o(c,{icon:"mdi-link-variant",size:"26"})])],8,Qe)],8,We)]),s("div",{style:{"font-size":"1.1em"},class:"mt-1",innerHTML:n.description,onClick:he},null,8,Ge)]))),128))])),T.value?(i(),u("div",Xe,[e[10]||(e[10]=s("h2",null,"Vorbereitungen",-1)),V(P)?_("",!0):(i(),u("div",Ye,[o(S,{onClick:pe,variant:"plain",rounded:"",style:{"font-size":"0.7em"}},{default:a(()=>e[8]||(e[8]=[y("Zurücksetzen")])),_:1,__:[8]})])),e[11]||(e[11]=s("h3",null,"Zutatenvorbereitungen",-1)),V(D).length===0?(i(),u("div",et," Keine Vorbereitungen nötig. ")):_("",!0),(i(!0),u(U,null,A(V(D),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),e[12]||(e[12]=s("h3",{class:"mt-3"},"Rezeptvorbereitungen",-1)),s("span",tt,"Dauer: "+I(V(O))+" Min.",1),(i(!0),u(U,null,A(V(ce),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),s("div",nt,[o(S,{onClick:ee,color:"primary",variant:"outlined",rounded:""},{default:a(()=>e[9]||(e[9]=[y("Schnibbelmodus beenden")])),_:1,__:[9]})])])):_("",!0),s("div",ot,[V(P)?_("",!0):(i(),u("div",st,[e[13]||(e[13]=s("span",{style:{"font-size":"1.6em"}},"Wie gut hat dir dieses Essen geschmeckt?",-1)),s("div",it,[o(Te,{"onUpdate:modelValue":[fe,e[1]||(e[1]=n=>l.value.rating=n)],hover:"",length:"5",size:"30",modelValue:l.value.rating,"active-color":"primary"},null,8,["modelValue"])])])),s("div",at,[o(S,{variant:"text",to:"/recipes","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:X},{default:a(()=>e[14]||(e[14]=[y("Zurück zur Übersicht")])),_:1,__:[14]})])]),e[15]||(e[15]=s("div",{style:{height:"600px"}},null,-1))]),_:1,__:[15]})):_("",!0),w.value?(i(),u("div",lt,[s("div",ut,[z.value?(i(),u("div",rt,[o(oe,{"max-width":"400"},{default:a(()=>[o(Re,null,{default:a(()=>[s("tbody",null,[(i(!0),u(U,null,A(w.value,n=>(i(),u("tr",{key:n.name},[s("td",null,[n.amount?(i(),u("span",dt,I(n.amount),1)):_("",!0),e[16]||(e[16]=y()),n.unit?(i(),u("span",ct,I(n.unit),1)):_("",!0)]),s("td",null,I(n.name),1)]))),128))])]),_:1})]),_:1})])):_("",!0),s("div",vt,[s("div",mt,[o(S,{style:{width:"100%"},class:"my-2",variant:"text",onClick:e[2]||(e[2]=n=>z.value=!z.value),elevation:"0","prepend-icon":"mdi-food-apple-outline"},{default:a(()=>e[17]||(e[17]=[y("Zutatenliste")])),_:1,__:[17]})]),f.value&&f.value.length>0?(i(),u("div",pt,[s("div",null,[o(S,{variant:"text",elevation:"0",disabled:"","prepend-icon":"mdi-timer-play-outline"},{default:a(()=>e[18]||(e[18]=[y("Stoppuhren")])),_:1,__:[18]})]),(i(!0),u(U,null,A(f.value,n=>(i(),u("div",{key:n.title,class:"my-1"},[o(m,{class:"mb-1"}),o(Ve,{align:"center"},{default:a(()=>[o(S,{icon:"mdi-close",onClick:C=>ye(n.id),variant:"text"},null,8,["onClick"]),o(se,{class:"text-left",style:{"font-size":"1.2em","font-weight":"400","line-height":"1.1 !important"}},{default:a(()=>[y(I(n.title),1)]),_:2},1024),o(se,{class:"d-flex align-center justify-end"},{default:a(()=>[o(S,{onClick:C=>Se(n),icon:"mdi-minus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),o(S,{onClick:C=>Ie(n),icon:"mdi-plus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),s("span",_t,I(ke(n.remainingSeconds)),1),n.timerStarted?_("",!0):(i(),L(S,{key:0,onClick:C=>be(n),icon:"mdi-play-circle-outline",class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0"},null,8,["onClick"])),n.timerStarted?(i(),L(S,{key:1,onClick:C=>xe(n),class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0",icon:""},{default:a(()=>[n.isPaused?(i(),u("span",ft,[o(c,{icon:"mdi-play-circle-outline"})])):_("",!0),n.isPaused?_("",!0):(i(),u("span",gt,[o(c,{icon:"mdi-pause-circle-outline"})]))]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):_("",!0)])])])):_("",!0),o(Ne,{onResult:e[3]||(e[3]=n=>j.value=n)}),o(je,{onResult:e[4]||(e[4]=n=>q.value=n)})])}}},kt=de(ht,[["__scopeId","data-v-68702b1e"]]),It={__name:"index",setup(G){const E=W(),x=Ee();p(!1);const P=E.query.id;return Q(async()=>{P||x.push("/recipes")}),(J,N)=>(i(),L(kt))}};export{It as default};
