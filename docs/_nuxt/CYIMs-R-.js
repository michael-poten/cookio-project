import{K as f,aa as u,ab as M,_ as ne,r as h,o as ae,g as m,Q as O,y as k,C as d,B as i,a0 as ge,z as _,D as P,a1 as _e,ac as he,O as ye,N as be,u as we,P as ke,x as V,ad as te,U,R as x,A as Q,S as Se,T as Ce,Y as H}from"./syDYqR5w.js";const q={convertToBringUrl:function(r){let n=[];for(const C of r){const g=[];g.push(C.name),C.amount&&C.amount!==0&&g.push(C.amount+(C.unit?" "+C.unit:"")),n.push(g.join("__"))}const a=n.join("---"),t=btoa(unescape(encodeURIComponent(a)));let b="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return b=encodeURIComponent(b),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+b+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeWithNewEngine:async function(r,n){const a=f();try{return await M.post(a.lanAddress+"api/"+r+"/recipes/"+n+"/import/newEngine",{})}catch(t){u.catchError(t)}},analyzeIngredients:async function(r,n,a){const t=f();try{const c=new FormData;return c.append("image",a),await M.post(t.lanAddress+"api/"+r+"/recipes/"+n+"/import/image/ingredients",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},analyzeSections:async function(r,n,a){const t=f();try{const c=new FormData;return c.append("image",a),await M.post(t.lanAddress+"api/"+r+"/recipes/"+n+"/import/image/sections",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},uploadImage:async function(r,n,a){const t=f();try{const c=new FormData;return c.append("image",a),await M.post(t.lanAddress+"api/"+r+"/recipes/"+n+"/import/image",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},generateImage:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/recipes/"+n+"/import/generateImage")}catch(t){u.catchError(t)}},loginPicnic:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/loginPicnic",n)}catch(t){u.catchError(t)}},saveIcsUrl:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/icsUrl",{url:n})}catch(t){u.catchError(t)}},fetchIcsData:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/fetchIcsData",{url:n})}catch(t){u.catchError(t)}},saveCalendarPlan:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/calendarPlan",n)}catch(t){u.catchError(t)}},searchPicnic:async function(r,n,a,t=!1){const c=f();try{return await u.post(c.lanAddress+"api/"+r+"/picnic/search",{query:n,ingredientDescription:a,useChatGpt:t})}catch(b){u.catchError(b)}},addProductToPicnicShoppingCart:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/picnic/addProductToShoppingCart",{productId:n})}catch(t){u.catchError(t)}}},K={getRecipe:async function(r,n){const a=f();try{if(a.isNetworkAccess){let t=a.lanAddress+"api/"+r+"/recipes/"+n;return(await u.get(t)).data}else return(await u.get("https://mmhhhh.de/data/home/recipes.json")).data[n]}catch(t){u.catchError(t)}},getRecipeIngredients:async function(r,n){const a=f();try{let t;return a.isNetworkAccess?t=a.lanAddress+"api/"+r+"/recipes/"+n+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+n+"/ingredients.json",await u.get(t)}catch(t){u.catchError(t)}},getRecipeSections:async function(r,n){const a=f();try{let t;return a.isNetworkAccess?t=a.lanAddress+"api/"+r+"/recipes/"+n+"/sections":t="https://mmhhhh.de/data/home/recipes/"+n+"/sections.json",await u.get(t)}catch(t){u.catchError(t)}},updateRecipe:async function(r,n,a){const t=f();try{return await u.put(t.lanAddress+"api/"+r+"/recipes/"+n,a)}catch(c){u.catchError(c)}},uploadRecipeToGithub:async function(r,n){const a=f();let t={};n&&(t.recipeId=n);try{return await u.put(a.lanAddress+"api/"+r+"/recipes/githubUpload",t)}catch(c){u.catchError(c)}},deleteRecipe:async function(r,n){const a=f();try{return await u.post(a.lanAddress+"api/"+r+"/recipes/"+n+"/delete")}catch(t){u.catchError(t)}}};const xe=["innerHTML"],Ve={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(r,{emit:n}){const a=r,t=n,c=h(!1),b=h(a.message),C=h(a.title);let g=null;ae(()=>{t("result",$=>(c.value=!0,new Promise((w,S)=>{g=w})))});function j(){g&&g(!0),c.value=!1,g=null}function L(){g&&g(!1),c.value=!1,g=null}return($,w)=>{const S=m("v-toolbar"),v=m("v-btn"),B=m("v-col"),z=m("v-row"),N=m("v-container"),I=m("v-card-text"),D=m("v-card"),A=m("v-dialog");return k(),O(A,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=E=>c.value=E),onKeydown:he(L,["esc"]),"max-width":"420"},{default:d(()=>[i(D,null,{default:d(()=>[i(S,{color:"rgb(191, 208, 217)",title:C.value},null,8,["title"]),ge(i(I,null,{default:d(()=>[_("div",{style:{"margin-bottom":"30px"},innerHTML:b.value},null,8,xe),i(N,{class:"sub-grid"},{default:d(()=>[i(z,null,{default:d(()=>[i(B,{cols:"6"},{default:d(()=>[i(v,{onClick:L,style:{width:"100%"}},{default:d(()=>[...w[1]||(w[1]=[P("Abbrechen",-1)])]),_:1})]),_:1}),i(B,{cols:"6"},{default:d(()=>[i(v,{color:"secondary",onClick:j,style:{width:"100%"}},{default:d(()=>[...w[2]||(w[2]=[P(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!b.value]])]),_:1})]),_:1},8,["modelValue"])}}},Pe=ne(Ve,[["__scopeId","data-v-6b314bdd"]]),Ie={class:"d-flex justify-space-between align-center"},Ae={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Be={key:0,class:"text-h6 text-medium-emphasis"},Ne={key:0},De={class:"text-right mt-3"},Ee={key:1,style:{width:"100%","text-align":"right"}},Re={colspan:1,style:{"min-width":"70px"},class:"px-0 mx-0"},Te={class:"pl-6"},Ue={key:2};const ze=["onClick"],je={style:{"max-width":"200px"}},Le={class:"my-2"},$e={class:"my-2"},Fe={class:"my-2"},Me={class:"text-right"},Qe={key:0,class:"mt-3"},Ke={class:"mt-2"},Oe={__name:"IngredientsDialog",emits:["result"],setup(r,{emit:n}){const a=ye(),t=f(),{authInfo:c,githubMode:b}=be(t),C=n;we(),ke();const g=h(!1),j=h(null),L=h(null),$=h(null),w=h([]),S=h([]),v=h(null),B=h(null),z=h(2),N=h(!1),I=h(!1),D=h(!1),A=h(!1),E=h({name:null,password:null});ae(async()=>{C("result",async o=>(Array.isArray(o)?w.value=o:w.value=[o],B.value=null,S.value=[],v.value=null,D.value=!1,A.value=!1,I.value=!1,z.value=2,G(),await oe(!0),g.value=!0,new Promise((e,s)=>{j.value=e,L.value=s})))});async function G(){let o=await t.getAuthInfo();N.value=o.picnicLoggedIn}async function oe(o){let e=[];for(const s of w.value){const p=await K.getRecipe(c.value.userId,s);p.ingredients=(await K.getRecipeIngredients(c.value.userId,s)).data,e.push(p)}S.value=e,W(o)}async function se(){await q.loginPicnic(c.value.userId,E.value),await G()}async function ie(o){o.ready=!0,await navigator.clipboard.writeText(o.basicName)}async function re(){let o=!1;for(const e of S.value)e.planned&&!e.ordered&&(o=!0);o?$.value().then(async e=>{if(e){for(const s of S.value)if(s.planned&&!s.ordered){const p={ordered:!0};await K.updateRecipe(c.value.userId,s.id,p)}}g.value=!1,j.value(!0)}):(g.value=!1,j.value(!1))}async function J(){let o=v.value.filter(e=>e.bring);B.value=q.convertToBringUrl(o)}async function le(){let o=v.value.filter(p=>p.picnic);for(const p of o)if(p.selectedPicnicProduktId){let y=p.picnicResults.find(R=>R.id===p.selectedPicnicProduktId).multiplier;(!y||y===0||y>0&&y<1)&&(y=1),y=Math.ceil(y);for(let R=1;R<=y;R++)await q.addProductToPicnicShoppingCart(c.value.userId,p.selectedPicnicProduktId)}I.value=!0;const s={picnicPurchaseDate:new Date().toISOString()};for(const p of w.value)await K.updateRecipe(c.value.userId,p,s)}function W(o){v.value=[];for(const e of S.value){let s=e.portions?e.portions:2;e.ingredients.forEach(p=>{v.value.push({name:p.name,basicName:p.basicName,genericName:p.genericName?p.genericName:"Sonstiges",unit:p.unit,amount:Math.ceil(p.amount/s*z.value),standardIngredient:p.standardIngredient})})}o&&ce(),J()}function ce(){v.value.forEach(o=>{o.standardIngredient?(o.bring=!1,o.picnic=!1):(o.bring=!0,o.picnic=!1)}),A.value=v.value.filter(o=>!!o.bring).length>0,v.value=v.value.sort((o,e)=>{let s=0;return!o.bring&&!e.bring&&(s=0),!o.bring&&e.bring&&(s=1),o.bring&&!e.bring&&(s=-1),o.bring&&e.bring&&(s=0),s!==0?s:o.genericName.localeCompare(e.genericName)})}async function ue(){v.value.forEach(o=>{o.bring&&F("picnic",o)})}async function F(o,e){o==="bring"?(e.bring=!0,e.picnic=!1,D.value=v.value.filter(s=>!!s.picnic).length>0,A.value=v.value.filter(s=>!!s.bring).length>0):o==="picnic"?(e.loading=!0,e.bring=!1,e.picnic=!0,D.value=v.value.filter(s=>!!s.picnic).length>0,A.value=v.value.filter(s=>!!s.bring).length>0,e.loading=!1):(e.bring=!1,e.picnic=!1,D.value=v.value.filter(s=>!!s.picnic).length>0,A.value=v.value.filter(s=>!!s.bring).length>0),J()}return(o,e)=>{const s=m("v-btn"),p=m("v-card-title"),y=m("v-img"),R=m("v-text-field"),Y=m("v-card-text"),X=m("v-card"),de=m("v-select"),pe=m("v-checkbox"),ee=m("v-row"),me=m("v-icon"),Ze=m("v-progress-linear"),He=m("v-list-item"),Z=m("v-col"),ve=m("v-table"),fe=m("v-dialog");return k(),V("div",null,[i(fe,{"max-width":"600",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=l=>g.value=l),fullscreen:U(a).smAndDown.value},{default:d(()=>[i(X,{style:{"background-color":"white"},class:te({"pa-4":!U(a).smAndDown.value})},{default:d(()=>[i(p,{style:{"white-space":"normal"}},{default:d(()=>[_("div",Ie,[_("div",Ae,[e[6]||(e[6]=P(" Zutaten einkaufen ",-1)),S.value?(k(),V("div",Be,Q(S.value.map(l=>l.title).join(", ")),1)):x("",!0)]),i(s,{icon:"mdi-close",variant:"text",onClick:re})])]),_:1}),i(Y,null,{default:d(()=>[S.value?(k(),V("div",Ne,[!N.value&&!U(b)?(k(),O(X,{key:0,class:"mb-4"},{default:d(()=>[i(p,null,{default:d(()=>[i(y,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=P(" Bei Picnic einloggen ",-1))]),_:1}),i(Y,null,{default:d(()=>[i(R,{modelValue:E.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value.name=l),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),i(R,{modelValue:E.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>E.value.password=l),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),_("div",De,[i(s,{variant:"outlined",onClick:se},{default:d(()=>[...e[8]||(e[8]=[P("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):x("",!0),e[13]||(e[13]=_("h3",null,"Anzahl Portionen",-1)),i(de,{modelValue:z.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>z.value=l),W],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=_("h3",null,"Zutatenliste",-1)),U(b)?x("",!0):(k(),V("div",Ee,[i(s,{variant:"flat",onClick:e[3]||(e[3]=l=>ue()),class:"mb-1 my-1"},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=P(" Alles bei Picnic einkaufen ",-1))]),_:1})])),i(ve,{class:"table-ingredients"},{default:d(()=>[_("tbody",null,[(k(!0),V(Se,null,Ce(v.value,l=>(k(),V("tr",{key:l.name},[_("td",Re,[_("div",Te,[_("span",null,[i(ee,{class:"align-center"},{default:d(()=>[(l.bring||l.picnic)&&l.amount&&l.amount!==0?(k(),O(pe,{key:0,modelValue:l.ready,"onUpdate:modelValue":T=>l.ready=T,"hide-details":"auto",density:"comfortable",label:""},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),l.amount?(k(),V("span",{key:1,class:te({"ml-9":!((l.bring||l.picnic)&&l.amount&&l.amount!==0)})},Q(l.amount),3)):x("",!0),e[10]||(e[10]=P()),l.unit?(k(),V("span",Ue,Q(l.unit),1)):x("",!0)]),_:2},1024)])]),x("",!0)]),_("td",{class:"px-0 mx-0",style:{cursor:"pointer"},onClick:T=>ie(l)},Q(l.name),9,ze),_("td",je,[i(ee,{class:"px-0 mx-0",style:{width:"180px"}},{default:d(()=>[i(Z,{cols:"3"},{default:d(()=>[_("div",Le,[i(s,{variant:"flat",style:H({opacity:l.bring?1:.3}),onClick:T=>F("bring",l),class:"mx-0"},{default:d(()=>[i(y,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),U(b)?x("",!0):(k(),O(Z,{key:0,cols:"3"},{default:d(()=>[_("div",$e,[i(s,{variant:"plain",style:H({opacity:l.picnic?1:.3}),disabled:!N.value||I.value,onClick:T=>F("picnic",l)},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),i(Z,{cols:"4"},{default:d(()=>[_("div",Fe,[i(s,{variant:"plain",style:H({opacity:!l.bring&&!l.picnic?1:.3}),disabled:!U(b)&&!N.value||I.value,onClick:T=>F(null,l)},{default:d(()=>[i(me,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):x("",!0),_("div",Me,[U(b)?x("",!0):(k(),V("div",Qe,[i(s,{variant:"outlined",rounded:"",onClick:le,"prepend-icon":I.value?"mdi-check":null,disabled:!N.value||I.value||!D.value},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=P(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),_("div",Ke,[i(s,{link:"",variant:"outlined",rounded:"",href:B.value,disabled:B.value===null||!A.value,target:"_blank",class:"ml-2"},{default:d(()=>[i(y,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=P(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),i(Pe,{onResult:e[5]||(e[5]=l=>$.value=l),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},We=ne(Oe,[["__scopeId","data-v-8e5f79a8"]]);export{Pe as C,We as I,K as R,q as a};
