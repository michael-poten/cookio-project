import{K as y,n as k,$ as r,a6 as Q,M as de,L as pe,u as me,N as fe,r as g,o as ve,g as h,O as L,y as m,C as u,B as o,a7 as ge,Q as R,z as d,D as S,A as I,P as _,x as b,R as he,S as _e,T as ye,a8 as q}from"./CtnI7D-e.js";import{_ as we}from"./DlAUqK2U.js";const O={getRecipe:async function(l,i){try{let t=k().public.apiBase;{const s=y();if(s.isNetworkAccess)t=s.lanAddress;else return t="https://mmhhhh.de/data/home/recipes.json",(await r.get(t)).data[i]}return(await r.get(t+"api/"+l+"/recipes/"+i)).data}catch(t){r.catchError(t)}},getRecipeIngredients:async function(l,i){try{let t=k().public.apiBase;{const s=y();s.isNetworkAccess?(t=s.lanAddress,t=t+"api/"+l+"/recipes/"+i+"/ingredients"):t="https://mmhhhh.de/data/home/recipes/"+i+"/ingredients.json"}return await r.get(t)}catch(t){r.catchError(t)}},getRecipeSections:async function(l,i){try{let t=k().public.apiBase;{const s=y();s.isNetworkAccess?(t=s.lanAddress,t=t+"api/"+l+"/recipes/"+i+"/sections"):t="https://mmhhhh.de/data/home/recipes/"+i+"/sections.json"}return await r.get(t)}catch(t){r.catchError(t)}},updateRecipe:async function(l,i,t){const s=y();try{let n=k().public.apiBase;return s.isNetworkAccess&&(n=s.lanAddress),await r.put(n+"api/"+l+"/recipes/"+i,t)}catch(n){r.catchError(n)}},deleteRecipe:async function(l,i){const t=y();try{let s=k().public.apiBase;return t.isNetworkAccess&&(s=t.lanAddress),await r.post(s+"api/"+l+"/recipes/"+i+"/delete")}catch(s){r.catchError(s)}}},E={convertToBringUrl:function(l){let i=[];for(const x of l){const A=[];A.push(x.name),x.amount&&x.amount!==0&&A.push(x.amount+(x.unit?" "+x.unit:"")),i.push(A.join("__"))}const t=i.join("---"),s=btoa(unescape(encodeURIComponent(t)));let p="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(s)+"/bringImport.json";return p=encodeURIComponent(p),console.log("jsonServerUrl:",p),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+p+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeIngredients:async function(l,i,t){const s=y();try{let n=k().public.apiBase;s.isNetworkAccess&&(n=s.lanAddress);const p=new FormData;return p.append("image",t),await Q.post(n+"api/"+l+"/recipes/"+i+"/import/image/ingredients",p,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){r.catchError(n)}},analyzeSections:async function(l,i,t){const s=y();try{let n=k().public.apiBase;s.isNetworkAccess&&(n=s.lanAddress);const p=new FormData;return p.append("image",t),await Q.post(n+"api/"+l+"/recipes/"+i+"/import/image/sections",p,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){r.catchError(n)}},uploadImage:async function(l,i,t){const s=y();try{let n=k().public.apiBase;s.isNetworkAccess&&(n=s.lanAddress);const p=new FormData;return p.append("image",t),await Q.post(n+"api/"+l+"/recipes/"+i+"/import/image",p,{headers:{"Content-Type":"multipart/form-data"}})}catch(n){r.catchError(n)}},generateImage:async function(l,i){const t=y();try{let s=k().public.apiBase;return t.isNetworkAccess&&(s=t.lanAddress),await r.post(s+"api/"+l+"/recipes/"+i+"/import/generateImage")}catch(s){r.catchError(s)}},loginPicnic:async function(l,i){const t=y();try{let s=k().public.apiBase;return t.isNetworkAccess&&(s=t.lanAddress),await r.post(s+"api/"+l+"/loginPicnic",i)}catch(s){r.catchError(s)}},searchPicnic:async function(l,i){const t=y();try{let s=k().public.apiBase;return t.isNetworkAccess&&(s=t.lanAddress),await r.post(s+"api/"+l+"/picnic/search",{query:i})}catch(s){r.catchError(s)}},addProductToPicnicShoppingCart:async function(l,i){const t=y();try{let s=k().public.apiBase;return t.isNetworkAccess&&(s=t.lanAddress),await r.post(s+"api/"+l+"/picnic/addProductToShoppingCart",{productId:i})}catch(s){r.catchError(s)}}},be={methods:{formatCurrency(l){return"€ "+(""+(Math.round(l*100)/100).toFixed(2)).replace(".",",")}}},ke={class:"d-flex justify-space-between align-center"},Pe={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Se={class:"text-h6 text-medium-emphasis"},Ie={class:"mt-2 px-2"},xe={key:0},Ae={class:"text-right mt-3"},Re=["colspan"],Ce={key:0,class:"pl-6"},Ue={key:0},Be={key:1},Ne={key:1,class:"py-2"},Ve={style:{"font-size":"0.8em"}},De={key:0},Ee={key:1},Te={key:0},je={key:0,class:"px-0 mx-0"},ze={style:{"max-width":"200px"}},Le={class:"my-2"},Fe={class:"my-2"},Me={class:"my-2"},$e={class:"text-right"},Qe={key:0,class:"mt-3"},qe={class:"mt-2"},Oe={__name:"IngredientsDialog",emits:["result"],setup(l,{emit:i}){const t=de(),s=y(),{authInfo:n,githubMode:p}=pe(s),x=i;me(),fe();const A=g(!1),Z=g(null),se=g(null),T=g(null),P=g(null),f=g(null),j=g(null),z=g(2),U=g(!1),B=g(!1),N=g(!1),V=g(!1),D=g({name:null,password:null});ve(async()=>{x("result",async v=>(T.value=v,j.value=null,P.value=null,f.value=null,z.value=2,K(),await ae(),A.value=!0,new Promise((e,c)=>{Z.value=e,se.value=c})))});async function K(){let v=await s.getAuthInfo();U.value=v.picnicLoggedIn}async function ae(){P.value=await O.getRecipe(n.value.userId,T.value),P.value.ingredients=(await O.getRecipeIngredients(n.value.userId,T.value)).data,H()}async function ie(){await E.loginPicnic(n.value.userId,D.value),await K()}function ne(){A.value=!1,Z.value(!1)}async function G(){let v=f.value.filter(e=>e.bring);j.value=E.convertToBringUrl(v)}async function oe(){let v=f.value.filter(w=>w.picnic);for(const w of v)w.selectedPicnicProduktId&&await E.addProductToPicnicShoppingCart(n.value.userId,w.selectedPicnicProduktId);B.value=!0;const c={picnicPurchaseDate:new Date().toISOString()};await O.updateRecipe(n.value.userId,T,c)}function H(){let v=P.value.portions?P.value.portions:2;f.value=[],P.value.ingredients.forEach(e=>{f.value.push({name:e.name,basicName:e.basicName,unit:e.unit,amount:e.amount/v*z.value})}),G()}async function F(v,e){v==="bring"?(e.bring=!0,e.picnic=!1,N.value=f.value.filter(c=>!!c.picnic).length>0,V.value=f.value.filter(c=>!!c.bring).length>0):v==="picnic"?(e.bring=!1,e.picnic=!0,e.picnicResults=(await E.searchPicnic(n.value.userId,e.basicName+" bio")).data,e.picnicResults&&e.picnicResults.length>0?(e.selectedPicnicProduktId=e.picnicResults[0].id,N.value=f.value.filter(c=>!!c.picnic).length>0,V.value=f.value.filter(c=>!!c.bring).length>0):(e.picnicResults=(await E.searchPicnic(n.value.userId,e.basicName)).data,e.picnicResults&&e.picnicResults.length>0&&(e.selectedPicnicProduktId=e.picnicResults[0].id,N.value=f.value.filter(c=>!!c.picnic).length>0,V.value=f.value.filter(c=>!!c.bring).length>0))):(e.bring=!1,e.picnic=!1,N.value=f.value.filter(c=>!!c.picnic).length>0,V.value=f.value.filter(c=>!!c.bring).length>0),G()}return(v,e)=>{const c=h("v-btn"),w=h("v-img"),J=h("v-card-title"),W=h("v-text-field"),X=h("v-card-text"),Y=h("v-card"),ee=h("v-select"),te=h("v-icon"),le=h("v-list-item"),M=h("v-col"),ce=h("v-row"),re=h("v-table"),ue=h("v-dialog");return m(),L(ue,{"max-width":"600",modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=a=>A.value=a),fullscreen:R(t).smAndDown.value},{default:u(()=>[o(Y,{style:{"background-color":"white"},class:ge({"pa-4":!R(t).smAndDown.value})},{default:u(()=>[o(J,{style:{"white-space":"normal"}},{default:u(()=>[d("div",ke,[d("div",Pe,[e[4]||(e[4]=S(" Zutaten einkaufen ")),d("div",Se,I(P.value.title),1)]),o(c,{icon:"mdi-close",variant:"text",onClick:ne})]),d("div",Ie,[!P.value.imageInProgress&&P.value.imageUploaded?(m(),L(w,{key:0,height:"200",src:"/api/"+R(n).userId+"/recipes/"+P.value.id+"/image",color:"grey",cover:""},null,8,["src"])):_("",!0)])]),_:1}),o(X,null,{default:u(()=>[P.value?(m(),b("div",xe,[!U.value&&!R(p)?(m(),L(Y,{key:0},{default:u(()=>[o(J,null,{default:u(()=>[o(w,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[5]||(e[5]=S(" Bei Picnic einloggen "))]),_:1,__:[5]}),o(X,null,{default:u(()=>[o(W,{modelValue:D.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>D.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),o(W,{modelValue:D.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>D.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),d("div",Ae,[o(c,{variant:"outlined",onClick:ie},{default:u(()=>e[6]||(e[6]=[S("Einloggen")])),_:1,__:[6]})])]),_:1})]),_:1})):_("",!0),e[10]||(e[10]=d("h3",{class:"mt-4"},"Anzahl Portionen",-1)),o(ee,{modelValue:z.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>z.value=a),H],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[11]||(e[11]=d("h3",null,"Zutatenliste",-1)),o(re,{class:"table-ingredients"},{default:u(()=>[d("tbody",null,[(m(!0),b(he,null,_e(f.value,a=>(m(),b("tr",{key:a.name},[d("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?_("",!0):(m(),b("div",Ce,[a.amount?(m(),b("span",Ue,I(a.amount),1)):_("",!0),e[7]||(e[7]=S()),a.unit?(m(),b("span",Be,I(a.unit),1)):_("",!0)])),a.picnic?(m(),b("div",Ne,[d("div",Ve,[o(te,{icon:"mdi-arrow-right"}),e[8]||(e[8]=S()),a.amount?(m(),b("span",De,I(a.amount),1)):_("",!0),e[9]||(e[9]=S()),a.unit?(m(),b("span",Ee,I(a.unit),1)):_("",!0),S(" "+I(a.name),1)]),a.picnic?(m(),b("div",Te,[o(ee,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":C=>a.selectedPicnicProduktId=C,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":""},{item:u(({props:C,item:$})=>[o(le,ye({ref_for:!0},C),{default:u(()=>[d("h4",null,I($.raw.unit_quantity),1),d("h5",null,I(R(be).methods.formatCurrency($.raw.display_price/100)),1),o(w,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${$.raw.image_id}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items"])])):_("",!0)])):_("",!0)],8,Re),a.picnic?_("",!0):(m(),b("td",je,I(a.name),1)),d("td",ze,[o(ce,{class:"px-0 mx-0",style:{width:"180px"}},{default:u(()=>[o(M,{cols:"3"},{default:u(()=>[d("div",Le,[o(c,{variant:"flat",style:q({opacity:a.bring?1:.3}),onClick:C=>F("bring",a),class:"mx-0"},{default:u(()=>[o(w,{src:"/images/bring.png",width:"32",contain:""})]),_:2},1032,["style","onClick"])])]),_:2},1024),R(p)?_("",!0):(m(),L(M,{key:0,cols:"3"},{default:u(()=>[d("div",Fe,[o(c,{variant:"plain",style:q({opacity:a.picnic?1:.3}),disabled:!U.value||B.value,onClick:C=>F("picnic",a)},{default:u(()=>[o(w,{src:"/images/picnic.png",width:"32",contain:""})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024)),o(M,{cols:"4"},{default:u(()=>[d("div",Me,[o(c,{variant:"plain",style:q({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!U.value||B.value,onClick:C=>F(null,a)},{default:u(()=>[o(te,{icon:"mdi-selection-remove",size:"34"})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):_("",!0),d("div",$e,[R(p)?_("",!0):(m(),b("div",Qe,[o(c,{variant:"outlined",rounded:"",onClick:oe,"prepend-icon":B.value?"mdi-check":null,disabled:!U.value||B.value||!N.value},{default:u(()=>[o(w,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[12]||(e[12]=S(" In Picnic importieren "))]),_:1,__:[12]},8,["prepend-icon","disabled"])])),d("div",qe,[o(c,{link:"",variant:"outlined",rounded:"",href:j.value,disabled:j.value===null||!V.value,target:"_blank",class:"ml-2"},{default:u(()=>[o(w,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[13]||(e[13]=S(" In Bring importieren "))]),_:1,__:[13]},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"])}}},Ge=we(Oe,[["__scopeId","data-v-4ada0818"]]);export{Ge as I,O as R,E as a};
