import{a0 as We,M as ye,K as be,r as g,u as xe,N as le,o as re,g as v,O as W,y as l,C as a,B as o,z as i,x as c,R as G,S as J,A as R,D as b,a1 as _e,a2 as Ze,L as Oe,a3 as Ge,V as Je,k as ie,P as _,Q as F,a4 as qe,a5 as He,J as Ke}from"./DGaJmGMA.js";import{R as O,I as Qe}from"./BTfsgJVm.js";import{_ as Se}from"./DlAUqK2U.js";const Xe=We("/images/bellring.png"),Ye={class:"mt-3"},et={__name:"TimerDialog",emits:["result"],setup($,{emit:D}){ye();const x=be();g(x.authInfo);const L=D;xe(),le().params.userId;const Z=g(!1),oe=g(null),I=g(null),m=g([]);re(async()=>{L("result",async q=>(m.value=q,Z.value=!0,new Promise((d,H)=>{oe.value=d,I.value=H})))});function N(){Z.value=!1,oe.value(!1)}return(q,d)=>{const H=v("v-card-title"),Q=v("v-divider"),U=v("v-card-text"),Y=v("v-btn"),ee=v("v-card-actions"),X=v("v-card"),S=v("v-dialog");return l(),W(S,{"max-width":"600",persistent:"",modelValue:Z.value,"onUpdate:modelValue":d[0]||(d[0]=M=>Z.value=M)},{default:a(()=>[o(X,{style:{"background-color":"#fcfaf7"},class:"pa-4"},{default:a(()=>[o(H,null,{default:a(()=>[...d[1]||(d[1]=[i("h2",null,"Zeit abgelaufen!",-1)])]),_:1}),o(U,null,{default:a(()=>[d[3]||(d[3]=i("div",{style:{width:"100%"},class:"text-center"},[i("div",{class:"vibrate"},[i("img",{alt:"bellring",src:Xe,style:{width:"300px",height:"300px"},class:"mt-2"})])],-1)),o(Q),i("div",Ye,[d[2]||(d[2]=i("h3",null,"Folgende Timer sind abgelaufen:",-1)),(l(!0),c(G,null,J(m.value,M=>(l(),c("div",{key:M.id,style:{"font-size":"1.6em"}}," - "+R(M.title),1))),128))])]),_:1}),o(ee,null,{default:a(()=>[o(Y,{onClick:N,style:{width:"100%"},rounded:"",size:"50",variant:"outlined"},{default:a(()=>[...d[4]||(d[4]=[b(" Schließen ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},tt=Se(et,[["__scopeId","data-v-dbd91138"]]),he={},ae={},nt={debounceTime($,D,x){clearTimeout(he[$]),he[$]=setTimeout(()=>{D.apply(this)},x)},reduceExecutions($,D,x){ae[$]||(ae[$]=!0,setTimeout(()=>{ae[$]=!1},x),D.apply(this))}},ot={class:"mt-2"},st={class:"mb-1 mt-2"},it={class:"text-medium-emphasis"},at={class:"mt-2"},lt={class:"text-h4 text-medium-emphasis mt-4"},rt={key:0,class:"mt-6"},ut=["href"],ct=["id"],dt=["innerHTML"],mt={key:1,class:"mt-6"},pt={key:0,class:"mb-4"},vt={key:1},ft={style:{"font-size":"0.9em"}},gt={class:"mt-4"},_t={class:"text-center",style:{"margin-top":"40px"}},ht={key:0},kt={class:"text-center mt-2"},yt={class:"text-medium-emphasis mt-6"},bt={key:1,class:"custom-bottom-sheet no-print"},xt={class:"sheet-content",style:{"background-color":"rgb(226, 226, 226)"}},St={key:0,class:"sheet-ingredients"},wt={key:0},It={key:1},Ct={style:{"background-color":"rgb(203, 203, 204)",display:"flex"}},Tt={class:"ml-2",style:{width:"100px","flex-shrink":"0"}},Rt={class:"mx-2",style:{flex:"1"}},zt={key:0},Pt={style:{"font-size":"1.7em","border-radius":"6px","background-color":"#ffffff",color:"#3d3d3d"},class:"px-2"},Vt={key:0},Dt={key:1},ke="*",$t={__name:"MealMaker",setup($){_e.extend(Ze),ye();const D=be(),{authInfo:x,githubMode:L,lanAddress:ne}=Oe(D),Z=xe(),I=le().query.id,m=g(null),N=g(null),q=g(2),d=g([]),H=g(null),Q=g(!1),U=g(!1),Y=g(null),ee=g(null),X=g([]),S=g([]),M=g(!1),ue=g([]),j=g(-1),ce=g([]);re(async()=>{m.value=null,N.value=null,await D.getAuthInfo(),await E(!0),m.value.planned&&(H.value=setTimeout(async()=>{const e={cooked:!0};await O.updateRecipe(x.value.userId,I,e),await E()},5*6e4));const t=localStorage.getItem("timers-"+I);if(t)try{const e=JSON.parse(t);e.forEach(u=>{u.isPaused=!0}),d.value=e.map(u=>({...u,timeoutId:null}))}catch(e){console.error("Timer konnte nicht geladen werden:",e)}}),Ge(()=>{d.value.forEach(t=>clearTimeout(t.timeoutId)),clearTimeout(H.value)}),Je(d,t=>{const e=t.map(({timeoutId:u,...p})=>p);localStorage.setItem("timers-"+I,JSON.stringify(e))},{deep:!0}),window.addEventListener("message",t=>{var u;const e=t.data;!e||typeof e!="object"||(e.type==="speech-commands:ready"&&console.log(`iFrame bereit (${((u=e.vocab)==null?void 0:u.length)||0} Wörter)`),e.type==="speech-commands:result"&&nt.reduceExecutions("speech-commands",()=>{const p=e.scores.find(h=>h.label==="one");p&&p.score>.95&&(ve(),console.log(`Result: ${e.top.label} (${e.top.score})`),console.log("Result JSON",e))},1e3))});const we=ie(()=>!S||S.value.length===0?0:S.value.filter(t=>!t.ingredient&&t.duration).reduce((t,e)=>t+e.duration,0)),de=ie(()=>!S||S.value.length===0?[]:S.value.filter(t=>!!t.ingredient)),Ie=ie(()=>!S||S.value.length===0?[]:S.value.filter(t=>!t.ingredient));function Ce(){const t=[];m.value.ingredients.forEach(e=>{e.preparationRequired&&t.push({name:e.preparationLongText,ingredient:!0})}),m.value.sections.forEach(e=>{e.ingredientsPreparations&&e.ingredientsPreparations.length>0&&e.ingredientsPreparations.forEach(u=>{t.push({name:u.instruction,sectionIndex:e.index-1,duration:u.duration})})}),S.value=t}function Te(){j.value=-1,E()}function Re(t){return L.value?"https://mmhhhh.de/data/home/recipes/"+t.id+"/image.jpg":ne.value+"api/"+x.value.userId+"/recipes/"+t.id+"/image"}function me(){window.close()}async function ze(){const t={preparations:[]};await O.updateRecipe(x.value.userId,I,t),await E(!0)}function Pe(t){ge(t),E()}async function Ve(t){const e={rating:t};await O.updateRecipe(x.value.userId,I,e),await E()}async function pe(){if(!L.value){const t={preparations:S.value};await O.updateRecipe(x.value.userId,I,t),await E()}}function ve(){j.value++,E()}async function E(t=!1){m.value=await O.getRecipe(x.value.userId,I),m.value.ingredients=(await O.getRecipeIngredients(x.value.userId,I)).data;let e=(await O.getRecipeSections(x.value.userId,I)).data;t&&(m.value.preparations&&m.value.preparations.length>0?S.value=m.value.preparations:Ce()),ge(),ue.value=[];let u=-1;const p=[];let h=null;for(let f=0;f<e.length;f++){let k=e[f],C=k.description,y="",B=Fe(C);const z=u+B.length;if(B.forEach((s,w)=>{u++,ue.value.push(s);const r=S.value.find(P=>P.checked&&f===P.sectionIndex&&P.name===s);j.value>z||j.value>=u?y=y+'<span style="color: #9a9a9a;">'+s+" </span>":j.value+1===u?r?(y=y+'<span style="color: #9a9a9a;">'+s+" </span>",j.value++):y=y+'▶ <span style="background-color: #bfe7d2; padding-top: 4px; padding-bottom: 4px">'+s+" </span> ":y=y+s+" "}),C=y,j.value+1>z&&e.length>f+1&&(h=e[f+1].index),k.timer&&k.timer.length>0)for(let s=0;s<k.timer.length;s++){let w=k.timer[s];C=C.replace(w.descriptionText,'<span class="pa-1 stopwatch-button" style="cursor: pointer; background-color: rgba(187,187,187,0.66); border: rgba(41,56,80,0.49) solid 3px; border-radius: 20px; color: #545454; font-size: 0.9em" data-id="'+s+'" data-sectionid="'+f+'"> ⏱ '+w.descriptionText+"</span >")}U.value||k.ingredientsPreparations.forEach(s=>{S.value.find(r=>r.checked&&f===r.sectionIndex&&r.name===s.instruction)&&(C=C.replace(s.instruction,'<span style="text-decoration-line: line-through;text-decoration-style: solid;text-decoration-thickness: 2px;text-underline-offset: 4px;">'+s.instruction+"</span>"))}),k.usedIngredients.forEach(s=>{const w=N.value.find(P=>P.name===s.ingredientNameList);let r="";w&&!p.includes(w.name)&&(r=w.amount?w.amount+(w.unit?" "+w.unit:"")+" ":"",p.push(w.name)),C=C.replace(s.ingredientNameText,"<b>"+r+s.ingredientNameText+"</b>")}),k.description=C}ce.value=e,h&&(await Z.push("/recipes/go?id="+I+"#section-"+h),console.log("sectionGoTo",h)),document.title=m.value.title+" - Cookio"}function De(){document.getElementById("scFrame").contentWindow.postMessage({type:"speech-commands:control",action:"start"},ke),M.value=!0}function $e(){document.getElementById("scFrame").contentWindow.postMessage({type:"speech-commands:control",action:"stop"},ke),M.value=!1}function Me(t){Y.value(t)}function fe(){U.value=!U.value,E()}function ge(t){t&&(q.value=t);let e=m.value.portions?m.value.portions:2;N.value=[],m.value.ingredients.forEach(u=>{N.value.push({name:u.name,unit:u.unit,amount:u.amount/e*q.value})})}function Ee(t){const e=t.target.closest(".stopwatch-button");if(e){const u=e.dataset.id,p=e.dataset.sectionid,h=parseInt(u,10),f=parseInt(p,10),k=m.value.sections[f].timer[h];d.value.push({id:f+"-"+h,title:k.title,remainingSeconds:k.duration*60,timerStarted:!1,isPaused:!1,timeoutId:null})}}const Ae=t=>{const e=_e.duration(t*1e3),u=String(e.minutes()).padStart(2,"0"),p=String(e.seconds()).padStart(2,"0");return`${u}:${p}`};function Le(t){d.value=d.value.filter(e=>e.id!==t)}const se=t=>{t.isPaused||t.remainingSeconds<=0||d.value.find(e=>e.id===t.id)&&(console.log("tick",t.id),t.remainingSeconds--,t.remainingSeconds<=0&&(X.value.push(t),ee.value(X.value).then(()=>{X.value=[],d.value=d.value.filter(e=>e.remainingSeconds>0)})),t.remainingSeconds>0?t.timeoutId=setTimeout(()=>se(t),1e3):t.timeoutId=null)},Ne=t=>{clearTimeout(t.timeoutId),t.timerStarted=!0,t.isPaused=!1,t.timeoutId=setTimeout(()=>se(t),1e3)},Ue=t=>{t.isPaused=!t.isPaused,!t.isPaused&&t.remainingSeconds>0&&(t.timeoutId=setTimeout(()=>se(t),1e3))},je=t=>{t.remainingSeconds=t.remainingSeconds+60},Be=t=>{const e=t.remainingSeconds-60;t.remainingSeconds=Math.max(e,0)};function Fe(t,e=[]){const u=["ca.","etc.","ggf.","bspw.","bzw.","vgl.","Dr.","Prof.","Nr.","Stk.","Abs.","Art.","Sek.","Std.","Min.","z. B.","u. a.","i. d. R.","z. T.","sog."],p=r=>r.toLowerCase().replace(/[.\s]/g,""),h=new Set([...u,...e].map(p)),f=r=>r>="0"&&r<="9",k=r=>/\s/.test(r),C=r=>/[)"'\]\}»”]/.test(r),y=t.length,B=[];let z="",s=0;function w(r){const P=Math.max(0,r-15),K=p(t.slice(P,r));for(const V of h)if(K.endsWith(V))return!0;if(t[r]==="."){let V=r+1;for(;V<y&&k(t[V]);)V++;if(V+1<y&&/[A-Za-zÄÖÜäöü]/.test(t[V])&&t[V+1]===".")return!0}return!1}for(;s<y;){const r=t[s];if(z+=r,r==="."||r==="!"||r==="?"){const P=t[s-1]||"",K=t[s+1]||"";if(!(r==="."&&f(P)&&f(K))&&!w(s)){let T=s+1;for(;T<y&&(C(t[T])||t[T]==="*");)z+=t[T],T++;const te=z.trim();for(te&&B.push(te),z="";T<y&&k(t[T]);)T++;s=T;continue}}s++}return z.trim()&&B.push(z.trim()),B}return(t,e)=>{const u=v("v-app-bar-nav-icon"),p=v("v-icon"),h=v("v-list-item-title"),f=v("v-list-item"),k=v("v-divider"),C=v("v-chip"),y=v("v-list"),B=v("v-menu"),z=v("v-app-bar"),s=v("v-btn"),w=v("v-img"),r=v("v-checkbox"),P=v("v-rating"),K=v("v-container"),V=v("v-table"),T=v("v-col"),te=v("v-row");return l(),c("div",null,[o(z,{collapse:"",elevation:0,color:"#6969695A",class:"no-print"},{prepend:a(()=>[o(B,null,{activator:a(({props:n})=>[o(u,qe(He(n)),null,16)]),default:a(()=>[o(y,{class:"mt-2"},{default:a(()=>[o(f,{onClick:fe},{default:a(()=>[o(h,null,{default:a(()=>[o(p,{icon:"mdi-knife",size:"20"}),b(" Schnibbelmodus "+R(U.value?"beenden":""),1)]),_:1})]),_:1}),M.value?_("",!0):(l(),W(f,{key:0,onClick:e[0]||(e[0]=n=>De())},{default:a(()=>[o(h,null,{default:a(()=>[o(p,{icon:"mdi-microphone-message",size:"20"}),e[7]||(e[7]=b(" Sprachsteuerung aktivieren",-1))]),_:1})]),_:1})),M.value?(l(),W(f,{key:1,onClick:e[1]||(e[1]=n=>$e())},{default:a(()=>[o(h,null,{default:a(()=>[o(p,{icon:"mdi-microphone-message-off",size:"20"}),e[8]||(e[8]=b(" Sprachsteuerung beenden",-1))]),_:1})]),_:1})):_("",!0),o(f,{onClick:e[2]||(e[2]=n=>Me(F(I)))},{default:a(()=>[o(h,null,{default:a(()=>[o(p,{icon:"mdi-truck",size:"20"}),e[9]||(e[9]=b(" Zutaten einkaufen",-1))]),_:1})]),_:1}),o(f,{onClick:Te,disabled:j.value===-1},{default:a(()=>[o(h,null,{default:a(()=>[o(p,{icon:"mdi-backup-restore",size:"20"}),e[10]||(e[10]=b(" Fortschritt zurücksetzen",-1))]),_:1})]),_:1},8,["disabled"]),o(k),o(f,null,{default:a(()=>[i("div",ot,[o(p,{icon:"mdi-account-group",size:"20"}),e[11]||(e[11]=b(" Portionen ",-1))]),i("div",st,[(l(),c(G,null,J([1,2,3,4,5,6],n=>i("span",{key:n,class:"ml-1"},[o(C,{color:n===q.value?"indigo":null,"prepend-icon":"mdi-account",onClick:A=>Pe(n)},{default:a(()=>[b(R(n),1)]),_:2},1032,["color","onClick"])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),m.value?(l(),W(K,{key:0,class:"pt-0"},{default:a(()=>[i("div",null,[i("div",it,[o(s,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:me},{default:a(()=>[...e[12]||(e[12]=[b("Zurück",-1)])]),_:1})])]),i("div",at,[!m.value.imageInProgress&&m.value.imageUploaded?(l(),W(w,{key:0,height:"200",src:Re(m.value),color:"grey",cover:""},null,8,["src"])):_("",!0),i("div",lt,R(m.value.title),1)]),U.value?_("",!0):(l(),c("div",rt,[(l(!0),c(G,null,J(ce.value,n=>(l(),c("div",{key:n.index},[i("div",null,[i("a",{href:"/recipes/go?id="+F(I)+"#section-"+n.index,style:{all:"revert","text-decoration":"none",cursor:"pointer"}},[i("h2",{style:{color:"dimgray"},class:"pt-8",id:"section-"+n.index},[b(R(n.index)+" "+R(n.sectionTitle)+" ",1),i("span",null,[o(p,{icon:"mdi-link-variant",size:"26"})])],8,ct)],8,ut)]),i("div",{style:{"font-size":"1.2em"},class:"mt-1",innerHTML:n.description,onClick:Ee},null,8,dt)]))),128))])),U.value?(l(),c("div",mt,[e[15]||(e[15]=i("h2",null,"Vorbereitungen",-1)),F(L)?_("",!0):(l(),c("div",pt,[o(s,{onClick:ze,variant:"plain",rounded:"",style:{"font-size":"0.7em"}},{default:a(()=>[...e[13]||(e[13]=[b("Zurücksetzen",-1)])]),_:1})])),e[16]||(e[16]=i("h3",null,"Zutatenvorbereitungen",-1)),F(de).length===0?(l(),c("div",vt," Keine Vorbereitungen nötig. ")):_("",!0),(l(!0),c(G,null,J(F(de),n=>(l(),c("div",{class:"mt-1",key:n.name},[o(r,{modelValue:n.checked,"onUpdate:modelValue":A=>n.checked=A,"hide-details":"auto",density:"comfortable",label:n.name,onChange:pe},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),e[17]||(e[17]=i("h3",{class:"mt-3"},"Rezeptvorbereitungen",-1)),i("span",ft,"Dauer: "+R(F(we))+" Min.",1),(l(!0),c(G,null,J(F(Ie),n=>(l(),c("div",{class:"mt-1",key:n.name},[o(r,{modelValue:n.checked,"onUpdate:modelValue":A=>n.checked=A,"hide-details":"auto",density:"comfortable",label:n.name,onChange:pe},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),i("div",gt,[o(s,{onClick:fe,color:"primary",variant:"outlined",rounded:""},{default:a(()=>[...e[14]||(e[14]=[b("Schnibbelmodus beenden",-1)])]),_:1})])])):_("",!0),i("div",_t,[F(L)?_("",!0):(l(),c("div",ht,[e[18]||(e[18]=i("span",{style:{"font-size":"1.6em"}},"Wie gut hat dir dieses Essen geschmeckt?",-1)),i("div",kt,[o(P,{"onUpdate:modelValue":[Ve,e[3]||(e[3]=n=>m.value.rating=n)],hover:"",length:"5",size:"30",modelValue:m.value.rating,"active-color":"primary"},null,8,["modelValue"])])])),i("div",yt,[o(s,{variant:"text",to:"/recipes","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:me},{default:a(()=>[...e[19]||(e[19]=[b("Zurück zur Übersicht",-1)])]),_:1})])]),e[20]||(e[20]=i("div",{style:{height:"600px"}},null,-1))]),_:1})):_("",!0),N.value?(l(),c("div",bt,[i("div",xt,[Q.value?(l(),c("div",St,[o(K,{"max-width":"400"},{default:a(()=>[o(V,null,{default:a(()=>[i("tbody",null,[(l(!0),c(G,null,J(N.value,n=>(l(),c("tr",{key:n.name},[i("td",null,[n.amount?(l(),c("span",wt,R(n.amount),1)):_("",!0),e[21]||(e[21]=b()),n.unit?(l(),c("span",It,R(n.unit),1)):_("",!0)]),i("td",null,R(n.name),1)]))),128))])]),_:1})]),_:1})])):_("",!0),i("div",null,[i("div",Ct,[i("span",Tt,[o(s,{style:{width:"100%"},"min-height":"60",class:"my-2",variant:"elevated",onClick:e[4]||(e[4]=n=>Q.value=!Q.value),elevation:"0","prepend-icon":"mdi-food-apple-outline"})]),i("span",Rt,[o(s,{color:"rgb(191, 231, 210)",style:{width:"100%"},"min-height":"60",class:"my-2",variant:"elevated",onClick:ve,elevation:"0","prepend-icon":"mdi-skip-forward"},{default:a(()=>[...e[22]||(e[22]=[b("Nächster Schritt",-1)])]),_:1})])]),d.value&&d.value.length>0?(l(),c("div",zt,[i("div",null,[o(s,{variant:"text",elevation:"0",disabled:"","prepend-icon":"mdi-timer-play-outline"},{default:a(()=>[...e[23]||(e[23]=[b("Stoppuhren",-1)])]),_:1})]),(l(!0),c(G,null,J(d.value,n=>(l(),c("div",{key:n.title,class:"my-1"},[o(k,{class:"mb-1"}),o(te,{align:"center"},{default:a(()=>[o(s,{icon:"mdi-close",onClick:A=>Le(n.id),variant:"text"},null,8,["onClick"]),o(T,{class:"text-left",style:{"font-size":"1.2em","font-weight":"400","line-height":"1.1 !important"}},{default:a(()=>[b(R(n.title),1)]),_:2},1024),o(T,{class:"d-flex align-center justify-end"},{default:a(()=>[o(s,{onClick:A=>Be(n),icon:"mdi-minus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),o(s,{onClick:A=>je(n),icon:"mdi-plus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),i("span",Pt,R(Ae(n.remainingSeconds)),1),n.timerStarted?_("",!0):(l(),W(s,{key:0,onClick:A=>Ne(n),icon:"mdi-play-circle-outline",class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0"},null,8,["onClick"])),n.timerStarted?(l(),W(s,{key:1,onClick:A=>Ue(n),class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0",icon:""},{default:a(()=>[n.isPaused?(l(),c("span",Vt,[o(p,{icon:"mdi-play-circle-outline"})])):_("",!0),n.isPaused?_("",!0):(l(),c("span",Dt,[o(p,{icon:"mdi-pause-circle-outline"})]))]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):_("",!0)])])])):_("",!0),e[24]||(e[24]=i("div",{style:{display:"none"}},[i("iframe",{id:"scFrame",src:"/tfjs.html",allow:"microphone"})],-1)),o(Qe,{onResult:e[5]||(e[5]=n=>Y.value=n)}),o(tt,{onResult:e[6]||(e[6]=n=>ee.value=n)})])}}},Mt=Se($t,[["__scopeId","data-v-aa370c88"]]),Nt={__name:"index",setup($){const D=le(),x=Ke();g(!1);const L=D.query.id;return re(async()=>{L||x.push("/recipes")}),(ne,Z)=>(l(),W(Mt))}};export{Nt as default};
