import{V as me,W as ge,K as te,X as le,_ as ye,N as ke,r as o,M as xe,u as Ie,Y as Ce,o as be,Z as he,g as b,x as r,y as s,B as t,C as n,R as u,Q as z,$ as I,D as a,z as i,a0 as h,P as W,a1 as w}from"./CDk2ivPY.js";import{a as T,I as we}from"./CahNPjgw.js";const We=me("recipe",{state:()=>ge({recipes:[]}),actions:{getAllRecipes:async function(K){const _=te();try{let m;_.isNetworkAccess?m=_.lanAddress+"api/"+K+"/recipes":m="https://mmhhhh.de/data/home/recipes.json?t="+new Date().getTime();let g=(await le.get(m)).data;const v=[];for(const[f,F]of Object.entries(g))v.push(F);return console.log("recipesList",v),v.forEach(f=>{if(f.lastCookedAt){const F=Math.abs(new Date().getTime()-new Date(f.lastCookedAt).getTime());f.lastCookedDays=Math.floor(F/(1e3*60*60*24))}}),this.$patch({recipes:v}),v}catch(m){le.catchError(m)}}}}),De={key:0},Se={key:1},Fe={key:2},Me={key:0},Re={key:0},$e={key:1,class:"mt-3"},Ae={key:2,class:"mt-3"},Te={class:"d-flex flex-no-wrap justify-space-between"},_e={key:0,class:"mt-3"},Ee={key:1},Ue={class:"d-flex flex-no-wrap justify-space-between"},je={key:0,class:"mt-3"},ze={key:1},Be={key:0},Ve={key:1,class:"mt-3"},Ne={key:2,class:"mt-3"},Ze={__name:"RecipeImportDialog",emits:["result"],setup(K,{emit:_}){const m=ke(),g=o(null),v=o(null),f=o(null),F=te(),{authInfo:M}=xe(F),ne=_;Ie(),Ce();const D=o(!1),E=o(null),ae=o(null),S=o(null),c=o(!1),p=o(null),y=o(!1),B=o(null),V=o(!1),N=o(null),Z=o(!1),R=o(!1),U=o(!1),O=o(!1);o(!0);const P=o(!0),j=o(!0),H=o([]),Q=o([]);be(async()=>{ne("result",async l=>(p.value=null,B.value=null,N.value=null,g.value=null,v.value=null,f.value=null,y.value=!1,V.value=!1,Z.value=!1,R.value=!1,l?(S.value=l.id,c.value=!0,l.sectionsUploaded?j.value=!1:j.value=!0,P.value=!1):(S.value=ee(),P.value=!0,j.value=!0),D.value=!0,new Promise((e,d)=>{E.value=e,ae.value=d})))}),he(H,l=>{Q.value=[...l].sort((e,d)=>e.name.localeCompare(d.name)),pe(Q.value)});function ie(){D.value=!1,E.value(null)}function oe(){D.value=!1,E.value(S.value)}function X(l){const e=l.target.files;e&&e.length>0&&(g.value=e[0]),Y()}function se(l){const e=l.dataTransfer.files;e&&e.length>0&&(g.value=e[0]),Y()}function ue(l){const e=l.dataTransfer.files;if(e&&e.length>0){const d=Array.from(e);H.value=Array.from(d)}}async function Y(){if(g.value){y.value=!0;try{p.value=(await T.analyzeIngredients(M.value.userId,S.value,g.value)).data,y.value=!1}catch{y.value=!1}}}function q(l){const e=l.target.files;e&&e.length>0&&(v.value=e[0]),G()}function de(l){const e=l.dataTransfer.files;e&&e.length>0&&(v.value=e[0]),G()}async function G(){if(v.value&&!(!p.value&&!c.value)){V.value=!0;try{B.value=(await T.analyzeSections(M.value.userId,S.value,v.value)).data}catch{}}}function J(l){const e=l.target.files;e&&e.length>0&&(f.value=e[0]),L()}function re(l){const e=l.dataTransfer.files;e&&e.length>0&&(f.value=e[0]),L()}async function L(){if(f.value&&!(!p.value&&!c.value)){Z.value=!0;try{N.value=(await T.uploadImage(M.value.userId,S.value,f.value)).data}catch{}}}function ee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const e=Math.random()*16|0;return(l==="x"?e:e&3|8).toString(16)})}function ve(l){const e=Array.from(l.target.files);H.value=e}async function pe(l){U.value=!0;try{for(let e=0;e<l.length;e+=2){const d=l[e],C=l[e+1]||null,k=ee();await T.analyzeIngredients(M.value.userId,k,d),await T.analyzeSections(M.value.userId,k,C)}}catch{}U.value=!1,y.value=!1,setTimeout(()=>{D.value=!1,E.value(!0)},500)}return(l,e)=>{const d=b("v-btn"),C=b("v-card-title"),k=b("v-icon"),$=b("v-card-text"),A=b("v-card"),fe=b("v-card-actions"),ce=b("v-dialog");return s(),r("div",null,[t(ce,{"max-width":"600",modelValue:D.value,"onUpdate:modelValue":e[12]||(e[12]=x=>D.value=x)},{default:n(()=>[t(A,{class:"pa-4",style:{"background-color":"white"}},{default:n(()=>[t(C,null,{default:n(()=>[c.value?u("",!0):(s(),r("div",De,"Rezept hinzufügen")),c.value?(s(),r("div",Se,"Rezeptdaten importieren")):u("",!0),c.value?u("",!0):(s(),r("div",Fe,[R.value?u("",!0):(s(),z(d,{key:0,variant:"plain",style:{"font-size":"0.7em"},onClick:e[0]||(e[0]=I(x=>R.value=!0,["prevent"])),"prepend-icon":"mdi-arrow-right"},{default:n(()=>[...e[13]||(e[13]=[a("Zum Multi-Dateiupload",-1)])]),_:1}))]))]),_:1}),t($,null,{default:n(()=>[R.value?u("",!0):(s(),r("div",Me,[P.value?(s(),r("div",{key:0,onDrop:I(se,["prevent"]),onDragover:e[3]||(e[3]=I(()=>{},["prevent"]))},[t(A,{rounded:"",loading:y.value},{default:n(()=>[i("div",null,[i("div",null,[t(C,null,{default:n(()=>[...e[14]||(e[14]=[a(" Zutatenliste ",-1)])]),_:1}),t($,null,{default:n(()=>[e[19]||(e[19]=a(" Erkennt sämtliche Zutaten aus der Zutatenliste. Dabei wird insbesondere der Fokus auf die Menge und den Namen gelegt. ",-1)),!y.value&&!p.value&&!g.value?(s(),r("div",Re,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[1]||(e[1]=x=>l.$refs.uploadIngredients.click())},{default:n(()=>[...e[15]||(e[15]=[a("Bild hochladen ",-1)])]),_:1})]),i("div",null,[W(m).smAndDown.value?(s(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-camera-enhance",onClick:e[2]||(e[2]=x=>l.$refs.uploadIngredientsCamera.click())},{default:n(()=>[...e[16]||(e[16]=[a("Foto machen ",-1)])]),_:1})):u("",!0)])])):u("",!0),y.value&&!p.value?(s(),r("div",$e,[t(k,{icon:"mdi-sync"}),e[17]||(e[17]=a(" Analyse läuft... ",-1))])):u("",!0),p.value?(s(),r("div",Ae,[t(k,{icon:"mdi-check"}),e[18]||(e[18]=a(" Upload abgeschlossen. ",-1))])):u("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadIngredients",ref:"uploadIngredients",onChange:X,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadIngredientsCamera",ref:"uploadIngredientsCamera",capture:"environment",onChange:X,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1},8,["loading"])],32)):u("",!0),j.value?(s(),r("div",{key:1,class:"mt-2",onDrop:I(de,["prevent"]),onDragover:e[6]||(e[6]=I(()=>{},["prevent"]))},[t(A,null,{default:n(()=>[i("div",Te,[i("div",null,[t(C,null,{default:n(()=>[...e[20]||(e[20]=[a(" Tätigkeitsschritte ",-1)])]),_:1}),t($,null,{default:n(()=>[e[24]||(e[24]=a(" Erfasst alle Arbeitsschritte, den Titel, die Zubereitungsdauer und generiert Schlagwörter. Wird im Hintergrund analysiert. ",-1)),v.value&&!B.value&&V.value?(s(),r("div",_e,[t(k,{icon:"mdi-check"}),e[21]||(e[21]=a(" Upload abgeschlossen. ",-1))])):u("",!0),v.value?u("",!0):(s(),r("div",Ee,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!c.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[4]||(e[4]=x=>l.$refs.uploadSections.click())},{default:n(()=>[...e[22]||(e[22]=[a("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[W(m).smAndDown.value?(s(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!c.value,"prepend-icon":"mdi-camera-enhance",onClick:e[5]||(e[5]=x=>l.$refs.uploadSectionsCamera.click())},{default:n(()=>[...e[23]||(e[23]=[a("Foto machen ",-1)])]),_:1},8,["disabled"])):u("",!0)])]))]),_:1})])]),h(i("input",{type:"file",id:"uploadSections",ref:"uploadSections",onChange:q,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadSectionsCamera",ref:"uploadSectionsCamera",capture:"environment",onChange:q,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1})],32)):u("",!0),i("div",{class:"mt-2",onDrop:I(re,["prevent"]),onDragover:e[9]||(e[9]=I(()=>{},["prevent"]))},[t(A,null,{default:n(()=>[i("div",Ue,[i("div",null,[t(C,null,{default:n(()=>[...e[25]||(e[25]=[a(" Rezeptbild ",-1)])]),_:1}),t($,null,{default:n(()=>[e[29]||(e[29]=a(" Hier kann ein Bild vom zubereiteten Rezept hochgeladen werden. ",-1)),f.value&&!N.value&&Z.value?(s(),r("div",je,[t(k,{icon:"mdi-check"}),e[26]||(e[26]=a(" Upload abgeschlossen. ",-1))])):u("",!0),f.value?u("",!0):(s(),r("div",ze,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!c.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[7]||(e[7]=x=>l.$refs.uploadImage.click())},{default:n(()=>[...e[27]||(e[27]=[a("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[W(m).smAndDown.value?(s(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!c.value,"prepend-icon":"mdi-camera-enhance",onClick:e[8]||(e[8]=x=>l.$refs.uploadImageCamera.click())},{default:n(()=>[...e[28]||(e[28]=[a("Foto machen ",-1)])]),_:1},8,["disabled"])):u("",!0)])]))]),_:1})])]),h(i("input",{type:"file",id:"uploadImage",ref:"uploadImage",onChange:J,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadImageCamera",ref:"uploadImageCamera",capture:"environment",onChange:J,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1})],32)])),R.value?(s(),r("div",{key:1,onDrop:I(ue,["prevent"]),onDragover:e[11]||(e[11]=I(()=>{},["prevent"]))},[t(A,{rounded:"",loading:U.value},{default:n(()=>[i("div",null,[i("div",null,[t(C,null,{default:n(()=>[...e[30]||(e[30]=[a(" Multi-Dateiupload ",-1)])]),_:1}),t($,null,{default:n(()=>[e[34]||(e[34]=a(" Erkennt sämtliche Zutaten und Tätigkeitsschritte aus den hochgeladenen Bildern. Die Dateien werden immer pärchenweise entsprechend der alphabetischen Reihenfolge des Dateinamens analysiert. ",-1)),!y.value&&!p.value&&!g.value?(s(),r("div",Be,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[10]||(e[10]=x=>l.$refs.uploadMulti.click())},{default:n(()=>[...e[31]||(e[31]=[a("Bilder hochladen ",-1)])]),_:1})])])):u("",!0),U.value&&!O.value?(s(),r("div",Ve,[t(k,{icon:"mdi-sync"}),e[32]||(e[32]=a(" Upload läuft... ",-1))])):u("",!0),O.value?(s(),r("div",Ne,[t(k,{icon:"mdi-check"}),e[33]||(e[33]=a(" Upload abgeschlossen. ",-1))])):u("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadMulti",ref:"uploadMulti",multiple:"",onChange:ve,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1},8,["loading"])],32)):u("",!0)]),_:1}),t(fe,null,{default:n(()=>[t(d,{onClick:ie,rounded:"",variant:"outlined",text:"",color:"red"},{default:n(()=>[...e[35]||(e[35]=[a(" Abbrechen ",-1)])]),_:1}),t(d,{disabled:!p.value&&!c.value,onClick:oe,rounded:"",variant:"outlined",text:""},{default:n(()=>[...e[36]||(e[36]=[a(" Fertig ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we)])}}},Ke=ye(Ze,[["__scopeId","data-v-e0aa61c2"]]);export{Ke as R,We as u};
