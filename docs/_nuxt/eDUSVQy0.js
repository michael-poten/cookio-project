import{C as ee,R,I as L}from"./BHsCZCym.js";import{L as re,_ as Re,M as Ce,N as te,O as Pe,J as xe,P as $e,K as ie,r as x,o as de,k as T,g as _,x as c,y as o,z as s,B as u,Q as f,R as a,C as r,D as v,S as ne,T as oe,A as k,U as S,V as ae}from"./CbHVuqT-.js";import"./DA__SF9z.js";import{I as Se}from"./DXw2pR4a.js";import{R as Ee}from"./C0MNv2Lh.js";import"./C17AfF7F.js";function se($){return $?re($).format("DD.MM."):"-"}function le($){return $?re($).format("DD.MM.YYYY"):"-"}const ze={class:"text-center"},Te={class:"text-center"},Ue={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ae={class:"mx-auto"},Me={style:{"background-color":"rgba(93,93,93,0.66)"}},Ve={key:0,class:"px-1 pb-1"},He={key:1,class:"pa-1 text-white",style:{"font-size":"0.8em"}},Oe={class:"text-white"},Le={key:0,class:"px-1"},Be={class:"ma-2"},Fe=["onClick"],Ne={style:{width:"100%"}},Ye={style:{width:"100%"},class:"text-right mt-2"},Ze={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},je={class:"overlay-bottom-right pl-3"},Ge={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},Ke={style:{"font-size":"1.1em"},class:"px-1"},We=["href"],Je={key:1,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Qe={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},qe={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Xe={key:1,class:"ml-1"},et={key:0},tt={key:1},nt={key:2},ot={key:3},at={key:1,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},st={key:2,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},lt={key:2,class:"ml-1"},rt={key:3,class:"ml-1"},it={key:4,class:"ml-1"},dt={key:3,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},ut={class:"ma-2"},ct={class:"ma-2"},ft={class:"ma-2"},gt={class:"overlay-bottom-right"},vt={style:{"font-size":"1.1em",width:"100%"},class:"px-1 text-center"},mt={style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},kt={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},yt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},_t={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},pt={key:0,class:"ml-1"},ht={key:0},bt={key:1},Dt={key:2},wt={key:3},It={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Rt={key:1,class:"ml-1"},Ct={class:"ma-2"},Pt={__name:"MealPlanner",setup($){const U=Ce(),{recipes:C}=te(U);Pe(),xe(),$e();const E=ie(),{authInfo:y,githubMode:A,lanAddress:ue}=te(E);x("");const B=x({}),F=new Intl.DateTimeFormat("de-DE",{weekday:"long"});x({});const M=x(null),N=x(null),Y=x(null),Z=x(null),V=x([]);de(async()=>{await h()}),T(()=>b.value.filter(n=>!n.ordered));const j=T(()=>b.value.filter(n=>!n.ordered&&n.type!=="SCHEDULED"&&n.type!=="OTHER")),w=T(()=>C.value?(C.value=C.value.sort((n,t)=>{const i=n.rating,l=t.rating,d=typeof i=="number"&&i!==null,g=typeof l=="number"&&l!==null;return!d&&!g?0:d?g?l-i:-1:1}),C.value.filter(n=>!!n.voting)):[]),b=T(()=>{let n=[];return C.value.filter(t=>!!t.planned).forEach(t=>{n.push(t)}),V.value.forEach(t=>n.push(t)),n=n.sort((t,i)=>{const l=t.plannedInDays,d=i.plannedInDays;return l===null&&d===null?0:l===null?1:d===null?-1:l-d}),console.log("filteredPlannedRecipes",n),n});function ce(n){if(n==="OTHER")return"Sonstiges";if(n==="SCHEDULED")return"Ausw√§rts / Lieferung";if(n==="RECIPE")return"Rezept"}function G(n){if(!n&&n!==0)return"";if(n<-2)return"(vor "+Math.abs(n)+" Tagen)";if(n===-2)return"vorgestern";if(n===-1)return"gestern";if(n===0)return"heute";if(n===1)return"morgen";if(n===2)return"√ºbermorgen";if(n>2)return"(in "+n+" Tagen)"}function H(n){return n?(console.log("imageUrl",n),n&&n.type==="SCHEDULED"?"/images/scheduled.png":n&&n.type==="OTHER"?"/images/other.png":A.value?"https://mmhhhh.de/data/home/recipes/"+n.id+"/image.jpg":ue.value+"api/"+y.value.userId+"/recipes/"+n.id+"/image"):""}async function O(n){A.value?window.open("https://mmhhhh.de/recipes/go?id="+n.id,"_blank","noopener"):window.open("/recipes/go?id="+n.id,"_blank","noopener")}async function fe(n){await R.planRecipe(y.value.userId,n),await h()}async function ge(){N.value().then(async n=>{if(n){let t=w.value;for(const i of t){const l={voting:0};await R.updateRecipe(y.value.userId,i.id,l)}await h()}})}async function ve(n){const t={voting:0};await R.updateRecipe(y.value.userId,n,t),await h()}async function me(){Y.value().then(async n=>{if(n){let t=b.value;for(const i of t){const l={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await R.updateRecipe(y.value.userId,i.id,l)}await h(),R.uploadRecipeToGithub(y.value.userId,null)}})}async function ke(){const n=b.value.filter(t=>!t.ordered&&t.type!=="SCHEDULED"&&t.type!=="OTHER").map(t=>t.id);console.log("buyIngredients",n),n&&n.length>0&&M.value(n).then(t=>{h()})}async function ye(){const n=[],t=C.value.filter(l=>l.voting&&l.voting>0);if(t.length>0)for(const l of t)n.push(l.title+" - https://mmhhhh.de/recipes/go?id="+l.id);const i=n.join(`
`);if(await navigator.clipboard.writeText(i),navigator.share)try{await navigator.share({title:i,text:i})}catch(l){console.error("Teilen abgebrochen",l)}}async function K(n){const t=n.id,i={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await R.updateRecipe(y.value.userId,t,i),await h(),R.uploadRecipeToGithub(y.value.userId,null);let l=y.value.calendarPlan;if(l||(l={}),n.cooked){const d=new Date;for(const g of Object.keys(l))l[g]&&l[g].recipeId===t&&(new Date(g).getTime()<=d.getTime()?l[g].cooked=!0:l[g].cooked||delete l[g])}else for(const d of Object.keys(l))l[d]&&l[d].recipeId===t&&!l[d].cooked&&delete l[d];await L.saveCalendarPlan(y.value.userId,l)}async function _e(n){const t=n.id,i={planned:!0,voting:0,cooked:!1,ordered:!1,preparations:[]};await R.updateRecipe(y.value.userId,t,i),await h(),R.uploadRecipeToGithub(y.value.userId,null)}async function h(){C.value=await U.getAllRecipes(y.value.userId),await De()}function W(n){M.value(n).then(t=>{h()})}function pe(n){Z.value(n)}async function he(n){let i=(await E.getAuthInfo()).calendarPlan;const l=n.plannedDate.getFullYear(),d=String(n.plannedDate.getMonth()+1).padStart(2,"0"),g=String(n.plannedDate.getDate()).padStart(2,"0");delete i[`${l}-${d}-${g}`],await L.saveCalendarPlan(y.value.userId,i),await E.refreshPlannendUntil(),await h()}async function be(n){let i=(await E.getAuthInfo()).calendarPlan;const l=n.plannedDate.getFullYear(),d=String(n.plannedDate.getMonth()+1).padStart(2,"0"),g=String(n.plannedDate.getDate()).padStart(2,"0");i[`${l}-${d}-${g}`].cooked=!0,await L.saveCalendarPlan(y.value.userId,i),await E.refreshPlannendUntil(),await h()}async function De(){V.value=[];let n=await E.getAuthInfo();if(n){let t=n.calendarPlan;if(t||(t={}),t){const i=new Date;i.setHours(0,0,0,0),new Date().setHours(23,59,59,0);for(let d=0;d<14;d++){const g=new Date;if(g.setDate(g.getDate()+d),g.getTime()>i.getTime()){const I=g.getFullYear(),D=String(g.getMonth()+1).padStart(2,"0"),p=String(g.getDate()).padStart(2,"0");if(t[`${I}-${D}-${p}`]&&t[`${I}-${D}-${p}`].type&&t[`${I}-${D}-${p}`].type!=="RECIPE"&&!t[`${I}-${D}-${p}`].cooked){const P=new Date(g).getTime()-new Date().getTime(),z=Math.floor(P/(1e3*60*60*24));V.value.push({plannedDate:g,plannedInDays:z,title:t[`${I}-${D}-${p}`].recipeTitle,type:t[`${I}-${D}-${p}`].type,cooked:t[`${I}-${D}-${p}`].cooked})}}}}}}return(n,t)=>{const i=_("v-btn"),l=_("v-rating"),d=_("v-icon"),g=_("v-carousel-item"),I=_("v-carousel"),D=_("v-divider"),p=_("v-list-item-title"),P=_("v-list-item"),z=_("v-list"),J=_("v-menu"),Q=_("v-toolbar"),q=_("v-img"),X=_("v-card"),we=_("v-col"),Ie=_("v-row");return o(),c("div",null,[s("div",ze,[t[12]||(t[12]=s("h2",{class:"mt-6 text-center"},"Vorschl√§ge",-1)),w.value&&w.value.length>0?(o(),f(i,{key:0,variant:"plain",class:"text-center",onClick:ge},{default:r(()=>[...t[4]||(t[4]=[v("Alle entfernen",-1)])]),_:1})):a("",!0),w.value&&w.value.length>0?(o(),f(i,{key:1,variant:"plain",class:"text-center",onClick:ye},{default:r(()=>[...t[5]||(t[5]=[v("Teilen",-1)])]),_:1})):a("",!0),s("div",Te,[w.value.length===0?(o(),c("div",Ue,[...t[6]||(t[6]=[s("div",{style:{"font-size":"1.2em"}},"Keine Likes vorhanden!",-1)])])):a("",!0),w.value.length>0?(o(),f(I,{key:1,"hide-delimiter-background":"","hide-delimiters":w.value.length===1},{default:r(()=>[(o(!0),c(ne,null,oe(w.value,e=>(o(),f(g,{cover:"",src:H(e),key:e.id},{default:r(()=>[s("div",Ae,[s("div",Me,[e.rating?(o(),c("div",Ve,[u(l,{modelValue:e.rating,"onUpdate:modelValue":m=>e.rating=m,hover:"",length:"5",size:"20",readonly:"",color:"white"},null,8,["modelValue","onUpdate:modelValue"])])):a("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.imageInProgress&&!e.sectionsUploaded?(o(),c("div",He,[s("span",null,[u(d,{icon:"mdi-information-slab-circle"}),t[7]||(t[7]=v()),t[8]||(t[8]=s("b",null,"Nur Zutatenliste vorhanden!",-1))])])):a("",!0),s("div",Oe,[e.duration?(o(),c("span",Le,[s("b",null,k(e.duration)+" Min.",1),t[9]||(t[9]=v(" | ",-1))])):a("",!0),s("span",null,[s("b",null,k(e.voting)+" x üëç",1)])])]),s("div",Be,[s("span",{onClick:m=>O(e),style:{cursor:"pointer","text-decoration-line":"none","font-weight":"700","font-size":"2.04em",color:"#ffffff !important","background-color":"rgba(93,93,93,0.66)",hyphens:"auto","overflow-wrap":"break-word"},class:"text-medium-emphasis"},k(e.title),9,Fe)]),s("div",null,[u(i,{onClick:m=>fe(e.id),variant:"flat",color:"rgba(198, 217, 238, 0.7)",height:"50"},{default:r(()=>[...t[10]||(t[10]=[v("Rezept einplanen",-1)])]),_:1},8,["onClick"])]),s("div",null,[u(i,{onClick:m=>ve(e.id),variant:"flat",color:"rgb(238 198 198 / 70%)",class:"mt-1"},{default:r(()=>[...t[11]||(t[11]=[v("Ignorieren",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["src"]))),128))]),_:1},8,["hide-delimiters"])):a("",!0)])]),u(D,{class:"mt-4"}),s("div",Ne,[t[29]||(t[29]=s("h2",{class:"mt-6 text-center"},"Ausgew√§hlt",-1)),s("div",Ye,[b.value&&b.value.length>0?(o(),f(i,{key:0,variant:"outlined",onClick:ke,disabled:!j.value||j.value.length===0},{default:r(()=>[...t[13]||(t[13]=[v("Alle Zutaten einkaufen",-1)])]),_:1},8,["disabled"])):a("",!0),b.value&&b.value.length>0?(o(),f(i,{key:1,variant:"outlined",class:"ml-2",color:"red",onClick:me},{default:r(()=>[...t[14]||(t[14]=[v("Alle entfernen",-1)])]),_:1})):a("",!0)]),u(Ie,{class:"text-center mt-2",id:"recipesDiv"},{default:r(()=>[b.value.length===0?(o(),c("div",Ze,[...t[15]||(t[15]=[s("div",{style:{"font-size":"1.2em"}},"Keine geplanten Rezepte gefunden!",-1)])])):a("",!0),(o(!0),c(ne,null,oe(b.value,e=>(o(),f(we,{cols:"12",sm:"12",md:"6",lg:"4",xl:"3",key:e.id},{default:r(()=>[e.type!=="SCHEDULED"&&e.type!=="OTHER"?(o(),f(X,{key:0,class:"mx-auto","max-width":"374"},{default:r(()=>[(o(),f(q,{class:"position-relative",height:"200",src:H(e),key:B.value[e.id]?B.value[e.id]:0,color:"grey",cover:""},{default:r(()=>[s("div",je,[e.duration?(o(),c("div",Ge,[s("b",null,k(e.duration)+" Min.",1)])):a("",!0),s("div",Ke,[!e.ingredientsInProgress&&!e.sectionsInProgress&&e.sectionsUploaded?(o(),c("a",{key:0,target:"_blank",href:"/recipes/go?id="+e.id,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},k(e.title),9,We)):a("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.sectionsUploaded?(o(),c("span",Je,k(e.title),1)):a("",!0)])]),s("div",Qe,[t[18]||(t[18]=s("div",{style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},[s("h2",null,[s("u",null,[s("b",null,"Rezept")])])],-1)),!e.cooked&&e.plannedDate?(o(),c("div",qe,[e.plannedDate?(o(),f(d,{key:0,icon:"mdi-calendar-outline"})):a("",!0),e.plannedDate?(o(),c("b",Xe,[e.plannedInDays<0?(o(),c("span",et,"War geplant")):a("",!0),e.plannedInDays>=0?(o(),c("span",tt,"Geplant")):a("",!0),e.plannedInDays>=-2&&e.plannedInDays<=2?(o(),c("span",nt," f√ºr ")):a("",!0),e.plannedInDays<-2&&e.plannedInDays>2?(o(),c("span",ot,k(S(F).format(e.plannedDate)),1)):a("",!0),v(" "+k(G(e.plannedInDays))+", "+k(S(se)(e.plannedDate)),1)])):a("",!0)])):a("",!0),e.cooked?a("",!0):(o(),c("div",at,[e.ordered?(o(),f(d,{key:0,icon:"mdi-check-bold"})):a("",!0),e.ordered?a("",!0):(o(),f(d,{key:1,icon:"mdi-close-thick",color:"red"})),t[16]||(t[16]=s("b",{class:"ml-1"},"Zutaten bestellt",-1))])),e.sectionsUploaded&&!e.sectionsInProgress&&e.ordered?(o(),c("div",st,[e.cooked?(o(),f(d,{key:0,icon:"mdi-check-bold"})):a("",!0),e.cooked?a("",!0):(o(),f(d,{key:1,icon:"mdi-close-thick",color:"red"})),e.cooked?a("",!0):(o(),c("b",lt,"Noch nicht zubereitet")),e.cooked&&!e.lastCookedAt?(o(),c("b",rt,"Rezept zubereitet")):a("",!0),e.cooked&&e.lastCookedAt?(o(),c("b",it,"Zubereitet am "+k(S(le)(e.lastCookedAt)),1)):a("",!0)])):a("",!0),!e.sectionsUploaded&&!e.sectionsInProgress?(o(),c("div",dt,[u(d,{icon:"mdi-information"}),t[17]||(t[17]=s("b",null,"Nur Zutatenliste vorhanden",-1))])):a("",!0)]),u(Q,{color:"transparent"},{append:r(()=>[u(J,null,{activator:r(({props:m})=>[!e.imageInProgress&&!e.sectionsInProgress&&!e.ingredientsInProgress?(o(),f(i,ae({key:0,icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},m),{default:r(()=>[u(d,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)):a("",!0)]),default:r(()=>[u(z,null,{default:r(()=>[u(P,{onClick:m=>W(e.id),"prepend-icon":"mdi-truck"},{default:r(()=>[u(p,null,{default:r(()=>[...t[19]||(t[19]=[v("Zutaten einkaufen",-1)])]),_:1})]),_:1},8,["onClick"]),e.sectionsUploaded&&!e.sectionsInProgress?(o(),f(P,{key:0,onClick:m=>O(e,!0),"prepend-icon":"mdi-chef-hat"},{default:r(()=>[u(p,null,{default:r(()=>[...t[20]||(t[20]=[v("Rezept zubereiten",-1)])]),_:1})]),_:1},8,["onClick"])):a("",!0),S(A)?a("",!0):(o(),f(P,{key:1,onClick:m=>pe(e),"prepend-icon":"mdi-image-plus"},{default:r(()=>[u(p,null,{default:r(()=>[...t[21]||(t[21]=[v("Daten importieren",-1)])]),_:1})]),_:1},8,["onClick"])),u(D),e.cooked||e.ordered?(o(),f(P,{key:2,onClick:m=>_e(e),"prepend-icon":"mdi-restore"},{default:r(()=>[u(p,null,{default:r(()=>[...t[22]||(t[22]=[v("Planung zur√ºcksetzen",-1)])]),_:1})]),_:1},8,["onClick"])):a("",!0),u(P,{onClick:m=>K(e),"prepend-icon":"mdi-delete"},{default:r(()=>[u(p,null,{default:r(()=>[...t[23]||(t[23]=[v("Aus Planung entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])),s("div",ut,[!e.ordered&&!e.cooked?(o(),f(i,{key:0,variant:"outlined",onClick:m=>W(e.id)},{default:r(()=>[...t[24]||(t[24]=[v("Zutaten einkaufen",-1)])]),_:1},8,["onClick"])):a("",!0)]),s("div",ct,[e.ordered&&!e.cooked&&e.sectionsUploaded&&!e.sectionsInProgress?(o(),f(i,{key:0,variant:"outlined",onClick:m=>O(e,!0),color:"blue"},{default:r(()=>[...t[25]||(t[25]=[v("Rezept zubereiten",-1)])]),_:1},8,["onClick"])):a("",!0)]),s("div",ft,[e.sectionsUploaded&&!e.sectionsInProgress&&e.cooked||!(e.sectionsUploaded&&!e.sectionsInProgress)&&e.ordered?(o(),f(i,{key:0,variant:"outlined",color:"red",onClick:m=>K(e)},{default:r(()=>[...t[26]||(t[26]=[v("Aus Planung entfernen",-1)])]),_:1},8,["onClick"])):a("",!0)])]),_:2},1024)):a("",!0),e.type==="SCHEDULED"||e.type==="OTHER"?(o(),f(X,{key:1,class:"mx-auto","max-width":"374"},{default:r(()=>[u(q,{class:"position-relative",src:H(e),height:"200",color:"rgb(160, 171, 183)",cover:""},{default:r(()=>[s("div",gt,[s("div",vt,[s("span",mt,k(e.title),1)])]),s("div",kt,[s("div",yt,[s("h2",null,[s("u",null,[s("b",null,k(ce(e.type)),1)])])]),s("div",_t,[u(d,{icon:"mdi-calendar-outline"}),e.plannedDate?(o(),c("b",pt,[e.plannedInDays<0?(o(),c("span",ht,"War geplant")):a("",!0),e.plannedInDays>=0?(o(),c("span",bt,"Geplant")):a("",!0),e.plannedInDays>=-2&&e.plannedInDays<=2?(o(),c("span",Dt," f√ºr")):a("",!0),e.plannedInDays<-2&&e.plannedInDays>2?(o(),c("span",wt,k(S(F).format(e.plannedDate)),1)):a("",!0),v(" "+k(G(e.plannedInDays))+", "+k(S(se)(e.plannedDate)),1)])):a("",!0)]),(e.type==="RECIPE"||e.type==="OTHER")&&e.cooked?(o(),c("div",It,[e.cooked?(o(),f(d,{key:0,icon:"mdi-check-bold"})):a("",!0),e.cooked?(o(),c("b",Rt,"Verzehrt am "+k(S(le)(e.plannedDate)),1)):a("",!0)])):a("",!0)]),u(Q,{color:"transparent"},{append:r(()=>[u(J,null,{activator:r(({props:m})=>[u(i,ae({icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},m),{default:r(()=>[u(d,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)]),default:r(()=>[u(z,null,{default:r(()=>[u(P,{onClick:m=>he(e),"prepend-icon":"mdi-calendar-remove"},{default:r(()=>[u(p,null,{default:r(()=>[...t[27]||(t[27]=[v("Aus Kalender entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"]),s("div",Ct,[e.cooked?a("",!0):(o(),f(i,{key:0,variant:"outlined",onClick:m=>be(e),color:"red"},{default:r(()=>[...t[28]||(t[28]=[v("Mahlzeit wurde verzehrt",-1)])]),_:1},8,["onClick"]))])]),_:2},1024)):a("",!0)]),_:2},1024))),128))]),_:1})]),u(Se,{onResult:t[0]||(t[0]=e=>M.value=e)}),u(Ee,{onResult:t[1]||(t[1]=e=>Z.value=e)}),u(ee,{onResult:t[2]||(t[2]=e=>N.value=e),title:"Bitte best√§tigen",message:"Sollen alle vorgeschlagenen Rezepte entfernt werden?"}),u(ee,{onResult:t[3]||(t[3]=e=>Y.value=e),title:"Bitte best√§tigen",message:"Sollen alle geplanten Rezepte aus der Planung entfernt werden?"})])}}},xt=Re(Pt,[["__scopeId","data-v-c4a2531c"]]),At={__name:"index",setup($){return de(async()=>{ie()}),(U,C)=>(o(),f(xt))}};export{At as default};
