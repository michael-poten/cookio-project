import{_ as Ue,O as we,r as n,K as Se,N as he,u as De,Z as Fe,o as _e,W as je,e as ze,g as y,x as d,y as o,B as t,C as u,R as s,Q as O,$ as k,D as r,z as i,a0 as h,U as $,a1 as D,a2 as Be}from"./Ds6spcz5.js";import{a as L,R as $e}from"./DZK96omx.js";import{f as Le}from"./B1YF1_9P.js";const Me={key:0,style:{"font-size":"1.3em"}},Te={key:1,style:{"font-size":"1.3em"}},Ee={key:2},Ve={key:0},Ae={key:0},Oe={key:1,class:"mt-3"},Ze={key:2,class:"mt-3"},Ne={key:0,class:"mt-3"},Pe={key:1},qe={class:"ma-4"},He={key:0,class:"mt-3"},We={key:1},Ke={key:1,class:"mx-2 mt-2 mb-2"},Qe={key:2,class:"ml-2 mt-3"},Ge={key:0},Je={key:1,class:"mt-3"},Xe={key:2,class:"mt-3"},Ye={__name:"RecipeImportDialog",emits:["result"],setup(el,{emit:ne}){const M=we(),ae=n({aspectRatio:1.3}),Z=n(null),F=n(null),x=n(null),ue=n("image/jpeg"),oe=n(.9),ie=n(!1),b=n(null),R=n(null),U=n(null),C=n(null),se=Se(),{authInfo:_}=he(se),re=ne;De(),Fe();const j=n(!1),T=n(null),de=n(null),w=n(null),v=n(!1),p=n(null),m=n(!1),N=n(null),P=n(!1),z=n(!1),q=n(!1),B=n(!1),E=n(!1),Q=n(!1);n(!0);const H=n(!0),V=n(!0),W=n([]),G=n([]),K=n(!1);_e(async()=>{re("result",async l=>(p.value=null,N.value=null,z.value=null,v.value=!1,R.value=null,U.value=null,C.value=null,m.value=!1,P.value=!1,q.value=!1,B.value=!1,F.value=null,b.value=null,l?(w.value=l.id,v.value=!0,l.sectionsUploaded?V.value=!1:V.value=!0,H.value=!1):(w.value=te(),H.value=!0,V.value=!0),j.value=!0,new Promise((e,a)=>{T.value=e,de.value=a})))}),je(W,l=>{G.value=[...l].sort((e,a)=>e.name.localeCompare(a.name)),be(G.value)});async function ve(){if(K.value){const l={planned:!0,voting:0};await $e.updateRecipe(_.value.userId,w.value,l)}}function pe(){j.value=!1,T.value(null)}async function ce(){F.value&&!z.value&&await ke(),j.value=!1,T.value(w.value)}function J(l){const e=l.target.files;e&&e.length>0&&(R.value=e[0]),X()}function fe(l){const e=l.dataTransfer.files;e&&e.length>0&&(R.value=e[0]),X()}function me(l){const e=l.dataTransfer.files;if(e&&e.length>0){const a=Array.from(e);W.value=Array.from(a)}}async function X(){if(R.value){m.value=!0;try{p.value=(await L.analyzeIngredients(_.value.userId,w.value,R.value)).data,m.value=!1}catch{m.value=!1}}}function Y(l){const e=l.target.files;e&&e.length>0&&(U.value=e[0]),ee()}function ge(l){const e=l.dataTransfer.files;e&&e.length>0&&(U.value=e[0]),ee()}async function ee(){if(U.value&&!(!p.value&&!v.value)){P.value=!0;try{N.value=(await L.analyzeSections(_.value.userId,w.value,U.value)).data}catch{}}}function le(l){const e=l.target.files;e&&e.length>0&&(C.value=e[0]);const a=URL.createObjectURL(C.value);x.value&&URL.revokeObjectURL(x.value),x.value=a,F.value=a}function ye(l){const e=l.dataTransfer.files;e&&e.length>0&&(C.value=e[0]);const a=URL.createObjectURL(C.value);x.value&&URL.revokeObjectURL(x.value),x.value=a,F.value=a}async function ke(){if(!C.value||!p.value&&!v.value||(q.value=!0,!Z.value))return;const l=Z.value.getResult(),e=l&&l.canvas;if(!e)return;const a=ue.value,g=a==="image/jpeg"||a==="image/webp"?oe.value:void 0;ie.value=!0;const c=await new Promise((I,S)=>{e.toBlob(A=>A?I(A):S(new Error("toBlob() failed")),a,g)});try{await L.uploadImage(_.value.userId,w.value,c),z.value=!0,b.value&&URL.revokeObjectURL(b.value),b.value=URL.createObjectURL(c)}catch{}}ze(()=>{x.value&&URL.revokeObjectURL(x.value),b.value&&URL.revokeObjectURL(b.value)});function te(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const e=Math.random()*16|0;return(l==="x"?e:e&3|8).toString(16)})}function xe(l){const e=Array.from(l.target.files);W.value=e}async function be(l){E.value=!0;try{for(let e=0;e<l.length;e+=2){const a=l[e],g=l[e+1]||null,c=te();await L.analyzeIngredients(_.value.userId,c,a),await L.analyzeSections(_.value.userId,c,g)}}catch{}E.value=!1,m.value=!1,setTimeout(()=>{j.value=!1,T.value(!0)},500)}return(l,e)=>{const a=y("v-btn"),g=y("v-card-title"),c=y("v-icon"),I=y("v-card-text"),S=y("v-card"),A=y("v-img"),Ce=y("v-checkbox"),Ie=y("v-card-actions"),Re=y("v-dialog");return o(),d("div",null,[t(Re,{"max-width":"600",modelValue:j.value,"onUpdate:modelValue":e[13]||(e[13]=f=>j.value=f)},{default:u(()=>[t(S,{style:{"background-color":"white"},class:"text-center"},{default:u(()=>[t(g,{class:"px-4 py-4 pb-0"},{default:u(()=>[v.value?s("",!0):(o(),d("div",Me,"Rezept hinzufügen")),v.value?(o(),d("div",Te,"Bild ändern")):s("",!0),v.value?s("",!0):(o(),d("div",Ee,[B.value?s("",!0):(o(),O(a,{key:0,variant:"plain",style:{"font-size":"0.7em"},onClick:e[0]||(e[0]=k(f=>B.value=!0,["prevent"])),"prepend-icon":"mdi-arrow-right"},{default:u(()=>[...e[14]||(e[14]=[r("Zum Multi-Dateiupload",-1)])]),_:1}))]))]),_:1}),t(I,{class:"ma-0 pa-0 text-center"},{default:u(()=>[B.value?s("",!0):(o(),d("div",Ve,[H.value?(o(),d("div",{key:0,onDrop:k(fe,["prevent"]),onDragover:e[3]||(e[3]=k(()=>{},["prevent"]))},[t(S,{rounded:"",loading:m.value,elevation:"0",color:"white"},{default:u(()=>[i("div",null,[i("div",null,[t(g,null,{default:u(()=>[...e[15]||(e[15]=[r(" Zutatenliste ",-1)])]),_:1}),t(I,null,{default:u(()=>[e[20]||(e[20]=r(" Erkennt sämtliche Zutaten aus der Zutatenliste. Dabei wird insbesondere der Fokus auf die Menge und den Namen gelegt. ",-1)),!m.value&&!p.value&&!R.value?(o(),d("div",Ae,[i("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[1]||(e[1]=f=>l.$refs.uploadIngredients.click())},{default:u(()=>[...e[16]||(e[16]=[r("Bild hochladen ",-1)])]),_:1})]),i("div",null,[$(M).smAndDown.value?(o(),O(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-camera-enhance",onClick:e[2]||(e[2]=f=>l.$refs.uploadIngredientsCamera.click())},{default:u(()=>[...e[17]||(e[17]=[r("Foto machen ",-1)])]),_:1})):s("",!0)])])):s("",!0),m.value&&!p.value?(o(),d("div",Oe,[t(c,{icon:"mdi-sync"}),e[18]||(e[18]=r(" Analyse läuft... ",-1))])):s("",!0),p.value?(o(),d("div",Ze,[t(c,{icon:"mdi-check"}),e[19]||(e[19]=r(" Upload abgeschlossen. ",-1))])):s("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadIngredients",ref:"uploadIngredients",onChange:J,accept:"image/png,image/jpeg"},null,544),[[D,!1]]),h(i("input",{type:"file",id:"uploadIngredientsCamera",ref:"uploadIngredientsCamera",capture:"environment",onChange:J,accept:"image/png,image/jpeg"},null,544),[[D,!1]])]),_:1},8,["loading"])],32)):s("",!0),V.value?(o(),d("div",{key:1,class:"mt-2",onDrop:k(ge,["prevent"]),onDragover:e[6]||(e[6]=k(()=>{},["prevent"]))},[t(S,null,{default:u(()=>[i("div",null,[i("div",null,[t(g,{class:"text-center"},{default:u(()=>[...e[21]||(e[21]=[r(" Tätigkeitsschritte ",-1)])]),_:1}),t(I,{class:"text-center"},{default:u(()=>[e[25]||(e[25]=r(" Erfasst alle Arbeitsschritte, den Titel, die Zubereitungsdauer und generiert Schlagwörter. Wird im Hintergrund analysiert. ",-1)),U.value&&!N.value&&P.value?(o(),d("div",Ne,[t(c,{icon:"mdi-check"}),e[22]||(e[22]=r(" Upload abgeschlossen. ",-1))])):s("",!0),U.value?s("",!0):(o(),d("div",Pe,[i("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[4]||(e[4]=f=>l.$refs.uploadSections.click())},{default:u(()=>[...e[23]||(e[23]=[r("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[$(M).smAndDown.value?(o(),O(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-camera-enhance",onClick:e[5]||(e[5]=f=>l.$refs.uploadSectionsCamera.click())},{default:u(()=>[...e[24]||(e[24]=[r("Foto machen ",-1)])]),_:1},8,["disabled"])):s("",!0)])]))]),_:1})])]),h(i("input",{type:"file",id:"uploadSections",ref:"uploadSections",onChange:Y,accept:"image/png,image/jpeg"},null,544),[[D,!1]]),h(i("input",{type:"file",id:"uploadSectionsCamera",ref:"uploadSectionsCamera",capture:"environment",onChange:Y,accept:"image/png,image/jpeg"},null,544),[[D,!1]])]),_:1})],32)):s("",!0),i("div",{class:"mt-2",onDrop:k(ye,["prevent"]),onDragover:e[9]||(e[9]=k(()=>{},["prevent"]))},[t(S,null,{default:u(()=>[i("div",null,[i("div",null,[t(g,{class:"ma-2 pa-0 text-center"},{default:u(()=>[...e[26]||(e[26]=[r(" Rezeptbild ",-1)])]),_:1}),t(I,{class:"ma-0 pa-0 text-center"},{default:u(()=>[i("div",qe,[e[30]||(e[30]=r(" Hier kann ein Bild vom zubereiteten Rezept hochgeladen werden. ",-1)),C.value&&!z.value&&q.value?(o(),d("div",He,[t(c,{icon:"mdi-check"}),e[27]||(e[27]=r(" Upload abgeschlossen. ",-1))])):s("",!0),C.value?s("",!0):(o(),d("div",We,[i("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[7]||(e[7]=f=>l.$refs.uploadImage.click())},{default:u(()=>[...e[28]||(e[28]=[r("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[$(M).smAndDown.value?(o(),O(a,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!p.value&&!v.value,"prepend-icon":"mdi-camera-enhance",onClick:e[8]||(e[8]=f=>l.$refs.uploadImageCamera.click())},{default:u(()=>[...e[29]||(e[29]=[r("Foto machen ",-1)])]),_:1},8,["disabled"])):s("",!0)])]))]),F.value&&!z.value?(o(),d("div",{key:0,style:Be({width:$(M).smAndDown.value?"370px":"580px"})},[t($(Le),{ref_key:"cropperRef",ref:Z,src:F.value,"stencil-props":ae.value,"auto-zoom":!1,"image-restriction":"stencil",transitions:!0,debounce:150},null,8,["src","stencil-props"])],4)):s("",!0),b.value?(o(),d("div",Ke,[e[31]||(e[31]=i("p",{class:"text-sm text-gray-600"},"Bild erfolgreich hochgeladen!",-1)),t(A,{src:b.value,alt:"Cropped preview",class:"mt-1 w-full rounded border"},null,8,["src"])])):s("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadImage",ref:"uploadImage",onChange:le,accept:"image/png,image/jpeg"},null,544),[[D,!1]]),h(i("input",{type:"file",id:"uploadImageCamera",ref:"uploadImageCamera",capture:"environment",onChange:le,accept:"image/png,image/jpeg"},null,544),[[D,!1]])]),_:1})],32),v.value?s("",!0):(o(),d("div",Qe,[t(Ce,{modelValue:K.value,"onUpdate:modelValue":[e[10]||(e[10]=f=>K.value=f),ve],"hide-details":"",density:"comfortable",label:"Rezept nach Import sofort einplanen"},null,8,["modelValue"])]))])),B.value?(o(),d("div",{key:1,onDrop:k(me,["prevent"]),onDragover:e[12]||(e[12]=k(()=>{},["prevent"]))},[t(S,{rounded:"",loading:E.value},{default:u(()=>[i("div",null,[i("div",null,[t(g,null,{default:u(()=>[...e[32]||(e[32]=[r(" Multi-Dateiupload ",-1)])]),_:1}),t(I,null,{default:u(()=>[e[36]||(e[36]=r(" Erkennt sämtliche Zutaten und Tätigkeitsschritte aus den hochgeladenen Bildern. Die Dateien werden immer pärchenweise entsprechend der alphabetischen Reihenfolge des Dateinamens analysiert. ",-1)),!m.value&&!p.value&&!R.value?(o(),d("div",Ge,[i("div",null,[t(a,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[11]||(e[11]=f=>l.$refs.uploadMulti.click())},{default:u(()=>[...e[33]||(e[33]=[r("Bilder hochladen ",-1)])]),_:1})])])):s("",!0),E.value&&!Q.value?(o(),d("div",Je,[t(c,{icon:"mdi-sync"}),e[34]||(e[34]=r(" Upload läuft... ",-1))])):s("",!0),Q.value?(o(),d("div",Xe,[t(c,{icon:"mdi-check"}),e[35]||(e[35]=r(" Upload abgeschlossen. ",-1))])):s("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadMulti",ref:"uploadMulti",multiple:"",onChange:xe,accept:"image/png,image/jpeg"},null,544),[[D,!1]])]),_:1},8,["loading"])],32)):s("",!0)]),_:1}),t(Ie,null,{default:u(()=>[t(a,{onClick:pe,rounded:"",variant:"outlined",text:"",color:"red"},{default:u(()=>[...e[37]||(e[37]=[r(" Abbrechen ",-1)])]),_:1}),t(a,{disabled:!p.value&&!v.value,onClick:ce,rounded:"",variant:"outlined",text:""},{default:u(()=>[...e[38]||(e[38]=[r(" Fertig ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},al=Ue(Ye,[["__scopeId","data-v-97bdc989"]]);export{al as R};
