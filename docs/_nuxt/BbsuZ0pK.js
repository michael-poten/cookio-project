import{C as ee,R as I,I as N}from"./BGlQAd_r.js";import{L as le,_ as we,M as Ie,N as te,O as Re,J as Ce,P as Pe,K as ie,r as C,o as de,k as F,g as k,x as c,y as o,z as i,B as u,Q as f,R as a,C as s,D as g,S as ne,T as oe,A as y,U as z,V as ae}from"./DOW9I-6q.js";import"./DA__SF9z.js";import{I as $e}from"./Bge_YF44.js";import{R as xe}from"./gwiQZHC6.js";import"./CM7bSYME.js";function Se(P){return P?le(P).format("DD.MM."):"-"}function se(P){return P?le(P).format("DD.MM.YYYY"):"-"}const ze={class:"text-center"},Ae={class:"text-center"},Te={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Me={class:"mx-auto"},Ue={style:{"background-color":"rgba(93,93,93,0.66)"}},Ee={key:0,class:"px-1 pb-1"},Ve={key:1,class:"pa-1 text-white",style:{"font-size":"0.8em"}},Ne={class:"text-white"},Fe={key:0,class:"px-1"},He={class:"ma-2"},Oe=["onClick"],Ze={style:{width:"100%"}},Be={style:{width:"100%"},class:"text-right mt-2"},Le={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ye={class:"overlay-bottom-right"},Ke={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},Ge={style:{"font-size":"1.1em"},class:"px-1"},je=["href"],We={key:1,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Je={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},Qe={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},qe={key:2,class:"ml-1"},Xe={key:0},et={key:1},tt={key:2},nt={key:3},ot={key:3,class:"ml-1"},at={key:1,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},st={key:2,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},lt={key:2,class:"ml-1"},it={key:3,class:"ml-1"},dt={key:4,class:"ml-1"},rt={key:3,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},ut={class:"ma-2"},ct={class:"ma-2"},ft={class:"ma-2"},vt={key:0,class:"overlay-bottom-right"},gt={style:{color:"#ffffff","background-color":"rgba(93,93,93,0.66)","font-size":"1.4em"},class:"pa-1"},mt={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},_t={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},kt={key:0,class:"ml-1"},yt={key:0},ht={key:1},pt={key:2},bt={key:3},Dt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},wt={key:2,class:"ml-1"},It={key:3,class:"ml-1"},Rt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Ct={class:"ml-1"},Pt={class:"ma-2"},$t={__name:"MealPlanner",setup(P){const T=Ie(),{recipes:$}=te(T);Re(),Ce(),Pe();const S=ie(),{authInfo:_,githubMode:M,lanAddress:re}=te(S);C("");const H=C({}),O=new Intl.DateTimeFormat("de-DE",{weekday:"long"});C({});const U=C(null),Z=C(null),B=C(null),L=C(null),E=C([]);de(async()=>{await p()});const Y=F(()=>D.value.filter(n=>!n.ordered)),x=F(()=>$.value?($.value=$.value.sort((n,t)=>{const d=n.rating,r=t.rating,l=typeof d=="number"&&d!==null,v=typeof r=="number"&&r!==null;return!l&&!v?0:l?v?r-d:-1:1}),$.value.filter(n=>!!n.voting)):[]),D=F(()=>{let n=[];return $.value.filter(t=>!!t.planned).forEach(t=>{n.push(t)}),E.value.forEach(t=>n.push(t)),n=n.sort((t,d)=>{const r=t.plannedInDays,l=d.plannedInDays;return r===null&&l===null?0:r===null?1:l===null?-1:r-l}),n});function ue(n){if(n==="OTHER")return"Sonstiges";if(n==="SCHEDULED")return"Ausw√§rts / Lieferung"}function K(n){if(!n&&n!==0)return"";if(n<-2)return"(vor "+Math.abs(n)+" Tagen)";if(n===-2)return"vorgestern";if(n===-1)return"gestern";if(n===0)return"heute";if(n===1)return"morgen";if(n===2)return"√ºbermorgen";if(n>2)return"(in "+n+" Tagen)"}function G(n){return n?M.value?"https://mmhhhh.de/data/home/recipes/"+n+"/image.jpg":re.value+"api/"+_.value.userId+"/recipes/"+n+"/image":""}async function V(n){M.value?window.open("https://mmhhhh.de/recipes/go?id="+n.id,"_blank","noopener"):window.open("/recipes/go?id="+n.id,"_blank","noopener")}async function ce(n){await I.planRecipe(_.value.userId,n),await p()}async function fe(){Z.value().then(async n=>{if(n){let t=x.value;for(const d of t){const r={voting:0};await I.updateRecipe(_.value.userId,d.id,r)}await p()}})}async function ve(n){const t={voting:0};await I.updateRecipe(_.value.userId,n,t),await p()}async function ge(){B.value().then(async n=>{if(n){let t=D.value;for(const d of t){const r={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await I.updateRecipe(_.value.userId,d.id,r)}await p(),I.uploadRecipeToGithub(_.value.userId,null)}})}async function me(){const n=D.value.filter(t=>!t.ordered).map(t=>t.id);n&&n.length>0&&U.value(n).then(t=>{p()})}async function j(n){const t=n.id,d={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await I.updateRecipe(_.value.userId,t,d),await p(),I.uploadRecipeToGithub(_.value.userId,null);let r=_.value.calendarPlan;if(r||(r={}),n.cooked){const l=new Date;for(const v of Object.keys(r))r[v]&&r[v].recipeId===t&&(new Date(v).getTime()<=l.getTime()?r[v].cooked=!0:r[v].cooked||delete r[v])}else for(const l of Object.keys(r))r[l]&&r[l].recipeId===t&&!r[l].cooked&&delete r[l];await N.saveCalendarPlan(_.value.userId,r)}async function _e(n){const t=n.id,d={planned:!0,voting:0,cooked:!1,ordered:!1,preparations:[]};await I.updateRecipe(_.value.userId,t,d),await p(),I.uploadRecipeToGithub(_.value.userId,null)}async function p(){$.value=await T.getAllRecipes(_.value.userId),await pe()}function W(n){U.value(n).then(t=>{p()})}function ke(n){L.value(n)}async function ye(n){let d=(await S.getAuthInfo()).calendarPlan;const r=n.plannedDate.getFullYear(),l=String(n.plannedDate.getMonth()+1).padStart(2,"0"),v=String(n.plannedDate.getDate()).padStart(2,"0");delete d[`${r}-${l}-${v}`],await N.saveCalendarPlan(_.value.userId,d),await S.refreshPlannendUntil(),await p()}async function he(n){let d=(await S.getAuthInfo()).calendarPlan;const r=n.plannedDate.getFullYear(),l=String(n.plannedDate.getMonth()+1).padStart(2,"0"),v=String(n.plannedDate.getDate()).padStart(2,"0");d[`${r}-${l}-${v}`].cooked=!0,await N.saveCalendarPlan(_.value.userId,d),await S.refreshPlannendUntil(),await p()}async function pe(){E.value=[];let n=await S.getAuthInfo();if(n){let t=n.calendarPlan;if(t||(t={}),t){const d=new Date;d.setHours(0,0,0,0),new Date().setHours(23,59,59,0);for(let l=0;l<14;l++){const v=new Date;if(v.setDate(v.getDate()+l),v.getTime()>d.getTime()){const w=v.getFullYear(),b=String(v.getMonth()+1).padStart(2,"0"),h=String(v.getDate()).padStart(2,"0");if(t[`${w}-${b}-${h}`]&&t[`${w}-${b}-${h}`].type&&t[`${w}-${b}-${h}`].type!=="RECIPE"&&!t[`${w}-${b}-${h}`].cooked){const R=new Date(v).getTime()-new Date().getTime(),A=Math.floor(R/(1e3*60*60*24));E.value.push({plannedDate:v,plannedInDays:A,title:t[`${w}-${b}-${h}`].recipeTitle,type:t[`${w}-${b}-${h}`].type,cooked:t[`${w}-${b}-${h}`].cooked})}}}}}}return(n,t)=>{const d=k("v-btn"),r=k("v-rating"),l=k("v-icon"),v=k("v-carousel-item"),w=k("v-carousel"),b=k("v-divider"),h=k("v-list-item-title"),R=k("v-list-item"),A=k("v-list"),J=k("v-menu"),Q=k("v-toolbar"),q=k("v-img"),X=k("v-card"),be=k("v-col"),De=k("v-row");return o(),c("div",null,[i("div",ze,[t[11]||(t[11]=i("h2",{class:"mt-6 text-center"},"Vorschl√§ge",-1)),x.value&&x.value.length>0?(o(),f(d,{key:0,variant:"plain",class:"text-center",onClick:fe},{default:s(()=>[...t[4]||(t[4]=[g("Alle Likes entfernen",-1)])]),_:1})):a("",!0),i("div",Ae,[x.value.length===0?(o(),c("div",Te,[...t[5]||(t[5]=[i("div",{style:{"font-size":"1.2em"}},"Keine Vorschl√§ge vorhanden!",-1)])])):a("",!0),x.value.length>0?(o(),f(w,{key:1,"hide-delimiter-background":"","hide-delimiters":x.value.length===1},{default:s(()=>[(o(!0),c(ne,null,oe(x.value,e=>(o(),f(v,{cover:"",src:G(e?e.id:null),key:e.id},{default:s(()=>[i("div",Me,[i("div",Ue,[e.rating?(o(),c("div",Ee,[u(r,{modelValue:e.rating,"onUpdate:modelValue":m=>e.rating=m,hover:"",length:"5",size:"20",readonly:"",color:"white"},null,8,["modelValue","onUpdate:modelValue"])])):a("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.imageInProgress&&!e.sectionsUploaded?(o(),c("div",Ve,[i("span",null,[u(l,{icon:"mdi-information-slab-circle"}),t[6]||(t[6]=g()),t[7]||(t[7]=i("b",null,"Nur Zutatenliste vorhanden!",-1))])])):a("",!0),i("div",Ne,[e.duration?(o(),c("span",Fe,[i("b",null,y(e.duration)+" Min.",1),t[8]||(t[8]=g(" | ",-1))])):a("",!0),i("span",null,[i("b",null,y(e.voting)+" x üëç",1)])])]),i("div",He,[i("span",{onClick:m=>V(e),style:{cursor:"pointer","text-decoration-line":"none","font-weight":"700","font-size":"2.04em",color:"#ffffff !important","background-color":"rgba(93,93,93,0.66)",hyphens:"auto","overflow-wrap":"break-word"},class:"text-medium-emphasis"},y(e.title),9,Oe)]),i("div",null,[u(d,{onClick:m=>ce(e.id),variant:"flat",color:"rgba(198, 217, 238, 0.7)",height:"50"},{default:s(()=>[...t[9]||(t[9]=[g("Rezept einplanen",-1)])]),_:1},8,["onClick"])]),i("div",null,[u(d,{onClick:m=>ve(e.id),variant:"flat",color:"rgb(238 198 198 / 70%)",class:"mt-1"},{default:s(()=>[...t[10]||(t[10]=[g("Ignorieren",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["src"]))),128))]),_:1},8,["hide-delimiters"])):a("",!0)])]),u(b,{class:"mt-4"}),i("div",Ze,[t[27]||(t[27]=i("h2",{class:"mt-6 text-center"},"Ausgew√§hlt",-1)),i("div",Be,[D.value&&D.value.length>0?(o(),f(d,{key:0,variant:"outlined",onClick:me,disabled:!Y.value||Y.value.length===0},{default:s(()=>[...t[12]||(t[12]=[g("Alle Zutaten einkaufen",-1)])]),_:1},8,["disabled"])):a("",!0),D.value&&D.value.length>0?(o(),f(d,{key:1,variant:"outlined",class:"ml-2",color:"red",onClick:ge},{default:s(()=>[...t[13]||(t[13]=[g("Alle entfernen",-1)])]),_:1})):a("",!0)]),u(De,{class:"text-center mt-2",id:"recipesDiv"},{default:s(()=>[D.value.length===0?(o(),c("div",Le,[...t[14]||(t[14]=[i("div",{style:{"font-size":"1.2em"}},"Keine geplanten Rezepte gefunden!",-1)])])):a("",!0),(o(!0),c(ne,null,oe(D.value,e=>(o(),f(be,{cols:"12",sm:"12",md:"6",lg:"4",xl:"3",key:e.id},{default:s(()=>[e.type!=="SCHEDULED"&&e.type!=="OTHER"?(o(),f(X,{key:0,class:"mx-auto","max-width":"374"},{default:s(()=>[(o(),f(q,{class:"position-relative",height:"200",src:G(e?e.id:null),key:H.value[e.id]?H.value[e.id]:0,color:"grey",cover:""},{default:s(()=>[i("div",Ye,[e.duration?(o(),c("div",Ke,[i("b",null,y(e.duration)+" Min.",1)])):a("",!0),i("div",Ge,[!e.ingredientsInProgress&&!e.sectionsInProgress&&e.sectionsUploaded?(o(),c("a",{key:0,target:"_blank",href:"/recipes/go?id="+e.id,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},y(e.title),9,je)):a("",!0),!e.ingredientsInProgress&&!e.sectionsInProgress&&!e.sectionsUploaded?(o(),c("span",We,y(e.title),1)):a("",!0)])]),i("div",Je,[e.cooked?a("",!0):(o(),c("div",Qe,[e.plannedDate?(o(),f(l,{key:0,icon:"mdi-check-bold"})):a("",!0),e.plannedDate?a("",!0):(o(),f(l,{key:1,icon:"mdi-close-thick",color:"red"})),e.plannedDate?(o(),c("b",qe,[e.plannedInDays<0?(o(),c("span",Xe,"War geplant")):a("",!0),e.plannedInDays>=0?(o(),c("span",et,"Geplant")):a("",!0),e.plannedInDays>=-2&&e.plannedInDays<=2?(o(),c("span",tt," f√ºr ")):a("",!0),e.plannedInDays<-2||e.plannedInDays>2?(o(),c("span",nt," f√ºr "+y(z(O).format(e.plannedDate)),1)):a("",!0),g(" "+y(K(e.plannedInDays)),1)])):a("",!0),e.plannedDate?a("",!0):(o(),c("b",ot,"Kein Datum festgelegt"))])),e.cooked?a("",!0):(o(),c("div",at,[e.ordered?(o(),f(l,{key:0,icon:"mdi-check-bold"})):a("",!0),e.ordered?a("",!0):(o(),f(l,{key:1,icon:"mdi-close-thick",color:"red"})),t[15]||(t[15]=i("b",{class:"ml-1"},"Zutaten bestellt",-1))])),e.sectionsUploaded&&!e.sectionsInProgress?(o(),c("div",st,[e.cooked?(o(),f(l,{key:0,icon:"mdi-check-bold"})):a("",!0),e.cooked?a("",!0):(o(),f(l,{key:1,icon:"mdi-close-thick",color:"red"})),e.cooked?a("",!0):(o(),c("b",lt,"Noch nicht zubereitet")),e.cooked&&!e.lastCookedAt?(o(),c("b",it,"Rezept zubereitet")):a("",!0),e.cooked&&e.lastCookedAt?(o(),c("b",dt,"Zubereitet am "+y(z(se)(e.lastCookedAt)),1)):a("",!0)])):a("",!0),!e.sectionsUploaded&&!e.sectionsInProgress?(o(),c("div",rt,[u(l,{icon:"mdi-information"}),t[16]||(t[16]=i("b",null,"Nur Zutatenliste vorhanden",-1))])):a("",!0)]),u(Q,{color:"transparent"},{append:s(()=>[u(J,null,{activator:s(({props:m})=>[!e.imageInProgress&&!e.sectionsInProgress&&!e.ingredientsInProgress?(o(),f(d,ae({key:0,icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},m),{default:s(()=>[u(l,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)):a("",!0)]),default:s(()=>[u(A,null,{default:s(()=>[u(R,{onClick:m=>W(e.id)},{default:s(()=>[u(h,null,{default:s(()=>[...t[17]||(t[17]=[g("Zutaten einkaufen",-1)])]),_:1})]),_:1},8,["onClick"]),e.sectionsUploaded&&!e.sectionsInProgress?(o(),f(R,{key:0,onClick:m=>V(e,!0)},{default:s(()=>[u(h,null,{default:s(()=>[...t[18]||(t[18]=[g("Rezept zubereiten",-1)])]),_:1})]),_:1},8,["onClick"])):a("",!0),z(M)?a("",!0):(o(),f(R,{key:1,onClick:m=>ke(e)},{default:s(()=>[u(h,null,{default:s(()=>[...t[19]||(t[19]=[g("Daten importieren",-1)])]),_:1})]),_:1},8,["onClick"])),u(b),e.cooked||e.ordered?(o(),f(R,{key:2,onClick:m=>_e(e)},{default:s(()=>[u(h,null,{default:s(()=>[...t[20]||(t[20]=[g("Planung zur√ºcksetzen",-1)])]),_:1})]),_:1},8,["onClick"])):a("",!0),u(R,{onClick:m=>j(e)},{default:s(()=>[u(h,null,{default:s(()=>[...t[21]||(t[21]=[g("Aus Planung entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])),i("div",ut,[!e.ordered&&!e.cooked?(o(),f(d,{key:0,variant:"outlined",onClick:m=>W(e.id)},{default:s(()=>[...t[22]||(t[22]=[g("Zutaten einkaufen",-1)])]),_:1},8,["onClick"])):a("",!0)]),i("div",ct,[e.ordered&&!e.cooked&&e.sectionsUploaded&&!e.sectionsInProgress?(o(),f(d,{key:0,variant:"outlined",onClick:m=>V(e,!0),color:"blue"},{default:s(()=>[...t[23]||(t[23]=[g("Rezept zubereiten",-1)])]),_:1},8,["onClick"])):a("",!0)]),i("div",ft,[e.sectionsUploaded&&!e.sectionsInProgress&&e.cooked||!(e.sectionsUploaded&&!e.sectionsInProgress)&&e.ordered?(o(),f(d,{key:0,variant:"outlined",color:"red",onClick:m=>j(e)},{default:s(()=>[...t[24]||(t[24]=[g("Aus Planung entfernen",-1)])]),_:1},8,["onClick"])):a("",!0)])]),_:2},1024)):a("",!0),e.type==="SCHEDULED"||e.type==="OTHER"?(o(),f(X,{key:1,class:"mx-auto","max-width":"374"},{default:s(()=>[u(q,{class:"position-relative",height:"200",color:"rgb(160, 171, 183)",cover:""},{default:s(()=>[e.title?(o(),c("div",vt,[i("div",gt,y(e.title),1)])):a("",!0),i("div",mt,[i("div",_t,[u(l,{icon:"mdi-check-bold"}),e.plannedDate?(o(),c("b",kt,[e.plannedInDays<0?(o(),c("span",yt,"War geplant")):a("",!0),e.plannedInDays>=0?(o(),c("span",ht,"Geplant")):a("",!0),e.plannedInDays>=-2&&e.plannedInDays<=2?(o(),c("span",pt," f√ºr ")):a("",!0),e.plannedInDays<-2&&e.plannedInDays>2?(o(),c("span",bt,y(z(O).format(e.plannedDate))+", "+y(z(Se)(e.plannedDate)),1)):a("",!0),g(" "+y(K(e.plannedInDays)),1)])):a("",!0)]),i("div",Dt,[e.cooked?(o(),f(l,{key:0,icon:"mdi-check-bold"})):a("",!0),e.cooked?a("",!0):(o(),f(l,{key:1,icon:"mdi-close-thick",color:"red"})),e.cooked?a("",!0):(o(),c("b",wt,"Noch nicht zubereitet")),e.cooked?(o(),c("b",It,"Zubereitet am "+y(z(se)(e.plannedDate)),1)):a("",!0)]),i("div",Rt,[u(l,{icon:"mdi-information"}),i("b",Ct,y(ue(e.type)),1)])]),u(Q,{color:"transparent"},{append:s(()=>[u(J,null,{activator:s(({props:m})=>[u(d,ae({icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},m),{default:s(()=>[u(l,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)]),default:s(()=>[u(A,null,{default:s(()=>[u(R,{onClick:m=>ye(e)},{default:s(()=>[u(h,null,{default:s(()=>[...t[25]||(t[25]=[g("Aus Kalender entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),i("div",Pt,[e.cooked?a("",!0):(o(),f(d,{key:0,variant:"outlined",onClick:m=>he(e),color:"red"},{default:s(()=>[...t[26]||(t[26]=[g("Mahlzeit wurde verzehrt",-1)])]),_:1},8,["onClick"]))])]),_:2},1024)):a("",!0)]),_:2},1024))),128))]),_:1})]),u($e,{onResult:t[0]||(t[0]=e=>U.value=e)}),u(xe,{onResult:t[1]||(t[1]=e=>L.value=e)}),u(ee,{onResult:t[2]||(t[2]=e=>Z.value=e),title:"Bitte best√§tigen",message:"Sollen alle vorgeschlagenen Rezepte entfernt werden?"}),u(ee,{onResult:t[3]||(t[3]=e=>B.value=e),title:"Bitte best√§tigen",message:"Sollen alle geplanten Rezepte aus der Planung entfernt werden?"})])}}},xt=we($t,[["__scopeId","data-v-f2d7a1ca"]]),Et={__name:"index",setup(P){return de(async()=>{ie()}),(T,$)=>(o(),f(xt))}};export{Et as default};
