import{_ as pe,O as me,K as ve,N as fe,u as _e,P as ge,r as m,o as ye,g as v,x as u,y as i,B as n,C as o,Z as be,U as k,z as p,D as f,R as r,A as _,Q as A,S as he,T as we,V as ke,$ as E}from"./B_Sz40mf.js";import{R as z,C as Pe,I as U}from"./BmcJFGjB.js";const xe={methods:{formatCurrency(L){return"€ "+(""+(Math.round(L*100)/100).toFixed(2)).replace(".",",")}}},Ie={class:"d-flex justify-space-between align-center"},Ce={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Re={key:0,class:"text-h6 text-medium-emphasis"},Ve={key:0},Se={class:"text-right mt-3"},Be={key:1,style:{width:"100%","text-align":"right"}},De=["colspan"],Te={key:0,class:"pl-6"},Ne={key:0},Ae={key:1},ze={key:1,class:"py-2"},Ue=["onClick"],$e={key:0},Me={key:1},Ee={key:0},Le={key:0},Fe={key:1},Qe={key:0,class:"px-0 mx-0"},Ze={style:{"max-width":"200px"}},je={class:"my-2"},Oe={class:"my-2"},Ke={class:"my-2"},qe={class:"text-right"},Ge={key:0,class:"mt-3"},He={class:"mt-2"},Je={__name:"IngredientsDialog",emits:["result"],setup(L,{emit:F}){const Q=me(),Z=ve(),{authInfo:b,githubMode:S}=fe(Z),X=F;_e(),ge();const I=m(!1),$=m(null),Y=m(null),j=m(null),B=m([]),g=m([]),c=m(null),D=m(null),T=m(2),C=m(!1),P=m(!1),R=m(!1),x=m(!1),V=m({name:null,password:null});ye(async()=>{X("result",async l=>(Array.isArray(l)?B.value=l:B.value=[l],D.value=null,g.value=[],c.value=null,R.value=!1,x.value=!1,P.value=!1,T.value=2,O(),await ee(!0),I.value=!0,new Promise((e,a)=>{$.value=e,Y.value=a})))});async function O(){let l=await Z.getAuthInfo();C.value=l.picnicLoggedIn}async function ee(l){let e=[];for(const a of B.value){const s=await z.getRecipe(b.value.userId,a);s.ingredients=(await z.getRecipeIngredients(b.value.userId,a)).data,e.push(s)}g.value=e,q(l)}async function te(){await U.loginPicnic(b.value.userId,V.value),await O()}async function le(){let l=!1;for(const e of g.value)e.planned&&!e.ordered&&(l=!0);l?j.value().then(async e=>{if(e){for(const a of g.value)if(a.planned&&!a.ordered){const s={ordered:!0};await z.updateRecipe(b.value.userId,a.id,s)}}I.value=!1,$.value(!0)}):(I.value=!1,$.value(!1))}async function K(){let l=c.value.filter(e=>e.bring);D.value=U.convertToBringUrl(l)}async function ae(){let l=c.value.filter(s=>s.picnic);for(const s of l)if(s.selectedPicnicProduktId){let d=s.picnicResults.find(h=>h.id===s.selectedPicnicProduktId).multiplier;(!d||d===0||d>0&&d<1)&&(d=1),d=Math.ceil(d);for(let h=1;h<=d;h++)await U.addProductToPicnicShoppingCart(b.value.userId,s.selectedPicnicProduktId)}P.value=!0;const a={picnicPurchaseDate:new Date().toISOString()};for(const s of B.value)await z.updateRecipe(b.value.userId,s,a)}async function ne(l){await navigator.clipboard.writeText(l.basicName)}function q(l){c.value=[];for(const e of g.value){let a=e.portions?e.portions:2;e.ingredients.forEach(s=>{c.value.push({name:s.name,basicName:s.basicName,genericName:s.genericName?s.genericName:"Sonstiges",unit:s.unit,amount:Math.ceil(s.amount/a*T.value),standardIngredient:s.standardIngredient})})}l&&se(),K()}function se(){c.value.forEach(l=>{l.standardIngredient?(l.bring=!1,l.picnic=!1):(l.bring=!0,l.picnic=!1)}),x.value=c.value.filter(l=>!!l.bring).length>0,c.value=c.value.sort((l,e)=>{let a=0;return!l.bring&&!e.bring&&(a=0),!l.bring&&e.bring&&(a=1),l.bring&&!e.bring&&(a=-1),l.bring&&e.bring&&(a=0),a!==0?a:l.genericName.localeCompare(e.genericName)})}async function ie(){c.value.forEach(l=>{l.bring&&N("picnic",l)})}async function N(l,e){if(l==="bring")e.bring=!0,e.picnic=!1,R.value=c.value.filter(a=>!!a.picnic).length>0,x.value=c.value.filter(a=>!!a.bring).length>0;else if(l==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const a=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await U.searchPicnic(b.value.userId,e.basicName,a,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),R.value=c.value.filter(s=>!!s.picnic).length>0,x.value=c.value.filter(s=>!!s.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,R.value=c.value.filter(a=>!!a.picnic).length>0,x.value=c.value.filter(a=>!!a.bring).length>0;K()}return(l,e)=>{const a=v("v-btn"),s=v("v-card-title"),d=v("v-img"),h=v("v-text-field"),G=v("v-card-text"),H=v("v-card"),J=v("v-select"),W=v("v-icon"),oe=v("v-progress-linear"),ce=v("v-list-item"),M=v("v-col"),ue=v("v-row"),re=v("v-table"),de=v("v-dialog");return i(),u("div",null,[n(de,{"max-width":"600",modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t),fullscreen:k(Q).smAndDown.value},{default:o(()=>[n(H,{style:{"background-color":"white"},class:be({"pa-4":!k(Q).smAndDown.value})},{default:o(()=>[n(s,{style:{"white-space":"normal"}},{default:o(()=>[p("div",Ie,[p("div",Ce,[e[6]||(e[6]=f(" Zutaten einkaufen ",-1)),g.value?(i(),u("div",Re,_(g.value.map(t=>t.title).join(", ")),1)):r("",!0)]),n(a,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),n(G,null,{default:o(()=>[g.value?(i(),u("div",Ve,[!C.value&&!k(S)?(i(),A(H,{key:0,class:"mb-4"},{default:o(()=>[n(s,null,{default:o(()=>[n(d,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=f(" Bei Picnic einloggen ",-1))]),_:1}),n(G,null,{default:o(()=>[n(h,{modelValue:V.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value.name=t),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),n(h,{modelValue:V.value.password,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value.password=t),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),p("div",Se,[n(a,{variant:"outlined",onClick:te},{default:o(()=>[...e[8]||(e[8]=[f("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):r("",!0),e[13]||(e[13]=p("h3",null,"Anzahl Portionen",-1)),n(J,{modelValue:T.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>T.value=t),q],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=p("h3",null,"Zutatenliste",-1)),k(S)?r("",!0):(i(),u("div",Be,[n(a,{variant:"flat",onClick:e[3]||(e[3]=t=>ie()),class:"mb-1 my-1"},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=f(" Alles bei Picnic einkaufen ",-1))]),_:1})])),n(re,{class:"table-ingredients"},{default:o(()=>[p("tbody",null,[(i(!0),u(he,null,we(c.value,t=>(i(),u("tr",{key:t.name},[p("td",{colspan:t.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[t.picnic?r("",!0):(i(),u("div",Te,[t.amount?(i(),u("span",Ne,_(t.amount),1)):r("",!0),e[10]||(e[10]=f()),t.unit?(i(),u("span",Ae,_(t.unit),1)):r("",!0)])),t.picnic?(i(),u("div",ze,[p("div",{style:{"font-size":"0.8em"},onClick:w=>ne(t)},[n(W,{icon:"mdi-arrow-right"}),e[11]||(e[11]=f()),t.amount?(i(),u("span",$e,_(t.amount),1)):r("",!0),e[12]||(e[12]=f()),t.unit?(i(),u("span",Me,_(t.unit),1)):r("",!0),f(" "+_(t.name),1)],8,Ue),t.picnic?(i(),u("div",Ee,[t.loading?(i(),A(oe,{key:0,indeterminate:""})):r("",!0),(i(),A(J,{modelValue:t.selectedPicnicProduktId,"onUpdate:modelValue":w=>t.selectedPicnicProduktId=w,label:"Bitte Produkt auswählen",items:t.picnicResults,"item-title":"name","item-value":"id","hide-details":"",key:t.id,disabled:t.loading},{item:o(({props:w,item:y})=>[n(ce,ke({ref_for:!0},w),{default:o(()=>[p("h4",null,[y.raw.multiplier&&y.raw.multiplier>1?(i(),u("span",Le,_(y.raw.multiplier)+"x ",1)):r("",!0),y.raw.unitQuantity&&y.raw.unitQuantity!=="undefined"?(i(),u("span",Fe,_(y.raw.unitQuantity),1)):r("",!0)]),p("h5",null,_(k(xe).methods.formatCurrency(y.raw.price/100)),1),n(d,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${y.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"]))])):r("",!0)])):r("",!0)],8,De),t.picnic?r("",!0):(i(),u("td",Qe,_(t.name),1)),p("td",Ze,[n(ue,{class:"px-0 mx-0",style:{width:"180px"}},{default:o(()=>[n(M,{cols:"3"},{default:o(()=>[p("div",je,[n(a,{variant:"flat",style:E({opacity:t.bring?1:.3}),onClick:w=>N("bring",t),class:"mx-0"},{default:o(()=>[n(d,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),k(S)?r("",!0):(i(),A(M,{key:0,cols:"3"},{default:o(()=>[p("div",Oe,[n(a,{variant:"plain",style:E({opacity:t.picnic?1:.3}),disabled:!C.value||P.value,onClick:w=>N("picnic",t)},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),n(M,{cols:"4"},{default:o(()=>[p("div",Ke,[n(a,{variant:"plain",style:E({opacity:!t.bring&&!t.picnic?1:.3}),disabled:!C.value||P.value,onClick:w=>N(null,t)},{default:o(()=>[n(W,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):r("",!0),p("div",qe,[k(S)?r("",!0):(i(),u("div",Ge,[n(a,{variant:"outlined",rounded:"",onClick:ae,"prepend-icon":P.value?"mdi-check":null,disabled:!C.value||P.value||!R.value},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=f(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),p("div",He,[n(a,{link:"",variant:"outlined",rounded:"",href:D.value,disabled:D.value===null||!x.value,target:"_blank",class:"ml-2"},{default:o(()=>[n(d,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=f(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),n(Pe,{onResult:e[5]||(e[5]=t=>j.value=t),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},Ye=pe(Je,[["__scopeId","data-v-65d98750"]]);export{Ye as I};
