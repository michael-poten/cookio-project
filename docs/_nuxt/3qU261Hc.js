import{K as f,ab as u,ac as M,_ as ne,r as _,o as ae,g as m,Q as Z,y as k,C as d,B as i,a1 as ge,z as h,D as I,a2 as _e,ad as he,O as ye,N as we,u as be,P as ke,x as P,Y as Q,U as C,R as V,A as K,S as xe,T as Se,Z as q}from"./CocLNjjF.js";const G={convertToBringUrl:function(r){let a=[];for(const S of r){const g=[];g.push(S.name),S.amount&&S.amount!==0&&g.push(S.amount+(S.unit?" "+S.unit:"")),a.push(g.join("__"))}const n=a.join("---"),t=btoa(unescape(encodeURIComponent(n)));let w="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return w=encodeURIComponent(w),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+w+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeWithNewEngine:async function(r,a){const n=f();try{return await M.post(n.lanAddress+"api/"+r+"/recipes/"+a+"/import/newEngine",{})}catch(t){u.catchError(t)}},analyzeIngredients:async function(r,a,n){const t=f();try{const l=new FormData;return l.append("image",n),await M.post(t.lanAddress+"api/"+r+"/recipes/"+a+"/import/image/ingredients",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){u.catchError(l)}},analyzeSections:async function(r,a,n){const t=f();try{const l=new FormData;return l.append("image",n),await M.post(t.lanAddress+"api/"+r+"/recipes/"+a+"/import/image/sections",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){u.catchError(l)}},uploadImage:async function(r,a,n){const t=f();try{const l=new FormData;return l.append("image",n),await M.post(t.lanAddress+"api/"+r+"/recipes/"+a+"/import/image",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){u.catchError(l)}},generateImage:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/recipes/"+a+"/import/generateImage")}catch(t){u.catchError(t)}},loginPicnic:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/loginPicnic",a)}catch(t){u.catchError(t)}},saveIcsUrl:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/icsUrl",{url:a})}catch(t){u.catchError(t)}},fetchIcsData:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/fetchIcsData",{url:a})}catch(t){u.catchError(t)}},saveCalendarPlan:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/calendarPlan",a)}catch(t){u.catchError(t)}},searchPicnic:async function(r,a,n,t=!1){const l=f();try{return await u.post(l.lanAddress+"api/"+r+"/picnic/search",{query:a,ingredientDescription:n,useChatGpt:t})}catch(w){u.catchError(w)}},addProductToPicnicShoppingCart:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/picnic/addProductToShoppingCart",{productId:a})}catch(t){u.catchError(t)}}},O={getRecipe:async function(r,a){const n=f();try{if(n.isNetworkAccess){let t=n.lanAddress+"api/"+r+"/recipes/"+a;return(await u.get(t)).data}else return(await u.get("https://mmhhhh.de/data/home/recipes.json")).data[a]}catch(t){u.catchError(t)}},getRecipeIngredients:async function(r,a){const n=f();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+r+"/recipes/"+a+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+a+"/ingredients.json",await u.get(t)}catch(t){u.catchError(t)}},getRecipeSections:async function(r,a){const n=f();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+r+"/recipes/"+a+"/sections":t="https://mmhhhh.de/data/home/recipes/"+a+"/sections.json",await u.get(t)}catch(t){u.catchError(t)}},updateRecipe:async function(r,a,n){const t=f();try{return await u.put(t.lanAddress+"api/"+r+"/recipes/"+a,n)}catch(l){u.catchError(l)}},uploadRecipeToGithub:async function(r,a){const n=f();let t={};a&&(t.recipeId=a);try{return await u.put(n.lanAddress+"api/"+r+"/recipes/githubUpload",t)}catch(l){u.catchError(l)}},deleteRecipe:async function(r,a){const n=f();try{return await u.post(n.lanAddress+"api/"+r+"/recipes/"+a+"/delete")}catch(t){u.catchError(t)}}};const Ce=["innerHTML"],Ve={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(r,{emit:a}){const n=r,t=a,l=_(!1),w=_(n.message),S=_(n.title);let g=null;ae(()=>{t("result",$=>(l.value=!0,new Promise((b,x)=>{g=b})))});function j(){g&&g(!0),l.value=!1,g=null}function L(){g&&g(!1),l.value=!1,g=null}return($,b)=>{const x=m("v-toolbar"),v=m("v-btn"),B=m("v-col"),z=m("v-row"),N=m("v-container"),A=m("v-card-text"),E=m("v-card"),D=m("v-dialog");return k(),Z(D,{modelValue:l.value,"onUpdate:modelValue":b[0]||(b[0]=R=>l.value=R),onKeydown:he(L,["esc"]),"max-width":"420"},{default:d(()=>[i(E,null,{default:d(()=>[i(x,{color:"rgb(191, 208, 217)",title:S.value},null,8,["title"]),ge(i(A,null,{default:d(()=>[h("div",{style:{"margin-bottom":"30px"},innerHTML:w.value},null,8,Ce),i(N,{class:"sub-grid"},{default:d(()=>[i(z,null,{default:d(()=>[i(B,{cols:"6"},{default:d(()=>[i(v,{onClick:L,style:{width:"100%"}},{default:d(()=>[...b[1]||(b[1]=[I("Abbrechen",-1)])]),_:1})]),_:1}),i(B,{cols:"6"},{default:d(()=>[i(v,{color:"secondary",onClick:j,style:{width:"100%"}},{default:d(()=>[...b[2]||(b[2]=[I(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!w.value]])]),_:1})]),_:1},8,["modelValue"])}}},Pe=ne(Ve,[["__scopeId","data-v-6b314bdd"]]),Ie={class:"d-flex justify-space-between align-center"},Ae={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},De={key:0,class:"text-h6 text-medium-emphasis"},Be={key:0},Ne={class:"text-right mt-3"},Ee={key:1,style:{width:"100%","text-align":"right"}},Re={colspan:1,style:{"min-width":"90px"},class:"px-0 mx-0"},Te={class:"pl-2"},Ue={key:2,class:"ml-1"};const ze=["onClick"],je={style:{"max-width":"200px"}},Le={class:"my-2"},$e={class:"my-2"},Fe={class:"my-2"},Me={class:"text-right"},Qe={key:0,class:"mt-3"},Ke={class:"mt-2"},Oe={__name:"IngredientsDialog",emits:["result"],setup(r,{emit:a}){const n=ye(),t=f(),{authInfo:l,githubMode:w}=we(t),S=a;be(),ke();const g=_(!1),j=_(null),L=_(null),$=_(null),b=_([]),x=_([]),v=_(null),B=_(null),z=_(2),N=_(!1),A=_(!1),E=_(!1),D=_(!1),R=_({name:null,password:null});ae(async()=>{S("result",async o=>(Array.isArray(o)?b.value=o:b.value=[o],B.value=null,x.value=[],v.value=null,E.value=!1,D.value=!1,A.value=!1,z.value=2,J(),await oe(!0),g.value=!0,new Promise((e,s)=>{j.value=e,L.value=s})))});async function J(){let o=await t.getAuthInfo();N.value=o.picnicLoggedIn}async function oe(o){let e=[];for(const s of b.value){const p=await O.getRecipe(l.value.userId,s);p.ingredients=(await O.getRecipeIngredients(l.value.userId,s)).data,e.push(p)}x.value=e,Y(o)}async function se(){await G.loginPicnic(l.value.userId,R.value),await J()}async function ie(o){o.ready=!0,await navigator.clipboard.writeText(o.basicName)}async function re(){let o=!1;for(const e of x.value)e.planned&&!e.ordered&&(o=!0);o?$.value().then(async e=>{if(e){for(const s of x.value)if(s.planned&&!s.ordered){const p={ordered:!0};await O.updateRecipe(l.value.userId,s.id,p)}}g.value=!1,j.value(!0)}):(g.value=!1,j.value(!1))}async function W(){let o=v.value.filter(e=>e.bring);B.value=G.convertToBringUrl(o)}async function le(){let o=v.value.filter(p=>p.picnic);for(const p of o)if(p.selectedPicnicProduktId){let y=p.picnicResults.find(T=>T.id===p.selectedPicnicProduktId).multiplier;(!y||y===0||y>0&&y<1)&&(y=1),y=Math.ceil(y);for(let T=1;T<=y;T++)await G.addProductToPicnicShoppingCart(l.value.userId,p.selectedPicnicProduktId)}A.value=!0;const s={picnicPurchaseDate:new Date().toISOString()};for(const p of b.value)await O.updateRecipe(l.value.userId,p,s)}function Y(o){v.value=[];for(const e of x.value){let s=e.portions?e.portions:2;e.ingredients.forEach(p=>{v.value.push({name:p.name,basicName:p.basicName,genericName:p.genericName?p.genericName:"Sonstiges",unit:p.unit,amount:Math.ceil(p.amount/s*z.value),standardIngredient:p.standardIngredient})})}o&&ce(),W()}function ce(){v.value.forEach(o=>{o.standardIngredient?(o.bring=!1,o.picnic=!1):(o.bring=!0,o.picnic=!1)}),D.value=v.value.filter(o=>!!o.bring).length>0,v.value=v.value.sort((o,e)=>{let s=0;return!o.bring&&!e.bring&&(s=0),!o.bring&&e.bring&&(s=1),o.bring&&!e.bring&&(s=-1),o.bring&&e.bring&&(s=0),s!==0?s:o.genericName.localeCompare(e.genericName)})}async function ue(){v.value.forEach(o=>{o.bring&&F("picnic",o)})}async function F(o,e){o==="bring"?(e.bring=!0,e.picnic=!1,E.value=v.value.filter(s=>!!s.picnic).length>0,D.value=v.value.filter(s=>!!s.bring).length>0):o==="picnic"?(e.loading=!0,e.bring=!1,e.picnic=!0,E.value=v.value.filter(s=>!!s.picnic).length>0,D.value=v.value.filter(s=>!!s.bring).length>0,e.loading=!1):(e.bring=!1,e.picnic=!1,E.value=v.value.filter(s=>!!s.picnic).length>0,D.value=v.value.filter(s=>!!s.bring).length>0),W()}return(o,e)=>{const s=m("v-btn"),p=m("v-card-title"),y=m("v-img"),T=m("v-text-field"),X=m("v-card-text"),ee=m("v-card"),de=m("v-select"),pe=m("v-checkbox"),te=m("v-row"),me=m("v-icon"),Ze=m("v-progress-linear"),He=m("v-list-item"),H=m("v-col"),ve=m("v-table"),fe=m("v-dialog");return k(),P("div",null,[i(fe,{"max-width":"700",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=c=>g.value=c),fullscreen:C(n).smAndDown.value},{default:d(()=>[i(ee,{style:{"background-color":"white"},class:Q({"pa-4":!C(n).smAndDown.value,"px-2 ma-0":C(n).smAndDown.value})},{default:d(()=>[i(p,{style:{"white-space":"normal"},class:Q({"mx-0 px-0":C(n).smAndDown.value})},{default:d(()=>[h("div",Ie,[h("div",Ae,[e[6]||(e[6]=I(" Zutaten einkaufen ",-1)),x.value?(k(),P("div",De,K(x.value.map(c=>c.title).join(", ")),1)):V("",!0)]),i(s,{icon:"mdi-close",variant:"text",onClick:re})])]),_:1},8,["class"]),i(X,{class:Q({"mx-0 px-0":C(n).smAndDown.value})},{default:d(()=>[x.value?(k(),P("div",Be,[!N.value&&!C(w)?(k(),Z(ee,{key:0,class:"mb-4"},{default:d(()=>[i(p,null,{default:d(()=>[i(y,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=I(" Bei Picnic einloggen ",-1))]),_:1}),i(X,null,{default:d(()=>[i(T,{modelValue:R.value.name,"onUpdate:modelValue":e[0]||(e[0]=c=>R.value.name=c),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),i(T,{modelValue:R.value.password,"onUpdate:modelValue":e[1]||(e[1]=c=>R.value.password=c),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),h("div",Ne,[i(s,{variant:"outlined",onClick:se},{default:d(()=>[...e[8]||(e[8]=[I("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):V("",!0),e[13]||(e[13]=h("h3",null,"Anzahl Portionen",-1)),i(de,{modelValue:z.value,"onUpdate:modelValue":[e[2]||(e[2]=c=>z.value=c),Y],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),C(w)?V("",!0):(k(),P("div",Ee,[i(s,{variant:"flat",onClick:e[3]||(e[3]=c=>ue()),class:"mb-1 my-1"},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=I(" Alles bei Picnic einkaufen ",-1))]),_:1})])),i(ve,{class:"table-ingredients"},{default:d(()=>[h("tbody",null,[(k(!0),P(xe,null,Se(v.value,c=>(k(),P("tr",{key:c.name},[h("td",Re,[h("div",Te,[h("span",null,[i(te,{class:"align-center"},{default:d(()=>[c.picnic&&c.amount&&c.amount!==0?(k(),Z(pe,{key:0,modelValue:c.ready,"onUpdate:modelValue":U=>c.ready=U,"hide-details":"auto",density:"comfortable",label:""},null,8,["modelValue","onUpdate:modelValue"])):V("",!0),c.amount?(k(),P("span",{key:1,class:Q({"ml-9":!(c.picnic&&c.amount&&c.amount!==0)})},K(c.amount),3)):V("",!0),e[10]||(e[10]=I()),c.unit?(k(),P("span",Ue,K(c.unit),1)):V("",!0)]),_:2},1024)])]),V("",!0)]),h("td",{class:"px-0 mx-0",style:{cursor:"pointer","max-width":"80px"},onClick:U=>ie(c)},K(c.name),9,ze),h("td",je,[i(te,{class:"px-0 mx-0",style:{width:"180px"}},{default:d(()=>[i(H,{cols:"3"},{default:d(()=>[h("div",Le,[i(s,{variant:"flat",style:q({opacity:c.bring?1:.3}),onClick:U=>F("bring",c),class:"mx-0"},{default:d(()=>[i(y,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),C(w)?V("",!0):(k(),Z(H,{key:0,cols:"3"},{default:d(()=>[h("div",$e,[i(s,{variant:"plain",style:q({opacity:c.picnic?1:.3}),disabled:!N.value||A.value,onClick:U=>F("picnic",c)},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),i(H,{cols:"4"},{default:d(()=>[h("div",Fe,[i(s,{variant:"plain",style:q({opacity:!c.bring&&!c.picnic?1:.3}),disabled:!C(w)&&!N.value||A.value,onClick:U=>F(null,c)},{default:d(()=>[i(me,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):V("",!0),h("div",Me,[C(w)?V("",!0):(k(),P("div",Qe,[i(s,{variant:"outlined",rounded:"",onClick:le,"prepend-icon":A.value?"mdi-check":null,disabled:!N.value||A.value||!E.value},{default:d(()=>[i(y,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[14]||(e[14]=I(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),h("div",Ke,[i(s,{link:"",variant:"outlined",rounded:"",href:B.value,disabled:B.value===null||!D.value,target:"_blank",class:"ml-2"},{default:d(()=>[i(y,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=I(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1},8,["class"])]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),i(Pe,{onResult:e[5]||(e[5]=c=>$.value=c),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},We=ne(Oe,[["__scopeId","data-v-e1a48bd0"]]);export{Pe as C,We as I,O as R,G as a};
