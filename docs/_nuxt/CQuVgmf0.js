import{K as _,aa as d,ab as O,_ as ne,r as k,o as se,g as f,Q as H,y as v,C as p,B as s,a0 as ge,z as b,D as I,a1 as _e,ac as he,O as ye,N as we,u as be,P as ke,x as y,ad as Pe,U as z,R as w,A as R,S as Se,T as Ie,V as xe,Y as G}from"./B1Xk-5O6.js";const j={convertToBringUrl:function(l){let a=[];for(const C of l){const h=[];h.push(C.name),C.amount&&C.amount!==0&&h.push(C.amount+(C.unit?" "+C.unit:"")),a.push(h.join("__"))}const n=a.join("---"),t=btoa(unescape(encodeURIComponent(n)));let P="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return P=encodeURIComponent(P),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+P+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeWithNewEngine:async function(l,a){const n=_();try{return await O.post(n.lanAddress+"api/"+l+"/recipes/"+a+"/import/newEngine",{})}catch(t){d.catchError(t)}},analyzeIngredients:async function(l,a,n){const t=_();try{const r=new FormData;return r.append("image",n),await O.post(t.lanAddress+"api/"+l+"/recipes/"+a+"/import/image/ingredients",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){d.catchError(r)}},analyzeSections:async function(l,a,n){const t=_();try{const r=new FormData;return r.append("image",n),await O.post(t.lanAddress+"api/"+l+"/recipes/"+a+"/import/image/sections",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){d.catchError(r)}},uploadImage:async function(l,a,n){const t=_();try{const r=new FormData;return r.append("image",n),await O.post(t.lanAddress+"api/"+l+"/recipes/"+a+"/import/image",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){d.catchError(r)}},generateImage:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/recipes/"+a+"/import/generateImage")}catch(t){d.catchError(t)}},loginPicnic:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/loginPicnic",a)}catch(t){d.catchError(t)}},saveIcsUrl:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/icsUrl",{url:a})}catch(t){d.catchError(t)}},fetchIcsData:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/fetchIcsData",{url:a})}catch(t){d.catchError(t)}},saveCalendarPlan:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/calendarPlan",a)}catch(t){d.catchError(t)}},searchPicnic:async function(l,a,n,t=!1){const r=_();try{return await d.post(r.lanAddress+"api/"+l+"/picnic/search",{query:a,ingredientDescription:n,useChatGpt:t})}catch(P){d.catchError(P)}},addProductToPicnicShoppingCart:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/picnic/addProductToShoppingCart",{productId:a})}catch(t){d.catchError(t)}}},Z={getRecipe:async function(l,a){const n=_();try{if(n.isNetworkAccess){let t=n.lanAddress+"api/"+l+"/recipes/"+a;return(await d.get(t)).data}else return(await d.get("https://mmhhhh.de/data/home/recipes.json")).data[a]}catch(t){d.catchError(t)}},getRecipeIngredients:async function(l,a){const n=_();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+l+"/recipes/"+a+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+a+"/ingredients.json",await d.get(t)}catch(t){d.catchError(t)}},getRecipeSections:async function(l,a){const n=_();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+l+"/recipes/"+a+"/sections":t="https://mmhhhh.de/data/home/recipes/"+a+"/sections.json",await d.get(t)}catch(t){d.catchError(t)}},updateRecipe:async function(l,a,n){const t=_();try{return await d.put(t.lanAddress+"api/"+l+"/recipes/"+a,n)}catch(r){d.catchError(r)}},uploadRecipeToGithub:async function(l,a){const n=_();let t={};a&&(t.recipeId=a);try{return await d.put(n.lanAddress+"api/"+l+"/recipes/githubUpload",t)}catch(r){d.catchError(r)}},deleteRecipe:async function(l,a){const n=_();try{return await d.post(n.lanAddress+"api/"+l+"/recipes/"+a+"/delete")}catch(t){d.catchError(t)}}},Ce={methods:{formatCurrency(l){return"€ "+(""+(Math.round(l*100)/100).toFixed(2)).replace(".",",")}}},Re=["innerHTML"],Ae={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(l,{emit:a}){const n=l,t=a,r=k(!1),P=k(n.message),C=k(n.title);let h=null;se(()=>{t("result",Q=>(r.value=!0,new Promise((S,x)=>{h=S})))});function M(){h&&h(!0),r.value=!1,h=null}function $(){h&&h(!1),r.value=!1,h=null}return(Q,S)=>{const x=f("v-toolbar"),g=f("v-btn"),U=f("v-col"),L=f("v-row"),T=f("v-container"),D=f("v-card-text"),N=f("v-card"),E=f("v-dialog");return v(),H(E,{modelValue:r.value,"onUpdate:modelValue":S[0]||(S[0]=B=>r.value=B),onKeydown:he($,["esc"]),"max-width":"420"},{default:p(()=>[s(N,null,{default:p(()=>[s(x,{color:"rgb(191, 208, 217)",title:C.value},null,8,["title"]),ge(s(D,null,{default:p(()=>[b("div",{style:{"margin-bottom":"30px"},innerHTML:P.value},null,8,Re),s(T,{class:"sub-grid"},{default:p(()=>[s(L,null,{default:p(()=>[s(U,{cols:"6"},{default:p(()=>[s(g,{onClick:$,style:{width:"100%"}},{default:p(()=>[...S[1]||(S[1]=[I("Abbrechen",-1)])]),_:1})]),_:1}),s(U,{cols:"6"},{default:p(()=>[s(g,{color:"secondary",onClick:M,style:{width:"100%"}},{default:p(()=>[...S[2]||(S[2]=[I(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!P.value]])]),_:1})]),_:1},8,["modelValue"])}}},De=ne(Ae,[["__scopeId","data-v-6b314bdd"]]),Ee={class:"d-flex justify-space-between align-center"},Ve={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Ue={key:0,class:"text-h6 text-medium-emphasis"},Te={key:0},Ne={class:"text-right mt-3"},Be={key:1,style:{width:"100%","text-align":"right"}},ze=["colspan"],je={key:0,class:"pl-6"},Le={key:0},Fe={key:1},Me={key:1,class:"py-2"},$e={style:{"font-size":"0.8em"}},Qe={key:0},Ke={key:1},Oe={key:0},Ze={key:0},He={key:1},qe={key:0,class:"px-0 mx-0"},Ge={style:{"max-width":"200px"}},Je={class:"my-2"},We={class:"my-2"},Ye={class:"my-2"},Xe={class:"text-right"},et={key:0,class:"mt-3"},tt={class:"mt-2"},at={__name:"IngredientsDialog",emits:["result"],setup(l,{emit:a}){const n=ye(),t=_(),{authInfo:r,githubMode:P}=we(t),C=a;be(),ke();const h=k(!1),M=k(null),$=k(null),Q=k(null),S=k([]),x=k([]),g=k(null),U=k(null),L=k(2),T=k(!1),D=k(!1),N=k(!1),E=k(!1),B=k({name:null,password:null});se(async()=>{C("result",async c=>(Array.isArray(c)?S.value=c:S.value=[c],U.value=null,x.value=[],g.value=null,N.value=!1,E.value=!1,D.value=!1,L.value=2,J(),await oe(!0),h.value=!0,new Promise((e,o)=>{M.value=e,$.value=o})))});async function J(){let c=await t.getAuthInfo();T.value=c.picnicLoggedIn}async function oe(c){let e=[];for(const o of S.value){const u=await Z.getRecipe(r.value.userId,o);u.ingredients=(await Z.getRecipeIngredients(r.value.userId,o)).data,e.push(u)}x.value=e,Y(c)}async function ie(){await j.loginPicnic(r.value.userId,B.value),await J()}async function le(){let c=!1;for(const e of x.value)e.planned&&!e.ordered&&(c=!0);c?Q.value().then(async e=>{if(e){for(const o of x.value)if(o.planned&&!o.ordered){const u={ordered:!0};await Z.updateRecipe(r.value.userId,o.id,u)}}h.value=!1,M.value(!0)}):(h.value=!1,M.value(!1))}async function W(){let c=g.value.filter(e=>e.bring);U.value=j.convertToBringUrl(c)}async function re(){let c=g.value.filter(u=>u.picnic);for(const u of c)if(u.selectedPicnicProduktId){let m=u.picnicResults.find(A=>A.id===u.selectedPicnicProduktId).multiplier;(!m||m===0||m>0&&m<1)&&(m=1),m=Math.ceil(m);for(let A=1;A<=m;A++)await j.addProductToPicnicShoppingCart(r.value.userId,u.selectedPicnicProduktId)}D.value=!0;const o={picnicPurchaseDate:new Date().toISOString()};for(const u of S.value)await Z.updateRecipe(r.value.userId,u,o)}function Y(c){g.value=[];for(const e of x.value){let o=e.portions?e.portions:2;e.ingredients.forEach(u=>{g.value.push({name:u.name,basicName:u.basicName,genericName:u.genericName?u.genericName:"Sonstiges",unit:u.unit,amount:Math.ceil(u.amount/o*L.value),standardIngredient:u.standardIngredient})})}c&&ce(),W()}function ce(){g.value.forEach(c=>{c.standardIngredient?(c.bring=!1,c.picnic=!1):(c.bring=!0,c.picnic=!1)}),E.value=g.value.filter(c=>!!c.bring).length>0,g.value=g.value.sort((c,e)=>{let o=0;return!c.bring&&!e.bring&&(o=0),!c.bring&&e.bring&&(o=1),c.bring&&!e.bring&&(o=-1),c.bring&&e.bring&&(o=0),o!==0?o:c.genericName.localeCompare(e.genericName)})}async function ue(){g.value.forEach(c=>{c.bring&&K("picnic",c)})}async function K(c,e){if(c==="bring")e.bring=!0,e.picnic=!1,N.value=g.value.filter(o=>!!o.picnic).length>0,E.value=g.value.filter(o=>!!o.bring).length>0;else if(c==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const o=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await j.searchPicnic(r.value.userId,e.basicName,o,!0)).data;let u=(await j.searchPicnic(r.value.userId,e.name,o,!1)).data;(!u||u.length===0)&&(u=(await j.searchPicnic(r.value.userId,e.basicName,o,!1)).data,(!u||u.length===0)&&(u=(await j.searchPicnic(r.value.userId,e.genericName,o,!1)).data)),u&&u.forEach(m=>{e.picnicResults.find(A=>A.id!==m.id)||e.picnicResults.push(m)}),e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),N.value=g.value.filter(m=>!!m.picnic).length>0,E.value=g.value.filter(m=>!!m.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,N.value=g.value.filter(o=>!!o.picnic).length>0,E.value=g.value.filter(o=>!!o.bring).length>0;W()}return(c,e)=>{const o=f("v-btn"),u=f("v-card-title"),m=f("v-img"),A=f("v-text-field"),X=f("v-card-text"),ee=f("v-card"),te=f("v-select"),ae=f("v-icon"),de=f("v-progress-linear"),pe=f("v-list-item"),q=f("v-col"),me=f("v-row"),fe=f("v-table"),ve=f("v-dialog");return v(),y("div",null,[s(ve,{"max-width":"600",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=i=>h.value=i),fullscreen:z(n).smAndDown.value},{default:p(()=>[s(ee,{style:{"background-color":"white"},class:Pe({"pa-4":!z(n).smAndDown.value})},{default:p(()=>[s(u,{style:{"white-space":"normal"}},{default:p(()=>[b("div",Ee,[b("div",Ve,[e[6]||(e[6]=I(" Zutaten einkaufen ",-1)),x.value?(v(),y("div",Ue,R(x.value.map(i=>i.title).join(", ")),1)):w("",!0)]),s(o,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),s(X,null,{default:p(()=>[x.value?(v(),y("div",Te,[!T.value&&!z(P)?(v(),H(ee,{key:0,class:"mb-4"},{default:p(()=>[s(u,null,{default:p(()=>[s(m,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=I(" Bei Picnic einloggen ",-1))]),_:1}),s(X,null,{default:p(()=>[s(A,{modelValue:B.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>B.value.name=i),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),s(A,{modelValue:B.value.password,"onUpdate:modelValue":e[1]||(e[1]=i=>B.value.password=i),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),b("div",Ne,[s(o,{variant:"outlined",onClick:ie},{default:p(()=>[...e[8]||(e[8]=[I("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):w("",!0),e[13]||(e[13]=b("h3",null,"Anzahl Portionen",-1)),s(te,{modelValue:L.value,"onUpdate:modelValue":[e[2]||(e[2]=i=>L.value=i),Y],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=b("h3",null,"Zutatenliste",-1)),z(P)?w("",!0):(v(),y("div",Be,[s(o,{variant:"flat",onClick:e[3]||(e[3]=i=>ue()),class:"mb-1 my-1"},{default:p(()=>[s(m,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=I(" Alles bei Picnic einkaufen ",-1))]),_:1})])),s(fe,{class:"table-ingredients"},{default:p(()=>[b("tbody",null,[(v(!0),y(Se,null,Ie(g.value,i=>(v(),y("tr",{key:i.name},[b("td",{colspan:i.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[i.picnic?w("",!0):(v(),y("div",je,[i.amount?(v(),y("span",Le,R(i.amount),1)):w("",!0),e[10]||(e[10]=I()),i.unit?(v(),y("span",Fe,R(i.unit),1)):w("",!0)])),i.picnic?(v(),y("div",Me,[b("div",$e,[s(ae,{icon:"mdi-arrow-right"}),e[11]||(e[11]=I()),i.amount?(v(),y("span",Qe,R(i.amount),1)):w("",!0),e[12]||(e[12]=I()),i.unit?(v(),y("span",Ke,R(i.unit),1)):w("",!0),I(" "+R(i.name),1)]),i.picnic?(v(),y("div",Oe,[i.loading?(v(),H(de,{key:0,indeterminate:""})):w("",!0),s(te,{modelValue:i.selectedPicnicProduktId,"onUpdate:modelValue":F=>i.selectedPicnicProduktId=F,label:"Bitte Produkt auswählen",items:i.picnicResults,"item-title":"name","item-value":"id","hide-details":"",disabled:i.loading},{item:p(({props:F,item:V})=>[s(pe,xe({ref_for:!0},F),{default:p(()=>[b("h4",null,[V.raw.multiplier&&V.raw.multiplier>1?(v(),y("span",Ze,R(V.raw.multiplier)+"x ",1)):w("",!0),V.raw.unitQuantity&&V.raw.unitQuantity!=="undefined"?(v(),y("span",He,R(V.raw.unitQuantity),1)):w("",!0)]),b("h5",null,R(z(Ce).methods.formatCurrency(V.raw.price/100)),1),s(m,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${V.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])])):w("",!0)])):w("",!0)],8,ze),i.picnic?w("",!0):(v(),y("td",qe,R(i.name),1)),b("td",Ge,[s(me,{class:"px-0 mx-0",style:{width:"180px"}},{default:p(()=>[s(q,{cols:"3"},{default:p(()=>[b("div",Je,[s(o,{variant:"flat",style:G({opacity:i.bring?1:.3}),onClick:F=>K("bring",i),class:"mx-0"},{default:p(()=>[s(m,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),z(P)?w("",!0):(v(),H(q,{key:0,cols:"3"},{default:p(()=>[b("div",We,[s(o,{variant:"plain",style:G({opacity:i.picnic?1:.3}),disabled:!T.value||D.value,onClick:F=>K("picnic",i)},{default:p(()=>[s(m,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),s(q,{cols:"4"},{default:p(()=>[b("div",Ye,[s(o,{variant:"plain",style:G({opacity:!i.bring&&!i.picnic?1:.3}),disabled:!T.value||D.value,onClick:F=>K(null,i)},{default:p(()=>[s(ae,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):w("",!0),b("div",Xe,[z(P)?w("",!0):(v(),y("div",et,[s(o,{variant:"outlined",rounded:"",onClick:re,"prepend-icon":D.value?"mdi-check":null,disabled:!T.value||D.value||!N.value},{default:p(()=>[s(m,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=I(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),b("div",tt,[s(o,{link:"",variant:"outlined",rounded:"",href:U.value,disabled:U.value===null||!E.value,target:"_blank",class:"ml-2"},{default:p(()=>[s(m,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=I(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),s(De,{onResult:e[5]||(e[5]=i=>Q.value=i),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},st=ne(at,[["__scopeId","data-v-e10a6f63"]]);export{De as C,st as I,Z as R,j as a};
