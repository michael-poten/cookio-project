import{I as wt,C as tt,R as C,a as N}from"./3qU261Hc.js";import{L as it,_ as It,M as Rt,N as et,O as Ct,J as Pt,P as Dt,K as dt,r as P,o as rt,k as O,g as _,x as v,y as o,z as l,B as u,Q as c,R as a,C as s,D as m,S as nt,T as ot,A as h,U as z,V as at}from"./CocLNjjF.js";import"./DA__SF9z.js";import{R as $t}from"./BxZt3kzm.js";function lt(D){return D?it(D).format("DD.MM."):"-"}function st(D){return D?it(D).format("DD.MM.YYYY"):"-"}const xt={class:"text-center"},St={class:"text-center"},zt={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},At={class:"mx-auto"},Vt={style:{"background-color":"rgba(93,93,93,0.66)"}},Et={key:0,class:"px-1 pb-1"},Mt={key:1,class:"pa-1 text-white",style:{"font-size":"0.8em"}},Ut={class:"text-white"},Tt={key:0,class:"px-1"},Nt={class:"ma-2"},Ot=["onClick"],Bt={style:{width:"100%"}},Yt={style:{width:"100%"},class:"text-right mt-2"},Zt={key:0,class:"text-center mt-8 text-high-emphasis",style:{width:"100%"}},Ft={class:"overlay-bottom-right"},Ht={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"px-1"},Kt={style:{"font-size":"1.1em"},class:"px-1"},jt=["href"],Gt={key:1,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Lt={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},Jt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Qt={key:2},Wt={key:3},qt={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},Xt={key:0,style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},te={key:2},ee={key:3},ne={key:4},oe={class:"ma-2"},ae={class:"ma-2"},le={class:"ma-2"},se={class:"overlay-bottom-right"},ie={style:{"font-size":"1.1em"},class:"px-1"},de={style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},re={class:"overlay-top-left pa-1",style:{"font-size":"0.8em"}},ue={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},ce={key:0},fe={style:{"background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},ve={key:2},ge={key:3},me={class:"ma-2"},_e={__name:"MealPlanner",setup(D){const E=Rt(),{recipes:$}=et(E);Ct(),Pt(),Dt();const x=dt(),{authInfo:k,githubMode:M,lanAddress:ut}=et(x);P("");const B=P({}),Y=new Intl.DateTimeFormat("de-DE",{weekday:"long"}),b=P({}),U=P(null),Z=P(null),F=P(null),H=P(null),V=P([]);rt(async()=>{await p()});const K=O(()=>w.value.filter(n=>!n.ordered)),S=O(()=>$.value?($.value=$.value.sort((n,e)=>{const i=n.rating,r=e.rating,d=typeof i=="number"&&i!==null,f=typeof r=="number"&&r!==null;return!d&&!f?0:d?f?r-i:-1:1}),$.value.filter(n=>!!n.voting)):[]),w=O(()=>{let n=[];return $.value.filter(e=>!!e.planned).forEach(e=>n.push(e)),V.value.forEach(e=>n.push(e)),n});function j(n){return n?M.value?"https://mmhhhh.de/data/home/recipes/"+n+"/image.jpg":ut.value+"api/"+k.value.userId+"/recipes/"+n+"/image":""}async function T(n){M.value?window.open("https://mmhhhh.de/recipes/go?id="+n.id,"_blank","noopener"):window.open("/recipes/go?id="+n.id,"_blank","noopener")}async function ct(n){const e={planned:!0,voting:0};await C.updateRecipe(k.value.userId,n,e),await p(),C.uploadRecipeToGithub(k.value.userId,null)}async function ft(){Z.value().then(async n=>{if(n){let e=S.value;for(const i of e){const r={voting:0};await C.updateRecipe(k.value.userId,i.id,r)}await p()}})}async function vt(n){const e={voting:0};await C.updateRecipe(k.value.userId,n,e),await p()}async function gt(){F.value().then(async n=>{if(n){let e=w.value;for(const i of e){const r={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await C.updateRecipe(k.value.userId,i.id,r)}await p(),C.uploadRecipeToGithub(k.value.userId,null)}})}async function mt(){const n=w.value.filter(e=>!e.ordered).map(e=>e.id);n&&n.length>0&&U.value(n).then(e=>{p()})}async function G(n){const e=n.id,i={planned:!1,voting:0,cooked:!1,ordered:!1,preparations:[]};await C.updateRecipe(k.value.userId,e,i),await p(),C.uploadRecipeToGithub(k.value.userId,null);let r=k.value.calendarPlan;if(r||(r={}),n.cooked){const d=new Date;for(const f of Object.keys(r))r[f]&&r[f].recipeId===e&&(new Date(f).getTime()<=d.getTime()?r[f].cooked=!0:r[f].cooked||delete r[f])}else for(const d of Object.keys(r))r[d]&&r[d].recipeId===e&&!r[d].cooked&&delete r[d];await N.saveCalendarPlan(k.value.userId,r)}async function p(){$.value=await E.getAllRecipes(k.value.userId);let e=(await x.getAuthInfo()).calendarPlan;e||(e={}),b.value={};for(const i of Object.keys(e))e[i]&&e[i].type==="RECIPE"&&e[i].recipeId&&(b.value[e[i].recipeId]=new Date(i));await ht()}function L(n){U.value(n).then(e=>{p()})}function _t(n){H.value(n)}async function kt(n){let i=(await x.getAuthInfo()).calendarPlan;const r=n.date.getFullYear(),d=String(n.date.getMonth()+1).padStart(2,"0"),f=String(n.date.getDate()).padStart(2,"0");delete i[`${r}-${d}-${f}`],await N.saveCalendarPlan(k.value.userId,i),await x.refreshPlannendUntil(),await p()}async function yt(n){let i=(await x.getAuthInfo()).calendarPlan;const r=n.date.getFullYear(),d=String(n.date.getMonth()+1).padStart(2,"0"),f=String(n.date.getDate()).padStart(2,"0");i[`${r}-${d}-${f}`].cooked=!0,await N.saveCalendarPlan(k.value.userId,i),await x.refreshPlannendUntil(),await p()}async function ht(){V.value=[];let n=await x.getAuthInfo();if(n){let e=n.calendarPlan;if(e||(e={}),e){const i=new Date;i.setHours(0,0,0,0),new Date().setHours(23,59,59,0);for(let d=0;d<14;d++){const f=new Date;if(f.setDate(f.getDate()+d),f.getTime()>i.getTime()){const I=f.getFullYear(),R=String(f.getMonth()+1).padStart(2,"0"),y=String(f.getDate()).padStart(2,"0");e[`${I}-${R}-${y}`]&&e[`${I}-${R}-${y}`].type&&e[`${I}-${R}-${y}`].type!=="RECIPE"&&!e[`${I}-${R}-${y}`].cooked&&V.value.push({date:f,title:e[`${I}-${R}-${y}`].recipeTitle,type:e[`${I}-${R}-${y}`].type,cooked:e[`${I}-${R}-${y}`].cooked})}}}}console.log(V.value)}return(n,e)=>{const i=_("v-btn"),r=_("v-rating"),d=_("v-icon"),f=_("v-carousel-item"),I=_("v-carousel"),R=_("v-divider"),y=_("v-list-item-title"),A=_("v-list-item"),J=_("v-list"),Q=_("v-menu"),W=_("v-toolbar"),q=_("v-img"),X=_("v-card"),pt=_("v-col"),bt=_("v-row");return o(),v("div",null,[l("div",xt,[e[11]||(e[11]=l("h2",{class:"mt-6 text-center"},"VorschlÃ¤ge",-1)),S.value&&S.value.length>0?(o(),c(i,{key:0,variant:"plain",class:"text-center",onClick:ft},{default:s(()=>[...e[4]||(e[4]=[m("Alle Likes entfernen",-1)])]),_:1})):a("",!0),l("div",St,[S.value.length===0?(o(),v("div",zt,[...e[5]||(e[5]=[l("div",{style:{"font-size":"1.2em"}},"Keine VorschlÃ¤ge vorhanden!",-1)])])):a("",!0),S.value.length>0?(o(),c(I,{key:1,"hide-delimiter-background":"","hide-delimiters":S.value.length===1},{default:s(()=>[(o(!0),v(nt,null,ot(S.value,t=>(o(),c(f,{cover:"",src:j(t?t.id:null),key:t.id},{default:s(()=>[l("div",At,[l("div",Vt,[t.rating?(o(),v("div",Et,[u(r,{modelValue:t.rating,"onUpdate:modelValue":g=>t.rating=g,hover:"",length:"5",size:"20",readonly:"",color:"white"},null,8,["modelValue","onUpdate:modelValue"])])):a("",!0),!t.ingredientsInProgress&&!t.sectionsInProgress&&!t.imageInProgress&&!t.sectionsUploaded?(o(),v("div",Mt,[l("span",null,[u(d,{icon:"mdi-information-slab-circle"}),e[6]||(e[6]=m()),e[7]||(e[7]=l("b",null,"Nur Zutatenliste vorhanden!",-1))])])):a("",!0),l("div",Ut,[t.duration?(o(),v("span",Tt,[l("b",null,h(t.duration)+" Min.",1),e[8]||(e[8]=m(" | ",-1))])):a("",!0),l("span",null,[l("b",null,h(t.voting)+" x ðŸ‘",1)])])]),l("div",Nt,[l("span",{onClick:g=>T(t),style:{cursor:"pointer","text-decoration-line":"none","font-weight":"700","font-size":"2.04em",color:"#ffffff !important","background-color":"rgba(93,93,93,0.66)",hyphens:"auto","overflow-wrap":"break-word"},class:"text-medium-emphasis"},h(t.title),9,Ot)]),l("div",null,[u(i,{onClick:g=>ct(t.id),variant:"flat",color:"rgba(198, 217, 238, 0.7)",height:"50"},{default:s(()=>[...e[9]||(e[9]=[m("Rezept einplanen",-1)])]),_:1},8,["onClick"])]),l("div",null,[u(i,{onClick:g=>vt(t.id),variant:"flat",color:"rgb(238 198 198 / 70%)",class:"mt-1"},{default:s(()=>[...e[10]||(e[10]=[m("Ignorieren",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["src"]))),128))]),_:1},8,["hide-delimiters"])):a("",!0)])]),u(R,{class:"mt-4"}),l("div",Bt,[e[25]||(e[25]=l("h2",{class:"mt-6 text-center"},"AusgewÃ¤hlt",-1)),l("div",Yt,[w.value&&w.value.length>0?(o(),c(i,{key:0,variant:"outlined",onClick:mt,disabled:!K.value||K.value.length===0},{default:s(()=>[...e[12]||(e[12]=[m("Alle Zutaten einkaufen",-1)])]),_:1},8,["disabled"])):a("",!0),w.value&&w.value.length>0?(o(),c(i,{key:1,variant:"outlined",class:"ml-2",color:"red",onClick:gt},{default:s(()=>[...e[13]||(e[13]=[m("Alle entfernen",-1)])]),_:1})):a("",!0)]),u(bt,{class:"text-center mt-2",id:"recipesDiv"},{default:s(()=>[w.value.length===0?(o(),v("div",Zt,[...e[14]||(e[14]=[l("div",{style:{"font-size":"1.2em"}},"Keine geplanten Rezepte gefunden!",-1)])])):a("",!0),(o(!0),v(nt,null,ot(w.value,t=>(o(),c(pt,{cols:"12",sm:"12",md:"6",lg:"4",xl:"3",key:t.id},{default:s(()=>[t.type!=="SCHEDULED"&&t.type!=="OTHER"?(o(),c(X,{key:0,class:"mx-auto","max-width":"374"},{default:s(()=>[(o(),c(q,{class:"position-relative",height:"200",src:j(t?t.id:null),key:B.value[t.id]?B.value[t.id]:0,color:"grey",cover:""},{default:s(()=>[l("div",Ft,[t.duration?(o(),v("div",Ht,[l("b",null,h(t.duration)+" Min.",1)])):a("",!0),l("div",Kt,[!t.ingredientsInProgress&&!t.sectionsInProgress&&t.sectionsUploaded?(o(),v("a",{key:0,target:"_blank",href:"/recipes/go?id="+t.id,style:{"text-decoration-line":"none",color:"#ffffff","background-color":"rgba(93,93,93,0.66)"},class:"pa-1"},h(t.title),9,jt)):a("",!0),!t.ingredientsInProgress&&!t.sectionsInProgress&&!t.sectionsUploaded?(o(),v("span",Gt,h(t.title),1)):a("",!0)])]),l("div",Lt,[l("div",Jt,[b.value[t.id]?(o(),c(d,{key:0,icon:"mdi-check-bold"})):a("",!0),b.value[t.id]?a("",!0):(o(),c(d,{key:1,icon:"mdi-close-thick",color:"red"})),b.value[t.id]?(o(),v("b",Qt,"Geplant "+h(z(Y).format(b.value[t.id]))+", "+h(z(lt)(b.value[t.id])),1)):a("",!0),b.value[t.id]?a("",!0):(o(),v("b",Wt,"Kein Datum festgelegt"))]),l("div",qt,[t.ordered?(o(),c(d,{key:0,icon:"mdi-check-bold"})):a("",!0),t.ordered?a("",!0):(o(),c(d,{key:1,icon:"mdi-close-thick",color:"red"})),e[15]||(e[15]=l("b",null,"Zutaten bestellt",-1))]),t.sectionsUploaded&&!t.sectionsInProgress?(o(),v("div",Xt,[t.cooked?(o(),c(d,{key:0,icon:"mdi-check-bold"})):a("",!0),t.cooked?a("",!0):(o(),c(d,{key:1,icon:"mdi-close-thick",color:"red"})),t.cooked?a("",!0):(o(),v("b",te,"Noch nicht zubereitet")),t.cooked&&!t.lastCookedAt?(o(),v("b",ee,"Rezept zubereitet")):a("",!0),t.cooked&&t.lastCookedAt?(o(),v("b",ne,"Zubereitet am "+h(z(st)(t.lastCookedAt)),1)):a("",!0)])):a("",!0)]),u(W,{color:"transparent"},{append:s(()=>[u(Q,null,{activator:s(({props:g})=>[!t.imageInProgress&&!t.sectionsInProgress&&!t.ingredientsInProgress?(o(),c(i,at({key:0,icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},g),{default:s(()=>[u(d,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)):a("",!0)]),default:s(()=>[u(J,null,{default:s(()=>[u(A,{onClick:g=>L(t.id)},{default:s(()=>[u(y,null,{default:s(()=>[...e[16]||(e[16]=[m("Zutaten einkaufen",-1)])]),_:1})]),_:1},8,["onClick"]),t.sectionsUploaded&&!t.sectionsInProgress?(o(),c(A,{key:0,onClick:g=>T(t,!0)},{default:s(()=>[u(y,null,{default:s(()=>[...e[17]||(e[17]=[m("Rezept zubereiten",-1)])]),_:1})]),_:1},8,["onClick"])):a("",!0),z(M)?a("",!0):(o(),c(A,{key:1,onClick:g=>_t(t)},{default:s(()=>[u(y,null,{default:s(()=>[...e[18]||(e[18]=[m("Daten importieren",-1)])]),_:1})]),_:1},8,["onClick"])),u(A,{onClick:g=>G(t)},{default:s(()=>[u(y,null,{default:s(()=>[...e[19]||(e[19]=[m("Aus Planung entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])),l("div",oe,[!t.ordered&&!t.cooked?(o(),c(i,{key:0,variant:"outlined",onClick:g=>L(t.id)},{default:s(()=>[...e[20]||(e[20]=[m("Zutaten einkaufen",-1)])]),_:1},8,["onClick"])):a("",!0)]),l("div",ae,[t.ordered&&!t.cooked&&t.sectionsUploaded&&!t.sectionsInProgress?(o(),c(i,{key:0,variant:"outlined",onClick:g=>T(t,!0),color:"blue"},{default:s(()=>[...e[21]||(e[21]=[m("Rezept zubereiten",-1)])]),_:1},8,["onClick"])):a("",!0)]),l("div",le,[t.sectionsUploaded&&!t.sectionsInProgress&&t.cooked||!(t.sectionsUploaded&&!t.sectionsInProgress)&&t.ordered?(o(),c(i,{key:0,variant:"outlined",color:"red",onClick:g=>G(t)},{default:s(()=>[...e[22]||(e[22]=[m("Aus Planung entfernen",-1)])]),_:1},8,["onClick"])):a("",!0)])]),_:2},1024)):a("",!0),t.type==="SCHEDULED"||t.type==="OTHER"?(o(),c(X,{key:1,class:"mx-auto","max-width":"374"},{default:s(()=>[u(q,{class:"position-relative",height:"200",color:"rgb(160, 171, 183)",cover:""},{default:s(()=>[l("div",se,[l("div",ie,[l("span",de,h(t.title),1)])]),l("div",re,[l("div",ue,[u(d,{icon:"mdi-check-bold"}),t.date?(o(),v("b",ce,"Geplant "+h(z(Y).format(b.value[t.id]))+", "+h(z(lt)(t.date)),1)):a("",!0)]),l("div",fe,[t.cooked?(o(),c(d,{key:0,icon:"mdi-check-bold"})):a("",!0),t.cooked?a("",!0):(o(),c(d,{key:1,icon:"mdi-close-thick",color:"red"})),t.cooked?a("",!0):(o(),v("b",ve,"Noch nicht zubereitet")),t.cooked?(o(),v("b",ge,"Zubereitet am "+h(z(st)(t.date)),1)):a("",!0)])]),u(W,{color:"transparent"},{append:s(()=>[u(Q,null,{activator:s(({props:g})=>[u(i,at({icon:"mdi-dots-vertical",color:"white"},{ref_for:!0},g),{default:s(()=>[u(d,{icon:"mdi-dots-vertical",size:"35"})]),_:1},16)]),default:s(()=>[u(J,null,{default:s(()=>[u(A,{onClick:g=>kt(t)},{default:s(()=>[u(y,null,{default:s(()=>[...e[23]||(e[23]=[m("Aus Kalender entfernen",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),l("div",me,[t.cooked?a("",!0):(o(),c(i,{key:0,variant:"outlined",onClick:g=>yt(t),color:"red"},{default:s(()=>[...e[24]||(e[24]=[m("Mahlzeit wurde verzehrt",-1)])]),_:1},8,["onClick"]))])]),_:2},1024)):a("",!0)]),_:2},1024))),128))]),_:1})]),u(wt,{onResult:e[0]||(e[0]=t=>U.value=t)}),u($t,{onResult:e[1]||(e[1]=t=>H.value=t)}),u(tt,{onResult:e[2]||(e[2]=t=>Z.value=t),title:"Bitte bestÃ¤tigen",message:"Sollen alle vorgeschlagenen Rezepte entfernt werden?"}),u(tt,{onResult:e[3]||(e[3]=t=>F.value=t),title:"Bitte bestÃ¤tigen",message:"Sollen alle geplanten Rezepte aus der Planung entfernt werden?"})])}}},ke=It(_e,[["__scopeId","data-v-a8b61523"]]),we={__name:"index",setup(D){return rt(async()=>{dt()}),(E,$)=>(o(),c(ke))}};export{we as default};
