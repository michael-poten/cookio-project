import{a0 as Ve,M as le,K as ue,r as _,u as re,N as K,o as W,g as r,O as A,y as i,C as a,B as o,z as s,x as u,R as $,S as M,A as I,D as y,a1 as ie,a2 as ze,L as De,a3 as ae,V as $e,k as H,P as g,Q as V,a4 as Me,a5 as Ue,J as Ee}from"./f8OX53IZ.js";import{R as D,I as Ne}from"./DKMR8BJI.js";import{_ as de}from"./DlAUqK2U.js";const Ae=Ve("/images/bellring.png"),Le={class:"mt-3"},Ze={__name:"TimerDialog",emits:["result"],setup(Q,{emit:U}){le();const x=ue();_(x.authInfo);const P=U;re(),K().params.userId;const m=_(!1),l=_(null),T=_(null),E=_([]);W(async()=>{P("result",async L=>(E.value=L,m.value=!0,new Promise((f,w)=>{l.value=f,T.value=w})))});function k(){m.value=!1,l.value(!1)}return(L,f)=>{const w=r("v-card-title"),B=r("v-divider"),j=r("v-card-text"),Z=r("v-btn"),h=r("v-card-actions"),J=r("v-card"),q=r("v-dialog");return i(),A(q,{"max-width":"600",persistent:"",modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=N=>m.value=N)},{default:a(()=>[o(J,{style:{"background-color":"#fcfaf7"},class:"pa-4"},{default:a(()=>[o(w,null,{default:a(()=>f[1]||(f[1]=[s("h2",null,"Zeit abgelaufen!",-1)])),_:1,__:[1]}),o(j,null,{default:a(()=>[f[3]||(f[3]=s("div",{style:{width:"100%"},class:"text-center"},[s("div",{class:"vibrate"},[s("img",{alt:"bellring",src:Ae,style:{width:"300px",height:"300px"},class:"mt-2"})])],-1)),o(B),s("div",Le,[f[2]||(f[2]=s("h3",null,"Folgende Timer sind abgelaufen:",-1)),(i(!0),u($,null,M(E.value,N=>(i(),u("div",{key:N.id,style:{"font-size":"1.6em"}}," - "+I(N.title),1))),128))])]),_:1,__:[3]}),o(h,null,{default:a(()=>[o(Z,{onClick:k,style:{width:"100%"},rounded:"",size:"50",variant:"outlined"},{default:a(()=>f[4]||(f[4]=[y(" Schließen ")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Be=de(Ze,[["__scopeId","data-v-dbd91138"]]),je={class:"mt-2"},qe={class:"mb-1 mt-2"},Je={class:"text-medium-emphasis"},Oe={class:"mt-2"},Fe={class:"text-h4 text-medium-emphasis mt-4"},He={key:0,class:"mt-6"},Ke=["href"],We=["id"],Qe=["innerHTML"],Ge={key:1,class:"mt-6"},Xe={key:0,class:"mb-4"},Ye={key:1},et={style:{"font-size":"0.9em"}},tt={class:"mt-4"},nt={class:"text-center",style:{"margin-top":"40px"}},ot={key:0},st={class:"text-center mt-2"},it={class:"text-medium-emphasis mt-6"},at={key:1,class:"custom-bottom-sheet no-print"},lt={class:"sheet-content",style:{"background-color":"rgb(226, 226, 226)"}},ut={key:0},rt={key:0},dt={key:1},ct={class:"text-center"},vt={style:{"background-color":"rgb(203, 203, 204)"}},mt={key:0},pt={style:{"font-size":"1.7em","border-radius":"6px","background-color":"#ffffff",color:"#3d3d3d"},class:"px-2"},_t={key:0},ft={key:1},gt={__name:"MealMaker",setup(Q){ie.extend(ze),le();const U=ue(),{authInfo:x,githubMode:P}=De(U);re();const m=K().query.id,l=_(null),T=_(null),E=_(2),k=_([]),L=_(null),f=_(!1),w=_(!1),B=_(null),j=_(null),Z=_([]),h=_([]);W(async()=>{l.value=null,T.value=null,await U.getAuthInfo(),await z(!0),l.value.planned&&(L.value=setTimeout(async()=>{const e={cooked:!0};await D.updateRecipe(x.value.userId,m,e),await z()},5*6e4));const t=localStorage.getItem("timers-"+m);if(t)try{const e=JSON.parse(t);e.forEach(d=>{d.isPaused=!0}),k.value=e.map(d=>({...d,timeoutId:null}))}catch(e){console.error("Timer konnte nicht geladen werden:",e)}}),ae(()=>{clearTimeout(L.value)}),$e(k,t=>{const e=t.map(({timeoutId:d,...c})=>c);localStorage.setItem("timers-"+m,JSON.stringify(e))},{deep:!0});const J=H(()=>!h||h.value.length===0?0:h.value.filter(t=>!t.ingredient&&t.duration).reduce((t,e)=>t+e.duration,0)),q=H(()=>!h||h.value.length===0?[]:h.value.filter(t=>!!t.ingredient)),N=H(()=>!h||h.value.length===0?[]:h.value.filter(t=>!t.ingredient));function ce(){const t=[];l.value.ingredients.forEach(e=>{e.preparationRequired&&t.push({name:e.preparationLongText,ingredient:!0})}),l.value.sections.forEach(e=>{e.ingredientsPreparations&&e.ingredientsPreparations.length>0&&e.ingredientsPreparations.forEach(d=>{t.push({name:d.instruction,sectionIndex:e.index-1,duration:d.duration})})}),h.value=t}function ve(t){return P.value?"https://mmhhhh.de/data/home/recipes/"+t.id+"/image.jpg":"/api/"+x.value.userId+"/recipes/"+t.id+"/image"}function X(){window.close()}async function me(){const t={preparations:[]};await D.updateRecipe(x.value.userId,m,t),await z(!0)}function pe(t){te(t),z()}async function _e(t){const e={rating:t};await D.updateRecipe(x.value.userId,m,e),await z()}async function Y(){if(!P.value){const t={preparations:h.value};await D.updateRecipe(x.value.userId,m,t),await z()}}async function z(t=!1){l.value=await D.getRecipe(x.value.userId,m),l.value.ingredients=(await D.getRecipeIngredients(x.value.userId,m)).data,l.value.sections=(await D.getRecipeSections(x.value.userId,m)).data,t&&(l.value.preparations&&l.value.preparations.length>0?h.value=l.value.preparations:ce()),te();const e=[];for(let d=0;d<l.value.sections.length;d++){let c=l.value.sections[d],b=c.description;if(c.timer&&c.timer.length>0)for(let v=0;v<c.timer.length;v++){let p=c.timer[v];b=b.replace(p.descriptionText,'<span class="pa-1 stopwatch-button" style="cursor: pointer; background-color: rgba(187,187,187,0.66); border: rgba(41,56,80,0.49) solid 3px; border-radius: 20px; color: #545454; font-size: 0.9em" data-id="'+v+'" data-sectionid="'+d+'"> ⏱ '+p.descriptionText+"</span >")}w.value||c.ingredientsPreparations.forEach(v=>{h.value.find(R=>R.checked&&d===R.sectionIndex&&R.name===v.instruction)&&(b=b.replace(v.instruction,'<span style="text-decoration-line: line-through;text-decoration-style: solid;text-decoration-thickness: 2px;text-underline-offset: 4px;">'+v.instruction+"</span>"))}),c.usedIngredients.forEach(v=>{const p=T.value.find(F=>F.name===v.ingredientNameList);let R="";p&&!e.includes(p.name)&&(R=p.amount?p.amount+(p.unit?" "+p.unit:"")+" ":"",e.push(p.name)),b=b.replace(v.ingredientNameText,"<b>"+R+v.ingredientNameText+"</b>")}),c.description=b}document.title=l.value.title+" - Cookio"}function fe(t){B.value(t)}function ee(){w.value=!w.value,z()}function te(t){t&&(E.value=t);let e=l.value.portions?l.value.portions:2;T.value=[],l.value.ingredients.forEach(d=>{T.value.push({name:d.name,unit:d.unit,amount:d.amount/e*E.value})})}function ge(t){const e=t.target.closest(".stopwatch-button");if(e){const d=e.dataset.id,c=e.dataset.sectionid,b=parseInt(d,10),v=parseInt(c,10),p=l.value.sections[v].timer[b];k.value.push({id:v+"-"+b,title:p.title,remainingSeconds:p.duration*60,timerStarted:!1,isPaused:!1,timeoutId:null})}}const he=t=>{const e=ie.duration(t*1e3),d=String(e.minutes()).padStart(2,"0"),c=String(e.seconds()).padStart(2,"0");return`${d}:${c}`};function ke(t){k.value=k.value.filter(e=>e.id!==t)}const O=t=>{t.isPaused||t.remainingSeconds<=0||k.value.find(e=>e.id===t.id)&&(console.log("tick",t.id),t.remainingSeconds--,t.remainingSeconds<=0&&(Z.value.push(t),j.value(Z.value).then(()=>{Z.value=[],k.value=k.value.filter(e=>e.remainingSeconds>0)})),t.remainingSeconds>0?t.timeoutId=setTimeout(()=>O(t),1e3):t.timeoutId=null)},ye=t=>{clearTimeout(t.timeoutId),t.timerStarted=!0,t.isPaused=!1,t.timeoutId=setTimeout(()=>O(t),1e3)},be=t=>{t.isPaused=!t.isPaused,!t.isPaused&&t.remainingSeconds>0&&(t.timeoutId=setTimeout(()=>O(t),1e3))},xe=t=>{t.remainingSeconds=t.remainingSeconds+60},Ie=t=>{const e=t.remainingSeconds-60;t.remainingSeconds=Math.max(e,0)};return ae(()=>{k.value.forEach(t=>clearTimeout(t.timeoutId))}),(t,e)=>{const d=r("v-app-bar-nav-icon"),c=r("v-icon"),b=r("v-list-item-title"),v=r("v-list-item"),p=r("v-divider"),R=r("v-chip"),F=r("v-list"),Se=r("v-menu"),we=r("v-app-bar"),S=r("v-btn"),Ce=r("v-img"),ne=r("v-checkbox"),Pe=r("v-rating"),oe=r("v-container"),Te=r("v-table"),se=r("v-col"),Re=r("v-row");return i(),u("div",null,[o(we,{collapse:"",elevation:0,color:"#6969695A",class:"no-print"},{prepend:a(()=>[o(Se,null,{activator:a(({props:n})=>[o(d,Me(Ue(n)),null,16)]),default:a(()=>[o(F,{class:"mt-2"},{default:a(()=>[o(v,{onClick:ee},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-knife",size:"20"}),y(" Schnibbelmodus "+I(w.value?"beenden":"aktivieren"),1)]),_:1})]),_:1}),o(v,{onClick:e[0]||(e[0]=n=>fe(V(m)))},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-truck",size:"20"}),e[5]||(e[5]=y(" Zutaten einkaufen"))]),_:1,__:[5]})]),_:1}),o(p),o(v,null,{default:a(()=>[s("div",je,[o(c,{icon:"mdi-account-group",size:"20"}),e[6]||(e[6]=y(" Portionen "))]),s("div",qe,[(i(),u($,null,M([1,2,3,4,5,6],n=>s("span",{key:n,class:"ml-1"},[o(R,{color:n===E.value?"indigo":null,"prepend-icon":"mdi-account",onClick:C=>pe(n)},{default:a(()=>[y(I(n),1)]),_:2},1032,["color","onClick"])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),l.value?(i(),A(oe,{key:0,class:"pt-0"},{default:a(()=>[s("div",null,[s("div",Je,[o(S,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:X},{default:a(()=>e[7]||(e[7]=[y("Zurück")])),_:1,__:[7]})])]),s("div",Oe,[!l.value.imageInProgress&&l.value.imageUploaded?(i(),A(Ce,{key:0,height:"200",src:ve(l.value),color:"grey",cover:""},null,8,["src"])):g("",!0),s("div",Fe,I(l.value.title),1)]),w.value?g("",!0):(i(),u("div",He,[(i(!0),u($,null,M(l.value.sections,n=>(i(),u("div",{key:n.index},[s("div",null,[s("a",{href:"/recipes/go?id"+V(m)+"#section-"+n.index,style:{all:"revert","text-decoration":"none",cursor:"pointer"}},[s("h2",{style:{color:"dimgray"},class:"pt-8",id:"section-"+n.index},[y(I(n.index)+" "+I(n.sectionTitle)+" ",1),s("span",null,[o(c,{icon:"mdi-link-variant",size:"26"})])],8,We)],8,Ke)]),s("div",{style:{"font-size":"1.1em"},class:"mt-1",innerHTML:n.description,onClick:ge},null,8,Qe)]))),128))])),w.value?(i(),u("div",Ge,[e[10]||(e[10]=s("h2",null,"Vorbereitungen",-1)),V(P)?g("",!0):(i(),u("div",Xe,[o(S,{onClick:me,variant:"plain",rounded:"",style:{"font-size":"0.7em"}},{default:a(()=>e[8]||(e[8]=[y("Zurücksetzen")])),_:1,__:[8]})])),e[11]||(e[11]=s("h3",null,"Zutatenvorbereitungen",-1)),V(q).length===0?(i(),u("div",Ye," Keine Vorbereitungen nötig. ")):g("",!0),(i(!0),u($,null,M(V(q),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),e[12]||(e[12]=s("h3",{class:"mt-3"},"Rezeptvorbereitungen",-1)),s("span",et,"Dauer: "+I(V(J))+" Min.",1),(i(!0),u($,null,M(V(N),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),s("div",tt,[o(S,{onClick:ee,color:"primary",variant:"outlined",rounded:""},{default:a(()=>e[9]||(e[9]=[y("Schnibbelmodus beenden")])),_:1,__:[9]})])])):g("",!0),s("div",nt,[V(P)?g("",!0):(i(),u("div",ot,[e[13]||(e[13]=s("span",{style:{"font-size":"1.6em"}},"Wie gut hat dir dieses Essen geschmeckt?",-1)),s("div",st,[o(Pe,{"onUpdate:modelValue":[_e,e[1]||(e[1]=n=>l.value.rating=n)],hover:"",length:"5",size:"30",modelValue:l.value.rating,"active-color":"primary"},null,8,["modelValue"])])])),s("div",it,[o(S,{variant:"text",to:"/recipes","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:X},{default:a(()=>e[14]||(e[14]=[y("Zurück zur Übersicht")])),_:1,__:[14]})])]),e[15]||(e[15]=s("div",{style:{height:"600px"}},null,-1))]),_:1,__:[15]})):g("",!0),T.value?(i(),u("div",at,[s("div",lt,[f.value?(i(),u("div",ut,[o(oe,{"max-width":"400"},{default:a(()=>[o(Te,null,{default:a(()=>[s("tbody",null,[(i(!0),u($,null,M(T.value,n=>(i(),u("tr",{key:n.name},[s("td",null,[n.amount?(i(),u("span",rt,I(n.amount),1)):g("",!0),e[16]||(e[16]=y()),n.unit?(i(),u("span",dt,I(n.unit),1)):g("",!0)]),s("td",null,I(n.name),1)]))),128))])]),_:1})]),_:1})])):g("",!0),s("div",ct,[s("div",vt,[o(S,{style:{width:"100%"},class:"my-2",variant:"text",onClick:e[2]||(e[2]=n=>f.value=!f.value),elevation:"0","prepend-icon":"mdi-food-apple-outline"},{default:a(()=>e[17]||(e[17]=[y("Zutatenliste")])),_:1,__:[17]})]),k.value&&k.value.length>0?(i(),u("div",mt,[s("div",null,[o(S,{variant:"text",elevation:"0",disabled:"","prepend-icon":"mdi-timer-play-outline"},{default:a(()=>e[18]||(e[18]=[y("Stoppuhren")])),_:1,__:[18]})]),(i(!0),u($,null,M(k.value,n=>(i(),u("div",{key:n.title,class:"my-1"},[o(p,{class:"mb-1"}),o(Re,{align:"center"},{default:a(()=>[o(S,{icon:"mdi-close",onClick:C=>ke(n.id),variant:"text"},null,8,["onClick"]),o(se,{class:"text-left",style:{"font-size":"1.2em","font-weight":"400","line-height":"1.1 !important"}},{default:a(()=>[y(I(n.title),1)]),_:2},1024),o(se,{class:"d-flex align-center justify-end"},{default:a(()=>[o(S,{onClick:C=>Ie(n),icon:"mdi-minus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),o(S,{onClick:C=>xe(n),icon:"mdi-plus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),s("span",pt,I(he(n.remainingSeconds)),1),n.timerStarted?g("",!0):(i(),A(S,{key:0,onClick:C=>ye(n),icon:"mdi-play-circle-outline",class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0"},null,8,["onClick"])),n.timerStarted?(i(),A(S,{key:1,onClick:C=>be(n),class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0",icon:""},{default:a(()=>[n.isPaused?(i(),u("span",_t,[o(c,{icon:"mdi-play-circle-outline"})])):g("",!0),n.isPaused?g("",!0):(i(),u("span",ft,[o(c,{icon:"mdi-pause-circle-outline"})]))]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):g("",!0)])])])):g("",!0),o(Ne,{onResult:e[3]||(e[3]=n=>B.value=n)}),o(Be,{onResult:e[4]||(e[4]=n=>j.value=n)})])}}},ht=de(gt,[["__scopeId","data-v-058b1dc2"]]),xt={__name:"index",setup(Q){const U=K(),x=Ee();_(!1);const P=U.query.id;return W(async()=>{P||x.push("/recipes")}),(G,m)=>(i(),A(ht))}};export{xt as default};
