import{$ as Pe,M as ae,K as le,r as g,u as ue,N as K,o as W,g as r,O as L,y as i,C as a,B as o,z as s,x as u,R as V,S as z,A as x,D as k,a0 as ie,a1 as Re,L as Te,V as Ve,k as H,a2 as ze,P as f,Q as w,a3 as De,a4 as $e,J as Me}from"./BkS6rhBD.js";import{R as A,I as Ue}from"./UkxKsAjm.js";import{_ as re}from"./DlAUqK2U.js";const Ee=Pe("/images/bellring.png"),Ne={class:"mt-3"},Ae={__name:"TimerDialog",emits:["result"],setup(Q,{emit:D}){ae();const I=le();g(I.authInfo);const T=D;ue(),K().params.userId;const _=g(!1),l=g(null),P=g(null),$=g([]);W(async()=>{T("result",async M=>($.value=M,_.value=!0,new Promise((v,U)=>{l.value=v,P.value=U})))});function y(){_.value=!1,l.value(!1)}return(M,v)=>{const U=r("v-card-title"),B=r("v-divider"),Z=r("v-card-text"),h=r("v-btn"),q=r("v-card-actions"),j=r("v-card"),J=r("v-dialog");return i(),L(J,{"max-width":"600",persistent:"",modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=E=>_.value=E)},{default:a(()=>[o(j,{style:{"background-color":"#fcfaf7"},class:"pa-4"},{default:a(()=>[o(U,null,{default:a(()=>v[1]||(v[1]=[s("h2",null,"Zeit abgelaufen!",-1)])),_:1,__:[1]}),o(Z,null,{default:a(()=>[v[3]||(v[3]=s("div",{style:{width:"100%"},class:"text-center"},[s("div",{class:"vibrate"},[s("img",{alt:"bellring",src:Ee,style:{width:"300px",height:"300px"},class:"mt-2"})])],-1)),o(B),s("div",Ne,[v[2]||(v[2]=s("h3",null,"Folgende Timer sind abgelaufen:",-1)),(i(!0),u(V,null,z($.value,E=>(i(),u("div",{key:E.id,style:{"font-size":"1.6em"}}," - "+x(E.title),1))),128))])]),_:1,__:[3]}),o(q,null,{default:a(()=>[o(h,{onClick:y,style:{width:"100%"},rounded:"",size:"50",variant:"outlined"},{default:a(()=>v[4]||(v[4]=[k(" Schließen ")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Le=re(Ae,[["__scopeId","data-v-dbd91138"]]),Ze={class:"mt-2"},Be={class:"mb-1 mt-2"},je={class:"text-medium-emphasis"},qe={class:"mt-2"},Je={class:"text-h4 text-medium-emphasis mt-4"},Oe={key:0,class:"mt-6"},Fe=["href"],He=["id"],Ke=["innerHTML"],We={key:1,class:"mt-6"},Qe={key:0,class:"mb-4"},Ge={key:1},Xe={style:{"font-size":"0.9em"}},Ye={class:"mt-4"},et={class:"text-center",style:{"margin-top":"40px"}},tt={key:0},nt={class:"text-center mt-2"},ot={class:"text-medium-emphasis mt-6"},st={key:1,class:"custom-bottom-sheet"},it={class:"sheet-content",style:{"background-color":"rgb(226, 226, 226)"}},at={key:0},lt={key:0},ut={key:1},rt={class:"text-center"},dt={style:{"background-color":"rgb(203, 203, 204)"}},ct={key:0},vt={style:{"font-size":"1.7em","border-radius":"6px","background-color":"#ffffff",color:"#3d3d3d"},class:"px-2"},mt={key:0},pt={key:1},_t={__name:"MealMaker",setup(Q){ie.extend(Re),ae();const D=le(),{authInfo:I,githubMode:T}=Te(D);ue();const _=K().query.id,l=g(null),P=g(null),$=g(2),y=g([]),M=g(!1),v=g(!1),U=g(null),B=g(null),Z=g([]),h=g([]);W(async()=>{l.value=null,P.value=null,await D.getAuthInfo(),await N(!0);const t=localStorage.getItem("timers-"+_);if(t)try{const e=JSON.parse(t);e.forEach(d=>{d.isPaused=!0}),y.value=e.map(d=>({...d,timeoutId:null}))}catch(e){console.error("Timer konnte nicht geladen werden:",e)}}),Ve(y,t=>{const e=t.map(({timeoutId:d,...c})=>c);localStorage.setItem("timers-"+_,JSON.stringify(e))},{deep:!0});const q=H(()=>!h||h.value.length===0?0:h.value.filter(t=>!t.ingredient&&t.duration).reduce((t,e)=>t+e.duration,0)),j=H(()=>!h||h.value.length===0?[]:h.value.filter(t=>!!t.ingredient)),J=H(()=>!h||h.value.length===0?[]:h.value.filter(t=>!t.ingredient));function E(){const t=[];l.value.ingredients.forEach(e=>{e.preparationRequired&&t.push({name:e.preparationLongText,ingredient:!0})}),l.value.sections.forEach(e=>{e.ingredientsPreparations&&e.ingredientsPreparations.length>0&&e.ingredientsPreparations.forEach(d=>{t.push({name:d.instruction,sectionIndex:e.index-1,duration:d.duration})})}),h.value=t}function X(){window.close()}async function de(){const t={preparations:[]};await A.updateRecipe(I.value.userId,_,t),await N(!0)}function ce(t){te(t),N()}async function ve(t){const e={rating:t};await A.updateRecipe(I.value.userId,_,e),await N()}async function Y(){if(!T.value){const t={preparations:h.value};await A.updateRecipe(I.value.userId,_,t),await N()}}async function N(t=!1){l.value=A.getRecipe(I.value.userId,_),l.value.ingredients=A.getRecipeIngredients(I.value.userId,_),l.value.sections=A.getRecipeSections(I.value.userId,_),t&&(l.value.preparations&&l.value.preparations.length>0?h.value=l.value.preparations:E()),te();const e=[];for(let d=0;d<l.value.sections.length;d++){let c=l.value.sections[d],b=c.description;if(c.timer&&c.timer.length>0)for(let m=0;m<c.timer.length;m++){let p=c.timer[m];b=b.replace(p.descriptionText,'<span class="pa-1 stopwatch-button" style="cursor: pointer; background-color: rgba(187,187,187,0.66); border: rgba(41,56,80,0.49) solid 3px; border-radius: 20px; color: #545454; font-size: 0.9em" data-id="'+m+'" data-sectionid="'+d+'"> ⏱ '+p.descriptionText+"</span >")}v.value||c.ingredientsPreparations.forEach(m=>{h.value.find(R=>R.checked&&d===R.sectionIndex&&R.name===m.instruction)&&(b=b.replace(m.instruction,'<span style="text-decoration-line: line-through;text-decoration-style: solid;text-decoration-thickness: 2px;text-underline-offset: 4px;">'+m.instruction+"</span>"))}),c.usedIngredients.forEach(m=>{const p=P.value.find(F=>F.name===m.ingredientNameList);let R="";p&&!e.includes(p.name)&&(R=p.amount?p.amount+(p.unit?" "+p.unit:"")+" ":"",e.push(p.name)),b=b.replace(m.ingredientNameText,"<b>"+R+m.ingredientNameText+"</b>")}),c.description=b}document.title=l.value.title+" - Cookio"}function me(t){U.value(t)}function ee(){v.value=!v.value,N()}function te(t){t&&($.value=t);let e=l.value.portions?l.value.portions:2;P.value=[],l.value.ingredients.forEach(d=>{P.value.push({name:d.name,unit:d.unit,amount:d.amount/e*$.value})})}function pe(t){const e=t.target.closest(".stopwatch-button");if(e){const d=e.dataset.id,c=e.dataset.sectionid,b=parseInt(d,10),m=parseInt(c,10),p=l.value.sections[m].timer[b];y.value.push({id:m+"-"+b,title:p.title,remainingSeconds:p.duration*60,timerStarted:!1,isPaused:!1,timeoutId:null})}}const _e=t=>{const e=ie.duration(t*1e3),d=String(e.minutes()).padStart(2,"0"),c=String(e.seconds()).padStart(2,"0");return`${d}:${c}`};function fe(t){y.value=y.value.filter(e=>e.id!==t)}const O=t=>{t.isPaused||t.remainingSeconds<=0||y.value.find(e=>e.id===t.id)&&(console.log("tick",t.id),t.remainingSeconds--,t.remainingSeconds<=0&&(Z.value.push(t),B.value(Z.value).then(()=>{Z.value=[],y.value=y.value.filter(e=>e.remainingSeconds>0)})),t.remainingSeconds>0?t.timeoutId=setTimeout(()=>O(t),1e3):t.timeoutId=null)},ge=t=>{clearTimeout(t.timeoutId),t.timerStarted=!0,t.isPaused=!1,t.timeoutId=setTimeout(()=>O(t),1e3)},he=t=>{t.isPaused=!t.isPaused,!t.isPaused&&t.remainingSeconds>0&&(t.timeoutId=setTimeout(()=>O(t),1e3))},ke=t=>{t.remainingSeconds=t.remainingSeconds+60},ye=t=>{const e=t.remainingSeconds-60;t.remainingSeconds=Math.max(e,0)};return ze(()=>{y.value.forEach(t=>clearTimeout(t.timeoutId))}),(t,e)=>{const d=r("v-app-bar-nav-icon"),c=r("v-icon"),b=r("v-list-item-title"),m=r("v-list-item"),p=r("v-divider"),R=r("v-chip"),F=r("v-list"),be=r("v-menu"),xe=r("v-app-bar"),S=r("v-btn"),Ie=r("v-img"),ne=r("v-checkbox"),Se=r("v-rating"),oe=r("v-container"),Ce=r("v-table"),se=r("v-col"),we=r("v-row");return i(),u("div",null,[o(xe,{collapse:"",elevation:0,color:"#6969695A"},{prepend:a(()=>[o(be,null,{activator:a(({props:n})=>[o(d,De($e(n)),null,16)]),default:a(()=>[o(F,{class:"mt-2"},{default:a(()=>[o(m,{onClick:ee},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-knife",size:"20"}),k(" Schnibbelmodus "+x(v.value?"beenden":"aktivieren"),1)]),_:1})]),_:1}),o(m,{onClick:e[0]||(e[0]=n=>me(w(_)))},{default:a(()=>[o(b,null,{default:a(()=>[o(c,{icon:"mdi-truck",size:"20"}),e[5]||(e[5]=k(" Zutaten einkaufen"))]),_:1,__:[5]})]),_:1}),o(p),o(m,null,{default:a(()=>[s("div",Ze,[o(c,{icon:"mdi-account-group",size:"20"}),e[6]||(e[6]=k(" Portionen "))]),s("div",Be,[(i(),u(V,null,z([1,2,3,4,5,6],n=>s("span",{key:n,class:"ml-1"},[o(R,{color:n===$.value?"indigo":null,"prepend-icon":"mdi-account",onClick:C=>ce(n)},{default:a(()=>[k(x(n),1)]),_:2},1032,["color","onClick"])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),l.value?(i(),L(oe,{key:0,class:"pt-0"},{default:a(()=>[s("div",null,[s("div",je,[o(S,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:X},{default:a(()=>e[7]||(e[7]=[k("Zurück")])),_:1,__:[7]})])]),s("div",qe,[!l.value.imageInProgress&&l.value.imageUploaded?(i(),L(Ie,{key:0,height:"200",src:"/api/"+w(I).userId+"/recipes/"+l.value.id+"/image",color:"grey",cover:""},null,8,["src"])):f("",!0),s("div",Je,x(l.value.title),1)]),v.value?f("",!0):(i(),u("div",Oe,[(i(!0),u(V,null,z(l.value.sections,n=>(i(),u("div",{key:n.index},[s("div",null,[s("a",{href:"/recipes/go?id"+w(_)+"#section-"+n.index,style:{all:"revert","text-decoration":"none",cursor:"pointer"}},[s("h2",{style:{color:"dimgray"},class:"pt-8",id:"section-"+n.index},[k(x(n.index)+" "+x(n.sectionTitle)+" ",1),s("span",null,[o(c,{icon:"mdi-link-variant",size:"26"})])],8,He)],8,Fe)]),s("div",{style:{"font-size":"1.1em"},class:"mt-1",innerHTML:n.description,onClick:pe},null,8,Ke)]))),128))])),v.value?(i(),u("div",We,[e[10]||(e[10]=s("h2",null,"Vorbereitungen",-1)),w(T)?f("",!0):(i(),u("div",Qe,[o(S,{onClick:de,variant:"plain",rounded:"",style:{"font-size":"0.7em"}},{default:a(()=>e[8]||(e[8]=[k("Zurücksetzen")])),_:1,__:[8]})])),e[11]||(e[11]=s("h3",null,"Zutatenvorbereitungen",-1)),w(j).length===0?(i(),u("div",Ge," Keine Vorbereitungen nötig. ")):f("",!0),(i(!0),u(V,null,z(w(j),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),e[12]||(e[12]=s("h3",{class:"mt-3"},"Rezeptvorbereitungen",-1)),s("span",Xe,"Dauer: "+x(w(q))+" Min.",1),(i(!0),u(V,null,z(w(J),n=>(i(),u("div",{class:"mt-1",key:n.name},[o(ne,{modelValue:n.checked,"onUpdate:modelValue":C=>n.checked=C,"hide-details":"auto",density:"comfortable",label:n.name,onChange:Y},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),s("div",Ye,[o(S,{onClick:ee,color:"primary",variant:"outlined",rounded:""},{default:a(()=>e[9]||(e[9]=[k("Schnibbelmodus beenden")])),_:1,__:[9]})])])):f("",!0),s("div",et,[w(T)?f("",!0):(i(),u("div",tt,[e[13]||(e[13]=s("span",{style:{"font-size":"1.6em"}},"Wie gut hat dir dieses Essen geschmeckt?",-1)),s("div",nt,[o(Se,{"onUpdate:modelValue":[ve,e[1]||(e[1]=n=>l.value.rating=n)],hover:"",length:"5",size:"30",modelValue:l.value.rating,"active-color":"primary"},null,8,["modelValue"])])])),s("div",ot,[o(S,{variant:"text",to:"/recipes","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:X},{default:a(()=>e[14]||(e[14]=[k("Zurück zur Übersicht")])),_:1,__:[14]})])]),e[15]||(e[15]=s("div",{style:{height:"600px"}},null,-1))]),_:1,__:[15]})):f("",!0),P.value?(i(),u("div",st,[s("div",it,[M.value?(i(),u("div",at,[o(oe,{"max-width":"400"},{default:a(()=>[o(Ce,null,{default:a(()=>[s("tbody",null,[(i(!0),u(V,null,z(P.value,n=>(i(),u("tr",{key:n.name},[s("td",null,[n.amount?(i(),u("span",lt,x(n.amount),1)):f("",!0),e[16]||(e[16]=k()),n.unit?(i(),u("span",ut,x(n.unit),1)):f("",!0)]),s("td",null,x(n.name),1)]))),128))])]),_:1})]),_:1})])):f("",!0),s("div",rt,[s("div",dt,[o(S,{style:{width:"100%"},class:"my-2",variant:"text",onClick:e[2]||(e[2]=n=>M.value=!M.value),elevation:"0","prepend-icon":"mdi-food-apple-outline"},{default:a(()=>e[17]||(e[17]=[k("Zutatenliste")])),_:1,__:[17]})]),y.value&&y.value.length>0?(i(),u("div",ct,[s("div",null,[o(S,{variant:"text",elevation:"0",disabled:"","prepend-icon":"mdi-timer-play-outline"},{default:a(()=>e[18]||(e[18]=[k("Stoppuhren")])),_:1,__:[18]})]),(i(!0),u(V,null,z(y.value,n=>(i(),u("div",{key:n.title,class:"my-1"},[o(p,{class:"mb-1"}),o(we,{align:"center"},{default:a(()=>[o(S,{icon:"mdi-close",onClick:C=>fe(n.id),variant:"text"},null,8,["onClick"]),o(se,{class:"text-left",style:{"font-size":"1.2em","font-weight":"400","line-height":"1.1 !important"}},{default:a(()=>[k(x(n.title),1)]),_:2},1024),o(se,{class:"d-flex align-center justify-end"},{default:a(()=>[o(S,{onClick:C=>ye(n),icon:"mdi-minus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),o(S,{onClick:C=>ke(n),icon:"mdi-plus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),s("span",vt,x(_e(n.remainingSeconds)),1),n.timerStarted?f("",!0):(i(),L(S,{key:0,onClick:C=>ge(n),icon:"mdi-play-circle-outline",class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0"},null,8,["onClick"])),n.timerStarted?(i(),L(S,{key:1,onClick:C=>he(n),class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0",icon:""},{default:a(()=>[n.isPaused?(i(),u("span",mt,[o(c,{icon:"mdi-play-circle-outline"})])):f("",!0),n.isPaused?f("",!0):(i(),u("span",pt,[o(c,{icon:"mdi-pause-circle-outline"})]))]),_:2},1032,["onClick"])):f("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):f("",!0)])])])):f("",!0),o(Ue,{onResult:e[3]||(e[3]=n=>U.value=n)}),e[19]||(e[19]=k("/ ")),o(Le,{onResult:e[4]||(e[4]=n=>B.value=n)})])}}},ft=re(_t,[["__scopeId","data-v-9c5bbd88"]]),yt={__name:"index",setup(Q){const D=K(),I=Me();g(!1);const T=D.query.id;return W(async()=>{T||I.push("/recipes")}),(G,_)=>(i(),L(ft))}};export{yt as default};
