import{_ as te,L as ae,a6 as ne,O as ie,K as le,N as re,u as se,P as O,r as w,o as P,X as oe,g as s,x as de,y as g,Q as I,R as y,B as a,C as n,z as m,D as f,U as b,V as ue,J as pe}from"./Bk_9wZSW.js";import"./FlFhfyrK.js";import{R as c,C as ce,I as Z}from"./Dupguumz.js";import{G as C}from"./CI608YEO.js";const ve={class:"mt-2"},fe={class:"text-center",style:{"margin-top":"40px"}},me={class:"text-medium-emphasis mt-6"},ge={__name:"MealEditor",setup(M){ae.extend(ne),ie();const R=le(),{authInfo:l,githubMode:_,lanAddress:T}=re(R),x=se(),U=O();let r=U.query.id;const u=w(!1),t=w(null);w(2),w(null);const B=w(null);w(!1),P(async()=>{t.value=null,await R.getAuthInfo(),await k()}),oe(()=>U.query.id,(i,e)=>{r=i,k()});async function $(){await Z.analyzeDraft(l.value.userId,t.value.id),x.push("/recipes")}async function K(){B.value().then(async i=>{if(i){await c.deleteRecipe(l.value.userId,t.value.id);const e={id:r,draftId:null};await c.updateRecipe(l.value.userId,r,e),x.push("/recipes")}})}async function j(){let i=await c.getRecipe(l.value.userId,r),e=await z(i,t.value.id);t.value.draftIngredients=e.draftIngredients,t.value.draftSections=e.draftSections,t.value.title=i.title,t.value.preheat=i.preheat,await c.updateRecipe(l.value.userId,t.value.id,t.value),await k()}async function q(){u.value=!0,await Z.creationWithTitleForDraft(l.value.userId,t.value.id),u.value=!1,await k()}function A(){return _.value?"https://mmhhhh.de/data/home/recipes/"+r+"/image.jpg":T.value+"api/"+l.value.userId+"/recipes/"+r+"/image"}function J(){_.value?window.open("https://mmhhhh.de/recipes/go?id="+r,"_blank","noopener"):window.open("/recipes/go?id="+r,"_blank","noopener")}async function k(){let i=await c.getRecipe(l.value.userId,r);if(u.value=i.draftInProgress,i.originalId){let e=await c.getRecipe(l.value.userId,r);if(!e){x.push("/recipes");return}r=i.originalId,t.value=e;let p=await c.getRecipe(l.value.userId,i.originalId);u.value=p.draftInProgress}else if(i.draftId)try{t.value=await c.getRecipe(l.value.userId,i.draftId)}catch{const p={id:r,draftId:null};await c.updateRecipe(l.value.userId,r,p),x.push("/recipes");return}else{let e=JSON.parse(JSON.stringify(i));e.id=F(),e.originalId=r;let p=await z(i);e.draftIngredients=p.draftIngredients,e.draftSections=p.draftSections,await c.updateRecipe(l.value.userId,e.id,e);const v={id:r,draftId:e.id};await c.updateRecipe(l.value.userId,r,v),t.value=e}}async function z(i){let e="";i.ingredients&&i.ingredients.forEach(o=>e+=(o.amount?o.amount+" "+(o.unit?o.unit+" ":""):"")+o.name+`
`);let p="";const v=i.sections;for(let o=0;o<v.length;o++)p=p+(o+1)+" "+v[o].sectionTitle+`

`+v[o].description+`


`;return{draftIngredients:e,draftSections:p}}async function h(){await c.updateRecipe(l.value.userId,t.value.id,t.value)}function E(){x.push("/recipes")}function F(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i==="x"?e:e&3|8).toString(16)})}return(i,e)=>{const p=s("v-alert"),v=s("v-btn"),o=s("v-col"),V=s("v-list-item-title"),S=s("v-list-item"),G=s("v-list"),W=s("v-menu"),L=s("v-row"),Q=s("v-img"),D=s("v-textarea"),X=s("v-card-title"),H=s("v-card-text"),Y=s("v-card"),N=s("v-container"),ee=s("v-divider");return g(),de("div",null,[t.value?(g(),I(N,{key:0,class:"pt-0"},{default:n(()=>[u.value?(g(),I(p,{key:0,type:"warning",color:"rgb(169, 209, 141)"},{default:n(()=>[...e[8]||(e[8]=[f("Es finden gerade Berechnungen statt. Derzeit kann der Entwurf nicht bearbeitet werden!",-1)])]),_:1})):y("",!0),a(L,{class:"my-2"},{default:n(()=>[a(o,null,{default:n(()=>[a(v,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:E},{default:n(()=>[...e[9]||(e[9]=[f("Zurück",-1)])]),_:1})]),_:1}),a(o,{class:"text-right"},{default:n(()=>[b(_)?y("",!0):(g(),I(v,{key:0,"prepend-icon":"mdi-delete-outline",elevation:"2",onClick:K,disabled:u.value},{default:n(()=>[...e[10]||(e[10]=[f("Verwerfen",-1)])]),_:1},8,["disabled"])),b(_)?y("",!0):(g(),I(v,{key:1,color:"rgb(124, 174, 120)","prepend-icon":"mdi-content-save-cog-outline",onClick:$,disabled:u.value,class:"ml-2"},{default:n(()=>[...e[11]||(e[11]=[f("Übernehmen",-1)])]),_:1},8,["disabled"])),a(W,null,{activator:n(({props:d})=>[a(v,ue({icon:"mdi-dots-vertical",variant:"text"},d),null,16)]),default:n(()=>[a(G,null,{default:n(()=>[a(S,{onClick:j,disabled:u.value},{default:n(()=>[a(V,null,{default:n(()=>[...e[12]||(e[12]=[f("Zurücksetzen auf Original",-1)])]),_:1})]),_:1},8,["disabled"]),a(S,{onClick:q,disabled:u.value},{default:n(()=>[a(V,null,{default:n(()=>[...e[13]||(e[13]=[f("Aus Titel ein Rezept generieren",-1)])]),_:1})]),_:1},8,["disabled"]),a(S,{onClick:J},{default:n(()=>[a(V,null,{default:n(()=>[...e[14]||(e[14]=[f("Original öffnen",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),m("div",ve,[!t.value.imageInProgress&&t.value.imageUploaded?(g(),I(Q,{key:0,height:"200",src:A(),color:"grey",cover:""},null,8,["src"])):y("",!0),m("div",null,[a(D,{rows:"1","auto-grow":"",modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=d=>t.value.title=d),variant:"plain",class:"title-text-field","hide-details":"",placeholder:"Titel",onKeyup:e[1]||(e[1]=d=>b(C).debounceTime("recipeUpdated",h,300)),disabled:u.value},null,8,["modelValue","disabled"])])]),m("div",null,[m("div",null,[a(D,{rows:"1","auto-grow":"",modelValue:t.value.preheat,"onUpdate:modelValue":e[2]||(e[2]=d=>t.value.preheat=d),variant:"plain",class:"preheat-text-field",disabled:u.value},{prepend:n(()=>[...e[15]||(e[15]=[m("span",{style:{"font-style":"italic"}},"Vorbereitung:",-1)])]),_:1},8,["modelValue","disabled"])]),a(N,null,{default:n(()=>[a(Y,{variant:"outlined"},{default:n(()=>[a(X,{class:"text-decoration-underline"},{default:n(()=>[...e[16]||(e[16]=[f("Zutatenliste",-1)])]),_:1}),a(H,null,{default:n(()=>[a(D,{rows:"1","auto-grow":"",modelValue:t.value.draftIngredients,"onUpdate:modelValue":e[3]||(e[3]=d=>t.value.draftIngredients=d),variant:"plain",class:"ingredients-text-field","hide-details":"",placeholder:"Bitte hier die Zutaten eintragen",onKeyup:e[4]||(e[4]=d=>b(C).debounceTime("recipeUpdated",h,300)),disabled:u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(ee,{class:"my-2",opacity:"0.8"},{default:n(()=>[...e[17]||(e[17]=[f("Zubereitung",-1)])]),_:1}),a(D,{modelValue:t.value.draftSections,"onUpdate:modelValue":e[5]||(e[5]=d=>t.value.draftSections=d),variant:"plain","auto-grow":"",placeholder:"Zubereitung",rows:"1",onKeyup:e[6]||(e[6]=d=>b(C).debounceTime("recipeUpdated",h,300)),disabled:u.value},null,8,["modelValue","disabled"])]),m("div",fe,[m("div",me,[a(v,{variant:"text","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:E},{default:n(()=>[...e[18]||(e[18]=[f("Zurück zur Übersicht",-1)])]),_:1})])]),e[19]||(e[19]=m("div",{style:{height:"600px"}},null,-1))]),_:1})):y("",!0),a(ce,{onResult:e[7]||(e[7]=d=>B.value=d),title:"Bitte bestätigen",message:"Soll der Entwurf wirklich gelöscht werden?"})])}}},_e=te(ge,[["__scopeId","data-v-46e50855"]]),be={__name:"index",setup(M){const R=O(),l=pe(),_=R.query.id;return P(async()=>{_||l.push("/recipes")}),(T,x)=>(g(),I(_e))}};export{be as default};
