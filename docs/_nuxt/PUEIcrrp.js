import{K as w,W as p,a7 as q,_ as ae,r as b,o as se,g as m,P as Z,y as f,C as u,B as n,$ as ge,z as y,D as P,a0 as _e,a8 as he,M as ye,L as be,u as we,N as ke,x as _,a9 as Se,O as z,Q as h,A as R,R as Pe,S as Ie,T as xe,aa as G}from"./PBTyrjFC.js";const K={convertToBringUrl:function(c){let s=[];for(const C of c){const g=[];g.push(C.name),C.amount&&C.amount!==0&&g.push(C.amount+(C.unit?" "+C.unit:"")),s.push(g.join("__"))}const l=s.join("---"),t=btoa(unescape(encodeURIComponent(l)));let k="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return k=encodeURIComponent(k),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+k+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeIngredients:async function(c,s,l){const t=w();try{const r=new FormData;return r.append("image",l),await q.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image/ingredients",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},analyzeSections:async function(c,s,l){const t=w();try{const r=new FormData;return r.append("image",l),await q.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image/sections",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},uploadImage:async function(c,s,l){const t=w();try{const r=new FormData;return r.append("image",l),await q.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},generateImage:async function(c,s){const l=w();try{return await p.post(l.lanAddress+"api/"+c+"/recipes/"+s+"/import/generateImage")}catch(t){p.catchError(t)}},loginPicnic:async function(c,s){const l=w();try{return await p.post(l.lanAddress+"api/"+c+"/loginPicnic",s)}catch(t){p.catchError(t)}},searchPicnic:async function(c,s,l,t=!1){const r=w();try{return await p.post(r.lanAddress+"api/"+c+"/picnic/search",{query:s,ingredientDescription:l,useChatGpt:t})}catch(k){p.catchError(k)}},addProductToPicnicShoppingCart:async function(c,s){const l=w();try{return await p.post(l.lanAddress+"api/"+c+"/picnic/addProductToShoppingCart",{productId:s})}catch(t){p.catchError(t)}}},O={getRecipe:async function(c,s){const l=w();try{if(l.isNetworkAccess){let t=l.lanAddress+"api/"+c+"/recipes/"+s;return(await p.get(t)).data}else return(await p.get("https://mmhhhh.de/data/home/recipes.json")).data[s]}catch(t){p.catchError(t)}},getRecipeIngredients:async function(c,s){const l=w();try{let t;return l.isNetworkAccess?t=l.lanAddress+"api/"+c+"/recipes/"+s+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+s+"/ingredients.json",await p.get(t)}catch(t){p.catchError(t)}},getRecipeSections:async function(c,s){const l=w();try{let t;return l.isNetworkAccess?t=l.lanAddress+"api/"+c+"/recipes/"+s+"/sections":t="https://mmhhhh.de/data/home/recipes/"+s+"/sections.json",await p.get(t)}catch(t){p.catchError(t)}},updateRecipe:async function(c,s,l){const t=w();try{return await p.put(t.lanAddress+"api/"+c+"/recipes/"+s,l)}catch(r){p.catchError(r)}},uploadRecipeToGithub:async function(c,s){const l=w();let t={};s&&(t.recipeId=s);try{return await p.put(l.lanAddress+"api/"+c+"/recipes/githubUpload",t)}catch(r){p.catchError(r)}},deleteRecipe:async function(c,s){const l=w();try{return await p.post(l.lanAddress+"api/"+c+"/recipes/"+s+"/delete")}catch(t){p.catchError(t)}}},Ce={methods:{formatCurrency(c){return"€ "+(""+(Math.round(c*100)/100).toFixed(2)).replace(".",",")}}},Re=["innerHTML"],Ae={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(c,{emit:s}){const l=c,t=s,r=b(!1),k=b(l.message),C=b(l.title);let g=null;se(()=>{t("result",$=>(r.value=!0,new Promise((S,I)=>{g=S})))});function F(){g&&g(!0),r.value=!1,g=null}function M(){g&&g(!1),r.value=!1,g=null}return($,S)=>{const I=m("v-toolbar"),v=m("v-btn"),T=m("v-col"),j=m("v-row"),U=m("v-container"),A=m("v-card-text"),E=m("v-card"),D=m("v-dialog");return f(),Z(D,{modelValue:r.value,"onUpdate:modelValue":S[0]||(S[0]=B=>r.value=B),onKeydown:he(M,["esc"]),"max-width":"420"},{default:u(()=>[n(E,null,{default:u(()=>[n(I,{color:"rgb(191, 208, 217)",title:C.value},null,8,["title"]),ge(n(A,null,{default:u(()=>[y("div",{style:{"margin-bottom":"30px"},innerHTML:k.value},null,8,Re),n(U,{class:"sub-grid"},{default:u(()=>[n(j,null,{default:u(()=>[n(T,{cols:"6"},{default:u(()=>[n(v,{onClick:M,style:{width:"100%"}},{default:u(()=>[...S[1]||(S[1]=[P("Abbrechen",-1)])]),_:1})]),_:1}),n(T,{cols:"6"},{default:u(()=>[n(v,{color:"secondary",onClick:F,style:{width:"100%"}},{default:u(()=>[...S[2]||(S[2]=[P(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!k.value]])]),_:1})]),_:1},8,["modelValue"])}}},De=ae(Ae,[["__scopeId","data-v-6b314bdd"]]),Ve={class:"d-flex justify-space-between align-center"},Te={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Ue={key:0,class:"text-h6 text-medium-emphasis"},Ee={key:0},Be={class:"text-right mt-3"},Ne={key:1,style:{width:"100%","text-align":"right"}},ze=["colspan"],je={key:0,class:"pl-6"},Le={key:0},Fe={key:1},Me={key:1,class:"py-2"},$e={style:{"font-size":"0.8em"}},Qe={key:0},Ke={key:1},Oe={key:0},Ze={key:0},He={key:1},qe={key:0,class:"px-0 mx-0"},Ge={style:{"max-width":"200px"}},Je={class:"my-2"},We={class:"my-2"},Xe={class:"my-2"},Ye={class:"text-right"},et={key:0,class:"mt-3"},tt={class:"mt-2"},nt={__name:"IngredientsDialog",emits:["result"],setup(c,{emit:s}){const l=ye(),t=w(),{authInfo:r,githubMode:k}=be(t),C=s;we(),ke();const g=b(!1),F=b(null),M=b(null),$=b(null),S=b([]),I=b([]),v=b(null),T=b(null),j=b(2),U=b(!1),A=b(!1),E=b(!1),D=b(!1),B=b({name:null,password:null});se(async()=>{C("result",async o=>(Array.isArray(o)?S.value=o:S.value=[o],T.value=null,I.value=[],v.value=null,E.value=!1,D.value=!1,A.value=!1,j.value=2,J(),await oe(!0),g.value=!0,new Promise((e,i)=>{F.value=e,M.value=i})))});async function J(){let o=await t.getAuthInfo();U.value=o.picnicLoggedIn}async function oe(o){let e=[];for(const i of S.value){const d=await O.getRecipe(r.value.userId,i);d.ingredients=(await O.getRecipeIngredients(r.value.userId,i)).data,e.push(d)}I.value=e,X(o)}async function ie(){await K.loginPicnic(r.value.userId,B.value),await J()}async function le(){let o=!1;for(const e of I.value)e.planned&&(o=!0);o?$.value().then(async e=>{if(e){for(const i of I.value)if(i.planned){const d={ordered:!0};await O.updateRecipe(r.value.userId,i.id,d)}}g.value=!1,F.value(!0)}):(g.value=!1,F.value(!1))}async function W(){let o=v.value.filter(e=>e.bring);T.value=K.convertToBringUrl(o)}async function re(){let o=v.value.filter(d=>d.picnic);for(const d of o)if(d.selectedPicnicProduktId){let x=d.picnicResults.find(N=>N.id===d.selectedPicnicProduktId).multiplier;x||(x=1);for(let N=1;N<=x;N++)await K.addProductToPicnicShoppingCart(r.value.userId,d.selectedPicnicProduktId)}A.value=!0;const i={picnicPurchaseDate:new Date().toISOString()};for(const d of S.value)await O.updateRecipe(r.value.userId,d,i)}function X(o){v.value=[];for(const e of I.value){let i=e.portions?e.portions:2;e.ingredients.forEach(d=>{v.value.push({name:d.name,basicName:d.basicName,genericName:d.genericName?d.genericName:"Sonstiges",unit:d.unit,amount:Math.ceil(d.amount/i*j.value),standardIngredient:d.standardIngredient})})}o&&ce(),W()}function ce(){v.value.forEach(o=>{o.standardIngredient?(o.bring=!1,o.picnic=!1):(o.bring=!0,o.picnic=!1)}),D.value=v.value.filter(o=>!!o.bring).length>0,v.value=v.value.sort((o,e)=>{let i=0;return!o.bring&&!e.bring&&(i=0),!o.bring&&e.bring&&(i=1),o.bring&&!e.bring&&(i=-1),o.bring&&e.bring&&(i=0),i!==0?i:o.genericName.localeCompare(e.genericName)})}async function ue(){v.value.forEach(o=>{o.bring&&Q("picnic",o)})}async function Q(o,e){if(o==="bring")e.bring=!0,e.picnic=!1,E.value=v.value.filter(i=>!!i.picnic).length>0,D.value=v.value.filter(i=>!!i.bring).length>0;else if(o==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const i=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await K.searchPicnic(r.value.userId,e.basicName,i,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),E.value=v.value.filter(d=>!!d.picnic).length>0,D.value=v.value.filter(d=>!!d.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,E.value=v.value.filter(i=>!!i.picnic).length>0,D.value=v.value.filter(i=>!!i.bring).length>0;W()}return(o,e)=>{const i=m("v-btn"),d=m("v-card-title"),x=m("v-img"),N=m("v-text-field"),Y=m("v-card-text"),ee=m("v-card"),te=m("v-select"),ne=m("v-icon"),de=m("v-progress-linear"),pe=m("v-list-item"),H=m("v-col"),me=m("v-row"),fe=m("v-table"),ve=m("v-dialog");return f(),_("div",null,[n(ve,{"max-width":"600",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),fullscreen:z(l).smAndDown.value},{default:u(()=>[n(ee,{style:{"background-color":"white"},class:Se({"pa-4":!z(l).smAndDown.value})},{default:u(()=>[n(d,{style:{"white-space":"normal"}},{default:u(()=>[y("div",Ve,[y("div",Te,[e[6]||(e[6]=P(" Zutaten einkaufen ",-1)),I.value?(f(),_("div",Ue,R(I.value.map(a=>a.title).join(", ")),1)):h("",!0)]),n(i,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),n(Y,null,{default:u(()=>[I.value?(f(),_("div",Ee,[!U.value&&!z(k)?(f(),Z(ee,{key:0,class:"mb-4"},{default:u(()=>[n(d,null,{default:u(()=>[n(x,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=P(" Bei Picnic einloggen ",-1))]),_:1}),n(Y,null,{default:u(()=>[n(N,{modelValue:B.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>B.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),n(N,{modelValue:B.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>B.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),y("div",Be,[n(i,{variant:"outlined",onClick:ie},{default:u(()=>[...e[8]||(e[8]=[P("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):h("",!0),e[13]||(e[13]=y("h3",null,"Anzahl Portionen",-1)),n(te,{modelValue:j.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>j.value=a),X],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=y("h3",null,"Zutatenliste",-1)),z(k)?h("",!0):(f(),_("div",Ne,[n(i,{variant:"flat",onClick:e[3]||(e[3]=a=>ue()),class:"mb-1 my-1"},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=P(" Alles bei Picnic einkaufen ",-1))]),_:1})])),n(fe,{class:"table-ingredients"},{default:u(()=>[y("tbody",null,[(f(!0),_(Pe,null,Ie(v.value,a=>(f(),_("tr",{key:a.name},[y("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?h("",!0):(f(),_("div",je,[a.amount?(f(),_("span",Le,R(a.amount),1)):h("",!0),e[10]||(e[10]=P()),a.unit?(f(),_("span",Fe,R(a.unit),1)):h("",!0)])),a.picnic?(f(),_("div",Me,[y("div",$e,[n(ne,{icon:"mdi-arrow-right"}),e[11]||(e[11]=P()),a.amount?(f(),_("span",Qe,R(a.amount),1)):h("",!0),e[12]||(e[12]=P()),a.unit?(f(),_("span",Ke,R(a.unit),1)):h("",!0),P(" "+R(a.name),1)]),a.picnic?(f(),_("div",Oe,[a.loading?(f(),Z(de,{key:0,indeterminate:""})):h("",!0),n(te,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":L=>a.selectedPicnicProduktId=L,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":"",disabled:a.loading},{item:u(({props:L,item:V})=>[n(pe,xe({ref_for:!0},L),{default:u(()=>[y("h4",null,[V.raw.multiplier&&V.raw.multiplier>1?(f(),_("span",Ze,R(V.raw.multiplier)+"x ",1)):h("",!0),V.raw.unitQuantity&&V.raw.unitQuantity!=="undefined"?(f(),_("span",He,R(V.raw.unitQuantity),1)):h("",!0)]),y("h5",null,R(z(Ce).methods.formatCurrency(V.raw.price/100)),1),n(x,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${V.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])])):h("",!0)])):h("",!0)],8,ze),a.picnic?h("",!0):(f(),_("td",qe,R(a.name),1)),y("td",Ge,[n(me,{class:"px-0 mx-0",style:{width:"180px"}},{default:u(()=>[n(H,{cols:"3"},{default:u(()=>[y("div",Je,[n(i,{variant:"flat",style:G({opacity:a.bring?1:.3}),onClick:L=>Q("bring",a),class:"mx-0"},{default:u(()=>[n(x,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),z(k)?h("",!0):(f(),Z(H,{key:0,cols:"3"},{default:u(()=>[y("div",We,[n(i,{variant:"plain",style:G({opacity:a.picnic?1:.3}),disabled:!U.value||A.value,onClick:L=>Q("picnic",a)},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),n(H,{cols:"4"},{default:u(()=>[y("div",Xe,[n(i,{variant:"plain",style:G({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!U.value||A.value,onClick:L=>Q(null,a)},{default:u(()=>[n(ne,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):h("",!0),y("div",Ye,[z(k)?h("",!0):(f(),_("div",et,[n(i,{variant:"outlined",rounded:"",onClick:re,"prepend-icon":A.value?"mdi-check":null,disabled:!U.value||A.value||!E.value},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=P(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),y("div",tt,[n(i,{link:"",variant:"outlined",rounded:"",href:T.value,disabled:T.value===null||!D.value,target:"_blank",class:"ml-2"},{default:u(()=>[n(x,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=P(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),n(De,{onResult:e[5]||(e[5]=a=>$.value=a),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},st=ae(nt,[["__scopeId","data-v-49f9c07d"]]);export{De as C,st as I,O as R,K as a};
