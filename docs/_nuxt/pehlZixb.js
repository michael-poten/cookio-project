import{_ as le,L as re,a0 as se,O as oe,K as de,N as ue,u as pe,P as K,r as x,o as M,X as ve,g as o,x as ce,y as g,Q as _,R as y,B as n,C as i,z as m,D as f,U as b,V as fe,J as me}from"./ntN661C_.js";import"./D2GdI7kA.js";import{R as v,C as ge,I as O}from"./DKS8wWy5.js";import{G as S}from"./CI608YEO.js";import{R as xe}from"./B8Mis72X.js";import"./BiyY3GZt.js";const _e={class:"mt-2"},we={class:"overlay-bottom-right"},ye={class:"text-center",style:{"margin-top":"40px"}},Ie={class:"text-medium-emphasis mt-6"},be={__name:"MealEditor",setup(j){re.extend(se),oe();const R=de(),{authInfo:s,githubMode:I,lanAddress:T}=ue(R),w=pe(),h=K();let r=h.query.id;const d=x(!1),t=x(null);x(2);const U=x(1);x(null);const z=x(null),B=x(null);x(!1),M(async()=>{t.value=null,await R.getAuthInfo(),await k()}),ve(()=>h.query.id,(a,e)=>{r=a,k()});async function q(){await O.analyzeDraft(s.value.userId,t.value.id),w.push("/recipes")}async function A(){B.value().then(async a=>{if(a){if(await v.deleteRecipe(s.value.userId,t.value.id),!t.value.isNew){const e={id:r,draftId:null};await v.updateRecipe(s.value.userId,r,e)}w.push("/recipes")}})}function J(){z.value({id:r,sectionsUploaded:!0}).then(async a=>{a&&U.value++})}async function F(){let a=await v.getRecipe(s.value.userId,r),e=await E(a,t.value.id);t.value.draftIngredients=e.draftIngredients,t.value.draftSections=e.draftSections,t.value.title=a.title,t.value.preheat=a.preheat,await v.updateRecipe(s.value.userId,t.value.id,t.value),await k()}async function G(){d.value=!0,await O.creationWithTitleForDraft(s.value.userId,t.value.id),d.value=!1,await k()}function W(){return I.value?"https://mmhhhh.de/data/home/recipes/"+r+"/image.jpg?key="+U.value:T.value+"api/"+s.value.userId+"/recipes/"+r+"/image?key="+U.value}function L(){I.value?window.open("https://mmhhhh.de/recipes/go?id="+r,"_blank","noopener"):window.open("/recipes/go?id="+r,"_blank","noopener")}async function k(){if(r==="new"){let a={title:"Neues Rezept",preheat:"",ingredients:[],sections:[],draftIngredients:"",draftSections:"",tags:[],duration:30,portions:2,isNew:!0};a.id=Z(),r=a.id,await v.updateRecipe(s.value.userId,a.id,a),t.value=a}else{let a=await v.getRecipe(s.value.userId,r);if(!a){w.push("/recipes");return}if(d.value=a.draftInProgress,a.isNew)t.value=a;else if(a.originalId){let e=await v.getRecipe(s.value.userId,r);if(!e){w.push("/recipes");return}r=a.originalId,t.value=e;let p=await v.getRecipe(s.value.userId,a.originalId);d.value=p.draftInProgress}else if(a.draftId)try{t.value=await v.getRecipe(s.value.userId,a.draftId)}catch{const p={id:r,draftId:null};await v.updateRecipe(s.value.userId,r,p),w.push("/recipes");return}else{let e=JSON.parse(JSON.stringify(a));e.id=Z(),e.originalId=r;let p=await E(a);e.draftIngredients=p.draftIngredients,e.draftSections=p.draftSections,await v.updateRecipe(s.value.userId,e.id,e);const c={id:r,draftId:e.id};await v.updateRecipe(s.value.userId,r,c),t.value=e}}}async function E(a){let e="";a.ingredients&&a.ingredients.forEach(u=>e+=(u.amount?u.amount+" "+(u.unit?u.unit+" ":""):"")+u.name+`
`);let p="";const c=a.sections;for(let u=0;u<c.length;u++)p=p+(u+1)+" "+c[u].sectionTitle+`

`+c[u].description+`


`;return{draftIngredients:e,draftSections:p}}async function D(){await v.updateRecipe(s.value.userId,t.value.id,t.value)}function P(){w.push("/recipes")}function Z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const e=Math.random()*16|0;return(a==="x"?e:e&3|8).toString(16)})}return(a,e)=>{const p=o("v-alert"),c=o("v-btn"),u=o("v-col"),C=o("v-list-item-title"),N=o("v-list-item"),Q=o("v-list"),X=o("v-menu"),H=o("v-row"),Y=o("v-img"),V=o("v-textarea"),ee=o("v-select"),te=o("v-card-title"),ae=o("v-card-text"),ne=o("v-card"),$=o("v-container"),ie=o("v-divider");return g(),ce("div",null,[t.value?(g(),_($,{key:0,class:"pt-0"},{default:i(()=>[d.value?(g(),_(p,{key:0,type:"warning",color:"rgb(169, 209, 141)"},{default:i(()=>[...e[12]||(e[12]=[f("Es finden gerade Berechnungen statt. Derzeit kann der Entwurf nicht bearbeitet werden!",-1)])]),_:1})):y("",!0),n(H,{class:"my-2"},{default:i(()=>[n(u,null,{default:i(()=>[n(c,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:P},{default:i(()=>[...e[13]||(e[13]=[f("Zurück",-1)])]),_:1})]),_:1}),n(u,{class:"text-right"},{default:i(()=>[b(I)?y("",!0):(g(),_(c,{key:0,"prepend-icon":"mdi-delete-outline",elevation:"2",onClick:A,disabled:d.value},{default:i(()=>[...e[14]||(e[14]=[f("Verwerfen",-1)])]),_:1},8,["disabled"])),b(I)?y("",!0):(g(),_(c,{key:1,color:"rgb(124, 174, 120)","prepend-icon":"mdi-content-save-cog-outline",onClick:q,disabled:d.value,class:"ml-2"},{default:i(()=>[...e[15]||(e[15]=[f("Übernehmen",-1)])]),_:1},8,["disabled"])),n(X,null,{activator:i(({props:l})=>[n(c,fe({icon:"mdi-dots-vertical",variant:"text"},l),null,16)]),default:i(()=>[n(Q,null,{default:i(()=>[n(N,{onClick:G,disabled:d.value},{default:i(()=>[n(C,null,{default:i(()=>[...e[16]||(e[16]=[f("Aus Titel ein Rezept generieren",-1)])]),_:1})]),_:1},8,["disabled"]),t.value.isNew?y("",!0):(g(),_(N,{key:0,onClick:F,disabled:d.value},{default:i(()=>[n(C,null,{default:i(()=>[...e[17]||(e[17]=[f("Zurücksetzen auf Original",-1)])]),_:1})]),_:1},8,["disabled"])),t.value.isNew?y("",!0):(g(),_(N,{key:1,onClick:L},{default:i(()=>[n(C,null,{default:i(()=>[...e[18]||(e[18]=[f("Original öffnen",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),m("div",_e,[!t.value.imageInProgress&&t.value.imageUploaded?(g(),_(Y,{key:0,height:"200",src:W(),color:"grey",cover:""},{default:i(()=>[m("div",we,[n(c,{icon:"mdi-pencil",color:"rgb(89, 135, 184)",onClick:e[0]||(e[0]=l=>J(t.value)),disabled:d.value},null,8,["disabled"]),e[19]||(e[19]=f("/ ",-1))])]),_:1},8,["src"])):y("",!0),m("div",null,[n(V,{rows:"1","auto-grow":"",modelValue:t.value.title,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.title=l),variant:"plain",class:"title-text-field","hide-details":"",placeholder:"Titel",onKeyup:e[2]||(e[2]=l=>b(S).debounceTime("recipeUpdated",D,300)),disabled:d.value},null,8,["modelValue","disabled"])])]),m("div",null,[m("div",null,[n(V,{rows:"1","auto-grow":"",modelValue:t.value.preheat,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.preheat=l),variant:"plain",class:"preheat-text-field",disabled:d.value},{prepend:i(()=>[...e[20]||(e[20]=[m("span",{style:{"font-style":"italic"}},"Vorbereitung:",-1)])]),_:1},8,["modelValue","disabled"])]),n($,null,{default:i(()=>[n(ne,{variant:"outlined"},{default:i(()=>[n(te,null,{default:i(()=>[e[21]||(e[21]=m("span",{class:"text-decoration-underline"},"Zutatenliste",-1)),e[22]||(e[22]=f(" für ",-1)),n(ee,{style:{display:"inline-block","vertical-align":"middle"},modelValue:t.value.portions,"onUpdate:modelValue":[e[4]||(e[4]=l=>t.value.portions=l),e[5]||(e[5]=l=>b(S).debounceTime("recipeUpdated",D,300))],"hide-details":"",variant:"solo",rounded:"",disabled:d.value,items:["1","2","3","4","5","6","7","8","9","10"]},null,8,["modelValue","disabled"]),e[23]||(e[23]=f(" Portionen ",-1))]),_:1}),n(ae,null,{default:i(()=>[n(V,{rows:"1","auto-grow":"",modelValue:t.value.draftIngredients,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.draftIngredients=l),variant:"plain",class:"ingredients-text-field","hide-details":"",placeholder:"Bitte hier die Zutaten eintragen",onKeyup:e[7]||(e[7]=l=>b(S).debounceTime("recipeUpdated",D,300)),disabled:d.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),n(ie,{class:"my-2",opacity:"0.8"},{default:i(()=>[...e[24]||(e[24]=[f("Zubereitung",-1)])]),_:1}),n(V,{modelValue:t.value.draftSections,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.draftSections=l),variant:"plain","auto-grow":"",placeholder:"Zubereitung",rows:"1",onKeyup:e[9]||(e[9]=l=>b(S).debounceTime("recipeUpdated",D,300)),disabled:d.value},null,8,["modelValue","disabled"])]),m("div",ye,[m("div",Ie,[n(c,{variant:"text","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:P},{default:i(()=>[...e[25]||(e[25]=[f("Zurück zur Übersicht",-1)])]),_:1})])]),e[26]||(e[26]=m("div",{style:{height:"600px"}},null,-1))]),_:1})):y("",!0),n(xe,{onResult:e[10]||(e[10]=l=>z.value=l)}),n(ge,{onResult:e[11]||(e[11]=l=>B.value=l),title:"Bitte bestätigen",message:"Soll der Entwurf wirklich gelöscht werden?"})])}}},Re=le(be,[["__scopeId","data-v-23054511"]]),Ne={__name:"index",setup(j){const R=K(),s=me(),I=R.query.id;return M(async()=>{I||s.push("/recipes")}),(T,w)=>(g(),_(Re))}};export{Ne as default};
