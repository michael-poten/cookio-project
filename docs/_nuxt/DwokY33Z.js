import{K as _,$ as r,a6 as $,M as ue,L as de,u as pe,N as me,r as f,o as ve,g as h,O as z,y as p,C as u,B as o,a7 as fe,Q as R,z as d,D as k,A as P,P as g,x as w,R as he,S as ge,T as _e,a8 as Q}from"./7vDRmOQw.js";import{_ as ye}from"./DlAUqK2U.js";const q={getRecipe:async function(i,s){const n=_();try{if(n.isNetworkAccess){let t=n.lanAddress+"api/"+i+"/recipes/"+s;return(await r.get(t)).data}else return(await r.get("https://mmhhhh.de/data/home/recipes.json")).data[s]}catch(t){r.catchError(t)}},getRecipeIngredients:async function(i,s){const n=_();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+i+"/recipes/"+s+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+s+"/ingredients.json",await r.get(t)}catch(t){r.catchError(t)}},getRecipeSections:async function(i,s){const n=_();try{let t;return n.isNetworkAccess?t=n.lanAddress+"api/"+i+"/recipes/"+s+"/sections":t="https://mmhhhh.de/data/home/recipes/"+s+"/sections.json",await r.get(t)}catch(t){r.catchError(t)}},updateRecipe:async function(i,s,n){const t=_();try{return await r.put(t.lanAddress+"api/"+i+"/recipes/"+s,n)}catch(l){r.catchError(l)}},deleteRecipe:async function(i,s){const n=_();try{return await r.post(n.lanAddress+"api/"+i+"/recipes/"+s+"/delete")}catch(t){r.catchError(t)}}},T={convertToBringUrl:function(i){let s=[];for(const I of i){const x=[];x.push(I.name),I.amount&&I.amount!==0&&x.push(I.amount+(I.unit?" "+I.unit:"")),s.push(x.join("__"))}const n=s.join("---"),t=btoa(unescape(encodeURIComponent(n)));let S="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return S=encodeURIComponent(S),console.log("jsonServerUrl:",S),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+S+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeIngredients:async function(i,s,n){const t=_();try{const l=new FormData;return l.append("image",n),await $.post(t.lanAddress+"api/"+i+"/recipes/"+s+"/import/image/ingredients",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){r.catchError(l)}},analyzeSections:async function(i,s,n){const t=_();try{const l=new FormData;return l.append("image",n),await $.post(t.lanAddress+"api/"+i+"/recipes/"+s+"/import/image/sections",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){r.catchError(l)}},uploadImage:async function(i,s,n){const t=_();try{const l=new FormData;return l.append("image",n),await $.post(t.lanAddress+"api/"+i+"/recipes/"+s+"/import/image",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){r.catchError(l)}},generateImage:async function(i,s){const n=_();try{return await r.post(n.lanAddress+"api/"+i+"/recipes/"+s+"/import/generateImage")}catch(t){r.catchError(t)}},loginPicnic:async function(i,s){const n=_();try{return await r.post(n.lanAddress+"api/"+i+"/loginPicnic",s)}catch(t){r.catchError(t)}},searchPicnic:async function(i,s){const n=_();try{return await r.post(n.lanAddress+"api/"+i+"/picnic/search",{query:s})}catch(t){r.catchError(t)}},addProductToPicnicShoppingCart:async function(i,s){const n=_();try{return await r.post(n.lanAddress+"api/"+i+"/picnic/addProductToShoppingCart",{productId:s})}catch(t){r.catchError(t)}}},we={methods:{formatCurrency(i){return"€ "+(""+(Math.round(i*100)/100).toFixed(2)).replace(".",",")}}},be={class:"d-flex justify-space-between align-center"},ke={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Pe={class:"text-h6 text-medium-emphasis"},Se={class:"mt-2 px-2"},Ie={key:0},xe={class:"text-right mt-3"},Re=["colspan"],Ce={key:0,class:"pl-6"},Ae={key:0},Ue={key:1},Ve={key:1,class:"py-2"},De={style:{"font-size":"0.8em"}},Ee={key:0},Te={key:1},Be={key:0},Ne={key:0,class:"px-0 mx-0"},je={style:{"max-width":"200px"}},ze={class:"my-2"},Le={class:"my-2"},Fe={class:"my-2"},Me={class:"text-right"},$e={key:0,class:"mt-3"},Qe={class:"mt-2"},qe={__name:"IngredientsDialog",emits:["result"],setup(i,{emit:s}){const n=ue(),t=_(),{authInfo:l,githubMode:S}=de(t),I=s;pe(),me();const x=f(!1),O=f(null),te=f(null),B=f(null),b=f(null),m=f(null),N=f(null),j=f(2),A=f(!1),U=f(!1),V=f(!1),D=f(!1),E=f({name:null,password:null});ve(async()=>{I("result",async v=>(B.value=v,N.value=null,b.value=null,m.value=null,j.value=2,Z(),await ae(),x.value=!0,new Promise((e,c)=>{O.value=e,te.value=c})))});async function Z(){let v=await t.getAuthInfo();A.value=v.picnicLoggedIn}async function ae(){b.value=await q.getRecipe(l.value.userId,B.value),b.value.ingredients=(await q.getRecipeIngredients(l.value.userId,B.value)).data,G()}async function se(){await T.loginPicnic(l.value.userId,E.value),await Z()}function ne(){x.value=!1,O.value(!1)}async function K(){let v=m.value.filter(e=>e.bring);N.value=T.convertToBringUrl(v)}async function oe(){let v=m.value.filter(y=>y.picnic);for(const y of v)y.selectedPicnicProduktId&&await T.addProductToPicnicShoppingCart(l.value.userId,y.selectedPicnicProduktId);U.value=!0;const c={picnicPurchaseDate:new Date().toISOString()};await q.updateRecipe(l.value.userId,B,c)}function G(){let v=b.value.portions?b.value.portions:2;m.value=[],b.value.ingredients.forEach(e=>{m.value.push({name:e.name,basicName:e.basicName,unit:e.unit,amount:e.amount/v*j.value})}),K()}async function L(v,e){v==="bring"?(e.bring=!0,e.picnic=!1,V.value=m.value.filter(c=>!!c.picnic).length>0,D.value=m.value.filter(c=>!!c.bring).length>0):v==="picnic"?(e.bring=!1,e.picnic=!0,e.picnicResults=(await T.searchPicnic(l.value.userId,e.basicName+" bio")).data,e.picnicResults&&e.picnicResults.length>0?(e.selectedPicnicProduktId=e.picnicResults[0].id,V.value=m.value.filter(c=>!!c.picnic).length>0,D.value=m.value.filter(c=>!!c.bring).length>0):(e.picnicResults=(await T.searchPicnic(l.value.userId,e.basicName)).data,e.picnicResults&&e.picnicResults.length>0&&(e.selectedPicnicProduktId=e.picnicResults[0].id,V.value=m.value.filter(c=>!!c.picnic).length>0,D.value=m.value.filter(c=>!!c.bring).length>0))):(e.bring=!1,e.picnic=!1,V.value=m.value.filter(c=>!!c.picnic).length>0,D.value=m.value.filter(c=>!!c.bring).length>0),K()}return(v,e)=>{const c=h("v-btn"),y=h("v-img"),H=h("v-card-title"),J=h("v-text-field"),W=h("v-card-text"),X=h("v-card"),Y=h("v-select"),ee=h("v-icon"),ie=h("v-list-item"),F=h("v-col"),le=h("v-row"),ce=h("v-table"),re=h("v-dialog");return p(),z(re,{"max-width":"600",modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),fullscreen:R(n).smAndDown.value},{default:u(()=>[o(X,{style:{"background-color":"white"},class:fe({"pa-4":!R(n).smAndDown.value})},{default:u(()=>[o(H,{style:{"white-space":"normal"}},{default:u(()=>[d("div",be,[d("div",ke,[e[4]||(e[4]=k(" Zutaten einkaufen ")),d("div",Pe,P(b.value.title),1)]),o(c,{icon:"mdi-close",variant:"text",onClick:ne})]),d("div",Se,[!b.value.imageInProgress&&b.value.imageUploaded?(p(),z(y,{key:0,height:"200",src:"/api/"+R(l).userId+"/recipes/"+b.value.id+"/image",color:"grey",cover:""},null,8,["src"])):g("",!0)])]),_:1}),o(W,null,{default:u(()=>[b.value?(p(),w("div",Ie,[!A.value&&!R(S)?(p(),z(X,{key:0},{default:u(()=>[o(H,null,{default:u(()=>[o(y,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[5]||(e[5]=k(" Bei Picnic einloggen "))]),_:1,__:[5]}),o(W,null,{default:u(()=>[o(J,{modelValue:E.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>E.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),o(J,{modelValue:E.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),d("div",xe,[o(c,{variant:"outlined",onClick:se},{default:u(()=>e[6]||(e[6]=[k("Einloggen")])),_:1,__:[6]})])]),_:1})]),_:1})):g("",!0),e[10]||(e[10]=d("h3",{class:"mt-4"},"Anzahl Portionen",-1)),o(Y,{modelValue:j.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>j.value=a),G],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[11]||(e[11]=d("h3",null,"Zutatenliste",-1)),o(ce,{class:"table-ingredients"},{default:u(()=>[d("tbody",null,[(p(!0),w(he,null,ge(m.value,a=>(p(),w("tr",{key:a.name},[d("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?g("",!0):(p(),w("div",Ce,[a.amount?(p(),w("span",Ae,P(a.amount),1)):g("",!0),e[7]||(e[7]=k()),a.unit?(p(),w("span",Ue,P(a.unit),1)):g("",!0)])),a.picnic?(p(),w("div",Ve,[d("div",De,[o(ee,{icon:"mdi-arrow-right"}),e[8]||(e[8]=k()),a.amount?(p(),w("span",Ee,P(a.amount),1)):g("",!0),e[9]||(e[9]=k()),a.unit?(p(),w("span",Te,P(a.unit),1)):g("",!0),k(" "+P(a.name),1)]),a.picnic?(p(),w("div",Be,[o(Y,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":C=>a.selectedPicnicProduktId=C,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":""},{item:u(({props:C,item:M})=>[o(ie,_e({ref_for:!0},C),{default:u(()=>[d("h4",null,P(M.raw.unit_quantity),1),d("h5",null,P(R(we).methods.formatCurrency(M.raw.display_price/100)),1),o(y,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${M.raw.image_id}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items"])])):g("",!0)])):g("",!0)],8,Re),a.picnic?g("",!0):(p(),w("td",Ne,P(a.name),1)),d("td",je,[o(le,{class:"px-0 mx-0",style:{width:"180px"}},{default:u(()=>[o(F,{cols:"3"},{default:u(()=>[d("div",ze,[o(c,{variant:"flat",style:Q({opacity:a.bring?1:.3}),onClick:C=>L("bring",a),class:"mx-0"},{default:u(()=>[o(y,{src:"/images/bring.png",width:"32",contain:""})]),_:2},1032,["style","onClick"])])]),_:2},1024),R(S)?g("",!0):(p(),z(F,{key:0,cols:"3"},{default:u(()=>[d("div",Le,[o(c,{variant:"plain",style:Q({opacity:a.picnic?1:.3}),disabled:!A.value||U.value,onClick:C=>L("picnic",a)},{default:u(()=>[o(y,{src:"/images/picnic.png",width:"32",contain:""})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024)),o(F,{cols:"4"},{default:u(()=>[d("div",Fe,[o(c,{variant:"plain",style:Q({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!A.value||U.value,onClick:C=>L(null,a)},{default:u(()=>[o(ee,{icon:"mdi-selection-remove",size:"34"})]),_:2},1032,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):g("",!0),d("div",Me,[R(S)?g("",!0):(p(),w("div",$e,[o(c,{variant:"outlined",rounded:"",onClick:oe,"prepend-icon":U.value?"mdi-check":null,disabled:!A.value||U.value||!V.value},{default:u(()=>[o(y,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[12]||(e[12]=k(" In Picnic importieren "))]),_:1,__:[12]},8,["prepend-icon","disabled"])])),d("div",Qe,[o(c,{link:"",variant:"outlined",rounded:"",href:N.value,disabled:N.value===null||!D.value,target:"_blank",class:"ml-2"},{default:u(()=>[o(y,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[13]||(e[13]=k(" In Bring importieren "))]),_:1,__:[13]},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"])}}},Ke=ye(qe,[["__scopeId","data-v-4ada0818"]]);export{Ke as I,q as R,T as a};
