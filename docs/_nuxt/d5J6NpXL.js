import{a0 as We,M as be,K as xe,r as k,u as we,N as le,o as re,g,O,y as l,C as a,B as s,z as i,x as m,R as J,S as q,A as R,D as x,a1 as he,a2 as Ze,L as Je,a3 as qe,V as Ge,k as ie,P as b,Q as F,a4 as He,a5 as Ke,J as Qe}from"./gNNyPR7M.js";import{R as Z,I as Xe}from"./Bn-rIWDk.js";import{_ as Se}from"./DlAUqK2U.js";const Ye=We("/images/bellring.png"),et={class:"mt-3"},tt={__name:"TimerDialog",emits:["result"],setup(M,{emit:N}){be();const w=xe();k(w.authInfo);const E=N;we(),le().params.userId;const W=k(!1),se=k(null),C=k(null),d=k([]);re(async()=>{E("result",async G=>(d.value=G,W.value=!0,new Promise((p,H)=>{se.value=p,C.value=H})))});function V(){W.value=!1,se.value(!1)}return(G,p)=>{const H=g("v-card-title"),Q=g("v-divider"),U=g("v-card-text"),Y=g("v-btn"),ee=g("v-card-actions"),X=g("v-card"),S=g("v-dialog");return l(),O(S,{"max-width":"600",persistent:"",modelValue:W.value,"onUpdate:modelValue":p[0]||(p[0]=$=>W.value=$)},{default:a(()=>[s(X,{style:{"background-color":"#fcfaf7"},class:"pa-4"},{default:a(()=>[s(H,null,{default:a(()=>[...p[1]||(p[1]=[i("h2",null,"Zeit abgelaufen!",-1)])]),_:1}),s(U,null,{default:a(()=>[p[3]||(p[3]=i("div",{style:{width:"100%"},class:"text-center"},[i("div",{class:"vibrate"},[i("img",{alt:"bellring",src:Ye,style:{width:"300px",height:"300px"},class:"mt-2"})])],-1)),s(Q),i("div",et,[p[2]||(p[2]=i("h3",null,"Folgende Timer sind abgelaufen:",-1)),(l(!0),m(J,null,q(d.value,$=>(l(),m("div",{key:$.id,style:{"font-size":"1.6em"}}," - "+R($.title),1))),128))])]),_:1}),s(ee,null,{default:a(()=>[s(Y,{onClick:V,style:{width:"100%"},rounded:"",size:"50",variant:"outlined"},{default:a(()=>[...p[4]||(p[4]=[x(" Schließen ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},nt=Se(tt,[["__scopeId","data-v-dbd91138"]]),ke={},ae={},st={debounceTime(M,N,w){clearTimeout(ke[M]),ke[M]=setTimeout(()=>{N.apply(this)},w)},reduceExecutions(M,N,w){ae[M]||(ae[M]=!0,setTimeout(()=>{ae[M]=!1},w),N.apply(this))}},ot={class:"mt-2"},it={class:"mb-1 mt-2"},at={class:"text-medium-emphasis"},lt={class:"mt-2"},rt={class:"text-h4 text-medium-emphasis mt-4"},ut={key:0,class:"mt-6"},ct=["href"],dt=["id"],mt=["innerHTML"],pt={key:1,class:"mt-6"},vt={key:0,class:"mb-4"},ft={key:1},gt={style:{"font-size":"0.9em"}},_t={class:"mt-4"},ht={class:"text-center",style:{"margin-top":"40px"}},kt={key:0},yt={class:"text-center mt-2"},bt={class:"text-medium-emphasis mt-6"},xt={key:1,class:"custom-bottom-sheet no-print"},wt={class:"sheet-content",style:{"background-color":"rgb(226, 226, 226)"}},St={key:0,class:"sheet-ingredients"},It={key:0},Ct={key:1},Tt={style:{"background-color":"rgb(203, 203, 204)",display:"flex"}},Rt={class:"ml-2",style:{width:"100px","flex-shrink":"0"}},zt={class:"mx-2",style:{flex:"1"}},Pt={key:0},Dt={style:{"font-size":"1.7em","border-radius":"6px","background-color":"#ffffff",color:"#3d3d3d"},class:"px-2"},Nt={key:0},Vt={key:1},ye="*",At={__name:"MealMaker",setup(M){he.extend(Ze),be();const N=xe(),{authInfo:w,githubMode:E,lanAddress:ne}=Je(N),W=we(),C=le().query.id,d=k(null),V=k(null),G=k(2),p=k([]),H=k(null),Q=k(!1),U=k(!1),Y=k(null),ee=k(null),X=k([]),S=k([]),$=k(!1),ue=k([]),j=k(-1),ce=k([]);re(async()=>{d.value=null,V.value=null,await N.getAuthInfo(),await fe(),await B(!0),d.value.planned&&(H.value=setTimeout(async()=>{const e={cooked:!0};await Z.updateRecipe(w.value.userId,C,e)},5*6e4));const t=localStorage.getItem("timers-"+C);if(t)try{const e=JSON.parse(t);e.forEach(u=>{u.isPaused=!0}),p.value=e.map(u=>({...u,timeoutId:null}))}catch(e){console.error("Timer konnte nicht geladen werden:",e)}}),qe(()=>{p.value.forEach(t=>clearTimeout(t.timeoutId)),clearTimeout(H.value)}),Ge(p,t=>{const e=t.map(({timeoutId:u,...r})=>r);localStorage.setItem("timers-"+C,JSON.stringify(e))},{deep:!0}),window.addEventListener("message",t=>{var u;const e=t.data;!e||typeof e!="object"||(e.type==="speech-commands:ready"&&console.log(`iFrame bereit (${((u=e.vocab)==null?void 0:u.length)||0} Wörter)`),e.type==="speech-commands:result"&&st.reduceExecutions("speech-commands",()=>{const r=e.scores.find(v=>v.label==="one");r&&r.score===1&&(ve(),console.log(`Result: ${e.top.label} (${e.top.score})`),console.log("Result JSON",e))},1e3))});const Ie=ie(()=>!S||S.value.length===0?0:S.value.filter(t=>!t.ingredient&&t.duration).reduce((t,e)=>t+e.duration,0)),de=ie(()=>!S||S.value.length===0?[]:S.value.filter(t=>!!t.ingredient)),Ce=ie(()=>!S||S.value.length===0?[]:S.value.filter(t=>!t.ingredient));function Te(){const t=[];d.value.ingredients.forEach(e=>{if(e.preparationRequired){let u=e.preparationLongText;const r=V.value.find(v=>e.name===v.name);if(r){let v="";v=r.amount?r.amount+(r.unit?" "+r.unit:"")+" ":"",u=u.replace(e.basicName,v+" "+e.basicName)}t.push({name:u,ingredient:!0})}}),d.value.sections.forEach(e=>{e.ingredientsPreparations&&e.ingredientsPreparations.length>0&&e.ingredientsPreparations.forEach(u=>{let r=[],v=u.instruction;for(let f=0;f<e.usedIngredients.length;f++){let _=e.usedIngredients[f];const h=V.value.find(A=>A.name===_.ingredientNameList);let y="";h&&!r.includes(h.name)&&(y=h.amount?h.amount+(h.unit?" "+h.unit:"")+" ":"",r.push(h.name),v=v.replace(_.ingredientNameText,y+" "+_.ingredientNameText))}t.push({name:v,originalName:u.instruction,sectionIndex:e.index-1,duration:u.duration})})}),S.value=t}function Re(){j.value=-1,B()}function ze(t){return E.value?"https://mmhhhh.de/data/home/recipes/"+t.id+"/image.jpg":ne.value+"api/"+w.value.userId+"/recipes/"+t.id+"/image"}function me(){window.close()}async function Pe(){const t={preparations:[]};await Z.updateRecipe(w.value.userId,C,t),await fe(),await B(!0)}function De(t){_e(t),B(!0)}async function Ne(t){const e={rating:t};await Z.updateRecipe(w.value.userId,C,e),await B()}async function pe(){if(!E.value){const t={preparations:S.value};await Z.updateRecipe(w.value.userId,C,t),await B()}}function ve(){j.value++,B()}async function fe(){d.value=await Z.getRecipe(w.value.userId,C),d.value.ingredients=(await Z.getRecipeIngredients(w.value.userId,C)).data,d.value.sections=(await Z.getRecipeSections(w.value.userId,C)).data}async function B(t=!1){let e=JSON.parse(JSON.stringify(d.value.sections));_e(),t&&(d.value.preparations&&d.value.preparations.length>0?S.value=d.value.preparations:Te()),ue.value=[];let u=-1;const r=[];let v=null;for(let f=0;f<e.length;f++){let _=e[f],h=_.description,y="",A=Oe(h);const z=u+A.length;if(A.forEach((o,I)=>{u++,ue.value.push(o);const c=S.value.find(P=>P.checked&&f===P.sectionIndex&&P.originalName===o);j.value>z||j.value>=u?y=y+'<span style="color: #9a9a9a;">'+o+" </span>":j.value+1===u?c?(y=y+'<span style="color: #9a9a9a;">'+o+" </span>",j.value++):y=y+'▶ <span style="background-color: #bfe7d2; padding-top: 4px; padding-bottom: 4px">'+o+" </span> ":y=y+o+" "}),h=y,j.value+1>z&&e.length>f+1&&(v=e[f+1].index),_.timer&&_.timer.length>0)for(let o=0;o<_.timer.length;o++){let I=_.timer[o];h=h.replace(I.descriptionText,'<span class="pa-1 stopwatch-button" style="cursor: pointer; background-color: rgba(187,187,187,0.66); border: rgba(41,56,80,0.49) solid 3px; border-radius: 20px; color: #545454; font-size: 0.9em" data-id="'+o+'" data-sectionid="'+f+'"> ⏱ '+I.descriptionText+"</span >")}U.value||_.ingredientsPreparations.forEach(o=>{S.value.find(c=>c.checked&&f===c.sectionIndex&&c.originalName===o.instruction)&&(h=h.replace(o.instruction,'<span style="text-decoration-line: line-through;text-decoration-style: solid;text-decoration-thickness: 2px;text-underline-offset: 4px;">'+o.instruction+"</span>"))}),_.usedIngredients.forEach(o=>{const I=V.value.find(P=>P.name===o.ingredientNameList);let c="";I&&!r.includes(I.name)&&(c=I.amount?I.amount+(I.unit?" "+I.unit:"")+" ":"",r.push(I.name)),h=h.replace(o.ingredientNameText,"<b>"+c+o.ingredientNameText+"</b>")}),_.description=h}ce.value=e,await W.push("/recipes/go?id="+C+"#section-"+(v||1)),document.title=d.value.title+" - Cookio"}function Ve(){document.getElementById("scFrame").contentWindow.postMessage({type:"speech-commands:control",action:"start"},ye),$.value=!0}function Ae(){document.getElementById("scFrame").contentWindow.postMessage({type:"speech-commands:control",action:"stop"},ye),$.value=!1}function Me(t){Y.value(t)}function ge(){U.value=!U.value,B()}function _e(t){t&&(G.value=t);let e=d.value.portions?d.value.portions:2;V.value=[],d.value.ingredients.forEach(u=>{V.value.push({name:u.name,unit:u.unit,amount:Math.ceil(u.amount/e*G.value)})})}function $e(t){const e=t.target.closest(".stopwatch-button");if(e){const u=e.dataset.id,r=e.dataset.sectionid,v=parseInt(u,10),f=parseInt(r,10),_=d.value.sections[f].timer[v];p.value.push({id:f+"-"+v,title:_.title,remainingSeconds:_.duration*60,timerStarted:!1,isPaused:!1,timeoutId:null})}}const Le=t=>{const e=he.duration(t*1e3),u=String(e.minutes()).padStart(2,"0"),r=String(e.seconds()).padStart(2,"0");return`${u}:${r}`};function Ee(t){p.value=p.value.filter(e=>e.id!==t)}const oe=t=>{t.isPaused||t.remainingSeconds<=0||p.value.find(e=>e.id===t.id)&&(console.log("tick",t.id),t.remainingSeconds--,t.remainingSeconds<=0&&(X.value.push(t),ee.value(X.value).then(()=>{X.value=[],p.value=p.value.filter(e=>e.remainingSeconds>0)})),t.remainingSeconds>0?t.timeoutId=setTimeout(()=>oe(t),1e3):t.timeoutId=null)},Ue=t=>{clearTimeout(t.timeoutId),t.timerStarted=!0,t.isPaused=!1,t.timeoutId=setTimeout(()=>oe(t),1e3)},je=t=>{t.isPaused=!t.isPaused,!t.isPaused&&t.remainingSeconds>0&&(t.timeoutId=setTimeout(()=>oe(t),1e3))},Be=t=>{t.remainingSeconds=t.remainingSeconds+60},Fe=t=>{const e=t.remainingSeconds-60;t.remainingSeconds=Math.max(e,0)};function Oe(t,e=[]){const u=["ca.","etc.","ggf.","bspw.","bzw.","vgl.","Dr.","Prof.","Nr.","Stk.","Abs.","Art.","Sek.","Std.","Min.","z. B.","u. a.","i. d. R.","z. T.","sog."],r=c=>c.toLowerCase().replace(/[.\s]/g,""),v=new Set([...u,...e].map(r)),f=c=>c>="0"&&c<="9",_=c=>/\s/.test(c),h=c=>/[)"'\]\}»”]/.test(c),y=t.length,A=[];let z="",o=0;function I(c){const P=Math.max(0,c-15),K=r(t.slice(P,c));for(const D of v)if(K.endsWith(D))return!0;if(t[c]==="."){let D=c+1;for(;D<y&&_(t[D]);)D++;if(D+1<y&&/[A-Za-zÄÖÜäöü]/.test(t[D])&&t[D+1]===".")return!0}return!1}for(;o<y;){const c=t[o];if(z+=c,c==="."||c==="!"||c==="?"){const P=t[o-1]||"",K=t[o+1]||"";if(!(c==="."&&f(P)&&f(K))&&!I(o)){let T=o+1;for(;T<y&&(h(t[T])||t[T]==="*");)z+=t[T],T++;const te=z.trim();for(te&&A.push(te),z="";T<y&&_(t[T]);)T++;o=T;continue}}o++}return z.trim()&&A.push(z.trim()),A}return(t,e)=>{const u=g("v-app-bar-nav-icon"),r=g("v-icon"),v=g("v-list-item-title"),f=g("v-list-item"),_=g("v-divider"),h=g("v-chip"),y=g("v-list"),A=g("v-menu"),z=g("v-app-bar"),o=g("v-btn"),I=g("v-img"),c=g("v-checkbox"),P=g("v-rating"),K=g("v-container"),D=g("v-table"),T=g("v-col"),te=g("v-row");return l(),m("div",null,[s(z,{collapse:"",elevation:0,color:"#6969695A",class:"no-print"},{prepend:a(()=>[s(A,null,{activator:a(({props:n})=>[s(u,He(Ke(n)),null,16)]),default:a(()=>[s(y,{class:"mt-2"},{default:a(()=>[s(f,{onClick:ge},{default:a(()=>[s(v,null,{default:a(()=>[s(r,{icon:"mdi-knife",size:"20"}),x(" Schnibbelmodus "+R(U.value?"beenden":""),1)]),_:1})]),_:1}),$.value?b("",!0):(l(),O(f,{key:0,onClick:e[0]||(e[0]=n=>Ve())},{default:a(()=>[s(v,null,{default:a(()=>[s(r,{icon:"mdi-microphone-message",size:"20"}),e[7]||(e[7]=x(" Sprachsteuerung aktivieren",-1))]),_:1})]),_:1})),$.value?(l(),O(f,{key:1,onClick:e[1]||(e[1]=n=>Ae())},{default:a(()=>[s(v,null,{default:a(()=>[s(r,{icon:"mdi-microphone-message-off",size:"20"}),e[8]||(e[8]=x(" Sprachsteuerung beenden",-1))]),_:1})]),_:1})):b("",!0),s(f,{onClick:e[2]||(e[2]=n=>Me(F(C)))},{default:a(()=>[s(v,null,{default:a(()=>[s(r,{icon:"mdi-truck",size:"20"}),e[9]||(e[9]=x(" Zutaten einkaufen",-1))]),_:1})]),_:1}),s(f,{onClick:Re,disabled:j.value===-1},{default:a(()=>[s(v,null,{default:a(()=>[s(r,{icon:"mdi-backup-restore",size:"20"}),e[10]||(e[10]=x(" Fortschritt zurücksetzen",-1))]),_:1})]),_:1},8,["disabled"]),s(_),s(f,null,{default:a(()=>[i("div",ot,[s(r,{icon:"mdi-account-group",size:"20"}),e[11]||(e[11]=x(" Portionen ",-1))]),i("div",it,[(l(),m(J,null,q([1,2,3,4,5,6],n=>i("span",{key:n,class:"ml-1"},[s(h,{color:n===G.value?"indigo":null,"prepend-icon":"mdi-account",onClick:L=>De(n)},{default:a(()=>[x(R(n),1)]),_:2},1032,["color","onClick"])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),d.value?(l(),O(K,{key:0,class:"pt-0"},{default:a(()=>[i("div",null,[i("div",at,[s(o,{variant:"plain","prepend-icon":"mdi-arrow-left",onClick:me},{default:a(()=>[...e[12]||(e[12]=[x("Zurück",-1)])]),_:1})])]),i("div",lt,[!d.value.imageInProgress&&d.value.imageUploaded?(l(),O(I,{key:0,height:"200",src:ze(d.value),color:"grey",cover:""},null,8,["src"])):b("",!0),i("div",rt,R(d.value.title),1)]),U.value?b("",!0):(l(),m("div",ut,[(l(!0),m(J,null,q(ce.value,n=>(l(),m("div",{key:n.index},[i("div",null,[i("a",{href:"/recipes/go?id="+F(C)+"#section-"+n.index,style:{all:"revert","text-decoration":"none",cursor:"pointer"}},[i("h2",{style:{color:"dimgray"},class:"pt-8",id:"section-"+n.index},[x(R(n.index)+" "+R(n.sectionTitle)+" ",1),i("span",null,[s(r,{icon:"mdi-link-variant",size:"26"})])],8,dt)],8,ct)]),i("div",{style:{"font-size":"1.2em"},class:"mt-1",innerHTML:n.description,onClick:$e},null,8,mt)]))),128))])),U.value?(l(),m("div",pt,[e[15]||(e[15]=i("h2",null,"Vorbereitungen",-1)),F(E)?b("",!0):(l(),m("div",vt,[s(o,{onClick:Pe,variant:"plain",rounded:"",style:{"font-size":"0.7em"}},{default:a(()=>[...e[13]||(e[13]=[x("Zurücksetzen",-1)])]),_:1})])),e[16]||(e[16]=i("h3",null,"Zutatenvorbereitungen",-1)),F(de).length===0?(l(),m("div",ft," Keine Vorbereitungen nötig. ")):b("",!0),(l(!0),m(J,null,q(F(de),n=>(l(),m("div",{class:"mt-1",key:n.name},[s(c,{modelValue:n.checked,"onUpdate:modelValue":L=>n.checked=L,"hide-details":"auto",density:"comfortable",label:n.name,onChange:pe},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),e[17]||(e[17]=i("h3",{class:"mt-3"},"Rezeptvorbereitungen",-1)),i("span",gt,"Dauer: "+R(F(Ie))+" Min.",1),(l(!0),m(J,null,q(F(Ce),n=>(l(),m("div",{class:"mt-1",key:n.name},[s(c,{modelValue:n.checked,"onUpdate:modelValue":L=>n.checked=L,"hide-details":"auto",density:"comfortable",label:n.name,onChange:pe},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),i("div",_t,[s(o,{onClick:ge,color:"primary",variant:"outlined",rounded:""},{default:a(()=>[...e[14]||(e[14]=[x("Schnibbelmodus beenden",-1)])]),_:1})])])):b("",!0),i("div",ht,[F(E)?b("",!0):(l(),m("div",kt,[e[18]||(e[18]=i("span",{style:{"font-size":"1.6em"}},"Wie gut hat dir dieses Essen geschmeckt?",-1)),i("div",yt,[s(P,{"onUpdate:modelValue":[Ne,e[3]||(e[3]=n=>d.value.rating=n)],hover:"",length:"5",size:"30",modelValue:d.value.rating,"active-color":"primary"},null,8,["modelValue"])])])),i("div",bt,[s(o,{variant:"text","prepend-icon":"mdi-arrow-left",style:{"font-size":"1.1em"},onClick:me},{default:a(()=>[...e[19]||(e[19]=[x("Zurück zur Übersicht",-1)])]),_:1})])]),e[20]||(e[20]=i("div",{style:{height:"600px"}},null,-1))]),_:1})):b("",!0),V.value?(l(),m("div",xt,[i("div",wt,[Q.value?(l(),m("div",St,[s(K,{"max-width":"400"},{default:a(()=>[s(D,null,{default:a(()=>[i("tbody",null,[(l(!0),m(J,null,q(V.value,n=>(l(),m("tr",{key:n.name},[i("td",null,[n.amount?(l(),m("span",It,R(n.amount),1)):b("",!0),e[21]||(e[21]=x()),n.unit?(l(),m("span",Ct,R(n.unit),1)):b("",!0)]),i("td",null,R(n.name),1)]))),128))])]),_:1})]),_:1})])):b("",!0),i("div",null,[i("div",Tt,[i("span",Rt,[s(o,{style:{width:"100%"},"min-height":"60",class:"my-2",variant:"elevated",onClick:e[4]||(e[4]=n=>Q.value=!Q.value),elevation:"0","prepend-icon":"mdi-food-apple-outline"})]),i("span",zt,[s(o,{color:"rgb(191, 231, 210)",style:{width:"100%"},"min-height":"60",class:"my-2",variant:"elevated",onClick:ve,elevation:"0","prepend-icon":"mdi-skip-forward"},{default:a(()=>[...e[22]||(e[22]=[x("Nächster Schritt",-1)])]),_:1})])]),p.value&&p.value.length>0?(l(),m("div",Pt,[i("div",null,[s(o,{variant:"text",elevation:"0",disabled:"","prepend-icon":"mdi-timer-play-outline"},{default:a(()=>[...e[23]||(e[23]=[x("Stoppuhren",-1)])]),_:1})]),(l(!0),m(J,null,q(p.value,n=>(l(),m("div",{key:n.title,class:"my-1"},[s(_,{class:"mb-1"}),s(te,{align:"center"},{default:a(()=>[s(o,{icon:"mdi-close",onClick:L=>Ee(n.id),variant:"text"},null,8,["onClick"]),s(T,{class:"text-left",style:{"font-size":"1.2em","font-weight":"400","line-height":"1.1 !important"}},{default:a(()=>[x(R(n.title),1)]),_:2},1024),s(T,{class:"d-flex align-center justify-end"},{default:a(()=>[s(o,{onClick:L=>Fe(n),icon:"mdi-minus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),s(o,{onClick:L=>Be(n),icon:"mdi-plus-circle-outline",class:"mr-2",elevation:"0"},null,8,["onClick"]),i("span",Dt,R(Le(n.remainingSeconds)),1),n.timerStarted?b("",!0):(l(),O(o,{key:0,onClick:L=>Ue(n),icon:"mdi-play-circle-outline",class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0"},null,8,["onClick"])),n.timerStarted?(l(),O(o,{key:1,onClick:L=>je(n),class:"ml-2",color:"rgb(152, 198, 226)",elevation:"0",icon:""},{default:a(()=>[n.isPaused?(l(),m("span",Nt,[s(r,{icon:"mdi-play-circle-outline"})])):b("",!0),n.isPaused?b("",!0):(l(),m("span",Vt,[s(r,{icon:"mdi-pause-circle-outline"})]))]),_:2},1032,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):b("",!0)])])])):b("",!0),e[24]||(e[24]=i("div",{style:{display:"none"}},[i("iframe",{id:"scFrame",src:"/tfjs.html",allow:"microphone"})],-1)),s(Xe,{onResult:e[5]||(e[5]=n=>Y.value=n)}),s(nt,{onResult:e[6]||(e[6]=n=>ee.value=n)})])}}},Mt=Se(At,[["__scopeId","data-v-a8cecc02"]]),Ut={__name:"index",setup(M){const N=le(),w=Qe();k(!1);const E=N.query.id;return re(async()=>{E||w.push("/recipes")}),(ne,W)=>(l(),O(Mt))}};export{Ut as default};
