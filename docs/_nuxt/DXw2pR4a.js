import{_ as pe,O as me,K as ve,N as fe,u as _e,P as ge,r as m,o as ye,g as v,x as u,y as i,B as n,C as o,a3 as be,U as k,z as p,D as f,R as r,A as _,Q as A,S as he,T as we,V as ke,X as E}from"./CbHVuqT-.js";import{R as z,C as Pe,I as U}from"./BHsCZCym.js";const xe={methods:{formatCurrency(L){return"€ "+(""+(Math.round(L*100)/100).toFixed(2)).replace(".",",")}}},Ie={class:"d-flex justify-space-between align-center"},Ce={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Re={key:0,class:"text-h6 text-medium-emphasis"},Ve={key:0},Se={class:"text-right mt-3"},Be={key:1,style:{width:"100%","text-align":"right"}},Ne=["colspan"],De={key:0,class:"pl-6"},Te={key:0},Ae={key:1},ze={key:1,class:"py-2"},Ue=["onClick"],Me={key:0},$e={key:1},Ee={key:0},Le={key:0},Fe={key:1},Qe={key:0,class:"px-0 mx-0"},je={style:{"max-width":"200px"}},Oe={class:"my-2"},Ze={class:"my-2"},Ke={class:"my-2"},Xe={class:"text-right"},qe={key:0,class:"mt-3"},Ge={class:"mt-2"},He={__name:"IngredientsDialog",emits:["result"],setup(L,{emit:F}){const Q=me(),j=ve(),{authInfo:b,githubMode:S}=fe(j),W=F;_e(),ge();const I=m(!1),M=m(null),Y=m(null),O=m(null),B=m([]),g=m([]),c=m(null),N=m(null),D=m(2),C=m(!1),P=m(!1),R=m(!1),x=m(!1),V=m({name:null,password:null});ye(async()=>{W("result",async a=>(Array.isArray(a)?B.value=a:B.value=[a],N.value=null,g.value=[],c.value=null,R.value=!1,x.value=!1,P.value=!1,D.value=2,Z(),await ee(!0),I.value=!0,new Promise((e,l)=>{M.value=e,Y.value=l})))});async function Z(){let a=await j.getAuthInfo();C.value=a.picnicLoggedIn}async function ee(a){let e=[];for(const l of B.value){const s=await z.getRecipe(b.value.userId,l);s.ingredients=(await z.getRecipeIngredients(b.value.userId,l)).data,e.push(s)}g.value=e,X(a)}async function te(){await U.loginPicnic(b.value.userId,V.value),await Z()}async function le(){let a=!1;for(const e of g.value)e.planned&&!e.ordered&&(a=!0);a?O.value().then(async e=>{if(e){for(const l of g.value)if(l.planned&&!l.ordered){const s={ordered:!0};await z.updateRecipe(b.value.userId,l.id,s)}}I.value=!1,M.value(!0)}):(I.value=!1,M.value(!1))}async function K(){let a=c.value.filter(e=>e.bring);N.value=U.convertToBringUrl(a)}async function ae(){let a=c.value.filter(s=>s.picnic);for(const s of a)if(s.selectedPicnicProduktId){let d=s.picnicResults.find(h=>h.id===s.selectedPicnicProduktId).multiplier;(!d||d===0||d>0&&d<1)&&(d=1),d=Math.ceil(d);for(let h=1;h<=d;h++)await U.addProductToPicnicShoppingCart(b.value.userId,s.selectedPicnicProduktId)}P.value=!0;const l={picnicPurchaseDate:new Date().toISOString()};for(const s of B.value)await z.updateRecipe(b.value.userId,s,l)}async function ne(a){await navigator.clipboard.writeText(a.basicName)}function X(a){c.value=[];for(const e of g.value){let l=e.portions?e.portions:2;e.ingredients.forEach(s=>{c.value.push({name:s.name,basicName:s.basicName,genericName:s.genericName?s.genericName:"Sonstiges",unit:s.unit,amount:Math.ceil(s.amount/l*D.value),standardIngredient:s.standardIngredient})})}c.value=c.value.sort((e,l)=>e.basicName.localeCompare(l.basicName)),console.log("ingredients",c.value),a&&se(),K()}function se(){c.value.forEach(a=>{a.standardIngredient?(a.bring=!1,a.picnic=!1):(a.bring=!0,a.picnic=!1)}),x.value=c.value.filter(a=>!!a.bring).length>0,c.value=c.value.sort((a,e)=>{let l=0;return!a.bring&&!e.bring&&(l=0),!a.bring&&e.bring&&(l=1),a.bring&&!e.bring&&(l=-1),a.bring&&e.bring&&(l=0),l!==0?l:a.genericName.localeCompare(e.genericName)})}async function ie(){c.value.forEach(a=>{a.bring&&T("picnic",a)})}async function T(a,e){if(a==="bring")e.bring=!0,e.picnic=!1,R.value=c.value.filter(l=>!!l.picnic).length>0,x.value=c.value.filter(l=>!!l.bring).length>0;else if(a==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const l=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await U.searchPicnic(b.value.userId,e.basicName,l,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),R.value=c.value.filter(s=>!!s.picnic).length>0,x.value=c.value.filter(s=>!!s.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,R.value=c.value.filter(l=>!!l.picnic).length>0,x.value=c.value.filter(l=>!!l.bring).length>0;K()}return(a,e)=>{const l=v("v-btn"),s=v("v-card-title"),d=v("v-img"),h=v("v-text-field"),q=v("v-card-text"),G=v("v-card"),H=v("v-select"),J=v("v-icon"),oe=v("v-progress-linear"),ce=v("v-list-item"),$=v("v-col"),ue=v("v-row"),re=v("v-table"),de=v("v-dialog");return i(),u("div",null,[n(de,{"max-width":"600",modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t),fullscreen:k(Q).smAndDown.value},{default:o(()=>[n(G,{style:{"background-color":"white"},class:be({"pa-4":!k(Q).smAndDown.value})},{default:o(()=>[n(s,{style:{"white-space":"normal"}},{default:o(()=>[p("div",Ie,[p("div",Ce,[e[6]||(e[6]=f(" Zutaten einkaufen ",-1)),g.value?(i(),u("div",Re,_(g.value.map(t=>t.title).join(", ")),1)):r("",!0)]),n(l,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),n(q,null,{default:o(()=>[g.value?(i(),u("div",Ve,[!C.value&&!k(S)?(i(),A(G,{key:0,class:"mb-4"},{default:o(()=>[n(s,null,{default:o(()=>[n(d,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=f(" Bei Picnic einloggen ",-1))]),_:1}),n(q,null,{default:o(()=>[n(h,{modelValue:V.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value.name=t),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),n(h,{modelValue:V.value.password,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value.password=t),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),p("div",Se,[n(l,{variant:"outlined",onClick:te},{default:o(()=>[...e[8]||(e[8]=[f("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):r("",!0),e[13]||(e[13]=p("h3",null,"Anzahl Portionen",-1)),n(H,{modelValue:D.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>D.value=t),X],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=p("h3",null,"Zutatenliste",-1)),k(S)?r("",!0):(i(),u("div",Be,[n(l,{variant:"flat",onClick:e[3]||(e[3]=t=>ie()),class:"mb-1 my-1"},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=f(" Alles bei Picnic einkaufen ",-1))]),_:1})])),n(re,{class:"table-ingredients"},{default:o(()=>[p("tbody",null,[(i(!0),u(he,null,we(c.value,t=>(i(),u("tr",{key:t.name},[p("td",{colspan:t.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[t.picnic?r("",!0):(i(),u("div",De,[t.amount?(i(),u("span",Te,_(t.amount),1)):r("",!0),e[10]||(e[10]=f()),t.unit?(i(),u("span",Ae,_(t.unit),1)):r("",!0)])),t.picnic?(i(),u("div",ze,[p("div",{style:{"font-size":"0.8em"},onClick:w=>ne(t)},[n(J,{icon:"mdi-arrow-right"}),e[11]||(e[11]=f()),t.amount?(i(),u("span",Me,_(t.amount),1)):r("",!0),e[12]||(e[12]=f()),t.unit?(i(),u("span",$e,_(t.unit),1)):r("",!0),f(" "+_(t.name),1)],8,Ue),t.picnic?(i(),u("div",Ee,[t.loading?(i(),A(oe,{key:0,indeterminate:""})):r("",!0),(i(),A(H,{modelValue:t.selectedPicnicProduktId,"onUpdate:modelValue":w=>t.selectedPicnicProduktId=w,label:"Bitte Produkt auswählen",items:t.picnicResults,"item-title":"name","item-value":"id","hide-details":"",key:t.id,disabled:t.loading},{item:o(({props:w,item:y})=>[n(ce,ke({ref_for:!0},w),{default:o(()=>[p("h4",null,[y.raw.multiplier&&y.raw.multiplier>1?(i(),u("span",Le,_(y.raw.multiplier)+"x ",1)):r("",!0),y.raw.unitQuantity&&y.raw.unitQuantity!=="undefined"?(i(),u("span",Fe,_(y.raw.unitQuantity),1)):r("",!0)]),p("h5",null,_(k(xe).methods.formatCurrency(y.raw.price/100)),1),n(d,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${y.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"]))])):r("",!0)])):r("",!0)],8,Ne),t.picnic?r("",!0):(i(),u("td",Qe,_(t.name),1)),p("td",je,[n(ue,{class:"px-0 mx-0",style:{width:"180px"}},{default:o(()=>[n($,{cols:"3"},{default:o(()=>[p("div",Oe,[n(l,{variant:"flat",style:E({opacity:t.bring?1:.3}),onClick:w=>T("bring",t),class:"mx-0"},{default:o(()=>[n(d,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),k(S)?r("",!0):(i(),A($,{key:0,cols:"3"},{default:o(()=>[p("div",Ze,[n(l,{variant:"plain",style:E({opacity:t.picnic?1:.3}),disabled:!C.value||P.value,onClick:w=>T("picnic",t)},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),n($,{cols:"4"},{default:o(()=>[p("div",Ke,[n(l,{variant:"plain",style:E({opacity:!t.bring&&!t.picnic?1:.3}),disabled:!C.value||P.value,onClick:w=>T(null,t)},{default:o(()=>[n(J,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):r("",!0),p("div",Xe,[k(S)?r("",!0):(i(),u("div",qe,[n(l,{variant:"outlined",rounded:"",onClick:ae,"prepend-icon":P.value?"mdi-check":null,disabled:!C.value||P.value||!R.value},{default:o(()=>[n(d,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=f(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),p("div",Ge,[n(l,{link:"",variant:"outlined",rounded:"",href:N.value,disabled:N.value===null||!x.value,target:"_blank",class:"ml-2"},{default:o(()=>[n(d,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=f(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),n(Pe,{onResult:e[5]||(e[5]=t=>O.value=t),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},Ye=pe(He,[["__scopeId","data-v-57629aea"]]);export{Ye as I};
