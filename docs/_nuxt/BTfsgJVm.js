import{K as f,$ as u,a6 as Q,M as de,L as pe,u as me,N as ve,r as g,o as fe,g as h,O as q,y as v,C as d,B as l,a7 as ge,Q as U,z as m,D as w,A as k,x as _,P as y,R as he,S as _e,T as ye,a8 as O}from"./DGaJmGMA.js";import{_ as be}from"./DlAUqK2U.js";const L={getRecipe:async function(o,a){const s=f();try{if(s.isNetworkAccess){let t=s.lanAddress+"api/"+o+"/recipes/"+a;return(await u.get(t)).data}else return(await u.get("https://mmhhhh.de/data/home/recipes.json")).data[a]}catch(t){u.catchError(t)}},getRecipeIngredients:async function(o,a){const s=f();try{let t;return s.isNetworkAccess?t=s.lanAddress+"api/"+o+"/recipes/"+a+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+a+"/ingredients.json",await u.get(t)}catch(t){u.catchError(t)}},getRecipeSections:async function(o,a){const s=f();try{let t;return s.isNetworkAccess?t=s.lanAddress+"api/"+o+"/recipes/"+a+"/sections":t="https://mmhhhh.de/data/home/recipes/"+a+"/sections.json",await u.get(t)}catch(t){u.catchError(t)}},updateRecipe:async function(o,a,s){const t=f();try{return await u.put(t.lanAddress+"api/"+o+"/recipes/"+a,s)}catch(c){u.catchError(c)}},uploadRecipeToGithub:async function(o,a){const s=f();try{return await u.put(s.lanAddress+"api/"+o+"/recipes/"+a+"/githubUpload")}catch(t){u.catchError(t)}},deleteRecipe:async function(o,a){const s=f();try{return await u.post(s.lanAddress+"api/"+o+"/recipes/"+a+"/delete")}catch(t){u.catchError(t)}}},B={convertToBringUrl:function(o){let a=[];for(const I of o){const S=[];S.push(I.name),I.amount&&I.amount!==0&&S.push(I.amount+(I.unit?" "+I.unit:"")),a.push(S.join("__"))}const s=a.join("---"),t=btoa(unescape(encodeURIComponent(s)));let P="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return P=encodeURIComponent(P),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+P+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeIngredients:async function(o,a,s){const t=f();try{const c=new FormData;return c.append("image",s),await Q.post(t.lanAddress+"api/"+o+"/recipes/"+a+"/import/image/ingredients",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},analyzeSections:async function(o,a,s){const t=f();try{const c=new FormData;return c.append("image",s),await Q.post(t.lanAddress+"api/"+o+"/recipes/"+a+"/import/image/sections",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},uploadImage:async function(o,a,s){const t=f();try{const c=new FormData;return c.append("image",s),await Q.post(t.lanAddress+"api/"+o+"/recipes/"+a+"/import/image",c,{headers:{"Content-Type":"multipart/form-data"}})}catch(c){u.catchError(c)}},generateImage:async function(o,a){const s=f();try{return await u.post(s.lanAddress+"api/"+o+"/recipes/"+a+"/import/generateImage")}catch(t){u.catchError(t)}},loginPicnic:async function(o,a){const s=f();try{return await u.post(s.lanAddress+"api/"+o+"/loginPicnic",a)}catch(t){u.catchError(t)}},searchPicnic:async function(o,a){const s=f();try{return await u.post(s.lanAddress+"api/"+o+"/picnic/search",{query:a})}catch(t){u.catchError(t)}},addProductToPicnicShoppingCart:async function(o,a){const s=f();try{return await u.post(s.lanAddress+"api/"+o+"/picnic/addProductToShoppingCart",{productId:a})}catch(t){u.catchError(t)}}},we={methods:{formatCurrency(o){return"€ "+(""+(Math.round(o*100)/100).toFixed(2)).replace(".",",")}}},ke={class:"d-flex justify-space-between align-center"},Ie={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Se={class:"text-h6 text-medium-emphasis"},Pe={key:0},xe={class:"text-right mt-3"},Re=["colspan"],Ce={key:0,class:"pl-6"},Ae={key:0},Ve={key:1},De={key:1,class:"py-2"},Ue={style:{"font-size":"0.8em"}},Ee={key:0},Te={key:1},Be={key:0},Ne={key:0,class:"px-0 mx-0"},ze={style:{"max-width":"200px"}},je={class:"my-2"},Le={class:"my-2"},Fe={class:"my-2"},Me={class:"text-right"},$e={key:0,class:"mt-3"},Qe={class:"mt-2"},qe={__name:"IngredientsDialog",emits:["result"],setup(o,{emit:a}){const s=de(),t=f(),{authInfo:c,githubMode:P}=pe(t),I=a;me(),ve();const S=g(!1),Z=g(null),ae=g(null),N=g(null),b=g(null),p=g(null),z=g(null),j=g(2),E=g(!1),C=g(!1),A=g(!1),x=g(!1),T=g({name:null,password:null});fe(async()=>{I("result",async r=>{if(N.value=r,z.value=null,b.value=null,p.value=null,A.value=!1,x.value=!1,C.value=!1,j.value=2,G(),await K(!0),b.value.planned){const e={ordered:!0};await L.updateRecipe(c.value.userId,b.value.id,e),await K(!0)}return S.value=!0,new Promise((e,i)=>{Z.value=e,ae.value=i})})});async function G(){let r=await t.getAuthInfo();E.value=r.picnicLoggedIn}async function K(r){b.value=await L.getRecipe(c.value.userId,N.value),b.value.ingredients=(await L.getRecipeIngredients(c.value.userId,N.value)).data,J(r)}async function ne(){await B.loginPicnic(c.value.userId,T.value),await G()}function se(){S.value=!1,Z.value(!1)}async function H(){let r=p.value.filter(e=>e.bring);z.value=B.convertToBringUrl(r)}async function ie(){let r=p.value.filter(R=>R.picnic);for(const R of r)R.selectedPicnicProduktId&&await B.addProductToPicnicShoppingCart(c.value.userId,R.selectedPicnicProduktId);C.value=!0;const i={picnicPurchaseDate:new Date().toISOString()};await L.updateRecipe(c.value.userId,N,i)}function J(r){let e=b.value.portions?b.value.portions:2;p.value=[],b.value.ingredients.forEach(i=>{p.value.push({name:i.name,basicName:i.basicName,unit:i.unit,amount:i.amount/e*j.value,standardIngredient:i.standardIngredient})}),r&&oe(),H()}function oe(){p.value.forEach(r=>{r.standardIngredient?(r.bring=!1,r.picnic=!1):(r.bring=!0,r.picnic=!1)}),x.value=p.value.filter(r=>!!r.bring).length>0,p.value=p.value.sort((r,e)=>!r.bring&&!e.bring?0:!r.bring&&e.bring?1:r.bring&&!e.bring?-1:(r.bring&&e.bring,0))}async function F(r,e){r==="bring"?(e.bring=!0,e.picnic=!1,A.value=p.value.filter(i=>!!i.picnic).length>0,x.value=p.value.filter(i=>!!i.bring).length>0):r==="picnic"?(e.bring=!1,e.picnic=!0,e.picnicResults=(await B.searchPicnic(c.value.userId,e.basicName+" bio")).data,e.picnicResults&&e.picnicResults.length>0?(e.selectedPicnicProduktId=e.picnicResults[0].id,A.value=p.value.filter(i=>!!i.picnic).length>0,x.value=p.value.filter(i=>!!i.bring).length>0):(e.picnicResults=(await B.searchPicnic(c.value.userId,e.basicName)).data,e.picnicResults&&e.picnicResults.length>0&&(e.selectedPicnicProduktId=e.picnicResults[0].id,A.value=p.value.filter(i=>!!i.picnic).length>0,x.value=p.value.filter(i=>!!i.bring).length>0))):(e.bring=!1,e.picnic=!1,A.value=p.value.filter(i=>!!i.picnic).length>0,x.value=p.value.filter(i=>!!i.bring).length>0),H()}return(r,e)=>{const i=h("v-btn"),R=h("v-card-title"),V=h("v-img"),W=h("v-text-field"),X=h("v-card-text"),Y=h("v-card"),ee=h("v-select"),te=h("v-icon"),le=h("v-list-item"),M=h("v-col"),re=h("v-row"),ce=h("v-table"),ue=h("v-dialog");return v(),q(ue,{"max-width":"600",modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=n=>S.value=n),fullscreen:U(s).smAndDown.value},{default:d(()=>[l(Y,{style:{"background-color":"white"},class:ge({"pa-4":!U(s).smAndDown.value})},{default:d(()=>[l(R,{style:{"white-space":"normal"}},{default:d(()=>[m("div",ke,[m("div",Ie,[e[4]||(e[4]=w(" Zutaten einkaufen ",-1)),m("div",Se,k(b.value.title),1)]),l(i,{icon:"mdi-close",variant:"text",onClick:se})])]),_:1}),l(X,null,{default:d(()=>[b.value?(v(),_("div",Pe,[!E.value&&!U(P)?(v(),q(Y,{key:0,class:"mb-4"},{default:d(()=>[l(R,null,{default:d(()=>[l(V,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[5]||(e[5]=w(" Bei Picnic einloggen ",-1))]),_:1}),l(X,null,{default:d(()=>[l(W,{modelValue:T.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>T.value.name=n),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),l(W,{modelValue:T.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>T.value.password=n),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),m("div",xe,[l(i,{variant:"outlined",onClick:ne},{default:d(()=>[...e[6]||(e[6]=[w("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):y("",!0),e[10]||(e[10]=m("h3",null,"Anzahl Portionen",-1)),l(ee,{modelValue:j.value,"onUpdate:modelValue":[e[2]||(e[2]=n=>j.value=n),J],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[11]||(e[11]=m("h3",null,"Zutatenliste",-1)),l(ce,{class:"table-ingredients"},{default:d(()=>[m("tbody",null,[(v(!0),_(he,null,_e(p.value,n=>(v(),_("tr",{key:n.name},[m("td",{colspan:n.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[n.picnic?y("",!0):(v(),_("div",Ce,[n.amount?(v(),_("span",Ae,k(n.amount),1)):y("",!0),e[7]||(e[7]=w()),n.unit?(v(),_("span",Ve,k(n.unit),1)):y("",!0)])),n.picnic?(v(),_("div",De,[m("div",Ue,[l(te,{icon:"mdi-arrow-right"}),e[8]||(e[8]=w()),n.amount?(v(),_("span",Ee,k(n.amount),1)):y("",!0),e[9]||(e[9]=w()),n.unit?(v(),_("span",Te,k(n.unit),1)):y("",!0),w(" "+k(n.name),1)]),n.picnic?(v(),_("div",Be,[l(ee,{modelValue:n.selectedPicnicProduktId,"onUpdate:modelValue":D=>n.selectedPicnicProduktId=D,label:"Bitte Produkt auswählen",items:n.picnicResults,"item-title":"name","item-value":"id","hide-details":""},{item:d(({props:D,item:$})=>[l(le,ye({ref_for:!0},D),{default:d(()=>[m("h4",null,k($.raw.unit_quantity),1),m("h5",null,k(U(we).methods.formatCurrency($.raw.display_price/100)),1),l(V,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${$.raw.image_id}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items"])])):y("",!0)])):y("",!0)],8,Re),n.picnic?y("",!0):(v(),_("td",Ne,k(n.name),1)),m("td",ze,[l(re,{class:"px-0 mx-0",style:{width:"180px"}},{default:d(()=>[l(M,{cols:"3"},{default:d(()=>[m("div",je,[l(i,{variant:"flat",style:O({opacity:n.bring?1:.3}),onClick:D=>F("bring",n),class:"mx-0"},{default:d(()=>[l(V,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),U(P)?y("",!0):(v(),q(M,{key:0,cols:"3"},{default:d(()=>[m("div",Le,[l(i,{variant:"plain",style:O({opacity:n.picnic?1:.3}),disabled:!E.value||C.value,onClick:D=>F("picnic",n)},{default:d(()=>[l(V,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),l(M,{cols:"4"},{default:d(()=>[m("div",Fe,[l(i,{variant:"plain",style:O({opacity:!n.bring&&!n.picnic?1:.3}),disabled:!E.value||C.value,onClick:D=>F(null,n)},{default:d(()=>[l(te,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):y("",!0),m("div",Me,[U(P)?y("",!0):(v(),_("div",$e,[l(i,{variant:"outlined",rounded:"",onClick:ie,"prepend-icon":C.value?"mdi-check":null,disabled:!E.value||C.value||!A.value},{default:d(()=>[l(V,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[12]||(e[12]=w(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),m("div",Qe,[l(i,{link:"",variant:"outlined",rounded:"",href:z.value,disabled:z.value===null||!x.value,target:"_blank",class:"ml-2"},{default:d(()=>[l(V,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[13]||(e[13]=w(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"])}}},Ge=be(qe,[["__scopeId","data-v-1204c250"]]);export{Ge as I,L as R,B as a};
