import{U as me,V as ge,K as te,W as le,_ as ye,M as ke,r as u,L as xe,u as Ie,X as Ce,o as be,Y as he,g as b,x as r,y as o,B as t,C as n,Q as s,P as z,Z as x,D as a,z as i,$ as h,O,a0 as w}from"./PBTyrjFC.js";import{a as _,I as we}from"./PUEIcrrp.js";const Oe=me("recipe",{state:()=>ge({recipes:[]}),actions:{getAllRecipes:async function(W){const U=te();try{let c;U.isNetworkAccess?c=U.lanAddress+"api/"+W+"/recipes":c="https://mmhhhh.de/data/home/recipes.json?t="+new Date().getTime();let m=(await le.get(c)).data;const p=[];for(const[I,E]of Object.entries(m))p.push(E);return this.$patch({recipes:p}),p}catch(c){le.catchError(c)}}}}),Se={key:0},De={key:1},Fe={key:2},Re={key:0},$e={key:0},Me={key:1,class:"mt-3"},_e={key:2,class:"mt-3"},Ue={class:"d-flex flex-no-wrap justify-space-between"},Ae={key:0,class:"mt-3"},Te={key:1},je={class:"d-flex flex-no-wrap justify-space-between"},ze={key:0,class:"mt-3"},Ee={key:1},Be={key:0},Ve={key:1,class:"mt-3"},Ze={key:2,class:"mt-3"},Ne={__name:"RecipeImportDialog",emits:["result"],setup(W,{emit:U}){const c=ke(),m=u(null),p=u(null),I=u(null),E=te(),{authInfo:F}=xe(E),ne=U;Ie(),Ce();const S=u(!1),A=u(null),ae=u(null),D=u(null),f=u(!1),v=u(null),g=u(!1),B=u(null),V=u(!1),Z=u(null),N=u(!1),R=u(!1),T=u(!1),K=u(!1);u(!0);const P=u(!0),j=u(!0),H=u([]),Q=u([]);be(async()=>{ne("result",async l=>(v.value=null,B.value=null,Z.value=null,m.value=null,p.value=null,I.value=null,g.value=!1,V.value=!1,N.value=!1,R.value=!1,l?(D.value=l.id,f.value=!0,l.sectionsUploaded?j.value=!1:j.value=!0,P.value=!1):(D.value=ee(),P.value=!0,j.value=!0),S.value=!0,new Promise((e,d)=>{A.value=e,ae.value=d})))}),he(H,l=>{Q.value=[...l].sort((e,d)=>e.name.localeCompare(d.name)),pe(Q.value)});function ie(){S.value=!1,A.value(null)}function ue(){S.value=!1,A.value(D.value)}function X(l){const e=l.target.files;e&&e.length>0&&(m.value=e[0]),Y()}function oe(l){const e=l.dataTransfer.files;e&&e.length>0&&(m.value=e[0]),Y()}function se(l){const e=l.dataTransfer.files;if(e&&e.length>0){const d=Array.from(e);H.value=Array.from(d)}}async function Y(){if(m.value){g.value=!0;try{v.value=(await _.analyzeIngredients(F.value.userId,D.value,m.value)).data,g.value=!1}catch{g.value=!1}}}function q(l){const e=l.target.files;e&&e.length>0&&(p.value=e[0]),G()}function de(l){const e=l.dataTransfer.files;e&&e.length>0&&(p.value=e[0]),G()}async function G(){if(p.value&&!(!v.value&&!f.value)){V.value=!0;try{B.value=(await _.analyzeSections(F.value.userId,D.value,p.value)).data}catch{}}}function J(l){const e=l.target.files;e&&e.length>0&&(I.value=e[0]),L()}function re(l){const e=l.dataTransfer.files;e&&e.length>0&&(I.value=e[0]),L()}async function L(){if(I.value&&!(!v.value&&!f.value)){N.value=!0;try{Z.value=(await _.uploadImage(F.value.userId,D.value,I.value)).data}catch{}}}function ee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const e=Math.random()*16|0;return(l==="x"?e:e&3|8).toString(16)})}function ve(l){const e=Array.from(l.target.files);H.value=e}async function pe(l){T.value=!0;try{for(let e=0;e<l.length;e+=2){const d=l[e],C=l[e+1]||null,y=ee();await _.analyzeIngredients(F.value.userId,y,d),await _.analyzeSections(F.value.userId,y,C)}}catch{}T.value=!1,g.value=!1,setTimeout(()=>{S.value=!1,A.value(!0)},500)}return(l,e)=>{const d=b("v-btn"),C=b("v-card-title"),y=b("v-icon"),$=b("v-card-text"),M=b("v-card"),fe=b("v-card-actions"),ce=b("v-dialog");return o(),r("div",null,[t(ce,{"max-width":"600",modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=k=>S.value=k)},{default:n(()=>[t(M,{class:"pa-4",style:{"background-color":"white"}},{default:n(()=>[t(C,null,{default:n(()=>[f.value?s("",!0):(o(),r("div",Se,"Rezept hinzufügen")),f.value?(o(),r("div",De,"Rezeptdaten importieren")):s("",!0),f.value?s("",!0):(o(),r("div",Fe,[R.value?s("",!0):(o(),z(d,{key:0,variant:"plain",style:{"font-size":"0.7em"},onClick:e[0]||(e[0]=x(k=>R.value=!0,["prevent"])),"prepend-icon":"mdi-arrow-right"},{default:n(()=>[...e[13]||(e[13]=[a("Zum Multi-Dateiupload",-1)])]),_:1}))]))]),_:1}),t($,null,{default:n(()=>[R.value?s("",!0):(o(),r("div",Re,[P.value?(o(),r("div",{key:0,onDrop:x(oe,["prevent"]),onDragover:e[3]||(e[3]=x(()=>{},["prevent"]))},[t(M,{rounded:"",loading:g.value},{default:n(()=>[i("div",null,[i("div",null,[t(C,null,{default:n(()=>[...e[14]||(e[14]=[a(" Zutatenliste ",-1)])]),_:1}),t($,null,{default:n(()=>[e[19]||(e[19]=a(" Erkennt sämtliche Zutaten aus der Zutatenliste. Dabei wird insbesondere der Fokus auf die Menge und den Namen gelegt. ",-1)),!g.value&&!v.value&&!m.value?(o(),r("div",$e,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[1]||(e[1]=k=>l.$refs.uploadIngredients.click())},{default:n(()=>[...e[15]||(e[15]=[a("Bild hochladen ",-1)])]),_:1})]),i("div",null,[O(c).smAndDown.value?(o(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-camera-enhance",onClick:e[2]||(e[2]=k=>l.$refs.uploadIngredientsCamera.click())},{default:n(()=>[...e[16]||(e[16]=[a("Foto machen ",-1)])]),_:1})):s("",!0)])])):s("",!0),g.value&&!v.value?(o(),r("div",Me,[t(y,{icon:"mdi-sync"}),e[17]||(e[17]=a(" Analyse läuft... ",-1))])):s("",!0),v.value?(o(),r("div",_e,[t(y,{icon:"mdi-check"}),e[18]||(e[18]=a(" Upload abgeschlossen. ",-1))])):s("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadIngredients",ref:"uploadIngredients",onChange:X,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadIngredientsCamera",ref:"uploadIngredientsCamera",capture:"environment",onChange:X,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1},8,["loading"])],32)):s("",!0),j.value?(o(),r("div",{key:1,class:"mt-2",onDrop:x(de,["prevent"]),onDragover:e[6]||(e[6]=x(()=>{},["prevent"]))},[t(M,null,{default:n(()=>[i("div",Ue,[i("div",null,[t(C,null,{default:n(()=>[...e[20]||(e[20]=[a(" Tätigkeitsschritte ",-1)])]),_:1}),t($,null,{default:n(()=>[e[24]||(e[24]=a(" Erfasst alle Arbeitsschritte, den Titel, die Zubereitungsdauer und generiert Schlagwörter. Wird im Hintergrund analysiert. ",-1)),p.value&&!B.value&&V.value?(o(),r("div",Ae,[t(y,{icon:"mdi-check"}),e[21]||(e[21]=a(" Upload abgeschlossen. ",-1))])):s("",!0),p.value?s("",!0):(o(),r("div",Te,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!v.value&&!f.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[4]||(e[4]=k=>l.$refs.uploadSections.click())},{default:n(()=>[...e[22]||(e[22]=[a("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[O(c).smAndDown.value?(o(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!v.value&&!f.value,"prepend-icon":"mdi-camera-enhance",onClick:e[5]||(e[5]=k=>l.$refs.uploadSectionsCamera.click())},{default:n(()=>[...e[23]||(e[23]=[a("Foto machen ",-1)])]),_:1},8,["disabled"])):s("",!0)])]))]),_:1})])]),h(i("input",{type:"file",id:"uploadSections",ref:"uploadSections",onChange:q,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadSectionsCamera",ref:"uploadSectionsCamera",capture:"environment",onChange:q,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1})],32)):s("",!0),i("div",{class:"mt-2",onDrop:x(re,["prevent"]),onDragover:e[9]||(e[9]=x(()=>{},["prevent"]))},[t(M,null,{default:n(()=>[i("div",je,[i("div",null,[t(C,null,{default:n(()=>[...e[25]||(e[25]=[a(" Rezeptbild ",-1)])]),_:1}),t($,null,{default:n(()=>[e[29]||(e[29]=a(" Hier kann ein Bild vom zubereiteten Rezept hochgeladen werden. ",-1)),I.value&&!Z.value&&N.value?(o(),r("div",ze,[t(y,{icon:"mdi-check"}),e[26]||(e[26]=a(" Upload abgeschlossen. ",-1))])):s("",!0),I.value?s("",!0):(o(),r("div",Ee,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"",disabled:!v.value&&!f.value,"prepend-icon":"mdi-cloud-upload-outline",onClick:e[7]||(e[7]=k=>l.$refs.uploadImage.click())},{default:n(()=>[...e[27]||(e[27]=[a("Bild hochladen ",-1)])]),_:1},8,["disabled"])]),i("div",null,[O(c).smAndDown.value?(o(),z(d,{key:0,class:"mt-1",rounded:"",variant:"outlined",text:"",disabled:!v.value&&!f.value,"prepend-icon":"mdi-camera-enhance",onClick:e[8]||(e[8]=k=>l.$refs.uploadImageCamera.click())},{default:n(()=>[...e[28]||(e[28]=[a("Foto machen ",-1)])]),_:1},8,["disabled"])):s("",!0)])]))]),_:1})])]),h(i("input",{type:"file",id:"uploadImage",ref:"uploadImage",onChange:J,accept:"image/png,image/jpeg"},null,544),[[w,!1]]),h(i("input",{type:"file",id:"uploadImageCamera",ref:"uploadImageCamera",capture:"environment",onChange:J,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1})],32)])),R.value?(o(),r("div",{key:1,onDrop:x(se,["prevent"]),onDragover:e[11]||(e[11]=x(()=>{},["prevent"]))},[t(M,{rounded:"",loading:T.value},{default:n(()=>[i("div",null,[i("div",null,[t(C,null,{default:n(()=>[...e[30]||(e[30]=[a(" Multi-Dateiupload ",-1)])]),_:1}),t($,null,{default:n(()=>[e[34]||(e[34]=a(" Erkennt sämtliche Zutaten und Tätigkeitsschritte aus den hochgeladenen Bildern. Die Dateien werden immer pärchenweise entsprechend der alphabetischen Reihenfolge des Dateinamens analysiert. ",-1)),!g.value&&!v.value&&!m.value?(o(),r("div",Be,[i("div",null,[t(d,{class:"mt-3",rounded:"",variant:"outlined",text:"","prepend-icon":"mdi-cloud-upload-outline",onClick:e[10]||(e[10]=k=>l.$refs.uploadMulti.click())},{default:n(()=>[...e[31]||(e[31]=[a("Bilder hochladen ",-1)])]),_:1})])])):s("",!0),T.value&&!K.value?(o(),r("div",Ve,[t(y,{icon:"mdi-sync"}),e[32]||(e[32]=a(" Upload läuft... ",-1))])):s("",!0),K.value?(o(),r("div",Ze,[t(y,{icon:"mdi-check"}),e[33]||(e[33]=a(" Upload abgeschlossen. ",-1))])):s("",!0)]),_:1})])]),h(i("input",{type:"file",id:"uploadMulti",ref:"uploadMulti",multiple:"",onChange:ve,accept:"image/png,image/jpeg"},null,544),[[w,!1]])]),_:1},8,["loading"])],32)):s("",!0)]),_:1}),t(fe,null,{default:n(()=>[t(d,{onClick:ie,rounded:"",variant:"outlined",text:"",color:"red"},{default:n(()=>[...e[35]||(e[35]=[a(" Abbrechen ",-1)])]),_:1}),t(d,{disabled:!v.value&&!f.value,onClick:ue,rounded:"",variant:"outlined",text:""},{default:n(()=>[...e[36]||(e[36]=[a(" Fertig ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we)])}}},We=ye(Ne,[["__scopeId","data-v-e0aa61c2"]]);export{We as R,Oe as u};
