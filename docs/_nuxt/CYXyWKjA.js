import{K as w,X as p,ab as K,_ as ae,r as b,o as se,g as m,Q as H,y as f,C as u,B as n,$ as ge,z as y,D as P,a0 as _e,ac as he,N as ye,M as be,u as we,O as ke,x as _,ad as Se,P as z,R as h,A as R,S as Pe,T as Ie,U as xe,a4 as G}from"./oEQ7_Y8u.js";const O={convertToBringUrl:function(c){let s=[];for(const C of c){const g=[];g.push(C.name),C.amount&&C.amount!==0&&g.push(C.amount+(C.unit?" "+C.unit:"")),s.push(g.join("__"))}const o=s.join("---"),t=btoa(unescape(encodeURIComponent(o)));let k="https://app-test.scansio.de/public/bring/import/"+encodeURIComponent(t)+"/bringImport.json";return k=encodeURIComponent(k),"https://api.getbring.com/rest/bringrecipes/deeplink?url="+k+"&source=web&baseQuantity=2&requestedQuantity=2"},analyzeWithNewEngine:async function(c,s){const o=w();try{return await K.post(o.lanAddress+"api/"+c+"/recipes/"+s+"/import/newEngine",{})}catch(t){p.catchError(t)}},analyzeIngredients:async function(c,s,o){const t=w();try{const r=new FormData;return r.append("image",o),await K.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image/ingredients",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},analyzeSections:async function(c,s,o){const t=w();try{const r=new FormData;return r.append("image",o),await K.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image/sections",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},uploadImage:async function(c,s,o){const t=w();try{const r=new FormData;return r.append("image",o),await K.post(t.lanAddress+"api/"+c+"/recipes/"+s+"/import/image",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(r){p.catchError(r)}},generateImage:async function(c,s){const o=w();try{return await p.post(o.lanAddress+"api/"+c+"/recipes/"+s+"/import/generateImage")}catch(t){p.catchError(t)}},loginPicnic:async function(c,s){const o=w();try{return await p.post(o.lanAddress+"api/"+c+"/loginPicnic",s)}catch(t){p.catchError(t)}},searchPicnic:async function(c,s,o,t=!1){const r=w();try{return await p.post(r.lanAddress+"api/"+c+"/picnic/search",{query:s,ingredientDescription:o,useChatGpt:t})}catch(k){p.catchError(k)}},addProductToPicnicShoppingCart:async function(c,s){const o=w();try{return await p.post(o.lanAddress+"api/"+c+"/picnic/addProductToShoppingCart",{productId:s})}catch(t){p.catchError(t)}}},Z={getRecipe:async function(c,s){const o=w();try{if(o.isNetworkAccess){let t=o.lanAddress+"api/"+c+"/recipes/"+s;return(await p.get(t)).data}else return(await p.get("https://mmhhhh.de/data/home/recipes.json")).data[s]}catch(t){p.catchError(t)}},getRecipeIngredients:async function(c,s){const o=w();try{let t;return o.isNetworkAccess?t=o.lanAddress+"api/"+c+"/recipes/"+s+"/ingredients":t="https://mmhhhh.de/data/home/recipes/"+s+"/ingredients.json",await p.get(t)}catch(t){p.catchError(t)}},getRecipeSections:async function(c,s){const o=w();try{let t;return o.isNetworkAccess?t=o.lanAddress+"api/"+c+"/recipes/"+s+"/sections":t="https://mmhhhh.de/data/home/recipes/"+s+"/sections.json",await p.get(t)}catch(t){p.catchError(t)}},updateRecipe:async function(c,s,o){const t=w();try{return await p.put(t.lanAddress+"api/"+c+"/recipes/"+s,o)}catch(r){p.catchError(r)}},uploadRecipeToGithub:async function(c,s){const o=w();let t={};s&&(t.recipeId=s);try{return await p.put(o.lanAddress+"api/"+c+"/recipes/githubUpload",t)}catch(r){p.catchError(r)}},deleteRecipe:async function(c,s){const o=w();try{return await p.post(o.lanAddress+"api/"+c+"/recipes/"+s+"/delete")}catch(t){p.catchError(t)}}},Ce={methods:{formatCurrency(c){return"€ "+(""+(Math.round(c*100)/100).toFixed(2)).replace(".",",")}}},Re=["innerHTML"],Ae={__name:"ConfirmationDialog",props:{message:{type:String,default:""},title:{type:String,default:""}},emits:["result"],setup(c,{emit:s}){const o=c,t=s,r=b(!1),k=b(o.message),C=b(o.title);let g=null;se(()=>{t("result",$=>(r.value=!0,new Promise((S,I)=>{g=S})))});function F(){g&&g(!0),r.value=!1,g=null}function M(){g&&g(!1),r.value=!1,g=null}return($,S)=>{const I=m("v-toolbar"),v=m("v-btn"),E=m("v-col"),j=m("v-row"),T=m("v-container"),A=m("v-card-text"),U=m("v-card"),D=m("v-dialog");return f(),H(D,{modelValue:r.value,"onUpdate:modelValue":S[0]||(S[0]=B=>r.value=B),onKeydown:he(M,["esc"]),"max-width":"420"},{default:u(()=>[n(U,null,{default:u(()=>[n(I,{color:"rgb(191, 208, 217)",title:C.value},null,8,["title"]),ge(n(A,null,{default:u(()=>[y("div",{style:{"margin-bottom":"30px"},innerHTML:k.value},null,8,Re),n(T,{class:"sub-grid"},{default:u(()=>[n(j,null,{default:u(()=>[n(E,{cols:"6"},{default:u(()=>[n(v,{onClick:M,style:{width:"100%"}},{default:u(()=>[...S[1]||(S[1]=[P("Abbrechen",-1)])]),_:1})]),_:1}),n(E,{cols:"6"},{default:u(()=>[n(v,{color:"secondary",onClick:F,style:{width:"100%"}},{default:u(()=>[...S[2]||(S[2]=[P(" Ja ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[_e,!!k.value]])]),_:1})]),_:1},8,["modelValue"])}}},De=ae(Ae,[["__scopeId","data-v-6b314bdd"]]),Ve={class:"d-flex justify-space-between align-center"},Ee={class:"text-medium-emphasis ps-2",style:{"font-size":"0.8em"}},Te={key:0,class:"text-h6 text-medium-emphasis"},Ue={key:0},Be={class:"text-right mt-3"},Ne={key:1,style:{width:"100%","text-align":"right"}},ze=["colspan"],je={key:0,class:"pl-6"},Le={key:0},Fe={key:1},Me={key:1,class:"py-2"},$e={style:{"font-size":"0.8em"}},Qe={key:0},Ke={key:1},Oe={key:0},Ze={key:0},He={key:1},qe={key:0,class:"px-0 mx-0"},Ge={style:{"max-width":"200px"}},Je={class:"my-2"},We={class:"my-2"},Xe={class:"my-2"},Ye={class:"text-right"},et={key:0,class:"mt-3"},tt={class:"mt-2"},nt={__name:"IngredientsDialog",emits:["result"],setup(c,{emit:s}){const o=ye(),t=w(),{authInfo:r,githubMode:k}=be(t),C=s;we(),ke();const g=b(!1),F=b(null),M=b(null),$=b(null),S=b([]),I=b([]),v=b(null),E=b(null),j=b(2),T=b(!1),A=b(!1),U=b(!1),D=b(!1),B=b({name:null,password:null});se(async()=>{C("result",async l=>(Array.isArray(l)?S.value=l:S.value=[l],E.value=null,I.value=[],v.value=null,U.value=!1,D.value=!1,A.value=!1,j.value=2,J(),await oe(!0),g.value=!0,new Promise((e,i)=>{F.value=e,M.value=i})))});async function J(){let l=await t.getAuthInfo();T.value=l.picnicLoggedIn}async function oe(l){let e=[];for(const i of S.value){const d=await Z.getRecipe(r.value.userId,i);d.ingredients=(await Z.getRecipeIngredients(r.value.userId,i)).data,e.push(d)}I.value=e,X(l)}async function ie(){await O.loginPicnic(r.value.userId,B.value),await J()}async function le(){let l=!1;for(const e of I.value)e.planned&&!e.ordered&&(l=!0);l?$.value().then(async e=>{if(e){for(const i of I.value)if(i.planned&&!i.ordered){const d={ordered:!0};await Z.updateRecipe(r.value.userId,i.id,d)}}g.value=!1,F.value(!0)}):(g.value=!1,F.value(!1))}async function W(){let l=v.value.filter(e=>e.bring);E.value=O.convertToBringUrl(l)}async function re(){let l=v.value.filter(d=>d.picnic);for(const d of l)if(d.selectedPicnicProduktId){let x=d.picnicResults.find(N=>N.id===d.selectedPicnicProduktId).multiplier;x||(x=1);for(let N=1;N<=x;N++)await O.addProductToPicnicShoppingCart(r.value.userId,d.selectedPicnicProduktId)}A.value=!0;const i={picnicPurchaseDate:new Date().toISOString()};for(const d of S.value)await Z.updateRecipe(r.value.userId,d,i)}function X(l){v.value=[];for(const e of I.value){let i=e.portions?e.portions:2;e.ingredients.forEach(d=>{v.value.push({name:d.name,basicName:d.basicName,genericName:d.genericName?d.genericName:"Sonstiges",unit:d.unit,amount:Math.ceil(d.amount/i*j.value),standardIngredient:d.standardIngredient})})}l&&ce(),W()}function ce(){v.value.forEach(l=>{l.standardIngredient?(l.bring=!1,l.picnic=!1):(l.bring=!0,l.picnic=!1)}),D.value=v.value.filter(l=>!!l.bring).length>0,v.value=v.value.sort((l,e)=>{let i=0;return!l.bring&&!e.bring&&(i=0),!l.bring&&e.bring&&(i=1),l.bring&&!e.bring&&(i=-1),l.bring&&e.bring&&(i=0),i!==0?i:l.genericName.localeCompare(e.genericName)})}async function ue(){v.value.forEach(l=>{l.bring&&Q("picnic",l)})}async function Q(l,e){if(l==="bring")e.bring=!0,e.picnic=!1,U.value=v.value.filter(i=>!!i.picnic).length>0,D.value=v.value.filter(i=>!!i.bring).length>0;else if(l==="picnic"){e.loading=!0,e.bring=!1,e.picnic=!0;const i=e.amount+" "+(e.unit?e.unit+" ":"")+e.name;e.picnicResults=(await O.searchPicnic(r.value.userId,e.basicName,i,!0)).data,e.picnicResults&&e.picnicResults.length>0?e.selectedPicnicProduktId=e.picnicResults[0].id:(e.selectedPicnicProduktId=null,e.bring=!0,e.picnic=!1),U.value=v.value.filter(d=>!!d.picnic).length>0,D.value=v.value.filter(d=>!!d.bring).length>0,e.loading=!1}else e.bring=!1,e.picnic=!1,U.value=v.value.filter(i=>!!i.picnic).length>0,D.value=v.value.filter(i=>!!i.bring).length>0;W()}return(l,e)=>{const i=m("v-btn"),d=m("v-card-title"),x=m("v-img"),N=m("v-text-field"),Y=m("v-card-text"),ee=m("v-card"),te=m("v-select"),ne=m("v-icon"),de=m("v-progress-linear"),pe=m("v-list-item"),q=m("v-col"),me=m("v-row"),fe=m("v-table"),ve=m("v-dialog");return f(),_("div",null,[n(ve,{"max-width":"600",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),fullscreen:z(o).smAndDown.value},{default:u(()=>[n(ee,{style:{"background-color":"white"},class:Se({"pa-4":!z(o).smAndDown.value})},{default:u(()=>[n(d,{style:{"white-space":"normal"}},{default:u(()=>[y("div",Ve,[y("div",Ee,[e[6]||(e[6]=P(" Zutaten einkaufen ",-1)),I.value?(f(),_("div",Te,R(I.value.map(a=>a.title).join(", ")),1)):h("",!0)]),n(i,{icon:"mdi-close",variant:"text",onClick:le})])]),_:1}),n(Y,null,{default:u(()=>[I.value?(f(),_("div",Ue,[!T.value&&!z(k)?(f(),H(ee,{key:0,class:"mb-4"},{default:u(()=>[n(d,null,{default:u(()=>[n(x,{src:"/images/picnic.png",width:"42",inline:"",class:"mt-2"}),e[7]||(e[7]=P(" Bei Picnic einloggen ",-1))]),_:1}),n(Y,null,{default:u(()=>[n(N,{modelValue:B.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>B.value.name=a),"hide-details":"auto",label:"Benutzername"},null,8,["modelValue"]),n(N,{modelValue:B.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>B.value.password=a),class:"mt-2","hide-details":"auto",label:"Passwort",type:"password"},null,8,["modelValue"]),y("div",Be,[n(i,{variant:"outlined",onClick:ie},{default:u(()=>[...e[8]||(e[8]=[P("Einloggen",-1)])]),_:1})])]),_:1})]),_:1})):h("",!0),e[13]||(e[13]=y("h3",null,"Anzahl Portionen",-1)),n(te,{modelValue:j.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>j.value=a),X],label:"Bitte auswählen",items:[1,2,3,4,5,6,7,8,9,10]},null,8,["modelValue"]),e[14]||(e[14]=y("h3",null,"Zutatenliste",-1)),z(k)?h("",!0):(f(),_("div",Ne,[n(i,{variant:"flat",onClick:e[3]||(e[3]=a=>ue()),class:"mb-1 my-1"},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",contain:"",class:"mr-2"}),e[9]||(e[9]=P(" Alles bei Picnic einkaufen ",-1))]),_:1})])),n(fe,{class:"table-ingredients"},{default:u(()=>[y("tbody",null,[(f(!0),_(Pe,null,Ie(v.value,a=>(f(),_("tr",{key:a.name},[y("td",{colspan:a.picnic?2:1,style:{"min-width":"70px"},class:"px-0 mx-0"},[a.picnic?h("",!0):(f(),_("div",je,[a.amount?(f(),_("span",Le,R(a.amount),1)):h("",!0),e[10]||(e[10]=P()),a.unit?(f(),_("span",Fe,R(a.unit),1)):h("",!0)])),a.picnic?(f(),_("div",Me,[y("div",$e,[n(ne,{icon:"mdi-arrow-right"}),e[11]||(e[11]=P()),a.amount?(f(),_("span",Qe,R(a.amount),1)):h("",!0),e[12]||(e[12]=P()),a.unit?(f(),_("span",Ke,R(a.unit),1)):h("",!0),P(" "+R(a.name),1)]),a.picnic?(f(),_("div",Oe,[a.loading?(f(),H(de,{key:0,indeterminate:""})):h("",!0),n(te,{modelValue:a.selectedPicnicProduktId,"onUpdate:modelValue":L=>a.selectedPicnicProduktId=L,label:"Bitte Produkt auswählen",items:a.picnicResults,"item-title":"name","item-value":"id","hide-details":"",disabled:a.loading},{item:u(({props:L,item:V})=>[n(pe,xe({ref_for:!0},L),{default:u(()=>[y("h4",null,[V.raw.multiplier&&V.raw.multiplier>1?(f(),_("span",Ze,R(V.raw.multiplier)+"x ",1)):h("",!0),V.raw.unitQuantity&&V.raw.unitQuantity!=="undefined"?(f(),_("span",He,R(V.raw.unitQuantity),1)):h("",!0)]),y("h5",null,R(z(Ce).methods.formatCurrency(V.raw.price/100)),1),n(x,{src:`https://storefront-prod.de.picnicinternational.com/static/images/${V.raw.imageId}/medium.png`,"max-height":"100"},null,8,["src"])]),_:2},1040)]),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])])):h("",!0)])):h("",!0)],8,ze),a.picnic?h("",!0):(f(),_("td",qe,R(a.name),1)),y("td",Ge,[n(me,{class:"px-0 mx-0",style:{width:"180px"}},{default:u(()=>[n(q,{cols:"3"},{default:u(()=>[y("div",Je,[n(i,{variant:"flat",style:G({opacity:a.bring?1:.3}),onClick:L=>Q("bring",a),class:"mx-0"},{default:u(()=>[n(x,{src:"/images/bring.png",width:"32",contain:""})]),_:1},8,["style","onClick"])])]),_:2},1024),z(k)?h("",!0):(f(),H(q,{key:0,cols:"3"},{default:u(()=>[y("div",We,[n(i,{variant:"plain",style:G({opacity:a.picnic?1:.3}),disabled:!T.value||A.value,onClick:L=>Q("picnic",a)},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",contain:""})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)),n(q,{cols:"4"},{default:u(()=>[y("div",Xe,[n(i,{variant:"plain",style:G({opacity:!a.bring&&!a.picnic?1:.3}),disabled:!T.value||A.value,onClick:L=>Q(null,a)},{default:u(()=>[n(ne,{icon:"mdi-selection-remove",size:"34"})]),_:1},8,["style","disabled","onClick"])])]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1})])):h("",!0),y("div",Ye,[z(k)?h("",!0):(f(),_("div",et,[n(i,{variant:"outlined",rounded:"",onClick:re,"prepend-icon":A.value?"mdi-check":null,disabled:!T.value||A.value||!U.value},{default:u(()=>[n(x,{src:"/images/picnic.png",width:"32",inline:"",class:"mr-2"}),e[15]||(e[15]=P(" In Picnic importieren ",-1))]),_:1},8,["prepend-icon","disabled"])])),y("div",tt,[n(i,{link:"",variant:"outlined",rounded:"",href:E.value,disabled:E.value===null||!D.value,target:"_blank",class:"ml-2"},{default:u(()=>[n(x,{src:"/images/bring.png",width:"32",inline:"",class:"mr-2"}),e[16]||(e[16]=P(" In Bring importieren ",-1))]),_:1},8,["href","disabled"])])])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","fullscreen"]),n(De,{onResult:e[5]||(e[5]=a=>$.value=a),title:"Bitte bestätigen",message:"Sollen alle Rezepte auf 'Zutaten eingekauft' gesetzt werden?"})])}}},st=ae(nt,[["__scopeId","data-v-3ba97901"]]);export{De as C,st as I,Z as R,O as a};
